{
  "_metadata": {
    "bundle_id": "CMGT_Entity_-_urnappiantranslation-stringv190287ce4-b093-4050-8585-ca186b1e0243"
  },
  "objects": {
    "_a-0000eb32-20f6-8000-9c60-011c48011c48_1482791": {
      "name": "CMGT_Contact_Details",
      "type": "Interface",
      "sail_code": "a!localVariables(\n  local!required: and(\n    not(a!defaultValue(ri!disabled, false)),\n    not(a!defaultValue(ri!readOnly, false))\n  ),\n  local!isAddressRelatedFieldsRequired: and(\n    any(\n      a!isNotNullOrEmpty,\n      {\n        ri!entity[recordType!CMGT_Entity.person.streetAddress],\n        ri!entity[recordType!CMGT_Entity.person.addressLine2],\n        ri!entity[recordType!CMGT_Entity.person.city],\n        ri!entity[recordType!CMGT_Entity.person.stateProvId],\n        ri!entity[recordType!CMGT_Entity.person.postalCode]\n      }\n    ),\n    local!required\n  ),\n  {\n    /*Name*/\n    #\"SYSTEM_SYSRULES_columnsLayout\"(\n      columns: {\n        #\"SYSTEM_SYSRULES_columnLayout\"(\n          contents: {\n            /*First Name*/\n            #\"SYSTEM_SYSRULES_textField\"(\n              label: #\"urn:appian:translation-string:v1:a98538d8-6e54-425f-a476-6b5a770eb222\",\n              labelPosition: \"ABOVE\",\n              value: ri!entity[recordType!CMGT_Entity.person.firstName],\n              saveInto: a!save(\n                ri!entity[recordType!CMGT_Entity.person.firstName],\n                trim(save!value)\n              ),\n              refreshAfter: \"UNFOCUS\",\n              characterLimit: cons!CMGT_INT_MAX_CHAR_LIMIT_MEDIUM,\n              showCharacterCount: false(),\n              required: local!required,\n              requiredMessage: #\"urn:appian:translation-string:v1:4fab94dc-fcb1-427a-af9f-1239079b2897\"(\n                #\"urn:appian:translation-variable:v1:3e31b6d5-df20-4d17-80a7-81f3c83ff370\": #\"urn:appian:translation-string:v1:a98538d8-6e54-425f-a476-6b5a770eb222\"\n              ),\n              readOnly: ri!readOnly,\n              disabled: ri!disabled,\n              accessibilityText: if(\n                a!isNotNullOrEmpty(ri!index),\n                #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n                  #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n                ),\n                null\n              ),\n              inputPurpose: \"NAME\"\n            )\n          }\n        ),\n        #\"SYSTEM_SYSRULES_columnLayout\"(\n          contents: {\n            /*Middle Initial*/\n            #\"SYSTEM_SYSRULES_textField\"(\n              label: #\"urn:appian:translation-string:v1:ab3f3862-768c-4661-8930-befd0a22779b\",\n              labelPosition: \"ABOVE\",\n              value: ri!entity[recordType!CMGT_Entity.person.middleInitial],\n              saveInto: a!save(\n                ri!entity[recordType!CMGT_Entity.person.middleInitial],\n                trim(save!value)\n              ),\n              refreshAfter: \"UNFOCUS\",\n              characterLimit: 1,\n              showCharacterCount: false(),\n              required: false,\n              readOnly: ri!readOnly,\n              disabled: ri!disabled,\n              accessibilityText: if(\n                a!isNotNullOrEmpty(ri!index),\n                #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n                  #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n                ),\n                null\n              )\n            )\n          },\n          width: \"NARROW\"\n        ),\n        #\"SYSTEM_SYSRULES_columnLayout\"(\n          contents: {\n            /*Name/Last Name*/\n            #\"SYSTEM_SYSRULES_textField\"(\n              label: #\"urn:appian:translation-string:v1:ec4b5229-54c6-4ca8-aa38-b6331fd5906e\",\n              labelPosition: \"ABOVE\",\n              value: ri!entity[recordType!CMGT_Entity.person.lastName],\n              saveInto: a!save(\n                ri!entity[recordType!CMGT_Entity.person.lastName],\n                trim(save!value)\n              ),\n              refreshAfter: \"UNFOCUS\",\n              characterLimit: cons!CMGT_INT_MAX_CHAR_LIMIT_MEDIUM,\n              showCharacterCount: false(),\n              required: local!required,\n              requiredMessage: #\"urn:appian:translation-string:v1:4fab94dc-fcb1-427a-af9f-1239079b2897\"(\n                #\"urn:appian:translation-variable:v1:3e31b6d5-df20-4d17-80a7-81f3c83ff370\": #\"urn:appian:translation-string:v1:ec4b5229-54c6-4ca8-aa38-b6331fd5906e\"\n              ),\n              readOnly: ri!readOnly,\n              disabled: ri!disabled,\n              accessibilityText: if(\n                a!isNotNullOrEmpty(ri!index),\n                #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n                  #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n                ),\n                null\n              )\n            )\n          }\n        )\n      },\n      spacing: \"DENSE\",\n      stackWhen: { \"PHONE\", \"TABLET_PORTRAIT\" }\n    ),\n    /*Street Address*/\n    #\"SYSTEM_SYSRULES_textField\"(\n      label: #\"urn:appian:translation-string:v1:9342e41e-1d92-4525-9916-e824e6c420b8\",\n      labelPosition: \"ABOVE\",\n      value: ri!entity[recordType!CMGT_Entity.person.streetAddress],\n      saveInto: a!save(\n        ri!entity[recordType!CMGT_Entity.person.streetAddress],\n        trim(save!value)\n      ),\n      refreshAfter: \"UNFOCUS\",\n      characterLimit: 100,\n      showCharacterCount: false(),\n      required: local!isAddressRelatedFieldsRequired,\n      requiredMessage: #\"urn:appian:translation-string:v1:4fab94dc-fcb1-427a-af9f-1239079b2897\"(\n        #\"urn:appian:translation-variable:v1:3e31b6d5-df20-4d17-80a7-81f3c83ff370\": #\"urn:appian:translation-string:v1:9342e41e-1d92-4525-9916-e824e6c420b8\"\n      ),\n      readOnly: ri!readOnly,\n      disabled: ri!disabled,\n      accessibilityText: if(\n        a!isNotNullOrEmpty(ri!index),\n        #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n          #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n        ),\n        null\n      ),\n      inputPurpose: \"STREET_ADDRESS\"\n    ),\n    /*Address Line 2*/\n    #\"SYSTEM_SYSRULES_textField\"(\n      label: #\"urn:appian:translation-string:v1:2a73df09-06f8-43bc-bc1d-0dcd2bcd611a\",\n      labelPosition: \"ABOVE\",\n      value: ri!entity[recordType!CMGT_Entity.person.addressLine2],\n      saveInto: a!save(\n        ri!entity[recordType!CMGT_Entity.person.addressLine2],\n        trim(save!value)\n      ),\n      refreshAfter: \"UNFOCUS\",\n      characterLimit: 100,\n      showCharacterCount: false(),\n      required: false,\n      requiredMessage: #\"urn:appian:translation-string:v1:4fab94dc-fcb1-427a-af9f-1239079b2897\"(\n        #\"urn:appian:translation-variable:v1:3e31b6d5-df20-4d17-80a7-81f3c83ff370\": #\"urn:appian:translation-string:v1:2a73df09-06f8-43bc-bc1d-0dcd2bcd611a\"\n      ),\n      readOnly: ri!readOnly,\n      disabled: ri!disabled,\n      accessibilityText: if(\n        a!isNotNullOrEmpty(ri!index),\n        #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n          #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n        ),\n        null\n      )\n    ),\n    #\"SYSTEM_SYSRULES_columnsLayout\"(\n      columns: {\n        #\"SYSTEM_SYSRULES_columnLayout\"(\n          contents: {\n            /*City*/\n            #\"SYSTEM_SYSRULES_textField\"(\n              label: #\"urn:appian:translation-string:v1:ad0362f8-6eb8-4007-b374-5a059db9208a\",\n              labelPosition: \"ABOVE\",\n              value: ri!entity[recordType!CMGT_Entity.person.city],\n              saveInto: a!save(\n                ri!entity[recordType!CMGT_Entity.person.city],\n                trim(save!value)\n              ),\n              refreshAfter: \"UNFOCUS\",\n              characterLimit: 100,\n              showCharacterCount: false(),\n              required: local!isAddressRelatedFieldsRequired,\n              requiredMessage: #\"urn:appian:translation-string:v1:4fab94dc-fcb1-427a-af9f-1239079b2897\"(\n                #\"urn:appian:translation-variable:v1:3e31b6d5-df20-4d17-80a7-81f3c83ff370\": #\"urn:appian:translation-string:v1:ad0362f8-6eb8-4007-b374-5a059db9208a\"\n              ),\n              readOnly: ri!readOnly,\n              disabled: ri!disabled,\n              accessibilityText: if(\n                a!isNotNullOrEmpty(ri!index),\n                #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n                  #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n                ),\n                null\n              )\n            )\n          }\n        ),\n        #\"SYSTEM_SYSRULES_columnLayout\"(\n          contents: {\n            /*State/Province*/\n            if(\n              ri!readOnly,\n              #\"SYSTEM_SYSRULES_textField\"(\n                label: #\"urn:appian:translation-string:v1:be813c67-3fe0-43c7-8b0b-b573b879fdb0\",\n                value: ri!entity[recordType!CMGT_Person.stateProvince.code],\n                readOnly: true,\n                accessibilityText: if(\n                  a!isNotNullOrEmpty(ri!index),\n                  #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n                    #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n                  ),\n                  null\n                )\n              ),\n              #\"SYSTEM_SYSRULES_dropdownField_v1\"(\n                data: #\"SYSTEM_SYSRULES_recordData\"(\n                  recordType: recordType!CMGT_CFG_StateProvince,\n                  filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                    operator: \"OR\",\n                    filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n                      field: recordType!CMGT_CFG_StateProvince.countryId,\n                      operator: \"=\",\n                      value: ri!entity[recordType!CMGT_Entity.person.stateProvince.country.countryId],\n                      applyWhen: a!isNotNullOrEmpty(\n                        ri!entity[recordType!CMGT_Entity.person.stateProvince.country.countryId]\n                      )\n                    )\n                  ),\n                  relatedRecordData: #\"SYSTEM_SYSRULES_relatedRecordData\"(\n                    relationship: recordType!CMGT_CFG_StateProvince.country\n                  )\n                ),\n                choiceLabels: recordType!CMGT_CFG_StateProvince.name,\n                choiceValues: recordType!CMGT_CFG_StateProvince.stateProvId,\n                label: #\"urn:appian:translation-string:v1:be813c67-3fe0-43c7-8b0b-b573b879fdb0\",\n                placeholder: #\"urn:appian:translation-string:v1:994dbec3-efff-4ab7-a2e3-9c04c0862b62\",\n                value: if(\n                  rule!CMGT_UTIL_IsBlank(\n                    ri!entity[recordType!CMGT_Entity.person.stateProvId]\n                  ),\n                  null,\n                  ri!entity[recordType!CMGT_Entity.person.stateProvId]\n                ),\n                saveInto: {\n                  ri!entity[recordType!CMGT_Entity.person.stateProvId],\n                  a!save(\n                    ri!entity[recordType!CMGT_Entity.person],\n                    rule!CMGT_QR_GetStateProvince(\n                      returnType: \"SINGLE_OBJECT\",\n                      executeWhen: true,\n                      stateProvId: ri!entity[recordType!CMGT_Entity.person.stateProvId]\n                    )\n                  )\n                },\n                required: local!isAddressRelatedFieldsRequired,\n                requiredMessage: #\"urn:appian:translation-string:v1:4fab94dc-fcb1-427a-af9f-1239079b2897\"(\n                  #\"urn:appian:translation-variable:v1:3e31b6d5-df20-4d17-80a7-81f3c83ff370\": #\"urn:appian:translation-string:v1:be813c67-3fe0-43c7-8b0b-b573b879fdb0\"\n                ),\n                disabled: ri!disabled,\n                accessibilityText: if(\n                  a!isNotNullOrEmpty(ri!index),\n                  #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n                    #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n                  ),\n                  null\n                )\n              )\n            )\n          },\n          width: \"NARROW\",\n          showWhen: a!isNotNullOrEmpty(\n            ri!entity[recordType!CMGT_Entity.person.countryId]\n          )\n        ),\n        #\"SYSTEM_SYSRULES_columnLayout\"(\n          contents: {\n            /*Postal Code*/\n            #\"SYSTEM_SYSRULES_textField\"(\n              label: #\"urn:appian:translation-string:v1:59af4775-76be-439d-ac0f-eaeafd1a2b93\",\n              labelPosition: \"ABOVE\",\n              value: ri!entity[recordType!CMGT_Entity.person.postalCode],\n              saveInto: {\n                a!save(\n                  ri!entity[recordType!CMGT_Entity.person.postalCode],\n                  trim(save!value)\n                )\n              },\n              refreshAfter: \"UNFOCUS\",\n              characterLimit: 10,\n              showCharacterCount: false(),\n              required: local!isAddressRelatedFieldsRequired,\n              requiredMessage: #\"urn:appian:translation-string:v1:4fab94dc-fcb1-427a-af9f-1239079b2897\"(\n                #\"urn:appian:translation-variable:v1:3e31b6d5-df20-4d17-80a7-81f3c83ff370\": #\"urn:appian:translation-string:v1:59af4775-76be-439d-ac0f-eaeafd1a2b93\"\n              ),\n              readOnly: ri!readOnly,\n              disabled: ri!disabled,\n              validations: {\n                if(\n                  a!isNotNullOrEmpty(\n                    stripwith(\n                      tostring(\n                        ri!entity[recordType!CMGT_Entity.person.postalCode]\n                      ),\n                      \"0123456789-\"\n                    )\n                  ),\n                  #\"urn:appian:translation-string:v1:07e53085-2964-45dc-b91f-d4209c433f84\",\n                  null\n                )\n              },\n              accessibilityText: if(\n                a!isNotNullOrEmpty(ri!index),\n                #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n                  #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n                ),\n                null\n              ),\n              inputPurpose: \"POSTAL_CODE\"\n            )\n          }\n        )\n      },\n      spacing: \"DENSE\",\n      stackWhen: { \"PHONE\", \"TABLET_PORTRAIT\" }\n    ),\n    #\"SYSTEM_SYSRULES_columnsLayout\"(\n      columns: {\n        #\"SYSTEM_SYSRULES_columnLayout\"(\n          contents: {\n            /*Phone Number*/\n            #\"SYSTEM_SYSRULES_textField\"(\n              label: #\"urn:appian:translation-string:v1:dc8e6e92-959d-432c-ba6f-96f144596d49\",\n              labelPosition: \"ABOVE\",\n              value: if(\n                a!isPhoneNumber(\n                  phoneNumber: tostring(\n                    ri!entity[recordType!CMGT_Entity.person.mobilePhone]\n                  ),\n                  countryCode: cons!CMGT_TXT_PHONE_COUNTRY_CODES\n                ),\n                a!formatPhoneNumber(\n                  phoneNumber: ri!entity[recordType!CMGT_Entity.person.mobilePhone],\n                  countryCode: cons!CMGT_TXT_PHONE_COUNTRY_CODES,\n                  outputFormat: cons!CMGT_TXT_PHONE_OUTPUT_FORMAT\n                ),\n                ri!entity[recordType!CMGT_Entity.person.mobilePhone]\n              ),\n              saveInto: a!save(\n                ri!entity[recordType!CMGT_Entity.person.mobilePhone],\n                trim(cleanwith(save!value, \"0123456789\"))\n              ),\n              refreshAfter: \"UNFOCUS\",\n              required: false(),\n              readOnly: ri!readOnly,\n              disabled: ri!disabled,\n              validations: if(\n                a!isPhoneNumber(\n                  phoneNumber: tostring(\n                    ri!entity[recordType!CMGT_Entity.person.mobilePhone]\n                  ),\n                  countryCode: { \"US\", \"GB\", \"DE\" }\n                ),\n                null,\n                #\"urn:appian:translation-string:v1:43b0daa9-b501-4e7b-a5e5-8a21855726fb\"\n              ),\n              accessibilityText: if(\n                a!isNotNullOrEmpty(ri!index),\n                #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n                  #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n                ),\n                null\n              ),\n              inputPurpose: \"PHONE_NUMBER\"\n            )\n          }\n        ),\n        #\"SYSTEM_SYSRULES_columnLayout\"(\n          contents: {\n            /*Email*/\n            #\"SYSTEM_SYSRULES_textField\"(\n              label: #\"urn:appian:translation-string:v1:e5740ff4-4bcb-4f66-b44b-3c39099f1863\",\n              labelPosition: \"ABOVE\",\n              value: ri!entity[recordType!CMGT_Entity.person.email],\n              saveInto: {\n                a!save(\n                  ri!entity[recordType!CMGT_Entity.person.email],\n                  trim(save!value)\n                ),\n                a!save(\n                  ri!entity[recordType!CMGT_Entity.identifyingAttribute1],\n                  trim(save!value)\n                )\n              },\n              refreshAfter: \"UNFOCUS\",\n              characterLimit: cons!CMGT_INT_MAX_CHAR_LIMIT_MEDIUM,\n              showCharacterCount: false(),\n              required: local!required,\n              requiredMessage:#\"urn:appian:translation-string:v1:4fab94dc-fcb1-427a-af9f-1239079b2897\"(#\"urn:appian:translation-variable:v1:3e31b6d5-df20-4d17-80a7-81f3c83ff370\":#\"urn:appian:translation-string:v1:e5740ff4-4bcb-4f66-b44b-3c39099f1863\"),\n              readOnly: ri!readOnly,\n              disabled: or(ri!disabled, ri!isEmailDisabled),\n              validations: {\n                rule!CMGT_UTIL_ValidateEmail(\n                  textInput: ri!entity[recordType!CMGT_Entity.person.email]\n                ),\n                ri!additionalEmailValidations\n              },\n              accessibilityText: if(\n                a!isNotNullOrEmpty(ri!index),\n                #\"urn:appian:translation-string:v1:3d90fd59-19e1-435a-8e39-69d466e1afea\"(\n                  #\"urn:appian:translation-variable:v1:cba6fdf3-f6fa-473b-8099-039df3266263\": ri!index\n                ),\n                null\n              ),\n              inputPurpose: \"EMAIL\"\n            )\n          }\n        )\n      },\n      stackWhen: { \"PHONE\", \"TABLET_PORTRAIT\" }\n    )\n  }\n)"
    },
    "9248008e-2c2c-4eea-bb28-4a3c89838403": {
      "name": "CMGT_UTIL_RemoveRecordRelationshipsWithSingleKey_Reducer",
      "type": "Expression Rule",
      "sail_code": "if(\n  runtimetypeof(ri!key) <> 'type!{http://www.appian.com/ae/types/2009}RecordRelationship',\n  ri!record,\n  a!match(\n    value: index(ri!record, ri!key, null),\n    whenTrue: count(fv!value) = 1,\n    then: with(\n      local!indexedValue: index(\n        ri!record,\n        ri!key,\n        1,\n        index(ri!record, ri!key, null)\n      ),\n      local!subKeys: a!keys(local!indexedValue),\n      if(\n        length(local!subKeys) = 1,\n        remove(ri!record, ri!key),\n        #\"urn:appian:function:v1:a:update\"(\n          ri!record,\n          ri!key,\n          reduce(\n            rule!CMGT_UTIL_RemoveRecordRelationshipsWithSingleKey_Reducer(record: _, key: _),\n            local!indexedValue,\n            local!subKeys\n          )\n        )\n      )\n    ),\n    default: ri!record\n  )\n)"
    },
    "_a-0000eaa7-a5c0-8000-9c22-011c48011c48_973190": {
      "name": "CMGT_UTIL_MergeWriteRecordIdsToProcessVariable",
      "type": "Expression Rule",
      "sail_code": "/*\nThe main rule to merge the ID-output of a WriteRecords SS node back to the input process variable.\n\nSTANDARD USAGE:\n- Use this in tandem with rule CMGT_UTIL_DropNonWritableRelationshipsFromRecord (see that description)\n- In the output of a WriteRecords SS, do:\n  A - New Custom Output\n  B - rule!CMGT_UTIL_MergeWriteRecordIdsToProcessVariable(\n        processData: pv![the pv your wrote],\n        recordsUpdated: ac!RecordsUpdated,\n        fksToParent: {list of record fields that are FKs to the primary PK you wrote}\n      )\n  C - Save this back to the pv you wrote\n\nMAPPING FKS:\n- Using this rule in the current state, child-FKs can only be set \nwhere they map back to the primary record type, using input \"fksToParent\".\n  -> For example, if you are writing \"Case\", \n    - you could set \"Case.Comment.caseId\"\n    - you could set \"Case.Comment.Replies.caseId\"\n    - but not \"Case.Comment.Replies.commentId\" (since the FK \"commentId\" is not the PK of \"Case\")\n- To set other foreign keys, you would have to run manual update rules using the result of this.\nNote:\n- \"fksToParent\" is optimized for 1:M relationships.\n  - Setting an fkToParent for a 1:1 will create an instance of that child record if it is null.\n\nIMPORTANT GENERAL NOTES: \n- The result of THIS rule will have data that IS considered changed, \nso a designer should be cautious about re-writing this later in process \nas it could cause race condition and performance side affects.\n\n- Also, the result of this WILL NOT have custom-fields calculated, \nsince they can be changed as a result of the write, but this rule is not re-querying.\nIf you need these, then re-query.\n\n- This should generally only be used for downstream flows that don't write it directly again, \nsuch as document processing, emails, etc.\n*/\nif(\n  or(\n    runtimetypeof(ri!recordsUpdated) = runtimetypeof(a!flatten(ri!recordsUpdated)),\n    runtimetypeof(ri!recordsUpdated) = 'type!{http://www.appian.com/ae/types/2009}Variant?list'\n  ),\n  if(\n    count(a!flatten(ri!recordsUpdated)) = 0,\n    ri!processData,\n    #\"SYSTEM_SYSRULES_forEach\"(\n      items: enumerate(count(a!flatten(ri!recordsUpdated))),\n      expression: rule!CMGT_UTIL_MergeWriteRecordIdsToProcessVariable(\n        processData: a!flatten(ri!processData)[fv!index],\n        recordsUpdated: cast(\n          runtimetypeof(a!flatten(ri!processData)),\n          ri!recordsUpdated\n        )[fv!index],\n        fksToParent: ri!fksToParent\n      )\n    )\n  ),\n  a!localVariables(\n    local!keys: #\"SYSTEM_SYSRULES_forEach\"(\n      items: a!keys(ri!recordsUpdated),\n      expression: a!map(\n        key: fv!item,\n        isPrimaryKey: runtimetypeof(fv!item) = 'type!{http://www.appian.com/ae/types/2009}RecordField'\n      )\n    ),\n    local!keysOrganized: rule!CMGT_UTIL_Filter(\n      records: local!keys,\n      field: \"isPrimaryKey\",\n      value: true,\n      filterType: \"FULL_RESULT\"\n    ),\n    local!primaryKeyField: local!keysOrganized.firstMatch.key,\n    local!updates: rule!CMGT_UTIL_SetRecordFields(\n      record: ri!processData,\n      neverOverwrite: {\n        a!map(\n          field: local!primaryKeyField,\n          value: ri!recordsUpdated[local!primaryKeyField]\n        ),\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: ri!fksToParent,\n          expression: a!map(\n            field: fv!item,\n            value: ri!recordsUpdated[local!primaryKeyField],\n            /*Children get complicated, and an update should only run if a child is actually attached*/\n            applyWhen: a!match(\n              value: runtimetypeof(ri!processData[fv!item]),\n              equals: runtimetypeof(a!flatten(ri!processData[fv!item])),\n              then: count(ri!processData[fv!item]) > 0,\n              equals: tointeger(\n                'type!{http://www.appian.com/ae/types/2009}Variant?list'\n              ),\n              then: or(\n                #\"SYSTEM_SYSRULES_forEach\"(\n                  items: ri!processData[fv!item],\n                  expression: a!isNotNullOrEmpty(fv!item)\n                )\n              ),\n              default: a!isNotNullOrEmpty(ri!processData[fv!item])\n            )\n          )\n        )\n      },\n      childRelationships: #\"SYSTEM_SYSRULES_forEach\"(\n        items: local!keysOrganized.rejects,\n        expression: a!map(\n          field: fv!item.key,\n          value: if(\n            rule!CMGT_UTIL_IsBlank(ri!processData[fv!item.key]),\n            ri!recordsUpdated[fv!item.key],\n            rule!CMGT_UTIL_MergeWriteRecordIdsToProcessVariable(\n              processData: ri!processData[fv!item.key],\n              recordsUpdated: ri!recordsUpdated[fv!item.key],\n              fksToParent: {}\n            )\n          )\n        )\n      )\n    ),\n    /*reduce over updates to remove any relationships that were incorrectly created with just an fk*/\n    if(\n      a!isNullOrEmpty(ri!fksToParent),\n      local!updates,\n      reduce(\n        rule!CMGT_UTIL_RemoveRecordRelationshipsWithSingleKey_Reducer(record: _, key: _),\n        local!updates,\n        a!keys(local!updates)\n      )\n    )\n  )\n)"
    },
    "_a-0000eb4d-d051-8000-9c68-011c48011c48_1674490": {
      "name": "CMGT_MTR_UserEditsEntity",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "5871189e-5b69-4276-978a-e1c5e4263102": {
      "name": "CMGT_QR_GetEntity",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_Entity,\n  returnType: ri!returnType,\n  triggerRefresh: ri!triggerRefresh,\n  executeWhen: ri!executeWhen,\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Entity.entityId,\n      operator: \"in\",\n      value: ri!entityId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Entity.isActive,\n      operator: \"=\",\n      value: true,\n      applyWhen: not(\n        a!defaultValue(ri!includeInactive, false)\n      )\n    )\n  },\n  logicalExpressions: ri!additionalLogicalExpression,\n  fields: {\n    ri!fields,\n    if(\n      ri!excludeRelatedRecords,\n      {},\n      {\n        recordType!CMGT_Entity.entityType,\n        recordType!CMGT_Entity.entityCategory,\n        recordType!CMGT_Entity.person\n      }\n    )\n  },\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  relatedRecordData: ri!relatedRecordData,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000eaab-5303-8000-9c24-011c48011c48_994738": {
      "name": "CMGT_formatEventInitiator",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!user: rule!CMGT_QR_GetUser(\n    username: ri!initiator,\n    returnType: \"SINGLE_OBJECT\"\n  ),\n  if(\n    rule!CMGT_UTIL_IsBlank(local!user),\n    ri!initiator,\n    if(\n      or(\n        local!user[#\"urn:appian:record-field:v1:SYSTEM_RECORD_TYPE_USER/SYSTEM_RECORD_TYPE_USER_FIELD_isServiceAccount\"] = true,\n        #\"urn:appian:function:v1:a:isusermemberofgroup?okey=a!isUserMemberOfGroup\"(\n          username: ri!initiator,\n          groups: cons!CMGT_GRP_SERVICE_ACCOUNTS\n        )\n      ),\n      cons!CMGT_TXT_AUTOMATED_SYSTEM,\n      ri!initiator\n    )\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_25890": {
      "name": "CMGT_UTIL_IsBlank",
      "type": "Expression Rule",
      "sail_code": "length(a!flatten(ri!value)) = 0"
    },
    "_a-0000eaba-1e20-8000-9c2a-011c48011c48_1039881": {
      "name": "CMGT_RelatedEntityMap_SetEvents",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!relatedEntityMaps,\n  expression: /*EVENTS THAT ARE PROCESS-SPECIFIC (based on \"eventType\" input)*/\n  a!match(\n    value: ri!eventType,\n    equals: \"DELETE\",\n    then: rule!CMGT_EntityEventHistory_Constructor(\n      entityId: fv!item[recordType!CMGT_RelatedEntityMap.entityId],\n      initiator: ri!initiator,\n      eventTypeId: cons!CMGT_REFID_EVENT_TYPE_ENTITY_REMOVE_RELATED_ENTITY,\n      details: a!map(\n        relatedEntityId: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityId],\n        relationshipTypeId: fv!item[recordType!CMGT_RelatedEntityMap.relationshipMapTypeId]\n      )\n    ),\n    equals: \"CREATE\",\n    then: rule!CMGT_EntityEventHistory_Constructor(\n      entityId: fv!item[recordType!CMGT_RelatedEntityMap.entityId],\n      initiator: ri!initiator,\n      eventTypeId: cons!CMGT_REFID_EVENT_TYPE_ENTITY_ADD_RELATED_ENTITY,\n      details: a!map(\n        relatedEntityId: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityId],\n        relationshipTypeId: fv!item[recordType!CMGT_RelatedEntityMap.relationshipMapTypeId]\n      )\n    ),\n    default: {}\n  )\n)"
    },
    "_a-0000e9fd-9441-8000-9bdc-011c48011c48_312992": {
      "name": "CMGT_EntityEventHistory_Constructor",
      "type": "Expression Rule",
      "sail_code": "recordType!CMGT_EventHistory_Entity(\n  recordType!CMGT_EventHistory_Entity.entityId: ri!entityId,\n  recordType!CMGT_EventHistory_Entity.timestamp: a!defaultValue(value: ri!timestamp, default: now()),\n  recordType!CMGT_EventHistory_Entity.username: rule!CMGT_formatEventInitiator(initiator: ri!initiator),\n  recordType!CMGT_EventHistory_Entity.entityEventTypeId: ri!eventTypeId,\n  recordType!CMGT_EventHistory_Entity.details: if(\n    a!isNotNullOrEmpty(ri!details),\n    #\"SYSTEM_SYSRULES_toJson_v1\"(value: ri!details),\n    null\n  )\n)"
    },
    "_a-0000e9ae-873e-8000-9baf-011c48011c48_97439": {
      "name": "CMGT_QR_GetUser",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: #\"urn:appian:record-type:v1:SYSTEM_RECORD_TYPE_USER\",\n  returnType: ri!returnType,\n  executeWhen: ri!executeWhen,\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: #\"urn:appian:record-field:v1:SYSTEM_RECORD_TYPE_USER/SYSTEM_RECORD_TYPE_USER_FIELD_username\",\n      operator: \"in\",\n      value: ri!username\n    )\n  },\n  fields: ri!fields,\n  relatedRecordData: ri!relatedRecordData,\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  triggerRefresh: ri!triggerRefresh,\n  logicalExpressions: ri!additionalLogicalExpression,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000eaba-1e20-8000-9c2a-011c48011c48_1040808": {
      "name": "CMGT_Entity_WriteRecordsProperties",
      "type": "Expression Rule",
      "sail_code": "if(\n  ri!isInput,\n  rule!CMGT_UTIL_DropNonWritableRelationshipsFromRecord(\n    records: ri!entities,\n    relationships: {\n      recordType!CMGT_Entity.caseEntityMap,\n      recordType!CMGT_Entity.caseEntityMap\n    }\n  ),\n  rule!CMGT_UTIL_MergeWriteRecordIdsToProcessVariable(\n    processData: ri!entities,\n    recordsUpdated: ri!recordsUpdated,\n    fksToParent: {\n      recordType!CMGT_Entity.person.entityId,\n      recordType!CMGT_Entity.relatedEntityMapChildren.entityId,\n      recordType!CMGT_Entity.caseEntityMap.entityId\n    }\n  )\n)"
    },
    "_a-0000eac3-5839-8000-9c2d-011c48011c48_1070771": {
      "name": "CMGT_CaseEntityMap_SetEvents",
      "type": "Expression Rule",
      "sail_code": "a!match(\n  value: ri!context,\n  equals: \"CASE\",\n  then: #\"SYSTEM_SYSRULES_forEach\"(\n    items: ri!caseEntityMaps,\n    expression: /*EVENTS THAT ARE PROCESS-SPECIFIC (based on \"eventType\" input)*/\n    rule!CMGT_CaseEventHistory_Constructor(\n      caseId: fv!item[recordType!CMGT_CaseEntityMap.caseId],\n      initiator: ri!initiator,\n      eventTypeId: a!match(\n        value: fv!item[recordType!CMGT_CaseEntityMap.isActive],\n        equals: true,\n        then: cons!CMGT_REFID_EVENT_TYPE_CASE_ADD_RELATED_ENTITY,\n        default: cons!CMGT_REFID_EVENT_TYPE_CASE_REMOVE_RELATED_ENTITY\n      ),\n      details: a!map(\n        entityId: fv!item[recordType!CMGT_CaseEntityMap.entityId],\n        entityTypeId: fv!item[recordType!CMGT_CaseEntityMap.entity.entityTypeId]\n      )\n    )\n  ),\n  equals: \"ENTITY\",\n  then: #\"SYSTEM_SYSRULES_forEach\"(\n    items: ri!caseEntityMaps,\n    expression: /*EVENTS THAT ARE PROCESS-SPECIFIC (based on \"eventType\" input)*/\n    rule!CMGT_EntityEventHistory_Constructor(\n      entityId: fv!item[recordType!CMGT_CaseEntityMap.entityId],\n      initiator: ri!initiator,\n      eventTypeId: a!match(\n        value: fv!item[recordType!CMGT_CaseEntityMap.isActive],\n        equals: true,\n        then: cons!CMGT_REFID_EVENT_TYPE_ENTITY_ADD_RELATED_CASE,\n        default: cons!CMGT_REFID_EVENT_TYPE_ENTITY_REMOVE_RELATED_CASE\n      ),\n      details: a!map(\n        caseId: fv!item[recordType!CMGT_CaseEntityMap.caseId]\n      )\n    )\n  ),\n  default: {}\n)"
    },
    "_a-0000e9d3-70bf-8000-9bbd-011c48011c48_180568": {
      "name": "CMGT_UTIL_IsNotBlank",
      "type": "Expression Rule",
      "sail_code": "not(rule!CMGT_UTIL_IsBlank(ri!input))"
    },
    "_a-0000e9dc-ab93-8000-9bc2-011c48011c48_205212": {
      "name": "CMGT_Entity_Dedupe",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!identifyingAttributesMap: #\"SYSTEM_SYSRULES_forEach\"(\n    items: ri!entities,\n    expression: a!map(\n      identifyingAttribute1: rule!CMGT_Entity_SetIdentifyingAttributeByEntityType(entity: fv!item),\n      entityTypeId: fv!item[recordType!CMGT_Entity.entityTypeId],\n      entityUuid: fv!item[recordType!CMGT_Entity.entityUuid],\n      entityId: fv!item[recordType!CMGT_Entity.entityId]\n    )\n  ),\n  /*Returns all possible entity matches for these critera*/\n  local!existingEntities: rule!CMGT_QR_GetEntity(\n    includeInactive: false,\n    executeWhen: a!isNotNullOrEmpty(local!identifyingAttributesMap),\n    additionalFilters: {\n      #\"SYSTEM_SYSRULES_queryFilter\"(\n        field: recordType!CMGT_Entity.identifyingAttribute1,\n        operator: \"in\",\n        value: local!identifyingAttributesMap.identifyingAttribute1\n      ),\n      #\"SYSTEM_SYSRULES_queryFilter\"(\n        field: recordType!CMGT_Entity.entityTypeId,\n        operator: \"in\",\n        value: local!identifyingAttributesMap.entityTypeId\n      )\n    },\n    sort: #\"SYSTEM_SYSRULES_sortInfo\"(\n      field: recordType!CMGT_Entity.entityId,\n      ascending: true\n    )\n  ),\n  a!flatten(\n    #\"SYSTEM_SYSRULES_forEach\"(\n      items: local!identifyingAttributesMap,\n      expression: a!localVariables(\n        local!match: rule!CMGT_UTIL_Filter(\n          records: local!existingEntities,\n          fieldValuePairs: {\n            a!map(\n              field: recordType!CMGT_Entity.identifyingAttribute1,\n              value: fv!item.identifyingAttribute1\n            ),\n            a!map(\n              field: recordType!CMGT_Entity.entityTypeId,\n              value: fv!item.entityTypeId\n            )\n          }\n        ),\n        if(\n          and(\n            /*first do a blank email check/should not matter since email is required, but return the entity as is*/\n            rule!CMGT_UTIL_IsNotBlank(local!match),\n            a!isNullOrEmpty(fv!item.entityId),\n            a!isNotNullOrEmpty(fv!item.identifyingAttribute1)\n          ),\n          local!match,\n          rule!CMGT_UTIL_Filter(\n            records: ri!entities,\n            field: recordType!CMGT_Entity.entityUuid,\n            value: fv!item.entityUuid\n          )\n        )\n      )\n    )\n  )\n)"
    },
    "_a-0000eb3b-5b04-8000-9c63-011c48011c48_1555818": {
      "name": "CMGT_Entity_SetIdentifyingAttributeByEntityType",
      "type": "Expression Rule",
      "sail_code": "a!match(\n  value: ri!entity[recordType!CMGT_Entity.entityTypeId],\n  equals: cons!CMGT_REFID_ENTITY_TYPE_CONTACT,\n  then: ri!entity[recordType!CMGT_Entity.person.email],\n  default: null\n)"
    },
    "_a-0000e9e5-e5dd-8000-9bc7-011c48011c48_216949": {
      "name": "CMGT_UTIL_InitializeContactEntity",
      "type": "Expression Rule",
      "sail_code": "recordType!CMGT_Entity(\n  recordType!CMGT_Entity.person: recordType!CMGT_Person(\n    recordType!CMGT_Person.countryId: cons!CMGT_REFID_COUNTRY_USA\n  ),\n  recordType!CMGT_Entity.entityCategoryId: cons!CMGT_REFID_ENTITY_CATEGORY_PERSON,\n  recordType!CMGT_Entity.entityTypeId: cons!CMGT_REFID_ENTITY_TYPE_CONTACT,\n  recordType!CMGT_Entity.entityUuid: rule!CMGT_UTIL_GenerateUuid_NonPlugin(),\n  recordType!CMGT_Entity.entityType: rule!CMGT_QR_GetEntityType(\n    entityTypeId: cons!CMGT_REFID_ENTITY_TYPE_CONTACT,\n    returnType: \"SINGLE_OBJECT\"\n  )\n)"
    },
    "_a-0000eb44-9609-8000-9c66-011c48011c48_1613527": {
      "name": "CMGT_Entity_Details",
      "type": "Interface",
      "sail_code": "a!match(\n  value: tointeger(\n    ri!entity[recordType!CMGT_Entity.entityTypeId]\n  ),\n  equals: cons!CMGT_REFID_ENTITY_TYPE_CONTACT,\n  then: rule!CMGT_Contact_Details(\n    entity: ri!entity,\n    additionalEmailValidations: {},\n    index: ri!index\n  ),\n  default: {}\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_33778": {
      "name": "CMGT_UTIL_SetRecordFields",
      "type": "Expression Rule",
      "sail_code": "/*\nFuture enhancement ideas:\n1 Parameter to skip update if the field isn't present in the object\n--- This would also apply to nested fields, as in, don't set a relationship field if the entire relationship object isn't there because it will instantiate it\n2 Parameter to overwrite based on more enhanced logic\n3 Allow list types for the `value`\n4 Allow reuse to apply setting metadata for nested relationships, but using their own set metadata rule\n--- e.g. CMGT_Entity_SetMetaData can be used in both the Case process and the individual Entity process\n*/\nif(\n  a!isNullOrEmpty(ri!record),\n  ri!record,\n  a!localVariables(\n    local!allUpdates: rule!CMGT_UTIL_RejectBlank(a!flatten(\n      {\n        ri!alwaysOverwrite,\n        ri!childRelationships,\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: ri!neverOverwrite,\n          expression: #\"urn:appian:function:v1:a:update\"(\n            fv!item,\n            \"value\",\n            /*Specifically using this instead of a!defaultValue() to account for the `{null}` value*/\n            if(\n              rule!CMGT_UTIL_IsBlank(ri!record[fv!item.field]),\n              fv!item.value,\n              ri!record[fv!item.field]\n            )\n          )\n        )\n      }\n    )),\n    local!onlyChangedUpdates: a!flatten(\n      #\"SYSTEM_SYSRULES_forEach\"(\n        items: local!allUpdates,\n        expression: if(\n          or(\n            tostring(ri!record[fv!item.field]) = tostring(fv!item.value),\n            toboolean(fv!item.applyWhen) = false\n          ),\n          {},\n          fv!item\n        )\n      )\n    ),\n    if(\n      a!isNullOrEmpty(local!onlyChangedUpdates),\n      ri!record,\n      #\"urn:appian:function:v1:a:update\"(\n        data: ri!record,\n        index: local!onlyChangedUpdates.field,\n        value: local!onlyChangedUpdates.value\n      )\n    )\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_25670": {
      "name": "CMGT_Entity_SetMetaData",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_Entity_SetEvents(\n  entities: #\"SYSTEM_SYSRULES_forEach\"(\n    items: ri!entities,\n    expression: rule!CMGT_UTIL_SetRecordFields(\n      record: fv!item,\n      alwaysOverwrite: {\n        a!map(\n          field: recordType!CMGT_Entity.modifiedOn,\n          value: now()\n        ),\n        a!map(\n          field: recordType!CMGT_Entity.modifiedBy,\n          value: ri!initiator\n        ),\n        a!map(\n          field: recordType!CMGT_Entity.identifyingAttribute1,\n          value: rule!CMGT_Entity_SetIdentifyingAttributeByEntityType(entity: fv!item)\n        ),\n        a!map(\n          field: recordType!CMGT_Entity.title,\n          value: rule!CMGT_Entity_SetTitleByEntityType(entity: fv!item)\n        )\n      },\n      neverOverwrite: {\n        a!map(\n          field: recordType!CMGT_Entity.isActive,\n          value: true\n        ),\n        a!map(\n          field: recordType!CMGT_Entity.createdOn,\n          value: now()\n        ),\n        a!map(\n          field: recordType!CMGT_Entity.createdBy,\n          value: ri!initiator\n        ),\n        a!map(\n          field: recordType!CMGT_Entity.entityCategoryId,\n          value: cons!CMGT_REFID_ENTITY_CATEGORY_PERSON\n        ),\n        a!map(\n          field: recordType!CMGT_Entity.entityUuid,\n          value: rule!CMGT_UTIL_GenerateUuid_NonPlugin()\n        )\n      },\n      childRelationships: {\n        a!map(\n          field: recordType!CMGT_Entity.person,\n          value: rule!CMGT_Person_SetMetaData(\n            person: fv!item[recordType!CMGT_Entity.person]\n          )\n        ),\n        a!map(\n          field: recordType!CMGT_Entity.caseEntityMap,\n          value: rule!CMGT_CaseEntityMap_SetMetaData(\n            caseEntityMaps: fv!item[recordType!CMGT_Entity.caseEntityMap]\n          )\n        ),\n        a!map(\n          field: recordType!CMGT_Entity.relatedEntityMapChildren,\n          value: rule!CMGT_RelatedEntityMap_SetMetaData(\n            relatedEntityMaps: fv!item[recordType!CMGT_Entity.relatedEntityMapChildren]\n          )\n        )\n      }\n    )\n  ),\n  initiator: ri!initiator,\n  eventType: ri!eventType\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_25707": {
      "name": "CMGT_RelatedEntityMap_SetMetaData",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!relatedEntityMaps,\n  expression: rule!CMGT_UTIL_SetRecordFields(\n    record: fv!item,\n    alwaysOverwrite: {\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.modifiedOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.modifiedBy,\n        value: ri!initiator\n      )\n    },\n    neverOverwrite: {\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.createdOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.createdBy,\n        value: ri!initiator\n      ),\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.isActive,\n        value: true\n      ),\n      /*\n      In case the ID of parent/child is on the object instead of the direct field itself, tie it to the direct field itself\n        e.g. `.parentEntity.entityId` is populated, so then we populate `.parentEntityId`\n      */\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.entityId,\n        value: fv!item[recordType!CMGT_RelatedEntityMap.entity.entityId]\n      ),\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.relatedEntityId,\n        value: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntity.entityId]\n      )\n    }\n  )\n)"
    },
    "_a-0000e98b-cfe0-8000-9ba5-011c48011c48_22352": {
      "name": "CMGT_UTIL_QueryRecord",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*Chosen return type*/\n  local!returnType: a!defaultValue(ri!returnType, \"OBJECT_ARRAY\"),\n  /*Determine the query parameters to use by the return type*/\n  local!queryParams: a!match(\n    value: local!returnType,\n    equals: \"OBJECT_ARRAY\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        #\"urn:appian:function:v1:a:listtype?okey=a!listType\"(ri!recordType),\n        'type!{http://www.appian.com/ae/types/2009}Map?list'\n      ),\n      fetchTotalCount: false,\n      isArray: true,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          cons!CMGT_INT_BATCH_SIZE_MAX\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"SINGLE_OBJECT\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        ri!recordType,\n        'type!{http://www.appian.com/ae/types/2009}Map'\n      ),\n      fetchTotalCount: false,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"DATA_SUBSET\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}DataSubset',\n      fetchTotalCount: true,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: a!defaultValue(ri!pagingInfo.startIndex, 1),\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          cons!CMGT_INT_BATCH_SIZE_MAX\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"TOTAL_COUNT\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}Integer',\n      fetchTotalCount: true,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(startIndex: 1, batchSize: 0)\n    ),\n    default: fn!error(\n      \"Invalid returnType, must be one of: OBJECT_ARRAY, SINGLE_OBJECT, DATA_SUBSET, TOTAL_COUNT\"\n    )\n  ),\n  if(\n    /*Early exit for skip execution*/\n    ri!executeWhen = false,\n    cast(\n      local!queryParams.castToType,\n      if(local!queryParams.isArray, {}, null)\n    ),\n    a!localVariables(\n      /*Run the query*/\n      local!queryResult: a!refreshVariable(\n        value: #\"SYSTEM_SYSRULES_queryRecordType_v2\"(\n          recordType: ri!recordType,\n          fields: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            reject(\n              a!isNullOrEmpty,\n              a!flatten(\n                {\n                  ri!fields,\n                  index(ri!relatedRecordData, \"relationship\", {})\n                }\n              )\n            ),\n            #\"SYSTEM_SYSRULES_aggregationFields\"(\n              groupings: #\"SYSTEM_SYSRULES_forEach\"(\n                items: ri!groupByFields,\n                expression: #\"SYSTEM_SYSRULES_grouping\"(field: fv!item, alias: tostring(fv!item))\n              ),\n              measures: #\"SYSTEM_SYSRULES_measure\"(\n                field: ri!groupByFields[1],\n                function: \"COUNT\",\n                alias: \"count\"\n              )\n            )\n          ),\n          filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n            operator: \"AND\",\n            ignoreFiltersWithEmptyValues: true,\n            logicalExpressions: {\n              ri!logicalExpressions,\n              if(\n                and(\n                  a!isNotNullOrEmpty(ri!searchFields),\n                  a!isNotNullOrEmpty(ri!searchTerm)\n                ),\n                #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                  operator: \"AND\",\n                  logicalExpressions: #\"SYSTEM_SYSRULES_forEach\"(\n                    items: split(trim(ri!searchTerm), \" \"),\n                    expression: a!localVariables(\n                      local!splitSearchTerm: fv!item,\n                      #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                        operator: \"OR\",\n                        filters: #\"SYSTEM_SYSRULES_forEach\"(\n                          items: ri!searchFields,\n                          expression: #\"SYSTEM_SYSRULES_queryFilter\"(\n                            field: fv!item,\n                            operator: \"includes\",\n                            value: local!splitSearchTerm\n                          )\n                        )\n                      )\n                    )\n                  )\n                ),\n                {}\n              )\n            },\n            filters: ri!filters\n          ),\n          pagingInfo: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            local!queryParams.pagingInfo,\n            #\"urn:appian:function:v1:a:update\"(\n              local!queryParams.pagingInfo,\n              \"sort\",\n              null\n            )\n          ),\n          fetchTotalCount: local!queryParams.fetchTotalCount,\n          relatedRecordData: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            ri!relatedRecordData,\n            {}\n          )\n        ),\n        refreshOnVarChange: ri!triggerRefresh,\n        refreshAfter: { \"RECORD_ACTION\" }\n      ),\n      /*Format the output*/\n      local!output: a!match(\n        value: local!returnType,\n        equals: \"OBJECT_ARRAY\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult.data\n        ),\n        equals: \"SINGLE_OBJECT\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult.data\n        ),\n        equals: \"DATA_SUBSET\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult\n        ),\n        equals: \"TOTAL_COUNT\",\n        then: local!queryResult.totalCount,\n        default: null\n      ),\n      local!output\n    )\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_36462": {
      "name": "CMGT_CaseEntityMap_SetMetaData",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!caseEntityMaps,\n  expression: rule!CMGT_UTIL_SetRecordFields(\n    record: fv!item,\n    alwaysOverwrite: {\n      a!map(\n        field: recordType!CMGT_CaseEntityMap.modifiedOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_CaseEntityMap.modifiedBy,\n        value: ri!initiator\n      )\n    },\n    neverOverwrite: {\n      a!map(\n        field: recordType!CMGT_CaseEntityMap.isActive,\n        value: true\n      ),\n      a!map(\n        field: recordType!CMGT_CaseEntityMap.createdOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_CaseEntityMap.createdBy,\n        value: ri!initiator\n      ),\n      /*Prime the caseId with the assigned case, if it's not already populated*/\n      a!map(\n        field: recordType!CMGT_CaseEntityMap.caseId,\n        value: fv!item[recordType!CMGT_CaseEntityMap.case.caseId]\n      ),\n      /*Prime the entityId with the assigned entity, if it's not already populated*/\n      a!map(\n        field: recordType!CMGT_CaseEntityMap.entityId,\n        value: fv!item[recordType!CMGT_CaseEntityMap.entity.entityId]\n      )\n    }\n  )\n)"
    },
    "_a-0000eab0-e049-8000-9c27-011c48011c48_1011527": {
      "name": "CMGT_UTIL_DropNonWritableRelationshipsFromRecord",
      "type": "Expression Rule",
      "sail_code": "/*\nThe main rule to \"cleanse\" the input of a WriteRecords SS node to remove non-writable relationships.\n\nSTANDARD USAGE:\n- Use this in tandem with rule CMGT_UTIL_MergeWriteRecordIdsToProcessVariable (see that description)\n- In the input of a WriteRecords SS (NOT in a previous script task), do:\n  A - Expressionable input to \"Records\" intput\n  B - rule!CMGT_UTIL_DropNonWritableRelationshipsFromRecord(\n        records: pv![the pv to write],\n        relationships: {list of record relationships that are not allowed to be written}\n      )\n\nIMPORTANT GENERAL NOTES: \n- The reason to run this in the input of the WriteRecords SS instead of a previous script task\nis that, when used with CMGT_UTIL_MergeWriteRecordIdsToProcessVariable, you can maintain the relationships\nthat you had to drop before writing.\n  -> For example, if you are writing \"Case\" but it has a child-relationship \"Address\" that cannot be written,\n    - this will drop \"Address\" before attempting to write\n    - if the output is configured properly it will reattach \"Address\" in the output\n    - the overall result is that you basically ran the node as if \"Address\" was ignored, \n      so that you can use it later in the process flow\n*/\n#\"SYSTEM_SYSRULES_forEach\"(\n  items: a!flatten(ri!records),\n  expression: reduce(\n    rule!CMGT_UTIL_DropNonWritableRelationshipsFromRecord_Reducer(\n      record: _,\n      relationship: _\n    ),\n    fv!item,\n    ri!relationships\n  )\n)"
    },
    "_a-0000eb0d-3639-8000-9c4d-011c48011c48_1364338": {
      "name": "CMGT_Entity_validateEntityExists",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!identifyingAttribute1: rule!CMGT_Entity_SetIdentifyingAttributeByEntityType(entity: ri!entity),\n  /* Duplicates are checked based on the identifying attribute and the type in the CMGT_Entity table */\n  local!databaseMatchCount: rule!CMGT_QR_GetEntity(\n    returnType: \"TOTAL_COUNT\",\n    includeInactive: false,\n    executeWhen: and(\n      rule!CMGT_UTIL_IsNotBlank(local!identifyingAttribute1),\n      not(\n        a!defaultValue(\n          value: ri!ignoreDatabaseMatch,\n          default: false\n        )\n      )\n    ),\n    additionalFilters: {\n      #\"SYSTEM_SYSRULES_queryFilter\"(\n        field: recordType!CMGT_Entity.identifyingAttribute1,\n        operator: \"=\",\n        value: rule!CMGT_Entity_SetIdentifyingAttributeByEntityType(entity: ri!entity)\n      ),\n      #\"SYSTEM_SYSRULES_queryFilter\"(\n        field: recordType!CMGT_Entity.entityTypeId,\n        operator: \"=\",\n        value: ri!entity[recordType!CMGT_Entity.entityTypeId]\n      ),\n      /*Ensures the current entity is not pulled back      */\n      #\"SYSTEM_SYSRULES_queryFilter\"(\n        field: recordType!CMGT_Entity.entityId,\n        operator: \"<>\",\n        value: ri!entity[recordType!CMGT_Entity.entityId]\n      )\n    }\n  ),\n  local!existingMatch: if(\n    and(\n      rule!CMGT_UTIL_IsNotBlank(local!identifyingAttribute1),\n      rule!CMGT_UTIL_IsNotBlank(ri!existingEntities)\n    ),\n    rule!CMGT_UTIL_RejectBlank(\n      #\"SYSTEM_SYSRULES_forEach\"(\n        items: rule!CMGT_UTIL_Filter(\n          records: ri!existingEntities,\n          fieldValuePairs: {\n            a!map(\n              field: recordType!CMGT_Entity.entityTypeId,\n              value: ri!entity[recordType!CMGT_Entity.entityTypeId]\n            )\n          }\n        ),\n        expression: a!localVariables(\n          local!existingIdentifyingAttribute1: rule!CMGT_Entity_SetIdentifyingAttributeByEntityType(entity: fv!item),\n          if(\n            local!existingIdentifyingAttribute1 = local!identifyingAttribute1,\n            fv!item,\n            null\n          )\n        )\n      )\n    ),\n    cast(\n      recordType!CMGT_Entity,\n      null\n    )\n  ),\n  if(\n    /*Duplicate identifying attribute 1 check\n                    - An identifying attribute 1 (email) already in the system\n                    - EntityID is not the same*/\n    local!databaseMatchCount > 0,\n    #\"urn:appian:translation-string:v1:45f6a9b0-04c5-4ec0-a49c-cf9584109d7c\",\n    if(\n      and(\n        a!isNotNullOrEmpty(local!existingMatch),\n        local!existingMatch[recordType!CMGT_Entity.entityUuid] <> ri!entity[recordType!CMGT_Entity.entityUuid]\n      ),\n      #\"urn:appian:translation-string:v1:660be136-4c49-491b-8a65-3ac1924ececa\",\n      null\n    )\n  )\n)"
    },
    "_a-0000eb3b-5b04-8000-9c63-011c48011c48_1586207": {
      "name": "CMGT_UTIL_InitializeEntityType",
      "type": "Expression Rule",
      "sail_code": "a!match(\n  value: ri!entityTypeId,\n  equals: cons!CMGT_REFID_ENTITY_TYPE_CONTACT,\n  then: rule!CMGT_UTIL_InitializeContactEntity(),\n  default: {}\n)"
    },
    "_a-0000e9fa-aa45-8000-9bda-011c48011c48_293777": {
      "name": "CMGT_CaseEventHistory_Constructor",
      "type": "Expression Rule",
      "sail_code": "recordType!CMGT_EventHistory_Case(\n  recordType!CMGT_EventHistory_Case.caseId: ri!caseId,\n  recordType!CMGT_EventHistory_Case.timestamp: a!defaultValue(value: ri!timestamp, default: now()),\n  recordType!CMGT_EventHistory_Case.username: rule!CMGT_formatEventInitiator(initiator: ri!initiator),\n  recordType!CMGT_EventHistory_Case.caseEventTypeId: ri!eventTypeId,\n  recordType!CMGT_EventHistory_Case.details: if(\n    a!isNotNullOrEmpty(ri!details),\n    #\"SYSTEM_SYSRULES_toJson_v1\"(\n      value: ri!details,\n      removeNullOrEmptyFields: false\n    ),\n    null\n  )\n)"
    },
    "_a-0000eb4d-d051-8000-9c68-011c48011c48_1674466": {
      "name": "CMGT_MTR_UserCreatesEntity",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "1e52af5c-4f4a-4b5a-83f6-b7a38a4ab2cc": {
      "name": "CMGT_Entity_CreateUpdate",
      "type": "Process Model",
      "sail_code": "// Output: ?\nrule!CMGT_Entity_Dedupe(\n  entities: pv!entities\n)\n\n// Input: ?\nrule!CMGT_Entity_WriteRecordsProperties(\n  entities: pv!entities,\n  isInput: true\n)\n\n// Input: ?\n=recordType!CMGT_Entity\n\n// Output: ?\nrule!CMGT_Entity_WriteRecordsProperties(\n  entities: pv!entities,\n  recordsUpdated: ac!RecordsUpdated,\n  isInput: false\n)\n\n// Input: ?\n=rule!CMGT_MTR_EntityWrapper(entities: pv!entities)\n\n// Output: ?\nrule!CMGT_Entity_SetMetaData(\n  entities: pv!entities,\n  initiator: pp!initiator,\n  eventType: \"CREATE/UPDATE\"\n)"
    },
    "c072ea06-cbc3-49ce-a52d-b2e75b962b10": {
      "name": "CMGT_Entity_RecordAction_CreateUpdate",
      "type": "Interface",
      "sail_code": "a!localVariables(\n  local!isUpdate: a!isNotNullOrEmpty(\n    ri!entity[recordType!CMGT_Entity.entityId]\n  ),\n  local!entity: if(\n    local!isUpdate,\n    ri!entity,\n    /*Default to Submitter entity type*/\n    rule!CMGT_UTIL_InitializeEntityType(\n      entityTypeId: cons!CMGT_REFID_ENTITY_TYPE_CONTACT\n    )\n  ),\n  #\"SYSTEM_SYSRULES_formLayout_v1\"(\n    label: if(\n      local!isUpdate,\n      #\"urn:appian:translation-string:v1:02435c90-9b8b-4bf9-af3d-e1beb795d4bf\",\n      #\"urn:appian:translation-string:v1:90287ce4-b093-4050-8585-ca186b1e0243\"\n    ),\n    contents: {\n      #\"SYSTEM_SYSRULES_columnsLayout\"(\n        columns: {\n          #\"SYSTEM_SYSRULES_columnLayout\"(\n            contents: {\n              #\"SYSTEM_SYSRULES_dropdownField_v1\"(\n                label: #\"urn:appian:translation-string:v1:cfd938d0-1c74-423e-89ee-f71a530aaec0\",\n                data: #\"SYSTEM_SYSRULES_recordData\"(\n                  recordType: recordType!CMGT_CFG_EntityType,\n                  filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                    operator: \"AND\",\n                    filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n                      field: recordType!CMGT_CFG_EntityType.isSystemOnly,\n                      operator: \"=\",\n                      value: false\n                    )\n                  )\n                ),\n                sort: {\n                  #\"SYSTEM_SYSRULES_sortInfo\"(\n                    field: recordType!CMGT_CFG_EntityType.fullLabel,\n                    ascending: true\n                  )\n                },\n                choiceLabels: recordType!CMGT_CFG_EntityType.fullLabel,\n                choiceValues: recordType!CMGT_CFG_EntityType.entityTypeId,\n                value: local!entity[recordType!CMGT_Entity.entityTypeId],\n                saveInto: {\n                  local!entity[recordType!CMGT_Entity.entityTypeId],\n                  a!save(\n                    local!entity,\n                    rule!CMGT_UTIL_InitializeEntityType(entityTypeId: save!value)\n                  )\n                },\n                showWhen: not(local!isUpdate),\n                required: true()\n              )\n            }\n          ),\n          #\"SYSTEM_SYSRULES_columnLayout\"()\n        }\n      ),\n      rule!CMGT_Entity_Details(entity: local!entity)\n    },\n    buttons: #\"SYSTEM_SYSRULES_ButtonLayout\"(\n      primaryButtons: {\n        #\"SYSTEM_SYSRULES_buttonWidget_v1\"(\n          label: if(\n            local!isUpdate,\n            #\"urn:appian:translation-string:v1:06dbafc7-e085-40de-a68a-c83054c1d7ec\",\n            #\"urn:appian:translation-string:v1:8109f456-b575-47d2-8f0f-097db1743e6b\"\n          ),\n          style: \"SOLID\",\n          submit: true,\n          validate: true,\n          saveInto: a!save(ri!entity, local!entity)\n        )\n      },\n      secondaryButtons: {\n        #\"SYSTEM_SYSRULES_buttonWidget_v1\"(\n          label: #\"urn:appian:translation-string:v1:651cf177-f30b-485b-900f-8aaf47805737\",\n          style: \"OUTLINE\",\n          submit: true,\n          validate: false,\n          saveInto: a!save(ri!entity, null)\n        )\n      }\n    ),\n    validations: #\"SYSTEM_SYSRULES_validationMessage\"(\n      message: rule!CMGT_Entity_validateEntityExists(entity: local!entity),\n      validateAfter: \"SUBMIT\"\n    )\n  )\n)"
    },
    "_a-0000eb4d-d051-8000-9c68-011c48011c48_1675077": {
      "name": "CMGT_MTR_EntityWrapper",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!entities,\n  expression: a!match(\n    value: fv!item[recordType!CMGT_Entity.entityId],\n    whenTrue: a!isNullOrEmpty(fv!value),\n    then: rule!CMGT_MTR_UserCreatesEntity(),\n    default: rule!CMGT_MTR_UserEditsEntity()\n  )\n)"
    },
    "_a-0000eb32-20f6-8000-9c60-011c48011c48_1486808": {
      "name": "CMGT_Person_SetMetaData",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_SetRecordFields(\n  record: ri!person,\n  alwaysOverwrite: {},\n  neverOverwrite: {},\n  childRelationships: {}\n)"
    },
    "_a-0000e99c-1217-8000-9ba9-011c48011c48_52143": {
      "name": "CMGT_UTIL_ValidateEmail",
      "type": "Expression Rule",
      "sail_code": "/*  Email Address Validation for Appian 7+  */\n/*  Allows the 'name' to contain letters, numbers, plus period and special characters: _ - + ' & %  */\n/*  Allows the 'domain' to contain only letters, numbers, period and dash.  */\n/*When the case is created from the portal and if that email is used for account creation, only then below validation should be displayed in portal else existing validation should be displayed\nPlease enter a valid email address. Email address may only contain letters, numbers, and the following special characters: @ . _ - */\na!localVariables(\n  local!validationMessage: #\"urn:appian:translation-string:v1:b90bb29b-f3c4-4405-a032-741e69f0ed63\",\n  if(\n    a!isNullOrEmpty(ri!textInput),\n    null,\n    a!localVariables(\n      local!localPart: index(split(trim(ri!textInput), \"@\"), 1, {}),\n      local!domainPart: index(split(trim(ri!textInput), \"@\"), 2, {}),\n      {\n        if(\n          or(\n            len(trim(ri!textInput)) > 255,\n            length(split(trim(ri!textInput), \" \")) > 1,\n            count(split(ri!textInput, \"@\")) <> 2\n          ),\n          local!validationMessage,\n          if(\n            or(\n              length(split(local!domainPart, \".\")) < 2,\n              contains(split(local!localPart, \".\"), \"\"),\n              contains(split(local!domainPart, \".\"), \"\"),\n            ),\n            local!validationMessage,\n            null\n          )\n        )\n      }\n    )\n  )\n)"
    },
    "_a-0000e9d3-70bf-8000-9bbd-011c48011c48_180481": {
      "name": "CMGT_UTIL_RejectBlank",
      "type": "Expression Rule",
      "sail_code": "cast(\n  runtimetypeof(a!flatten(ri!array)),\n  reject(a!isNullOrEmpty(_), a!flatten(ri!array))\n)"
    },
    "_a-0000eaba-1e20-8000-9c2a-011c48011c48_1040765": {
      "name": "CMGT_Entity_SetEvents",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!entities,\n  expression: /*EVENTS THAT ARE PROCESS-SPECIFIC (based on \"eventType\" input)*/\n  #\"urn:appian:function:v1:a:update\"(\n    fv!item,\n    recordType!CMGT_Entity.eventHistory,\n    a!flatten(\n      {\n        a!match(\n          value: ri!eventType,\n          equals: \"DELETE\",\n          then: rule!CMGT_EntityEventHistory_Constructor(\n            entityId: fv!item[recordType!CMGT_Entity.entityId],\n            initiator: ri!initiator,\n            eventTypeId: cons!CMGT_REFID_EVENT_TYPE_ENTITY_INACTIVATE\n          ),\n          equals: \"CREATE/UPDATE\",\n          then: rule!CMGT_EntityEventHistory_Constructor(\n            entityId: fv!item[recordType!CMGT_Entity.entityId],\n            initiator: ri!initiator,\n            eventTypeId: if(\n              a!isNullOrEmpty(\n                fv!item[recordType!CMGT_Entity.entityId]\n              ),\n              cons!CMGT_REFID_EVENT_TYPE_ENTITY_CREATE,\n              cons!CMGT_REFID_EVENT_TYPE_ENTITY_UPDATE\n            )\n          ),\n          default: {}\n        ),\n        /*EVENTS THAT ARE NON-PROCESS-SPECIFIC (based on \"what children are populated\")*/\n        /* - Case Entity Map - the case version of this audit is captured separately*/\n        rule!CMGT_CaseEntityMap_SetEvents(\n          caseEntityMaps: fv!item[recordType!CMGT_Entity.caseEntityMap],\n          initiator: ri!initiator,\n          context: \"ENTITY\"\n        ),\n        /* - Related Entity Map - the related version of this audit is captured separately*/\n        rule!CMGT_RelatedEntityMap_SetEvents(\n          relatedEntityMaps: fv!item[recordType!CMGT_Entity.relatedEntityMapChildren],\n          initiator: ri!initiator,\n          eventType: \"CREATE\"\n        )\n      }\n    )\n  )\n)"
    },
    "_a-0000e99c-1217-8000-9ba9-011c48011c48_54064": {
      "name": "CMGT_QR_GetStateProvince",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_CFG_StateProvince,\n  returnType: ri!returnType,\n  executeWhen: a!defaultValue(\n    ri!executeWhen,\n    a!isNotNullOrEmpty(ri!countryId)\n  ),\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_StateProvince.countryId,\n      operator: \"=\",\n      value: ri!countryId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_StateProvince.stateProvId,\n      operator: \"in\",\n      value: ri!stateProvId\n    )\n  },\n  fields: ri!fields,\n  relatedRecordData: ri!relatedRecordData,\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  triggerRefresh: ri!triggerRefresh,\n  logicalExpressions: ri!additionalLogicalExpression,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000eb3b-5b04-8000-9c63-011c48011c48_1555824": {
      "name": "CMGT_Entity_SetTitleByEntityType",
      "type": "Expression Rule",
      "sail_code": "a!match(\n  value: ri!entity[recordType!CMGT_Entity.entityTypeId],\n  equals: cons!CMGT_REFID_ENTITY_TYPE_CONTACT,\n  then: joinarray(\n    {\n      ri!entity[recordType!CMGT_Entity.person.firstName],\n      ri!entity[recordType!CMGT_Entity.person.middleInitial],\n      ri!entity[recordType!CMGT_Entity.person.lastName]\n    },\n    \" \"\n  ),\n  default: null\n)"
    },
    "_a-0000ea1d-36f5-8000-9bef-011c48011c48_538451": {
      "name": "CMGT_UTIL_GenerateUuid_NonPlugin",
      "type": "Expression Rule",
      "sail_code": "/*Reference:\nhttps://community.appian.com/w/the-appian-playbook/846/generating-uuids-guids*/\nfn!lower(\n  concat(\n    {\n      dec2hex(tointeger(rand(4) * 256), 2),\n      /*8 hex digits*/\n      \"-\",\n      dec2hex(tointeger(rand(2) * 256), 2),\n      /*4 hex digits*/\n      \"-4\",\n      /*version 4 = completely random*/\n      dec2hex(rand(3) * 256, 1),\n      /*3 hex digits*/\n      \"-\",\n      bin2hex(\"10\" & dec2bin(rand(1) * 4, 2), 1),\n      /*1 hex digit = Variant: 1st 2 bits=10=[ISO/IEC] + 2 rand bits*/\n      dec2hex(rand(3) * 256, 1),\n      /*3 hex digits*/\n      \"-\",\n      dec2hex(tointeger(rand(6) * 256), 2),\n      /*12 hex digits*/\n      \n    }\n  )\n)"
    },
    "af326a29-a1c8-4399-a28d-996f85819d9e": {
      "name": "CMGT_UTIL_Filter",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!fieldValuePairs: a!defaultValue(\n    ri!fieldValuePairs,\n    apply(\n      rule!CMGT_UTIL_Filter_CreateFieldValuePair(\n        field: _,\n        value: ri!value,\n        allFields: a!flatten(ri!field)\n      ),\n      a!flatten(ri!field)\n    )\n  ),\n  local!matchingCriteria: a!defaultValue(\n    value: ri!matchingCriteria,\n    default: \"ALL\"\n  ),\n  local!matchType: a!defaultValue(value: ri!matchType, default: \"EXACT\"),\n  local!matchIndices: if(\n    a!isNullOrEmpty(a!flatten(ri!records)),\n    tointeger({}),\n    reduce(\n      rule!CMGT_UTIL_Filter_Reducer(\n        matchingCriteria: local!matchingCriteria,\n        previousIndices: _,\n        records: a!flatten(ri!records),\n        fieldValuePair: _,\n        matchType: local!matchType\n      ),\n      a!match(\n        value: local!matchingCriteria,\n        equals: \"ALL\",\n        then: enumerate(count(a!flatten(ri!records))) + 1,\n        equals: \"ANY\",\n        then: {},\n        default: fn!error(\n          \"Invalid matchingCriteria, must be one of: ALL, ANY\"\n        )\n      ),\n      local!fieldValuePairs\n    )\n  ),\n  local!rejectIndices: difference(\n    if(\n      a!isNullOrEmpty(ri!records),\n      tointeger({}),\n      enumerate(count(a!flatten(ri!records))) + 1\n    ),\n    local!matchIndices\n  ),\n  local!matches: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!matchIndices, {})\n  ),\n  local!rejects: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!rejectIndices, {})\n  ),\n  local!output: a!match(\n    value: a!defaultValue(ri!filterType, \"FILTER\"),\n    equals: \"FILTER\",\n    then: local!matches,\n    equals: \"REJECT\",\n    then: local!rejects,\n    equals: \"FIRST_MATCH\",\n    then: index(local!matches, 1, null),\n    equals: \"FIRST_REJECT\",\n    then: index(local!rejects, 1, null),\n    equals: \"MATCH_COUNT\",\n    then: count(local!matchIndices),\n    equals: \"REJECT_COUNT\",\n    then: count(local!rejectIndices),\n    equals: \"MATCH_INDICES\",\n    then: local!matchIndices,\n    equals: \"REJECT_INDICES\",\n    then: local!rejectIndices,\n    equals: \"FULL_RESULT\",\n    then: a!map(\n      matches: local!matches,\n      rejects: local!rejects,\n      firstMatch: index(local!matches, 1, null),\n      firstReject: index(local!rejects, 1, null),\n      matchCount: count(local!matchIndices),\n      rejectCount: count(local!rejectIndices),\n      matchIndices: local!matchIndices,\n      rejectIndices: local!rejectIndices\n    ),\n    default: fn!error(\n      \"Invalid filterType, must be one of: FILTER, REJECT, FIRST_MATCH, FIRST_REJECT, MATCH_COUNT, REJECT_COUNT, MATCH_INDICES, REJECT_INDICES, FULL_RESULT\"\n    )\n  ),\n  local!output\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_24101": {
      "name": "CMGT_QR_GetEntityType",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_CFG_EntityType,\n  returnType: ri!returnType,\n  triggerRefresh: ri!triggerRefresh,\n  executeWhen: ri!executeWhen,\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_EntityType.entityTypeId,\n      operator: \"in\",\n      value: ri!entityTypeId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_EntityType.isSystemOnly,\n      operator: \"=\",\n      value: false,\n      applyWhen: ri!ignoreSystemOnlyEntities = true\n    )\n  },\n  fields: ri!fields,\n  relatedRecordData: ri!relatedRecordData,\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  logicalExpressions: ri!additionalLogicalExpression,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    }
  }
}