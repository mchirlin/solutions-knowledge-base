{
  "uuid": "_a-0000edc1-5343-8000-9e09-011c48011c48_15804918",
  "name": "zzzDEPRECATED_AS_GSS_SAVES_executeConsensusAiSuggestionIntegration_RatingJustification",
  "type": "Expression Rule",
  "description": "DEPRECATED IN GSS 2.6 - This rule handles evaluating the consensus AI suggestion and storing the results in the DB.  If the toggle is off, returns an empty list.",
  "sail_code": "/*No test cases added, as this rule returns reaction tree*/\nif(\n  cons!AS_GSS_TOGGLE_CONSENSUS_FORM_AI,\n  a!localVariables(\n    local!httpResponse,\n    local!responseFormattedText: rule!AS_GSS_BL_formatConsensusResponses_ToSuggestRatingJustificationByAI(\n      consensusResponses: ri!consensusResponses,\n      vendor: ri!consensusReport[recordType!AS_GSS_ConsensusReport_SYNCEDRECORD.evaluationVendor]\n    ),\n    {\n      a!save(\n        local!httpResponse,\n        rule!AS_GSS_INT_summarize_ConsensusResponsesOrFinalComment(\n          responseFormattedText: local!responseFormattedText,\n          prompt: cons!AS_GSS_SUGGEST_FINAL_COMMENT_PROMPT\n        )\n      ),\n      a!save(\n        ri!consensusAiSuggestion,\n        'type!{urn:com:appian:types}AS_GSS_ConsensusAiSuggestion'(\n          consensusId: ri!consensusReport[recordType!AS_GSS_ConsensusReport_SYNCEDRECORD.consensusId],\n          prompt: local!responseFormattedText,\n          response: if(\n            a!isNullOrEmpty(local!httpResponse.result),\n            null,\n            #\"SYSTEM_SYSRULES_toJson_v1\"(local!httpResponse.result)\n          ),\n          errorInfo: if(\n            a!isNullOrEmpty(index(local!httpResponse, \"error\", null)),\n            null,\n            #\"SYSTEM_SYSRULES_toJson_v1\"(\n              value: rule!AS_CO_UT_castToDictionary(\n                value: index(local!httpResponse, \"error\", null)\n              )\n            )\n          ),\n          isSuccess: local!httpResponse.success,\n          createdBy: loggedInUser(),\n          createdDateTime: now()\n        )\n      ),\n      #\"SYSTEM_SYSRULES_writeToDataStoreEntity\"(\n        dataStoreEntity: cons!AS_GSS_ENT_CONSENSUS_AI_SUGGESTION,\n        valueToStore: ri!consensusAiSuggestion\n      ),\n      if(\n        local!httpResponse.success,\n        rule!AS_GSS_MTR_SAVE_consensusFinalCommentsAiSuggestionGenerationSuccess(),\n        rule!AS_GSS_MTR_SAVE_consensusFinalCommentsAiSuggestionGenerationFailure()\n      )\n    }\n  ),\n  {}\n)",
  "calls": [
    {
      "name": "AS_GSS_BL_formatConsensusResponses_ToSuggestRatingJustificationByAI",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AS_GSS_INT_summarize_ConsensusResponsesOrFinalComment",
      "type": "Integration",
      "dep_type": "CALLS"
    },
    {
      "name": "AS_CO_UT_castToDictionary",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AS_GSS_MTR_SAVE_consensusFinalCommentsAiSuggestionGenerationSuccess",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AS_GSS_MTR_SAVE_consensusFinalCommentsAiSuggestionGenerationFailure",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AS_GSS_TOGGLE_CONSENSUS_FORM_AI",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "AS_GSS_SUGGEST_FINAL_COMMENT_PROMPT",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "AS_GSS_ENT_CONSENSUS_AI_SUGGESTION",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "AS_GSS_ConsensusReport_SYNCEDRECORD",
      "type": "Record Type",
      "dep_type": "USES_RECORD_TYPE"
    }
  ],
  "called_by": []
}