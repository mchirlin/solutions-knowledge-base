{
  "uuid": "_a-0000ed16-a792-8000-9c64-011c48011c48_267329",
  "name": "AIA_RULE_DynamicExpression",
  "type": "Interface",
  "description": "Interface to build a dynamic Boolean expression to evaluate condition rules in a record",
  "sail_code": "if(\n  a!defaultValue(value: ri!showWhen,default: true),\n  a!localVariables(\n    local!initalData: a!refreshVariable(\n      refreshOnReferencedVarChange: false,\n      value: a!defaultValue(ri!data, a!map())\n    ),\n    /*Obtain rule operations if not provided*/\n    local!allRuleOperations: reject(\n      fn!isnull,\n      #\"SYSTEM_SYSRULES_forEach\"(\n        items: a!defaultValue(\n          value: ri!ruleOperations,\n          default: rule!AIA_RULE_ENUM_RuleOperations()\n        ),\n        expression: if(fv!item.default, null, fv!item)\n      )\n    ),\n    /*Variables to check if the expression operator changed*/\n    /*Complex when AND or OR have been selected*/\n    local!isComplex: a!isNotNullOrEmpty(ri!data.expressionOperator),\n    local!wasComplex: local!isComplex,\n    {\n      /*If expression is complex - Show a list of conditions and expressions*/\n      if(\n        local!isComplex,\n        {\n          /*For each condition display...*/\n          #\"SYSTEM_SYSRULES_forEach\"(\n            items: ri!data.conditions,\n            expression: {\n              /*Expression Operation Selection*/\n              #\"SYSTEM_SYSRULES_sideBySideLayout\"(\n                items: {\n                  #\"SYSTEM_SYSRULES_sideBySideItem\"(\n                    item: #\"SYSTEM_SYSRULES_dropdownField_v1\"(\n                      label: \"Expression Operator\",\n                      labelPosition: \"COLLAPSED\",\n                      choiceLabels: { \"AND\", \"OR\" },\n                      choiceValues: { \"AND\", \"OR\" },\n                      disabled: fv!index > 2,\n                      saveInto: {\n                        /*Save new complex value*/\n                        a!save(\n                          local!isComplex,\n                          a!isNotNullOrEmpty(save!value)\n                        ),\n                        /*Determine what to do based on if the expression complexity changed*/\n                        a!match(\n                          value: local!isComplex,\n                          /*When complexiy changed from simple to complex*/\n                          whenTrue: and(local!isComplex, not(local!wasComplex)),\n                          /*Save the rule operation to the expression conditions*/\n                          then: a!save(ri!data, a!map(conditions: { ri!data })),\n                          default: null\n                        ),\n                        /*Store expression operator in data context*/\n                        a!save(ri!data.expressionOperator, save!value)\n                      },\n                      value: ri!data.expressionOperator,\n\n                    ),\n                    width: \"MINIMIZE\"\n                  ),\n                  #\"SYSTEM_SYSRULES_sideBySideItem\"()\n                },\n                showWhen: fv!index >= 2\n              ),\n              #\"SYSTEM_SYSRULES_columnsLayout\"(\n                marginBelow: \"EVEN_LESS\",\n                alignVertical: \"MIDDLE\",\n                columns: {\n                  #\"SYSTEM_SYSRULES_columnLayout\"(\n                    contents: #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n                      align: \"RIGHT\",\n                      value: {\n                        /*Remove button*/\n                        #\"SYSTEM_SYSRULES_richTextIcon\"(\n                          caption: \"Remove Rule operation\",\n                          icon: \"times\",\n                          color: \"NEGATIVE\",\n                          linkStyle: \"STANDALONE\",\n                          link: #\"SYSTEM_SYSRULES_dynamicLink\"(\n                            saveInto: {\n                              a!save(\n                                ri!data.conditions,\n                                remove(ri!data.conditions, fv!index)\n                              ),\n                              if(\n                                length(ri!data.conditions) = 1,\n                                a!save(local!isComplex, false),\n                                {}\n                              )\n                            }\n                          )\n                        )\n                      }\n                    ),\n                    width: \"EXTRA_NARROW\"\n                  ),\n                  /*Selectable rule operation and its components*/\n                  #\"SYSTEM_SYSRULES_columnLayout\"(\n                    contents: {\n                      rule!AIA_RULE_RuleDynamicComponents(\n                        isCreateValidation: ri!isCreateValidation,\n                        context: fv!item,\n                        ruleOperations: local!allRuleOperations\n                      )\n                    }\n                  )\n                }\n              ),\n\n            }\n          ),\n          /*For each expression display...*/\n          #\"SYSTEM_SYSRULES_forEach\"(\n            items: ri!data.expressions,\n            expression: {\n              /*Selected parent expression operator*/\n              #\"SYSTEM_SYSRULES_sideBySideLayout\"(\n                items: {\n                  #\"SYSTEM_SYSRULES_sideBySideItem\"(\n                    item: #\"SYSTEM_SYSRULES_dropdownField_v1\"(\n                      label: \"Expression Operator\",\n                      labelPosition: \"COLLAPSED\",\n                      choiceLabels: { \"AND\", \"OR\" },\n                      choiceValues: { \"AND\", \"OR\" },\n                      placeholder: \"AND/OR\",\n                      disabled: true,\n                      value: ri!data.expressionOperator,\n\n                    ),\n                    width: \"MINIMIZE\"\n                  ),\n                  #\"SYSTEM_SYSRULES_sideBySideItem\"()\n                },\n                showWhen: or(\n                  a!isNotNullOrEmpty(ri!data.conditions),\n                  not(fv!isFirst)\n                )\n              ),\n              /*Container of nested expression - Only visual*/\n              #\"SYSTEM_SYSRULES_cardLayout\"(\n                contents: {\n                  #\"SYSTEM_SYSRULES_columnsLayout\"(\n                    columns: {\n                      /*Nested expression - Recursive*/\n                      #\"SYSTEM_SYSRULES_columnLayout\"(\n                        contents: rule!AIA_RULE_DynamicExpression(\n                          data: fv!item,\n                          ruleOperations: local!allRuleOperations\n                        )\n                      ),\n                      /*Remove button*/\n                      #\"SYSTEM_SYSRULES_columnLayout\"(\n                        width: \"EXTRA_NARROW\",\n                        contents: #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n                          align: \"RIGHT\",\n                          value: {\n                            #\"SYSTEM_SYSRULES_richTextIcon\"(\n                              icon: \"times\",\n                              color: \"NEGATIVE\",\n                              linkStyle: \"STANDALONE\",\n                              link: #\"SYSTEM_SYSRULES_dynamicLink\"(\n                                saveInto: a!save(\n                                  ri!data.expressions,\n                                  remove(ri!data.expressions, fv!index)\n                                )\n                              )\n                            )\n                          }\n                        )\n                      )\n                    }\n                  )\n                },\n                padding: \"STANDARD\"\n              )\n            }\n          ),\n\n        },\n        /*Display a single rule operation if no expression is selected*/\n        {\n          rule!AIA_RULE_RuleDynamicComponents(\n            isCreateValidation: ri!isCreateValidation,\n            context: ri!data,\n            ruleOperations: local!allRuleOperations\n          )\n        }\n      ),\n      /*Buttons to add a new condition or new nested expression*/\n      #\"SYSTEM_SYSRULES_sideBySideLayout\"(\n        showWhen: ri!isCreateValidation,\n        marginAbove: \"STANDARD\",\n        items: {\n          /*Button to add a new condition*/\n          #\"SYSTEM_SYSRULES_sideBySideItem\"(\n            width: \"MINIMIZE\",\n            item: #\"SYSTEM_SYSRULES_linkField\"(\n              labelPosition: \"COLLAPSED\",\n              links: {\n                #\"SYSTEM_SYSRULES_dynamicLink\"(\n                  label: \"+ New Condition\",\n                  value: local!initalData,\n                  saveInto: {\n                    {\n                      /*Save new complex value*/\n                      a!save(\n                        local!isComplex,\n                        /*a!isNotNullOrEmpty(save!value)*/\n                        true\n                      ),\n                      /*Determine what to do based on if the expression complexity changed*/\n                      a!match(\n                        value: local!isComplex,\n                        /*When complexity changed from simple to complex*/\n                        whenTrue: and(local!isComplex, not(local!wasComplex)),\n                        /*Save the rule operation to the expression conditions*/\n                        then: {\n                          a!save(ri!data, a!map(conditions: { ri!data })),\n                          a!save(ri!data.expressionOperator, \"AND\")\n                        },\n                        /*When complexity changed from complex to simple*/\n                        whenTrue: local!isComplex <> local!wasComplex,\n                        /*Remove all conditions and expressions*/\n                        then: a!save(ri!data, local!initalData),\n                        default: null\n                      )\n                    },\n                    a!save(\n                      ri!data.conditions,\n                      append(ri!data.conditions, save!value)\n                    )\n                  }\n                )\n              }\n            )\n          ),\n          /*Button to add a new nested expression*/\n          #\"SYSTEM_SYSRULES_sideBySideItem\"(\n            width: \"MINIMIZE\",\n            item: #\"SYSTEM_SYSRULES_linkField\"(\n              labelPosition: \"COLLAPSED\",\n              links: {\n                #\"SYSTEM_SYSRULES_dynamicLink\"(\n                  label: \"+ New Nested Expression\",\n                  value: local!initalData,\n                  saveInto: {\n                    /*Save new complex value*/\n                    a!save(\n                      local!isComplex,\n                      /*a!isNotNullOrEmpty(save!value)*/\n                      true\n                    ),\n                    /*Determine what to do based on if the expression complexity changed*/\n                    a!match(\n                      value: local!isComplex,\n                      /*When complexity changed from simple to complex*/\n                      whenTrue: and(local!isComplex, not(local!wasComplex)),\n                      /*Save the rule operation to the expression conditions*/\n                      then: {\n                        a!save(ri!data, a!map(conditions: { ri!data })),\n                        a!save(ri!data.expressionOperator, \"AND\")\n                      },\n                      /*When complexity changed from complex to simple*/\n                      whenTrue: local!isComplex <> local!wasComplex,\n                      /*Remove all conditions and expressions*/\n                      then: a!save(ri!data, a!map()),\n                      default: null\n                    ),\n                    a!save(\n                      ri!data.expressions,\n                      append(ri!data.expressions, save!value)\n                    )\n                  }\n                )\n              }\n            )\n          )\n        },\n        marginBelow: \"NONE\"\n      )\n    }\n  ),\n  {}\n)",
  "calls": [
    {
      "name": "AIA_RULE_ENUM_RuleOperations",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AIA_RULE_RuleDynamicComponents",
      "type": "Interface",
      "dep_type": "CALLS"
    },
    {
      "name": "AIA_Test_GetLatestExtractionModelVersion",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    }
  ],
  "called_by": [
    {
      "name": "AIA_ExtractionModelVersion_RecordAction_ValidationRules_CreateUpdate",
      "type": "Interface",
      "dep_type": "CALLS"
    }
  ]
}