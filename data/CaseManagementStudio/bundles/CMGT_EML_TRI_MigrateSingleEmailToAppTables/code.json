{
  "_metadata": {
    "bundle_id": "CMGT_EML_TRI_MigrateSingleEmailToAppTables"
  },
  "objects": {
    "_a-0000e40a-de32-8000-9ba8-011c48011c48_280802-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_chooseWherecontainsHelper",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Integer',\n  rule!CMGT_EML_TRI_CO_UT_replaceNull(\n    nullableValue: rule!CMGT_EML_TRI_CO_UT_whereContains(\n      values: ri!value,\n      array: ri!inArray\n    ) + 1,\n    replacementValue: 1\n  )\n)"
    },
    "_a-0000e40a-de32-8000-9ba8-011c48011c48_272151-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_whereContains",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Integer?list',\n  with(\n    local!array: a!flatten(ri!array),\n  \n    if(\n    \n      /*Have to handle separately for document types due to how it casts to string*/\n      rule!CMGT_EML_TRI_CO_UT_typeCompare(\n        value1: local!array,\n        value2: {todocument(null)}\n      ),\n      wherecontains(\n        todocument(ri!values),\n        local!array\n      ),\n    \n      /*Have to handle separately for group types due to how it casts to string*/\n      rule!CMGT_EML_TRI_CO_UT_typeCompare(\n        value1: local!array,\n        value2: {togroup(null)}\n      ),\n      wherecontains(\n        togroup(ri!values),\n        local!array\n      ),\n    \n      /*Casting to string accounts for any primitive type (integer, boolean, ect.)*/\n      wherecontains(\n        if(\n          rule!CMGT_EML_TRI_CO_UT_isBlank(ri!values),\n          touniformstring(ri!values),\n          touniformstring(a!flatten(ri!values))\n        ),\n        touniformstring(local!array)\n      )\n    )\n  )\n)"
    },
    "_a-0000ecc5-16e5-8000-9cfe-011c48011c48_3267703": {
      "name": "CMGT_EML_TRI_MessageText_HtmlTagsToReplace",
      "type": "Expression Rule",
      "sail_code": "{\n  /*Bold, italics, strikethrough*/\n  a!map(tags: \"<b>\", replacementTag: \"<strong>\"),\n  a!map(tags: \"<i>\", replacementTag: \"<em>\"),\n  a!map(tags: \"<strike>\", replacementTag: \"<s>\"),\n  a!map(tags: \"</b>\", replacementTag: \"</strong>\"),\n  a!map(tags: \"</i>\", replacementTag: \"</em>\"),\n  a!map(tags: \"</strike>\", replacementTag: \"</s>\"),\n  /*Legal text*/\n  a!map(\n    tags: \"<span style=\"\"font-size:x-small\"\">This message and any attachments are solely for the intended recipient. If you are not the intended recipient, disclosure, copying, use, or distribution of the information included in this message is prohibited -- please immediately and permanently delete this message.</span>\",\n    replacementTag: \"\"\n  ),\n  /*Deliberately done as <div> tags arent rendered as separate lines.*/\n  a!map(tags: \"<div>\", replacementTag: \"<br>\"),\n  a!map(tags: \"</div>\", replacementTag: \"\")\n}"
    },
    "_a-0000e98b-cfe0-8000-9ba5-011c48011c48_22352": {
      "name": "CMGT_UTIL_QueryRecord",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*Chosen return type*/\n  local!returnType: a!defaultValue(ri!returnType, \"OBJECT_ARRAY\"),\n  /*Determine the query parameters to use by the return type*/\n  local!queryParams: a!match(\n    value: local!returnType,\n    equals: \"OBJECT_ARRAY\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        #\"urn:appian:function:v1:a:listtype?okey=a!listType\"(ri!recordType),\n        'type!{http://www.appian.com/ae/types/2009}Map?list'\n      ),\n      fetchTotalCount: false,\n      isArray: true,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          cons!CMGT_INT_BATCH_SIZE_MAX\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"SINGLE_OBJECT\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        ri!recordType,\n        'type!{http://www.appian.com/ae/types/2009}Map'\n      ),\n      fetchTotalCount: false,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"DATA_SUBSET\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}DataSubset',\n      fetchTotalCount: true,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: a!defaultValue(ri!pagingInfo.startIndex, 1),\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          cons!CMGT_INT_BATCH_SIZE_MAX\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"TOTAL_COUNT\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}Integer',\n      fetchTotalCount: true,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(startIndex: 1, batchSize: 0)\n    ),\n    default: fn!error(\n      \"Invalid returnType, must be one of: OBJECT_ARRAY, SINGLE_OBJECT, DATA_SUBSET, TOTAL_COUNT\"\n    )\n  ),\n  if(\n    /*Early exit for skip execution*/\n    ri!executeWhen = false,\n    cast(\n      local!queryParams.castToType,\n      if(local!queryParams.isArray, {}, null)\n    ),\n    a!localVariables(\n      /*Run the query*/\n      local!queryResult: a!refreshVariable(\n        value: #\"SYSTEM_SYSRULES_queryRecordType_v2\"(\n          recordType: ri!recordType,\n          fields: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            reject(\n              a!isNullOrEmpty,\n              a!flatten(\n                {\n                  ri!fields,\n                  index(ri!relatedRecordData, \"relationship\", {})\n                }\n              )\n            ),\n            #\"SYSTEM_SYSRULES_aggregationFields\"(\n              groupings: #\"SYSTEM_SYSRULES_forEach\"(\n                items: ri!groupByFields,\n                expression: #\"SYSTEM_SYSRULES_grouping\"(field: fv!item, alias: tostring(fv!item))\n              ),\n              measures: #\"SYSTEM_SYSRULES_measure\"(\n                field: ri!groupByFields[1],\n                function: \"COUNT\",\n                alias: \"count\"\n              )\n            )\n          ),\n          filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n            operator: \"AND\",\n            ignoreFiltersWithEmptyValues: true,\n            logicalExpressions: {\n              ri!logicalExpressions,\n              if(\n                and(\n                  a!isNotNullOrEmpty(ri!searchFields),\n                  a!isNotNullOrEmpty(ri!searchTerm)\n                ),\n                #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                  operator: \"AND\",\n                  logicalExpressions: #\"SYSTEM_SYSRULES_forEach\"(\n                    items: split(trim(ri!searchTerm), \" \"),\n                    expression: a!localVariables(\n                      local!splitSearchTerm: fv!item,\n                      #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                        operator: \"OR\",\n                        filters: #\"SYSTEM_SYSRULES_forEach\"(\n                          items: ri!searchFields,\n                          expression: #\"SYSTEM_SYSRULES_queryFilter\"(\n                            field: fv!item,\n                            operator: \"includes\",\n                            value: local!splitSearchTerm\n                          )\n                        )\n                      )\n                    )\n                  )\n                ),\n                {}\n              )\n            },\n            filters: ri!filters\n          ),\n          pagingInfo: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            local!queryParams.pagingInfo,\n            #\"urn:appian:function:v1:a:update\"(\n              local!queryParams.pagingInfo,\n              \"sort\",\n              null\n            )\n          ),\n          fetchTotalCount: local!queryParams.fetchTotalCount,\n          relatedRecordData: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            ri!relatedRecordData,\n            {}\n          )\n        ),\n        refreshOnVarChange: ri!triggerRefresh,\n        refreshAfter: { \"RECORD_ACTION\" }\n      ),\n      /*Format the output*/\n      local!output: a!match(\n        value: local!returnType,\n        equals: \"OBJECT_ARRAY\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult.data\n        ),\n        equals: \"SINGLE_OBJECT\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult.data\n        ),\n        equals: \"DATA_SUBSET\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult\n        ),\n        equals: \"TOTAL_COUNT\",\n        then: local!queryResult.totalCount,\n        default: null\n      ),\n      local!output\n    )\n  )\n)"
    },
    "_a-0000e3e6-fb42-8000-9ba5-011c48011c48_157503-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_returnTypeNumber",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Integer',\n  if(\n    isnull(ri!type),\n    typeof(ri!typeOf),\n    typeof(cast(ri!type, null))\n  )\n)"
    },
    "_a-0000e415-3035-8000-9bb2-011c48011c48_291236-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_zINTERNAL_returnCdtFields_handler",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Text?list',\n  with(\n    local!blankCdt: rule!CMGT_EML_TRI_CO_UT_returnSingleTypeObject(\n      type: ri!type,\n      typeOf: ri!typeOf\n    ),\n    split(\n      extract(\n        substitute(\n          tostring(\n            local!blankCdt\n          ),\n          \"[Document:]\",\n          \"\"\n        ),\n        \"[\",\n        \"=]\"\n      ),\n      \"=, \"\n    )\n  )\n)"
    },
    "_a-0000ecc5-16e5-8000-9cfe-011c48011c48_3267718": {
      "name": "CMGT_EML_TRI_MessageText_HtmlRegularExpressionsCleansingLibrary",
      "type": "Expression Rule",
      "sail_code": "{\n  /*To Remove the Reply from GMAIL*/\n  a!map(\n    regexPattern: \"<br><div\\b[^>]*class=\"\"gmail_quote[^\"\"]*\"\"[^>]*>([\\s\\S]*?)<\\/div><blockquote\\b[^>]*class=\"\"gmail_quote[^\"\"]*\"\"[^>]*>([\\s\\S]*?)<\\/blockquote><\\/div>\",\n    replacementString: \"\"\n  ),\n  /*To remove gmail signature prefix*/\n  a!map(\n    regexPattern: \"<span class=\"\"gmail_signature_prefix\"\".*?>.*?</span>\",\n    replacementString: \"\"\n  ),\n  /*To remove gmail signature*/\n  a!map(\n    regexPattern: \"<div\\s+dir=\"\"ltr\"\"\\s+class=\"\"gmail_signature\"\".*?>[\\s\\S]*</body>\",\n    replacementString: \"</body>\"\n  ),\n  a!map(\n    regexPattern: \"<div>--</div>\",\n    replacementString: \"\"\n  ),\n  /* to remove outlook replies*/\n  a!map(\n    regexPattern: \"<div\\s+id=\"\"appendonsend\"\"(.*?)<div\\s+id=\"\"divRplyFwdMsg[\\s\\S]*</body>\",\n    replacementString: \"</body>\"\n  ),\n  /*to remove the imprint unique ids from outlook*/\n  a!map(\n    regexPattern: \"<p class=\"\"ImprintUniqueID\"\".*?>.*?</p>\",\n    replacementString: \"\"\n  ),\n  /*to remove outlook signature*/\n  a!map(\n    regexPattern: \"<div\\s+id=\"\"*Signature[\\s\\S]*</body>\",\n    replacementString: \"</body>\"\n  ),\n  /*Deliberately done as <div> tags arent rendered as separate lines.*/\n  /*Replacing div followed by a break with single <br> tag*/\n  a!map(\n    regexpattern: \"<div(?:\\s+dir=\"\"[^\"\"]*\"\")?(?:\\s+class=\"\"[^\"\"]*\"\")?(?:\\s+style=\"\"[^\"\"]*\"\")?>\\s*<br\\s*/?>\",\n    replacementString: \"<br>\"\n  ),\n  /*Replacing multiple <div> tags next to each with a single <br>*/\n  a!map(\n    regexpattern: \"(<div(?:\\s+dir=\"\"[^\"\"]*\"\")?(?:\\s+class=\"\"[^\"\"]*\"\")?(?:\\s+style=\"\"[^\"\"]*\"\")?>)+\",\n    replacementString: \"<br>\"\n  )\n}"
    },
    "_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73536-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_isBlank",
      "type": "Expression Rule",
      "sail_code": "cast(\n  'type!{http://www.appian.com/ae/types/2009}Boolean',\n  length(a!flatten(ri!value)) = 0\n)"
    },
    "_a-0000e9d3-70bf-8000-9bbd-011c48011c48_180568": {
      "name": "CMGT_UTIL_IsNotBlank",
      "type": "Expression Rule",
      "sail_code": "not(rule!CMGT_UTIL_IsBlank(ri!input))"
    },
    "_a-0000ecc5-16e5-8000-9cfe-011c48011c48_3267738": {
      "name": "CMGT_EML_TRI_MessageText_RegexReplaceAllLogic",
      "type": "Expression Rule",
      "sail_code": "regexreplaceall(\n  ri!pattern,\n  ri!searchString,\n  ri!replacementString\n)"
    },
    "_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73980-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_replaceNull",
      "type": "Expression Rule",
      "sail_code": "if(\n  rule!CMGT_EML_TRI_CO_UT_isBlank(ri!nullableValue),\n  ri!replacementValue,\n  ri!nullableValue\n)"
    },
    "_a-0000e3ff-a5bc-8000-9ba8-011c48011c48_39610-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_returnArrayTypeNumber",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Integer',\n  typeof(\n    a!flatten(\n      rule!CMGT_EML_TRI_CO_UT_cast(\n        type: ri!type,\n        typeOf: ri!typeOf,\n        value: null\n      )\n    )\n  )\n)"
    },
    "_a-0000ecb5-acf8-8000-9cf6-011c48011c48_3191171": {
      "name": "CMGT_EML_TRI_QE_GetPolledMailAttachmentDetails",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_EML_TRI_UTIL_QueryEntity(\n  entity: cons!CMGT_EML_TRI_ENT_POLLED_MAIL_ATTACHMENTS,\n  entityType: 'type!{urn:com:appian:types:CMGT_EML_TRI}CMGT_EML_TRI_MailPollerDoc',\n  filters: {\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: \"appMailPollerId\",\n      operator: \"in\",\n      value: ri!pollerId,\n      applyWhen: a!isNotNullOrEmpty(ri!pollerId)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: \"appMailPollerDocId\",\n      operator: \"=\",\n      value: ri!pollerDocId,\n      applyWhen: a!isNotNullOrEmpty(ri!pollerDocId)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: \"elt\",\n      operator: \"=\",\n      value: ri!elt,\n      applyWhen: a!isNotNullOrEmpty(ri!elt)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: \"isDeleted\",\n      operator: \"=\",\n      value: a!defaultValue(ri!isDeleted, false())\n    ),\n    ri!additionalFilters\n  },\n  logicalExpression: ri!additionalLogicalExpression,\n  executeWhen: or(\n    a!isNotNullOrEmpty(ri!pollerDocId),\n    a!isNotNullOrEmpty(ri!pollerId),\n    a!isNotNullOrEmpty(ri!elt)\n  ),\n  returnType: cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_OBJECT_ARRAY\n)"
    },
    "_a-0000e3e6-fb42-8000-9ba5-011c48011c48_157870-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_UTIL_QueryEntity",
      "type": "Expression Rule",
      "sail_code": "/*\n\nPLEASE REFER TO THE BOTTOM OF THIS RULE FOR INSTRUCTIONS ON HOW TO USE\n\nPlease DO NOT auto-format this rule\n\n*/\n/*Error handling for invalid returnType or entityType*/\nif(\n  rule!CMGT_EML_TRI_CO_UT_isBlank(ri!returnType),\n  fn!error(\n    concat(\n      \"Null `returnType` passed to CMGT_EML_TRI_UTIL_queryEntity for entityType `\",\n      ri!entityType,\n      \"`.  See documentation in CMGT_EML_TRI_UTIL_queryEntity for further information on how to use this parameter.\"\n    )\n  ),\n  not(\n    contains(\n      rule!CMGT_EML_TRI_CO_CONS_QE_RETURN_TYPES(),\n      ri!returnType\n    )\n  ),\n  fn!error(\n    concat(\n      \"Unknown `returnType` passed to CMGT_EML_TRI_UTIL_queryEntity for entityType `\",\n      ri!entityType,\n      \"`.  See documentation in CMGT_EML_TRI_UTIL_queryEntity for further information on how to use this parameter.\"\n    )\n  ),\n  rule!CMGT_EML_TRI_CO_UT_isBlank(ri!entityType),\n  fn!error(\n    concat(\n      \"Null `entityType` passed to CMGT_EML_TRI_UTIL_queryEntity for entity `\",\n      ri!entity,\n      \"`.  See documentation in CMGT_EML_TRI_UTIL_queryEntity for further information on how to use this parameter.\"\n    )\n  ),\n  and(\n    ri!returnType = cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET,\n    rule!CMGT_EML_TRI_CO_UT_isBlank(ri!pagingInfo)\n  ),\n  fn!error(\n    concat(\n      \"`pagingInfo` is required (cannot be null) for `returnType` DATA_SUBSET\"\n    )\n  ),\n  and(\n    ri!returnType <> cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET,\n    rule!CMGT_EML_TRI_CO_UT_isNotBlank(ri!pagingInfo)\n  ),\n  fn!error(\n    concat(\n      \"`pagingInfo` must be null when the `returnType` is not DATA_SUBSET, instead use `sort` to pass custom-sorting and `startIndex` & `batchSize` will be automatically calculated for you\"\n    )\n  ),\n  and(\n    ri!returnType = cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_AGGREGATION,\n    rule!CMGT_EML_TRI_CO_UT_isBlank(ri!aggregation)\n  ),\n  fn!error(\n    \"You must provide an input for `aggregation` when `returnType` is AGGREGATION\"\n  ),\n  and(\n    ri!returnType <> cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_AGGREGATION,\n    rule!CMGT_EML_TRI_CO_UT_isNotBlank(ri!aggregation)\n  ),\n  fn!error(\n    \"You cannot provide an input for `aggregation` when `returnType` is not AGGREGATION\"\n  ),\n  a!localVariables(\n    /*Determine the castResultToType*/\n    local!castResultToType: rule!CMGT_EML_TRI_CO_UT_displayValue(\n      value: ri!returnType,\n      inArray: rule!CMGT_EML_TRI_CO_CONS_QE_RETURN_TYPES(),\n      replacement: {\n        /*DATA_SUBSET*/'type!{http://www.appian.com/ae/types/2009}DataSubset',\n        /*SINGLE_OBJECT*/ri!entityType,\n        /*OBJECT_ARRAY*/rule!CMGT_EML_TRI_CO_UT_returnArrayTypeNumber(type: ri!entityType),\n        /*AGGREGATION*/'type!{http://www.appian.com/ae/types/2009}Map?list',\n        /*TOTAL_COUNT*/'type!{http://www.appian.com/ae/types/2009}Integer',\n        \n      }\n    ),\n    /*Determine the batchSize*/\n    local!batchSize: rule!CMGT_EML_TRI_CO_UT_displayValue(\n      value: ri!returnType,\n      inArray: rule!CMGT_EML_TRI_CO_CONS_QE_RETURN_TYPES(),\n      replacement: {\n        /*DATA_SUBSET*/ri!pagingInfo.batchSize,\n        /*SINGLE_OBJECT*/1,\n        /*OBJECT_ARRAY*/rule!CMGT_EML_TRI_CO_UT_replaceNull(\n          nullableValue: ri!pagingInfo.batchSize,\n          replacementValue: cons!CMGT_EML_TRI_CO_INT_QUERY_MAX_BATCH_SIZE\n        ),\n        /*AGGREGATION*/cons!CMGT_EML_TRI_CO_INT_QUERY_MAX_BATCH_SIZE,\n        /*TOTAL_COUNT*/0,\n        \n      }\n    ),\n    /*Determine the sort*/\n    local!sort: rule!CMGT_EML_TRI_CO_UT_zInternal_queryEntity_determineSort(\n      entityType: ri!entityType,\n      returnType: ri!returnType,\n      pagingInfo: ri!pagingInfo,\n      sort: ri!sort\n    ),\n    /*Determine the pagingInfo*/\n    local!pagingInfo: if(\n      ri!returnType = cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET,\n      /*Use specific pagingInfo for DATA_SUBSET*/\n      #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: ri!pagingInfo.startIndex,\n        batchSize: ri!pagingInfo.batchSize,\n        sort: local!sort\n      ),\n      /*Otherwise calculate pagingInfo for all other returnTypes*/\n      #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: local!batchSize,\n        sort: local!sort\n      )\n    ),\n    /*Determine the fetchTotalCount*/\n    local!fetchTotalCount: rule!CMGT_EML_TRI_CO_UT_displayValue(\n      value: ri!returnType,\n      inArray: rule!CMGT_EML_TRI_CO_CONS_QE_RETURN_TYPES(),\n      replacement: {\n        /*DATA_SUBSET*/true,\n        /*SINGLE_OBJECT*/false,\n        /*OBJECT_ARRAY*/false,\n        /*AGGREGATION*/false,\n        /*TOTAL_COUNT*/true,\n        \n      }\n    ),\n    /*Execute the query*/\n    local!queryResult: a!refreshVariable(\n      value: if(\n        ri!executeWhen = false,\n        null,\n        #\"SYSTEM_SYSRULES_queryEntity_v1\"(\n          entity: ri!entity,\n          fetchTotalCount: local!fetchTotalCount,\n          query: #\"SYSTEM_SYSRULES_query\"(\n            pagingInfo: local!pagingInfo,\n            aggregation: ri!aggregation,\n            selection: if(\n              and(\n                ri!excludeNestedCdts = true,\n                rule!CMGT_EML_TRI_CO_UT_isBlank(ri!aggregation)\n              ),\n              #\"SYSTEM_SYSRULES_querySelection\"(\n                columns: #\"SYSTEM_SYSRULES_forEach\"(\n                  items: rule!CMGT_EML_TRI_CO_UT_returnCdtFields(\n                    type: ri!entityType,\n                    onlyPrimitiveFields: true\n                  ),\n                  expression: #\"SYSTEM_SYSRULES_queryColumn\"(field: fv!item)\n                )\n              ),\n              null\n            ),\n            logicalExpression: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n              operator: \"AND\",\n              logicalExpressions: {\n                #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                  operator: \"AND\",\n                  ignoreFiltersWithEmptyValues: true,\n                  filters: rule!CMGT_EML_TRI_CO_UT_replaceNull(\n                    nullableValue: ri!filters,\n                    replacementValue: {}\n                  )\n                ),\n                rule!CMGT_EML_TRI_CO_UT_replaceNull(\n                  nullableValue: ri!logicalExpression,\n                  replacementValue: {}\n                )\n              }\n            )\n          )\n        )\n      ),\n      refreshOnVarChange: ri!triggerRefresh,\n      refreshAfter: { \"RECORD_ACTION\" }\n    ),\n    /*Parse the queryResult*/\n    local!queryResultParse: choose(\n      rule!CMGT_EML_TRI_CO_UT_chooseWherecontainsHelper(\n        value: ri!returnType,\n        inArray: rule!CMGT_EML_TRI_CO_CONS_QE_RETURN_TYPES()\n      ),\n      /*Default, required value based on how CMGT_EML_TRI_CO_UT_chooseWherecontainsHelper operates*/\"\",\n      /*DATA_SUBSET*/local!queryResult,\n      /*SINGLE_OBJECT*/local!queryResult.data,\n      /*OBJECT_ARRAY*/local!queryResult.data,\n      /*AGGREGATION*/local!queryResult.data,\n      /*TOTAL_COUNT*/local!queryResult.totalCount,\n      \n    ),\n    rule!CMGT_EML_TRI_CO_UT_cast(\n      type: local!castResultToType,\n      value: local!queryResultParse\n    )\n  )\n)/*\n\nDOCUMENTATION\n\nThis rule is designed to minimize the overhead with querying data and then casting the result\n\n\nRequired Inputs:\n\n1. entity \n- This is the data store entity you are querying\n-- e.g. cons!AS_DATA_STORE_ENTITY_CASES\n\n2. entityType\n- This is a type! input of the data type which maps to the underlying data store entity\n- Note that your type! input should not end in parenthesis; this is NOT designed to take in an empty CDT\n-- e.g. 'type!{urn:com:appian:types}Case'\n\n3. returnType\n- This depends on the purpose for the query, and should be one of the returnTypes in rule!CMGT_EML_TRI_CO_CONS_QE_RETURN_TYPES\n-- DATA_SUBSET - This will return a DataSubset; pagingInfo is required\n-- SINGLE_OBJECT - This will return a single CDT whose type is the entityType; pagingInfo must be null\n-- ARRAY_OBJECT - This will return an array of CDTs whos type is an array of the entityType; pagingInfo must be null\n-- AGGREGATION - This will return an array of Dictionaries; pagingInfo must be null\n---- NOTE: If you need Aggregation with paging controls, such as for a grid, use returnType DATA_SUBSET\n-- TOTAL_COUNT - This will return an Integer of the total count; pagingInfo must be null\n\n\nOptional Inputs:\n\n4. executeWhen\n- The query will not execute if this is false, the query will execute if this is true or null\n-- This is meant to operate in a similar manner to the showWhen parameter of components\n- Use this to skip execution of a query without needing to wrap if() statements around the rule\n-- Examples of this would be to skip querying if your filter value is a null ID\n- If the query does not execute, this will return a null value whose type is based on the returnType input\n\n5. triggerRefresh\n- By default, the query will always re-execute whenever any inputs change\n- However, by updating the value of triggerRefresh, you can also trigger a re-execution even if none of the other inputs change\n\n6. excludeNestedCdts\n- When true, this will exclude all nested CDTs from the query selection, and only include primitive fields\n- When false or null, all fields will be included in the query, including all nested CDTs\n\n7. filters\n- Array of filters to apply to the query, built with a!queryFilter()\n- These filters will be applied with an AND operator\n- These filters will apply in addition to the logicalExpression input, combining both with an AND operator\n\n8. logicalExpression\n- A logical expression to apply to the query, built with a!queryLogicalExpression()\n- This logical expression will apply in addition to the filters input, combining both with an AND operator\n\n9. aggregation\n- Aggregation to apply to the query, built with a!queryAggregation()\n\n10. pagingInfo\n- Paging info to apply to the query, built with a!pagingInfo() or derived from fv!pagingInfo in grids\n- This is required if passing returnType DATA_SUBSET, otherwise it must be null\n- For returnTypes that are not DATA_SUBSET, the batch size will be automatically calculated depending on the returnType\n-- For example, passing SINGLE_OBJECT will automatically apply a batch size of 1, whereas ARRAY_OBJECT and AGGREGATION will automatically apply a batch size of -1\n\n11. sort\n- Array of sort to apply to the query, built with a!sortInfo()\n- This is meant to be used with returnType ARRAY_OBJECT and AGGREGATION, since pagingInfo is not required for these, but a specified sort may be used\n- If both sort and pagingInfo.sort are passed with valid values, they will be applied in conjuction, with the sort parameter being the primary sort\n\n*/"
    },
    "_a-0000eaf1-7a52-8000-9c42-011c48011c48_1227353": {
      "name": "CMGT_UTIL_StripHtmlTags",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!replacedText: substitute(\n    substitute(ri!value, \"<p>\", \"\"),\n    \"</p>\",\n    \"\"\n  ),\n  if(\n    ri!isFormatted,\n    /*The striphtml() will automatically substitue char(10) for <br>*/striphtml(local!replacedText),\n    striphtml(\n      substitute(local!replacedText, \"<br>\", \" \")\n    )\n  )\n)"
    },
    "_a-0000ecb1-795b-8000-9cf4-011c48011c48_3174906": {
      "name": "CMGT_EML_TRI_DisableLinksFromIncomingMessages",
      "type": "Expression Rule",
      "sail_code": "if(\n  rule!CMGT_UTIL_IsBlank(value: ri!messageText),\n  null(),\n  regexreplaceall(\n    \"<a\\s+[^>]*>(.*?)<\\/a\\s*>\",\n    ri!messageText,\n    \"$1\"\n  )\n)"
    },
    "_a-0000e52f-5316-8000-9bac-011c48011c48_303936-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_zInternal_queryEntity_determineSort",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!sortToUse: if(\n    /*SINGLE_OBJECT*/\n    ri!returnType = cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_SINGLE_OBJECT,\n    ri!sort,\n    \n    /*AGGREGATION*/\n    ri!returnType = cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_AGGREGATION,\n    ri!sort,\n    \n    /*TOTAL_COUNT*/\n    ri!returnType = cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_TOTAL_COUNT,\n    null,\n    \n    /*DATA_SUBSET or OBJECT_ARRAY*/\n    a!localVariables(\n      /*Guess what the primary key is by using the first primitive field in the CDT*/\n      local!primaryKeyField_guess: index(rule!CMGT_EML_TRI_CO_UT_returnCdtFields(\n        type: ri!entityType,\n        onlyPrimitiveFields: true\n      ), 1, null),\n      \n      /*Grab the appropriate input sort by the returnType*/\n      local!inputSort: if(\n        ri!returnType = cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET,\n        ri!pagingInfo.sort,\n        \n        ri!returnType = cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_OBJECT_ARRAY,\n        ri!sort,\n        \n        null\n      ),\n      \n      /*If the primaryKeyField_guess is not null, build a secondary sort by the PK field*/\n      local!secondaryPkSortToAppend: if(\n        isnull(local!primaryKeyField_guess),\n        {},\n        #\"SYSTEM_SYSRULES_sortInfo\"(field: local!primaryKeyField_guess, ascending: true)\n      ),\n      \n      /*Append the secondary PK sort to the sort*/\n      local!sortWithSecondaryPkSortApplied: if(\n        rule!CMGT_EML_TRI_CO_UT_isBlank(local!inputSort),\n        local!secondaryPkSortToAppend,\n        append(local!inputSort, local!secondaryPkSortToAppend)\n      ),\n      \n      local!sortWithSecondaryPkSortApplied\n    )\n  ),\n  \n  local!sortToUse\n)"
    },
    "_a-0000ecb5-acf8-8000-9cf6-011c48011c48_3194083": {
      "name": "CMGT_EML_TRI_ConstructAttachmentsForPollerMessage",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*get the attachments from poller doc table */\n  local!emailPollerDocs: rule!CMGT_EML_TRI_QE_GetPolledMailAttachmentDetails(\n    pollerId: ri!emailPollerId,\n    isDeleted: false()\n  ),\n  #\"SYSTEM_SYSRULES_forEach\"(\n    items: local!emailPollerDocs,\n    expression: recordType!CMGT_EML_TRI_Attachment(\n      recordType!CMGT_EML_TRI_Attachment.appianDocumentId: fv!item.elt,\n      recordType!CMGT_EML_TRI_Attachment.threadId: ri!threadId\n    )\n  )\n)"
    },
    "_a-0000e3e6-fb42-8000-9ba5-011c48011c48_157548-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_checkIfSingleType",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Boolean',\n  with(\n    local!typeNumber: rule!CMGT_EML_TRI_CO_UT_returnTypeNumber(\n      type: ri!type,\n      typeOf: ri!typeOf\n    ),\n  \n    and(\n      /*The type of the input equals the type of the input returned as single type*/\n      local!typeNumber = rule!CMGT_EML_TRI_CO_UT_returnTypeNumber(\n        typeOf: rule!CMGT_EML_TRI_CO_UT_returnSingleTypeObject(typeOf: cast(local!typeNumber, null))\n      ),\n      \n      /*And the type of the input is not list of variant*/\n      local!typeNumber <> rule!CMGT_EML_TRI_CO_UT_returnTypeNumber(\n        typeOf: {}\n      )\n    )\n  )\n)"
    },
    "_a-0000e3e6-fb42-8000-9ba5-011c48011c48_187421-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_displayValue",
      "type": "Expression Rule",
      "sail_code": "displayvalue(\n  \n  ri!value,\n  \n  ri!inArray,\n  \n  ri!replacement,\n  \n  if(\n    \n    ri!firstIsDefault,\n    ri!replacement[1],\n    \n    ri!lastIsDefault,\n    ri!replacement[count(ri!replacement)],\n    \n    ri!customDefault\n  )\n)"
    },
    "_a-0000ecb5-acf8-8000-9cf6-011c48011c48_3190514": {
      "name": "CMGT_EML_TRI_QE_GetPolledMailDetails",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_EML_TRI_UTIL_QueryEntity(\n  entity: cons!CMGT_EML_TRI_ENT_POLLED_MAIL,\n  entityType: 'type!{urn:com:appian:types:CMGT_EML_TRI}CMGT_EML_TRI_MailPoller',\n  filters: {\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: \"appMailPollerId\",\n      operator: \"in\",\n      value: ri!appMailpollerId,\n      applyWhen: a!isNotNullOrEmpty(ri!appMailpollerId)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: \"messageId\",\n      operator: \"=\",\n      value: ri!messageId,\n      applyWhen: a!isNotNullOrEmpty(ri!messageId)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: \"messageGraphId\",\n      operator: \"=\",\n      value: ri!messageGraphId,\n      applyWhen: a!isNotNullOrEmpty(ri!messageGraphId)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: \"status\",\n      operator: \"=\",\n      value: ri!status,\n      applyWhen: a!isNotNullOrEmpty(ri!status)\n    ),\n    ri!additionalFilters,\n\n  },\n  logicalExpression: ri!additionalLogicalExpression,\n  returnType: a!defaultValue(\n    ri!returnType,\n    cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_OBJECT_ARRAY\n  ),\n  pagingInfo: if(\n    ri!returnType <> cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET,\n    null,\n    a!defaultValue(ri!pagingInfo,#\"SYSTEM_SYSRULES_pagingInfo\"(1, cons!CMGT_INT_BATCH_SIZE_MEDIUM))\n  )\n)"
    },
    "_a-0000e9d3-70bf-8000-9bbd-011c48011c48_180481": {
      "name": "CMGT_UTIL_RejectBlank",
      "type": "Expression Rule",
      "sail_code": "cast(\n  runtimetypeof(a!flatten(ri!array)),\n  reject(a!isNullOrEmpty(_), a!flatten(ri!array))\n)"
    },
    "_a-0000ecc5-16e5-8000-9cfe-011c48011c48_3267710": {
      "name": "CMGT_EML_TRI_MessageText_CleanHtmlLogic",
      "type": "Expression Rule",
      "sail_code": "if(\n  rule!CMGT_UTIL_IsBlank(value: ri!body),\n  null(),\n  a!localVariables(\n    local!regexPattern: {\n      index(\n        rule!CMGT_EML_TRI_MessageText_HtmlRegularExpressionsCleansingLibrary(),\n        \"regexPattern\",\n        null()\n      )\n    },\n    local!regexReplacementString: {\n      index(\n        rule!CMGT_EML_TRI_MessageText_HtmlRegularExpressionsCleansingLibrary(),\n        \"replacementString\",\n        null()\n      )\n    },\n    local!bodyAfterRegexCleanup: reduce(\n      rule!CMGT_EML_TRI_MessageText_RegexReplaceAllLogic(\n        searchString: _,\n        pattern: _,\n        replacementString: _\n      ),\n      ri!body,\n      merge(\n        { local!regexPattern },\n        { local!regexReplacementString }\n      )\n    ),\n    local!tags: index(\n      rule!CMGT_EML_TRI_MessageText_HtmlTagsToReplace(),\n      \"tags\",\n      null()\n    ),\n    local!replacementTag: index(\n      rule!CMGT_EML_TRI_MessageText_HtmlTagsToReplace(),\n      \"replacementTag\",\n      null()\n    ),\n    reduce(\n      substitute(_, _, _),\n      local!bodyAfterRegexCleanup,\n      merge({ local!tags }, { local!replacementTag })\n    )\n  )\n)"
    },
    "_a-0000e2ad-62e7-8000-9ba2-011c48011c48_75660-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_returnCdtFields",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Text?list',\n  with(\n    local!cdtFields: rule!CMGT_EML_TRI_CO_UT_zINTERNAL_returnCdtFields_handler(\n      type: ri!type,\n      typeOf: ri!typeOf\n    ),\n    \n    if(\n      ri!onlyPrimitiveFields,\n      filter(\n        rule!CMGT_EML_TRI_CO_UT_zINTERNAL_returnCdtFields_primitiveTypeCheckHandler(\n          singleType: rule!CMGT_EML_TRI_CO_UT_returnSingleTypeObject(\n            type: ri!type,\n            typeOf: ri!typeOf\n          ),\n          field: _\n        ),\n        local!cdtFields\n      ),\n      ri!onlyComplexFields,\n      reject(\n        rule!CMGT_EML_TRI_CO_UT_zINTERNAL_returnCdtFields_primitiveTypeCheckHandler(\n          singleType: rule!CMGT_EML_TRI_CO_UT_returnSingleTypeObject(\n            type: ri!type,\n            typeOf: ri!typeOf\n          ),\n          field: _\n        ),\n        local!cdtFields\n      ),\n      local!cdtFields\n    )\n  )\n)"
    },
    "_a-0000e36c-7599-8000-9ba2-011c48011c48_64438-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_zINTERNAL_returnCdtFields_primitiveTypeCheckHandler",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Boolean',\n  any(\n    rule!CMGT_EML_TRI_CO_UT_typeCompare(\n      value1: ri!singleType[ri!field],\n      value2: _\n    ),\n    apply(\n      cast(\n        _,\n        null\n      ),\n      rule!CMGT_EML_TRI_CO_CONS_PRIMITIVE_TYPE_ARRAY()\n    )\n  )\n)"
    },
    "_a-0000ecb5-acf8-8000-9cf6-011c48011c48_3192425": {
      "name": "CMGT_EML_TRI_ConstructMessageFromPoller",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!listOfRecicpients: rule!CMGT_UTIL_RejectBlank(\n    {\n      a!map(\n        email: ri!pollerMessage.fromEmail,\n        name: ri!pollerMessage.fromName,\n        type: \"FROM\"\n      ),\n      a!localVariables(\n        local!toNames: split(ri!pollerMessage.toNames, \";\"),\n        local!toEmails: split(ri!pollerMessage.toEmails, \";\"),\n        local!ccNames: split(ri!pollerMessage.ccNames, \";\"),\n        local!ccEmails: split(ri!pollerMessage.ccEmails, \";\"),\n        local!bccNames: split(ri!pollerMessage.bccNames, \";\"),\n        local!bccEmails: split(ri!pollerMessage.bccEmails, \";\"),\n        local!toEmailMap: #\"SYSTEM_SYSRULES_forEach\"(\n          items: local!toEmails,\n          expression: a!map(\n            email: fv!item,\n            name: index(local!toNames, fv!index, null),\n            type: \"TO\"\n          )\n        ),\n        local!ccEmailMap: if(\n          rule!CMGT_UTIL_IsBlank(local!ccEmails),\n          null,\n          #\"SYSTEM_SYSRULES_forEach\"(\n            items: local!ccEmails,\n            expression: a!map(\n              email: fv!item,\n              name: index(local!ccNames, fv!index, null()),\n              type: \"CC\"\n            )\n          )\n        ),\n        local!bccEmailMap: if(\n          rule!CMGT_UTIL_IsBlank(local!bccEmails),\n          null,\n          #\"SYSTEM_SYSRULES_forEach\"(\n            items: local!bccEmails,\n            expression: a!map(\n              email: fv!item,\n              name: index(local!bccNames, fv!index, null()),\n              type: \"BCC\"\n            )\n          )\n        ),\n        local!allMaps: rule!CMGT_UTIL_RejectBlank(\n          array: {\n            local!toEmailMap,\n            local!ccEmailMap,\n            local!bccEmailMap\n          }\n        ),\n        remove(\n          local!allMaps,\n          wherecontains(\n            cons!CMGT_EML_TRI_MAILBOX_EMAIL_ADDRESS,\n            local!allMaps.email\n          )\n        )\n      )\n    }\n  ),\n  local!cleanedEmailBody: rule!CMGT_EML_TRI_MessageText_CleanHtmlLogic(body: ri!pollerMessage.bodyHtml),\n  recordType!CMGT_EML_TRI_Message(\n    recordType!CMGT_EML_TRI_Message.threadId: ri!threadId,\n    recordType!CMGT_EML_TRI_Message.messagePollerId: ri!pollerMessage.messageId,\n    recordType!CMGT_EML_TRI_Message.isActive: true,\n    recordType!CMGT_EML_TRI_Message.createdBy: cons!CMGT_EML_TRI_TXT_SYSTEM,\n    recordType!CMGT_EML_TRI_Message.createdOn: ri!pollerMessage.receivedDate,\n    recordType!CMGT_EML_TRI_Message.modifiedBy: cons!CMGT_EML_TRI_TXT_SYSTEM,\n    recordType!CMGT_EML_TRI_Message.modifiedOn: ri!pollerMessage.receivedDate,\n    /*'recordType!{851ef4a4-12f4-407e-aae5-713b0284c304-cmgt_eml_tri}CMGT_EML_TRI_Message.relationships.{29171887-90d8-4eab-9fc5-b53a9c0dc5d6-cmgt_eml_tri}attachments': rule for attachments,*/\n    recordType!CMGT_EML_TRI_Message.messageRecipients: {\n      #\"SYSTEM_SYSRULES_forEach\"(\n        local!listOfRecicpients,\n        recordType!CMGT_EML_TRI_MessageRecipient(\n          recordType!CMGT_EML_TRI_MessageRecipient.recipient: fv!item.name,\n          recordType!CMGT_EML_TRI_MessageRecipient.recipientEmail: fv!item.email,\n          recordType!CMGT_EML_TRI_MessageRecipient.isSender: if(fv!item.type = \"FROM\", true, false)\n        )\n      ),\n      /*we want to add the recipient for the to - mailbox*/\n      recordType!CMGT_EML_TRI_MessageRecipient(\n        recordType!CMGT_EML_TRI_MessageRecipient.recipientEmail: cons!CMGT_EML_TRI_MAILBOX_EMAIL_ADDRESS,\n        recordType!CMGT_EML_TRI_MessageRecipient.isSender: false\n      )\n    },\n    recordType!CMGT_EML_TRI_Message.attachments: rule!CMGT_EML_TRI_ConstructAttachmentsForPollerMessage(\n      threadId: ri!threadId,\n      emailPollerId: ri!pollerMessage.appMailPollerId\n    ),\n    recordType!CMGT_EML_TRI_Message.messageText: recordType!CMGT_EML_TRI_MessageText(\n      recordType!CMGT_EML_TRI_MessageText.message: rule!CMGT_EML_TRI_DisableLinksFromIncomingMessages(local!cleanedEmailBody),\n      recordType!CMGT_EML_TRI_MessageText.plainTextMessage: trim(\n        /*to remove extra spaces from cleaned email body*/fn!substitute(\n          rule!CMGT_UTIL_StripHtmlTags(\n            value: local!cleanedEmailBody,\n            isFormatted: false\n          ),\n          fn!char(10),\n          \" \"\n        )\n      )\n    )\n  )\n)"
    },
    "af326a29-a1c8-4399-a28d-996f85819d9e": {
      "name": "CMGT_UTIL_Filter",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!fieldValuePairs: a!defaultValue(\n    ri!fieldValuePairs,\n    apply(\n      rule!CMGT_UTIL_Filter_CreateFieldValuePair(\n        field: _,\n        value: ri!value,\n        allFields: a!flatten(ri!field)\n      ),\n      a!flatten(ri!field)\n    )\n  ),\n  local!matchingCriteria: a!defaultValue(\n    value: ri!matchingCriteria,\n    default: \"ALL\"\n  ),\n  local!matchType: a!defaultValue(value: ri!matchType, default: \"EXACT\"),\n  local!matchIndices: if(\n    a!isNullOrEmpty(a!flatten(ri!records)),\n    tointeger({}),\n    reduce(\n      rule!CMGT_UTIL_Filter_Reducer(\n        matchingCriteria: local!matchingCriteria,\n        previousIndices: _,\n        records: a!flatten(ri!records),\n        fieldValuePair: _,\n        matchType: local!matchType\n      ),\n      a!match(\n        value: local!matchingCriteria,\n        equals: \"ALL\",\n        then: enumerate(count(a!flatten(ri!records))) + 1,\n        equals: \"ANY\",\n        then: {},\n        default: fn!error(\n          \"Invalid matchingCriteria, must be one of: ALL, ANY\"\n        )\n      ),\n      local!fieldValuePairs\n    )\n  ),\n  local!rejectIndices: difference(\n    if(\n      a!isNullOrEmpty(ri!records),\n      tointeger({}),\n      enumerate(count(a!flatten(ri!records))) + 1\n    ),\n    local!matchIndices\n  ),\n  local!matches: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!matchIndices, {})\n  ),\n  local!rejects: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!rejectIndices, {})\n  ),\n  local!output: a!match(\n    value: a!defaultValue(ri!filterType, \"FILTER\"),\n    equals: \"FILTER\",\n    then: local!matches,\n    equals: \"REJECT\",\n    then: local!rejects,\n    equals: \"FIRST_MATCH\",\n    then: index(local!matches, 1, null),\n    equals: \"FIRST_REJECT\",\n    then: index(local!rejects, 1, null),\n    equals: \"MATCH_COUNT\",\n    then: count(local!matchIndices),\n    equals: \"REJECT_COUNT\",\n    then: count(local!rejectIndices),\n    equals: \"MATCH_INDICES\",\n    then: local!matchIndices,\n    equals: \"REJECT_INDICES\",\n    then: local!rejectIndices,\n    equals: \"FULL_RESULT\",\n    then: a!map(\n      matches: local!matches,\n      rejects: local!rejects,\n      firstMatch: index(local!matches, 1, null),\n      firstReject: index(local!rejects, 1, null),\n      matchCount: count(local!matchIndices),\n      rejectCount: count(local!rejectIndices),\n      matchIndices: local!matchIndices,\n      rejectIndices: local!rejectIndices\n    ),\n    default: fn!error(\n      \"Invalid filterType, must be one of: FILTER, REJECT, FIRST_MATCH, FIRST_REJECT, MATCH_COUNT, REJECT_COUNT, MATCH_INDICES, REJECT_INDICES, FULL_RESULT\"\n    )\n  ),\n  local!output\n)"
    },
    "_a-0000ea1d-36f5-8000-9bef-011c48011c48_538451": {
      "name": "CMGT_UTIL_GenerateUuid_NonPlugin",
      "type": "Expression Rule",
      "sail_code": "/*Reference:\nhttps://community.appian.com/w/the-appian-playbook/846/generating-uuids-guids*/\nfn!lower(\n  concat(\n    {\n      dec2hex(tointeger(rand(4) * 256), 2),\n      /*8 hex digits*/\n      \"-\",\n      dec2hex(tointeger(rand(2) * 256), 2),\n      /*4 hex digits*/\n      \"-4\",\n      /*version 4 = completely random*/\n      dec2hex(rand(3) * 256, 1),\n      /*3 hex digits*/\n      \"-\",\n      bin2hex(\"10\" & dec2bin(rand(1) * 4, 2), 1),\n      /*1 hex digit = Variant: 1st 2 bits=10=[ISO/IEC] + 2 rand bits*/\n      dec2hex(rand(3) * 256, 1),\n      /*3 hex digits*/\n      \"-\",\n      dec2hex(tointeger(rand(6) * 256), 2),\n      /*12 hex digits*/\n      \n    }\n  )\n)"
    },
    "_a-0000e2ad-62e7-8000-9ba2-011c48011c48_75782-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_isNotBlank",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Boolean',\n  not(rule!CMGT_EML_TRI_CO_UT_isBlank(ri!input))\n)"
    },
    "_a-0000e415-3035-8000-9bb2-011c48011c48_290200-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_CONS_QE_RETURN_TYPES",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Text?list',\n  {\n    cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET,\n    cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_SINGLE_OBJECT,\n    cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_OBJECT_ARRAY,\n    cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_AGGREGATION,\n    cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_TOTAL_COUNT,\n  }\n)"
    },
    "000decbc-1ab2-8000-1954-7f0000014e7a": {
      "name": "CMGT_EML_TRI_MigrateSingleEmailToAppTables",
      "type": "Process Model",
      "sail_code": "// Output: ?\nand(\n  a!isNullOrEmpty(pv!incomingEmail.inReplyTo),\n  a!isNullOrEmpty(\n    rule!CMGT_EML_TRI_ExtractThreadUUIDFromHTML(pv!incomingEmail.bodyHtml)\n  )\n)\n\n// Input: ?\na!localVariables(\n  local!threadUuid: rule!CMGT_EML_TRI_ExtractThreadUUIDFromHTML(pv!incomingEmail.bodyHtml),\n  local!existingMessages: rule!CMGT_EML_TRI_QR_getMessages(\n    returnType: \"SINGLE_OBJECT\",\n    additionalLogicalExpressions: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n      operator: \"OR\",\n      filters: {\n        #\"SYSTEM_SYSRULES_queryFilter\"(\n          field: recordType!CMGT_EML_TRI_Message.messagePollerId,\n          operator: \"=\",\n          value: pv!incomingEmail.inReplyTo\n        ),\n        #\"SYSTEM_SYSRULES_queryFilter\"(\n          field: recordType!CMGT_EML_TRI_Message.thread.threadUuid,\n          operator: \"=\",\n          value: local!threadUuid,\n          applyWhen: a!isNotNullOrEmpty(local!threadUuid)\n        )\n      }\n    )\n  ),\n  rule!CMGT_EML_TRI_ConstructMessageFromPoller(\n    pollerMessage: pv!incomingEmail,\n    threadId: local!existingMessages[recordType!CMGT_EML_TRI_Message.threadId]\n  )\n)\n\n// Input: ?\n=recordType!CMGT_EML_TRI_Message\n\n// Output: ?\nAC!RecordsUpdated\n\n// Input: ?\n={rule!CMGT_EML_TRI_ConstructThreadFromPoller(initialEmail: pv!incomingEmail)}\n\n// Input: ?\n={recordType!CMGT_EML_TRI_Thread}\n\n// Output: ?\nAC!RecordsUpdated\n\n// Input: ?\n={#\"urn:appian:function:v1:a:update\"(\n  data: a!flatten(\n    pv!thread[recordType!CMGT_EML_TRI_Thread.messages]\n  ),\n  index: recordType!CMGT_EML_TRI_Attachment.threadId,\n  value: pv!thread[recordType!CMGT_EML_TRI_Thread.threadId]\n)}\n\n// Input: ?\n={recordType!CMGT_EML_TRI_Attachment}\n\n// Output: ?\nappian:record-relationship:v1:53d3f93d-ccb6-423d-9238-2edf8811d08f-cmgt_eml_tri/d71930c6-baa2-4040-b922-878bb3ee848d-cmgt_eml_tri\"]:AC!RecordsUpdated\n\n// Input: ?\n=cons!CMGT_EML_TRI_ENT_POLLED_MAIL\n\n// Input: ?\n= #\"urn:appian:function:v1:a:update\"( pv!incomingEmail, \"status\", cons!CMGT_EML_TRI_TXT_INCOMING_EMAIL_INGESTION_COMPLETED)\n\n// Input: ?\n=pv!thread[recordType!CMGT_EML_TRI_Thread.messages][1][recordType!CMGT_EML_TRI_Message.attachments.appianDocumentId][tp!instanceindex]\n\n// Input: ?\n=a!documentFolderForRecordType(recordType!CMGT_EML_TRI_Attachment)\n\n// Input: ?\n={ {\n  #\"urn:appian:function:v1:a:update\"(\n    pv!thread,\n    {\n      recordType!CMGT_EML_TRI_Thread.threadStatus,\n      recordType!CMGT_EML_TRI_Thread.threadOriginator\n    },\n    {\n      cons!CMGT_EML_TRI_TRIAGE_STATUS_OPEN,\n      rule!CMGT_UTIL_Filter(\n        records: pv!thread[recordType!CMGT_EML_TRI_Thread.messages][1][recordType!CMGT_EML_TRI_Message.messageRecipients],\n        field: recordType!CMGT_EML_TRI_MessageRecipient.isSender,\n        value: true\n      )[recordType!CMGT_EML_TRI_MessageRecipient.messageRecipientId]\n    }\n  )\n}}\n\n// Input: ?\n={recordType!CMGT_EML_TRI_Thread}\n\n// Output: ?\nAC!RecordsUpdated\n\n// Input: ?\n=pv!message[recordType!CMGT_EML_TRI_Message.attachments.appianDocumentId][tp!instanceindex]\n\n// Input: ?\n=a!documentFolderForRecordType(recordType!CMGT_EML_TRI_Attachment)"
    },
    "_a-0000e3e6-fb42-8000-9ba5-011c48011c48_162769-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_typeCompare",
      "type": "Expression Rule",
      "sail_code": "cast(\n  'type!{http://www.appian.com/ae/types/2009}Boolean',\n  typeof(ri!value1) = typeof(ri!value2)\n)"
    },
    "_a-0000ecb5-acf8-8000-9cf6-011c48011c48_3191275": {
      "name": "CMGT_EML_TRI_ConstructThreadFromPoller",
      "type": "Expression Rule",
      "sail_code": "recordType!CMGT_EML_TRI_Thread(\n  recordType!CMGT_EML_TRI_Thread.subject: ri!initialEmail.subject,\n  recordType!CMGT_EML_TRI_Thread.isActive: true,\n  recordType!CMGT_EML_TRI_Thread.createdBy: cons!CMGT_EML_TRI_TXT_SYSTEM,\n  recordType!CMGT_EML_TRI_Thread.createdOn: ri!initialEmail.receivedDate,\n  recordType!CMGT_EML_TRI_Thread.modifiedBy: cons!CMGT_EML_TRI_TXT_SYSTEM,\n  recordType!CMGT_EML_TRI_Thread.modifiedOn: ri!initialEmail.receivedDate,\n  recordType!CMGT_EML_TRI_Thread.threadUuid: rule!CMGT_UTIL_GenerateUuid_NonPlugin(),\n  recordType!CMGT_EML_TRI_Thread.messages: rule!CMGT_EML_TRI_ConstructMessageFromPoller(pollerMessage: ri!initialEmail)\n)"
    },
    "_a-0000e2ad-62e7-8000-9ba2-011c48011c48_75842-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_returnSingleTypeObject",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!typeOf: if(\n    isnull(ri!type),\n    ri!typeOf,\n    cast(\n      ri!type,\n      {}\n    )\n  ),\n\n  index(\n    cast(\n      typeof({local!typeOf}), \n      updatearray({local!typeOf}, 1, {})\n    ), \n    1,\n    {}\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_25890": {
      "name": "CMGT_UTIL_IsBlank",
      "type": "Expression Rule",
      "sail_code": "length(a!flatten(ri!value)) = 0"
    },
    "_a-0000e415-3035-8000-9bb2-011c48011c48_291284-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_CONS_PRIMITIVE_TYPE_ARRAY",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Type?list',\n  {\n    /* 1*/ 'type!{http://www.appian.com/ae/types/2009}Text',\n    /* 2*/ 'type!{http://www.appian.com/ae/types/2009}Integer',\n    /* 3*/ 'type!{http://www.appian.com/ae/types/2009}Decimal',\n    /* 4*/ 'type!{http://www.appian.com/ae/types/2009}Boolean',\n    /* 5*/ 'type!{http://www.appian.com/ae/types/2009}Date',\n    /* 6*/ 'type!{http://www.appian.com/ae/types/2009}Datetime',\n    /* 7*/ 'type!{http://www.appian.com/ae/types/2009}Time',\n    /* 8*/ 'type!{http://www.appian.com/ae/types/2009}User',\n    /* 9*/ 'type!{http://www.appian.com/ae/types/2009}Group',\n    /*10*/ 'type!{http://www.appian.com/ae/types/2009}UserOrGroup',\n    /*11*/ 'type!{http://www.appian.com/ae/types/2009}Document',\n    /*12*/ 'type!{http://www.appian.com/ae/types/2009}Folder',\n  }\n)"
    },
    "_a-0000e3e6-fb42-8000-9ba5-011c48011c48_157603-msg-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_CO_UT_cast",
      "type": "Expression Rule",
      "sail_code": "with(  \n  local!typeNumber: rule!CMGT_EML_TRI_CO_UT_returnTypeNumber(\n    type: ri!type,\n    typeOf: ri!typeOf\n  ),\n\n  /* If the object is empty, use null or {} depending on if it is array type or not */\n  local!objectToCast: if(\n    rule!CMGT_EML_TRI_CO_UT_isNotBlank(ri!value),\n    ri!value,\n    rule!CMGT_EML_TRI_CO_UT_checkIfSingleType(\n      type: ri!type,\n      typeOf: ri!typeOf\n    ),\n    null,\n    {}\n  ),\n\n  cast(\n    local!typeNumber,\n    local!objectToCast\n  )\n  \n)"
    },
    "_a-0000e882-ff68-8000-9bb2-011c48011c48_34992-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_QR_getMessages",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_EML_TRI_Message,\n  filters: {\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.threadId,\n      operator: \"in\",\n      value: ri!threadIds,\n      applywhen: rule!CMGT_UTIL_IsNotBlank(ri!threadIds)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.createdBy,\n      operator: \"includes\",\n      value: ri!createdBy,\n      applywhen: rule!CMGT_UTIL_IsNotBlank(ri!createdBy)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.messageId,\n      operator: \"in\",\n      value: ri!messageIds,\n      applywhen: rule!CMGT_UTIL_IsNotBlank(ri!messageIds)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.messageId,\n      operator: \"not in\",\n      value: ri!excludeMessageIds,\n      applywhen: rule!CMGT_UTIL_IsNotBlank(ri!excludeMessageIds)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.messageRecipients.recipient,\n      operator: \"in\",\n      value: ri!recipients\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.isActive,\n      operator: \"in\",\n      value: { a!defaultValue(ri!isActive, true) }\n    ),\n    ri!additionalFilters\n  },\n  logicalExpressions: { ri!additionalLogicalExpressions },\n  fields: {\n    ri!fields,\n    recordType!CMGT_EML_TRI_Message.messageText\n  },\n  returnType: ri!returnType,\n  executeWhen: ri!executeWhen,\n  triggerRefresh: ri!triggerRefresh,\n  sort: ri!sort,\n  pagingInfo: ri!pagingInfo,\n  relatedRecordData: ri!relatedRecordData,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "3aa71948-7657-46da-bb00-cae6e7ebe83d": {
      "name": "CMGT_EML_TRI_ExtractThreadUUIDFromHTML",
      "type": "Expression Rule",
      "sail_code": "if(\n  rule!CMGT_UTIL_IsBlank(ri!message),\n  null(),\n  a!localVariables(\n    local!extractThreadUUID: regexfirstmatch(\"threadUUID:([a-zA-Z0-9_-]+)\", ri!message),\n    if(\n      a!isNotNullOrEmpty(local!extractThreadUUID),\n      substitute(\n        local!extractThreadUUID,\n        \"threadUUID:\",\n        \"\"\n      ),\n      \"\"\n    )\n  )\n)\n"
    }
  }
}