{
  "_metadata": {
    "bundle_id": "AIA_Extraction_Instance_-_urnappiantranslation-stringv1fe44019d-6588-4b35-8075-2"
  },
  "objects": {
    "_a-0000ed46-3c8c-8000-9bac-011c48011c48_12129": {
      "name": "AIA_UTIL_LoadBrandingMap",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!brandingDefault: getbrandingconfig(\n    cons!AIA_DOC_DEFAULT_BRANDING_CONFIG,\n    true()\n  ),\n  local!output: reduce(\n    #\"urn:appian:function:v1:a:update\"(_, _, _),\n    a!map(),\n    merge(\n      {\n        local!brandingDefault.defaultBranding.key,\n        local!brandingDefault.customBranding.key\n      },\n      {\n        local!brandingDefault.defaultBranding.value,\n        local!brandingDefault.customBranding.value\n      }\n    )\n  ),\n  local!output\n)"
    },
    "_a-0000ec2d-5396-8000-9bdc-011c48011c48_40839": {
      "name": "AIA_Test_GetLatestExtractionInstance",
      "type": "Expression Rule",
      "sail_code": "rule!AIA_Extraction_GetInstanceById(\n  identifier: #\"SYSTEM_SYSRULES_queryRecordType_v3\"(\n    recordType: recordType!AIA Extraction Instance,\n    pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n      startIndex: 1,\n      batchSize: 1,\n      sort: {\n        #\"SYSTEM_SYSRULES_sortInfo\"(\n          field: recordType!AIA Extraction Instance.id\n        )\n      }\n    )\n  ).data[recordType!AIA Extraction Instance.id],\n  additionalFields: {\n    recordType!AIA Extraction Instance.instanceUuid,\n    recordType!AIA Extraction Instance.modelVersion.versionId,\n    recordType!AIA Extraction Instance.modelVersion.modelId,\n    recordType!AIA Extraction Instance.modelVersion.uuid,\n    recordType!AIA Extraction Instance.modelVersion.extractionModel.key,\n    recordType!AIA Extraction Instance.documentFolderId,\n    recordType!AIA Extraction Instance.fieldCount,\n    recordType!AIA Extraction Instance.sections,\n    recordType!AIA Extraction Instance.boundingBoxes,\n    recordType!AIA Extraction Instance.responseDocumentId,\n    recordType!AIA Extraction Instance.sourceDocumentId\n  }\n)"
    },
    "_a-0000eeb3-c7af-8000-9c01-011c48011c48_155121": {
      "name": "AIA_QR_getModelTestSuiteCase",
      "type": "Expression Rule",
      "sail_code": "rule!SHRD_UTIL_QueryRecord(\n  recordType: recordType!AIA Model Test Suite Case,\n  returnType: ri!returnType,\n  fields: ri!fields,\n  executeWhen: ri!executeWhen,\n  filters: {\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Test Suite Case.modelTestSuite.modelUuid,\n      operator: \"=\",\n      value: ri!modelUuid,\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Test Suite Case.baselineInstanceUuid,\n      operator: \"=\",\n      value: ri!baselineInstanceUuid,\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Test Suite Case.modelTestSuiteId,\n      operator: \"in\",\n      value: ri!modelTestSuiteIds\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Test Suite Case.modelTestSuiteId,\n      operator: \"not in\",\n      value: ri!modelTestSuiteIdsToExclude\n    ),\n  },\n  sort: #\"SYSTEM_SYSRULES_sortInfo\"(\n    field: recordType!AIA Model Test Suite Case.testSuiteCaseId,\n    ascending: true\n  )\n)"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_36163": {
      "name": "SHRD_UTIL_QueryRecord",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!maxBatchSize: 5000,\n  /*Chosen return type*/\n  local!returnType: a!defaultValue(ri!returnType, \"OBJECT_ARRAY\"),\n  /*Determine the query parameters to use by the return type*/\n  local!queryParams: a!match(\n    value: local!returnType,\n    equals: \"OBJECT_ARRAY\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        #\"urn:appian:function:v1:a:listtype?okey=a!listType\"(ri!recordType),\n        'type!{http://www.appian.com/ae/types/2009}Map?list'\n      ),\n      fetchTotalCount: false,\n      isArray: true,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          local!maxBatchSize\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"SINGLE_OBJECT\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        ri!recordType,\n        'type!{http://www.appian.com/ae/types/2009}Map'\n      ),\n      fetchTotalCount: false,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"RECORD_BY_ID\",\n    then: a!map(\n      castToType: ri!recordType,\n      fetchTotalCount: false,\n      isArray: false,\n      queryRecordByIdentifier: true,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"DATA_SUBSET\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}DataSubset',\n      fetchTotalCount: true,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: a!defaultValue(ri!pagingInfo.startIndex, 1),\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          local!maxBatchSize\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"TOTAL_COUNT\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}Integer',\n      fetchTotalCount: true,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(startIndex: 1, batchSize: 0)\n    ),\n    default: fn!error(\n      \"Invalid returnType, must be one of: OBJECT_ARRAY, SINGLE_OBJECT, RECORD_BY_ID, DATA_SUBSET, TOTAL_COUNT\"\n    )\n  ),\n  if(\n    /*Early exit for skip execution*/\n    ri!executeWhen = false,\n    cast(\n      local!queryParams.castToType,\n      if(local!queryParams.isArray, {}, null)\n    ),\n    a!localVariables(\n      /*Run the query*/\n      local!queryResult: a!refreshVariable(\n        value: if(\n          local!queryParams.queryRecordByIdentifier,\n          #\"SYSTEM_SYSRULES_queryRecordByIdentifier\"(\n            recordType: ri!recordType,\n            identifier: index({ri!identifier},1,null),\n            /*If fields is sent in using a!selectionFields(), then adding the fields contained in ri!relatedRecordData will break the query*/\n            fields: reject(\n              a!isNullOrEmpty,\n              a!flatten(\n                {\n                  ri!fields,\n                  if(\n                    or(\n                      typeof(ri!fields) = typeof(#\"SYSTEM_SYSRULES_selectionFields\"()),\n                      typeof(ri!fields) = typeof({#\"SYSTEM_SYSRULES_selectionFields\"()})\n                    ),\n                    {},\n                    index(ri!relatedRecordData, \"relationship\", {})\n                  )\n                }\n              )\n            ),\n            relatedRecordData: ri!relatedRecordData\n          ),\n          #\"SYSTEM_SYSRULES_queryRecordType_v1\"(\n            recordType: ri!recordType,\n            fields: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              reject(\n                a!isNullOrEmpty,\n                a!flatten(\n                  {\n                    ri!fields,\n                    index(ri!relatedRecordData, \"relationship\", {})\n                  }\n                )\n              ),\n              #\"SYSTEM_SYSRULES_aggregationFields\"(\n                groupings: #\"SYSTEM_SYSRULES_forEach\"(\n                  items: ri!groupByFields,\n                  expression: #\"SYSTEM_SYSRULES_grouping\"(field: fv!item, alias: tostring(fv!item))\n                ),\n                measures: #\"SYSTEM_SYSRULES_measure\"(\n                  field: ri!groupByFields[1],\n                  function: \"COUNT\",\n                  alias: \"count\"\n                )\n              )\n            ),\n            filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n              operator: \"AND\",\n              ignoreFiltersWithEmptyValues: true,\n              logicalExpressions: {\n                ri!logicalExpressions,\n                if(\n                  and(\n                    a!isNotNullOrEmpty(ri!searchFields),\n                    a!isNotNullOrEmpty(ri!searchTerm)\n                  ),\n                  #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                    operator: \"AND\",\n                    logicalExpressions: #\"SYSTEM_SYSRULES_forEach\"(\n                      items: split(trim(ri!searchTerm), \" \"),\n                      expression: a!localVariables(\n                        local!splitSearchTerm: fv!item,\n                        /*   Initiate filter for each field by the value provided in searchTerm   */\n                        #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                          operator: \"OR\",\n                          filters: #\"SYSTEM_SYSRULES_forEach\"(\n                            items: ri!searchFields,\n                            expression: #\"SYSTEM_SYSRULES_queryFilter\"(\n                              field: fv!item,\n                              operator: \"includes\",\n                              value: local!splitSearchTerm\n                            )\n                          )\n                        )\n                      )\n                    )\n                  ),\n                  {}\n                )\n              },\n              filters: ri!filters\n            ),\n            pagingInfo: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              local!queryParams.pagingInfo,\n              #\"urn:appian:function:v1:a:update\"(\n                local!queryParams.pagingInfo,\n                \"sort\",\n                null\n              )\n            ),\n            fetchTotalCount: local!queryParams.fetchTotalCount,\n            relatedRecordData: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              ri!relatedRecordData,\n              {}\n            )\n          )\n        ),\n        refreshOnVarChange: ri!triggerRefresh,\n        refreshAfter: { \"RECORD_ACTION\" }\n      ),\n      /*Format the output*/\n      local!output: a!match(\n        value: local!returnType,\n        equals: \"OBJECT_ARRAY\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"data\",{})\n        ),\n        equals: \"SINGLE_OBJECT\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"data\",{})\n        ),\n        equals: \"RECORD_BY_ID\",\n        /*do not need to cast for queryRecordByIdentifier*/\n        then: local!queryResult,\n        equals: \"DATA_SUBSET\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult\n        ),\n        equals: \"TOTAL_COUNT\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"totalCount\",{})\n        ),\n        default: null\n      ),\n      local!output\n    )\n  )\n)"
    },
    "_a-0000ef43-16ec-8000-9fda-011c48011c48_478809": {
      "name": "AIA_ModelTestSuite_getSuitesWithMaxTestSuiteCases",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*get all suites that are selected that have 100 cases already*/\n  local!suitesWithMaxTestCases: rule!SHRD_UTIL_QueryRecord(\n    recordType: recordType!AIA Model Test Suite,\n    returnType: \"OBJECT_ARRAY\",\n    executeWhen: a!isNotNullOrEmpty(ri!modelTestSuiteIds),\n    fields: {\n      recordType!AIA Model Test Suite.testSuiteId,\n      recordType!AIA Model Test Suite.name\n    },\n    /*get the row that has this instance already saved if exists, will be used to ignore in validation below*/\n    relatedRecordData: if(\n      a!isNotNullOrEmpty(ri!instanceUuidToIgnore),\n      #\"SYSTEM_SYSRULES_relatedRecordData\"(\n        relationship: recordType!AIA Model Test Suite.modelTestSuiteCases,\n        limit: 1,\n        filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n          field: recordType!AIA Model Test Suite Case.baselineInstanceUuid,\n          operator: \"=\",\n          value: ri!instanceUuidToIgnore\n        )\n      ),\n      {}\n    ),\n    filters: {\n      #\"SYSTEM_SYSRULES_queryFilter\"(\n        field: recordType!AIA Model Test Suite.testSuiteId,\n        operator: \"in\",\n        value: ri!modelTestSuiteIds\n      ),\n      #\"SYSTEM_SYSRULES_queryFilter\"(\n        field: recordType!AIA Model Test Suite.testCaseCount,\n        operator: \">=\",\n        value: 100\n      )\n    }\n  ),\n  /*filter out by uuid to ignore if provided, else return query directly*/\n  if(\n    a!isNotNullOrEmpty(ri!instanceUuidToIgnore),\n    rule!AIA_UTIL_rejectNullValuesFromArray(\n      array: #\"SYSTEM_SYSRULES_forEach\"(\n        items: local!suitesWithMaxTestCases,\n        /*iterate over each and reject if the related record filter returned the current instance already saved in the DB*/\n        /*this means the current isntance already contriubtes to caseCount so not truely \"adding\"*/\n        expression: if(\n          a!isNotNullOrEmpty(fv!item[recordType!AIA Model Test Suite.modelTestSuiteCases.baselineInstanceUuid]),\n          null,\n          fv!item\n        )\n      )\n    ),\n    local!suitesWithMaxTestCases\n  )\n)"
    },
    "_a-0000eead-6b09-8000-9bee-011c48011c48_148667": {
      "name": "AIA_QR_getModelTestSuite",
      "type": "Expression Rule",
      "sail_code": "rule!SHRD_UTIL_QueryRecord(\n  recordType: recordType!AIA Model Test Suite,\n  returnType: ri!returnType,\n  fields: ri!fields,\n  executeWhen: ri!executeWhen,\n  pagingInfo: ri!pagingInfo,\n  identifier: ri!ids,\n  filters: {\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Test Suite.modelUuid,\n      operator: \"=\",\n      value: ri!uuid,\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Test Suite.testSuiteId,\n      operator: \"in\",\n      value: ri!ids\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Test Suite.testSuiteId,\n      operator: \"not in\",\n      value: ri!idsToExclude\n    ),\n  },\n  sort: #\"SYSTEM_SYSRULES_sortInfo\"(\n    field: recordType!AIA Model Test Suite.testSuiteId,\n    ascending: true\n  )\n)"
    },
    "_a-0000eeb2-df20-8000-9bfe-011c48011c48_154396": {
      "name": "AIA_ModelTestSuiteCase_InitializeInstanceForMultipleSuites",
      "type": "Expression Rule",
      "sail_code": "cast(\n  typeof({recordType!AIA Model Test Suite Case()}),\n  #\"SYSTEM_SYSRULES_forEach\"(\n    items: ri!modelTestSuiteIds,\n    expression: recordType!AIA Model Test Suite Case(\n      recordType!AIA Model Test Suite Case.modelTestSuiteId: fv!item,\n      recordType!AIA Model Test Suite Case.baselineInstanceUuid: ri!baselineInstanceUuid,\n      recordType!AIA Model Test Suite Case.createdBy: loggedInUser(),\n      recordType!AIA Model Test Suite Case.createdOn: now(),\n      recordType!AIA Model Test Suite Case.modifiedBy: loggedInUser(),\n      recordType!AIA Model Test Suite Case.modifiedOn: now()\n    )\n  )\n)"
    },
    "_a-0000eeb5-6c41-8000-9c02-011c48011c48_158649": {
      "name": "AIA_Instance_RecordAction_UpdateAssociatedModelTestSuites",
      "type": "Interface",
      "sail_code": "a!localVariables(\n  local!selectedValue: 1,\n  local!brandingMap: rule!AIA_UTIL_LoadBrandingMap(),\n\n  local!modelTestSuites: rule!AIA_QR_getModelTestSuite(uuid: ri!uuid),\n  local!modelTestSuiteInstances: rule!AIA_QR_getModelTestSuiteCase(\n    fields: {\n      recordType!AIA Model Test Suite Case.modelTestSuite.testSuiteId\n    },\n    baselineInstanceUuid: ri!instanceUuid\n  ),\n\n  local!modelTestSuiteIds: local!modelTestSuiteInstances[recordType!AIA Model Test Suite Case.modelTestSuite.testSuiteId],\n\n  local!suitesWithMaxTestCases: rule!AIA_ModelTestSuite_getSuitesWithMaxTestSuiteCases(\n    modelTestSuiteIds: local!modelTestSuiteIds,\n    instanceUuidToIgnore: ri!instanceUuid\n  ),\n\n  #\"SYSTEM_SYSRULES_formLayout_v1\"(\n    label: #\"urn:appian:translation-string:v1:fe44019d-6588-4b35-8075-294e8634ddf4\",\n    contents: {\n\n      #\"SYSTEM_SYSRULES_cardLayout\"(\n        contents: {\n          #\"SYSTEM_SYSRULES_multipleDropdownField_v1\"(\n            label: #\"urn:appian:translation-string:v1:e1d68a88-7496-4d79-9591-66cbdd9ef893\",\n            choiceLabels: local!modelTestSuites[recordType!AIA Model Test Suite.name],\n            choiceValues: local!modelTestSuites[recordType!AIA Model Test Suite.testSuiteId],\n            placeholder: #\"urn:appian:translation-string:v1:f744141b-3e47-4992-827f-1758bb3ff64f\"(#\"urn:appian:translation-variable:v1:ad0716ea-de59-4fd9-bed1-e6102d6dc170\": #\"urn:appian:translation-string:v1:572d331a-7e5e-4c1c-a6d1-3f08b96a0aed\"),\n            value: local!modelTestSuiteIds,\n            saveInto: local!modelTestSuiteIds\n          )\n        },\n        padding: \"NONE\",\n        marginAbove: \"LESS\",\n        marginBelow: \"NONE\",\n        showBorder: false\n      )\n\n    },\n    validations: #\"SYSTEM_SYSRULES_validationMessage\"(\n      message: #\"urn:appian:translation-string:v1:622db5b6-eb03-45db-a33e-180f6c840c16\"(\n        #\"urn:appian:translation-variable:v1:f7144572-32f1-4235-97cc-5e10c7448832\": joinarray(\n          local!suitesWithMaxTestCases[recordType!AIA Model Test Suite.name],\n          \", \"\n        )\n      ),\n      showWhen: a!isNotNullOrEmpty(local!suitesWithMaxTestCases),\n      validateAfter: \"SUBMIT\"\n    ),\n    buttons: #\"SYSTEM_SYSRULES_ButtonLayout\"(\n      primaryButtons: #\"SYSTEM_SYSRULES_buttonWidget_v1\"(\n        label: #\"urn:appian:translation-string:v1:fe44019d-6588-4b35-8075-294e8634ddf4\",\n        saveInto: {\n          a!save(\n            target: ri!deleteModelTestSuiteInstances,\n            value: local!modelTestSuiteInstances\n          ),\n\n          a!save(\n            target: ri!modelTestSuiteIds,\n            value: local!modelTestSuiteIds\n          )\n        },\n        submit: true,\n        style: \"SOLID\"\n      ),\n      secondaryButtons: #\"SYSTEM_SYSRULES_buttonWidget_v1\"(\n        label: #\"urn:appian:translation-string:v1:df61ccad-fe9a-4d7a-ba9a-d89b08f3467a\",\n        saveInto: a!save(ri!cancel, true),\n        submit: true,\n        validate: false\n      )\n    ),\n    skipAutoFocus: true()\n  )\n)"
    },
    "_a-0000edb0-f009-8000-9ba8-011c48011c48_97176": {
      "name": "AIA_UTIL_rejectNullValuesFromArray",
      "type": "Expression Rule",
      "sail_code": "cast(\n  typeof(ri!array),\n  reject(\n    rule!AIA_UTIL_isBlank(_),\n    a!flatten(ri!array)\n  )\n)"
    },
    "_a-0000edb0-f009-8000-9ba8-011c48011c48_97164": {
      "name": "AIA_UTIL_isBlank",
      "type": "Expression Rule",
      "sail_code": "cast(\n  'type!{http://www.appian.com/ae/types/2009}Boolean',\n  length(a!flatten(ri!value)) = 0\n)"
    },
    "000ceeb5-7c28-8000-fdf7-7f0000014e7a": {
      "name": "AIA Instance Update Associate Test Suite",
      "type": "Process Model",
      "sail_code": "// Input: ?\n={pv!modelTestSuiteCases}\n\n// Input: ?\n={recordType!AIA Model Test Suite Case}\n\n// Input: ?\n=pv!deleteModelTestSuiteCases\n\n// Output: ?\nAC!CountOfRecordsDeleted\n\n// Input: ?\n={recordType!AIA Extraction Instance(\n  recordType!AIA Extraction Instance.id: pv!instanceId,\n  recordType!AIA Extraction Instance.testInstance: true\n)}\n\n// Input: ?\n={recordType!AIA Extraction Instance}\n\n// Input: ?\n={recordType!AIA Classification Instance(\n  recordType!AIA Classification Instance.id: pv!instanceId,\n  recordType!AIA Classification Instance.testInstance: true\n)}\n\n// Input: ?\n={recordType!AIA Classification Instance}\n\n// Output: ?\nrule!AIA_ModelTestSuiteCase_InitializeInstanceForMultipleSuites(\n  modelTestSuiteIds: pv!modelTestSuiteIds,\n  baselineInstanceUuid: pv!instanceUuid\n)"
    }
  }
}