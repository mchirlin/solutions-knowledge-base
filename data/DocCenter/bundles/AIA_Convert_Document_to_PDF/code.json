{
  "_metadata": {
    "bundle_id": "AIA_Convert_Document_to_PDF"
  },
  "objects": {
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_182518": {
      "name": "AIA_IsDocumentExtension",
      "type": "Expression Rule",
      "sail_code": "and(\n  a!isNotNullOrEmpty(ri!document),\n  contains(\n    lower(ri!extensions),\n    lower(document(\n      ri!document,\n      \"extension\"\n    ))\n  )\n)"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_184766": {
      "name": "AIA_PLG_WriteFile",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!result: writefile(\n    ri!content,\n    ri!name,\n    ri!extension,\n    ri!folder,\n    ri!description\n  ),\n  if(\n    local!result.success,\n    local!result,\n    fn!error(local!result.error)\n  )\n)"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_85019": {
      "name": "AIA_IsExtractionInstance",
      "type": "Expression Rule",
      "sail_code": "runtimetypeof(\n  ri!Instance\n) = typeof(\n  recordType!AIA Extraction Instance()\n)"
    },
    "_a-0000ed74-17c4-8000-9c8d-011c48011c48_403026": {
      "name": "SHRD_CleanForFilename",
      "type": "Expression Rule",
      "sail_code": "stripwith(substitute(\n  substitute(\n    left(ri!input, 25),\n    char(10),\n    \" \"\n  ),\n  char(13),\n  \"\"\n), \"\\/;:\"\"|?'><*]\"),"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_90047": {
      "name": "AIA_CreateValidationErrorMessage",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_toJson_v1\"(\n  a!map(\n    type: ri!type,\n    error: ri!error\n  )\n)"
    },
    "_a-0000ec2d-5396-8000-9bdc-011c48011c48_40839": {
      "name": "AIA_Test_GetLatestExtractionInstance",
      "type": "Expression Rule",
      "sail_code": "rule!AIA_Extraction_GetInstanceById(\n  identifier: #\"SYSTEM_SYSRULES_queryRecordType_v3\"(\n    recordType: recordType!AIA Extraction Instance,\n    pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n      startIndex: 1,\n      batchSize: 1,\n      sort: {\n        #\"SYSTEM_SYSRULES_sortInfo\"(\n          field: recordType!AIA Extraction Instance.id\n        )\n      }\n    )\n  ).data[recordType!AIA Extraction Instance.id],\n  additionalFields: {\n    recordType!AIA Extraction Instance.instanceUuid,\n    recordType!AIA Extraction Instance.modelVersion.versionId,\n    recordType!AIA Extraction Instance.modelVersion.modelId,\n    recordType!AIA Extraction Instance.modelVersion.uuid,\n    recordType!AIA Extraction Instance.modelVersion.extractionModel.key,\n    recordType!AIA Extraction Instance.documentFolderId,\n    recordType!AIA Extraction Instance.fieldCount,\n    recordType!AIA Extraction Instance.sections,\n    recordType!AIA Extraction Instance.boundingBoxes,\n    recordType!AIA Extraction Instance.responseDocumentId,\n    recordType!AIA Extraction Instance.sourceDocumentId\n  }\n)"
    },
    "_a-0000ec67-5f00-8000-9bf0-011c48011c48_125017": {
      "name": "AIA_DocumentIsImage",
      "type": "Expression Rule",
      "sail_code": "rule!AIA_IsDocumentExtension(\n  document: ri!document,\n  extensions: cons!AIA_VALID_IMAGE_FORMATS\n)"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_76653": {
      "name": "AIA_CreateValidation",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!isExtraction: rule!AIA_IsExtractionInstance(\n    instance: ri!Instance\n  ),\n  recordType!AIA Instance Validation Error(\n    recordType!AIA Instance Validation Error.instanceId: a!defaultValue(\n      ri!instanceId,\n      if(\n        local!isExtraction,\n        ri!Instance[recordType!AIA Extraction Instance.id],\n        ri!Instance[recordType!AIA Classification Instance.id]\n      )\n    ),\n    recordType!AIA Instance Validation Error.instanceType: a!defaultValue(\n      ri!instanceType,\n      if(\n        local!isExtraction,\n        cons!AIA_MODEL_TYPE_VALUES[1],\n        cons!AIA_MODEL_TYPE_VALUES[2]\n      )\n    ),\n    recordType!AIA Instance Validation Error.typeId: ri!typeId,\n    recordType!AIA Instance Validation Error.message: ri!message,\n    recordType!AIA Instance Validation Error.severity: ri!severity\n  )\n)"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_83835": {
      "name": "AIA_CreateConversionValidation",
      "type": "Expression Rule",
      "sail_code": "rule!AIA_CreateValidation(\n  instance: ri!instance,\n  typeId: cons!AIA_VALIDATION_TYPE_ID_EXECUTION,\n  message: rule!AIA_CreateValidationErrorMessage(\n    type: #\"urn:appian:translation-string:v1:a2f8e2ac-32c6-4cf3-a6c7-c45b4b75ddb2\",\n    error: ri!errorMessage\n  ),\n  severity: cons!AIA_SEVERITY_CRITICAL\n)"
    },
    "_a-0000ecf1-11b9-8000-9c4e-011c48011c48_218469": {
      "name": "SHRD_CleanHmtl",
      "type": "Expression Rule",
      "sail_code": "substitute(\n  striphtml(\n    regexreplaceall(\n      \"<style[^>]*>.*<\\/style>\",\n      substitute(substitute(ri!inputText, char(10), \"||\"), char(13), \"\"),\n      \"\"\n    ),\n  ),\n  \"||\",\n  \"<br />\"\n)"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_182538": {
      "name": "AIA_FormatMsgAsText",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!mailMap: a!map(\n    from: ri!from,\n    to: ri!to,\n    subject: ri!subject,\n    body: ri!body,\n    sentDate: ri!sentDate\n  ),\n  rule!AIA_FormatEmailAsText(\n    mailMap: local!mailMap\n  )\n)"
    },
    "0002ec67-21e4-8000-019b-7f0000014e7a": {
      "name": "AIA Convert Document to PDF",
      "type": "Process Model",
      "sail_code": "// Output: ?\n=rule!AIA_NameFromInstance(Instance: a!defaultValue(pv!ClassificationInstance, pv!ExtractionInstance))\n\n// Output: ?\n= a!defaultValue( pv!ExtractionInstance[recordType!AIA Extraction Instance.documentFolderId], pv!ClassificationInstance[recordType!AIA Classification Instance.documentFolderId])\n\n// Input: ?\n=pv!folder\n\n// Input: ?\n=\"Msg Attachments\"\n\n// Output: ?\nAC!NewFolder\n\n// Output: ?\nrule!AIA_PLG_WriteFile(\n  content: pv!inputText,\n  name: \"inputText\",\n  extension: \"txt\",\n  folder: cons!AIA_FOLDER_TEMP_DOCS\n).document\n\n// Output: ?\nrule!AIA_PLG_WriteFile(\n  content: rule!AIA_FormatEmlAsText(\n    document: pv!document\n  ),\n  name: \"inputTxt\",\n  extension: \"txt\",\n  folder: cons!AIA_FOLDER_TEMP_DOCS\n).document\n\n// Input: ?\n=pv!newFolder\n\n// Input: ?\n=\"msg\"\n\n// Input: ?\n=pv!folder\n\n// Input: ?\n=pv!document\n\n// Output: ?\nrule!AIA_PLG_WriteFile(\n  content: rule!AIA_FormatMsgAsText(\n    from: ac!from,\n    to: ac!to,\n    subject: ac!subject,\n    body: ac!body,\n    sentDate: ac!sentDate\n  ),\n  name: \"msgText\",\n  extension: \"txt\",\n  folder: cons!AIA_FOLDER_TEMP_DOCS\n).document\n\n// Input: ?\n=pv!document\n\n// Input: ?\n=document(pv!document, \"name\")\n\n// Input: ?\n=document(pv!document, \"description\")\n\n// Input: ?\n=\"pdf\"\n\n// Input: ?\n=pv!ExtractionInstance[recordType!AIA Extraction Instance.documentFolderId]\n\n// Output: ?\nAC!errorTxt\n\n// Output: ?\nAC!errorOccurred\n\n// Output: ?\nAC!newDocument\n\n// Input: ?\n=pv!txtDoc\n\n// Input: ?\n=pv!filename\n\n// Input: ?\n=pv!folder\n\n// Output: ?\nAC!ErrorMessage\n\n// Output: ?\nAC!PDFCreated\n\n// Output: ?\n=not(ac!Success)\n\n// Input: ?\n=pv!document\n\n// Output: ?\nAC!errorTxt\n\n// Output: ?\nAC!errorOccurred\n\n// Output: ?\nAC!CSVDocument\n\n// Input: ?\n=pv!document\n\n// Input: ?\n=pv!filename\n\n// Input: ?\n=pv!folder\n\n// Output: ?\nAC!ErrorMessage\n\n// Output: ?\nAC!PDFCreated\n\n// Output: ?\n=not(ac!Success)\n\n// Input: ?\n=pv!document\n\n// Input: ?\n=pv!filename\n\n// Input: ?\n=pv!folder\n\n// Output: ?\nAC!ErrorText\n\n// Output: ?\nAC!ErrorOccurred\n\n// Output: ?\nAC!NewDocumentCreated\n\n// Input: ?\n=pv!document\n\n// Input: ?\n=cons!SHRD_FONTS\n\n// Input: ?\n=pv!filename\n\n// Input: ?\n=a!defaultValue( pv!ExtractionInstance[recordType!AIA Extraction Instance.documentFolderId], pv!ClassificationInstance[recordType!AIA Classification Instance.documentFolderId])\n\n// Output: ?\nAC!ErrorText\n\n// Output: ?\nAC!ErrorOccurred\n\n// Output: ?\nAC!NewDocumentCreated\n\n// Input: ?\nrule!AIA_CreateConversionValidation(\n  instance: a!defaultValue(pv!ExtractionInstance, pv!ClassificationInstance),\n  errorMessage: pv!errorMessage\n)\n\n// Output: ?\n#\"urn:appian:function:v1:a:update\"(\n  pv!ExtractionInstance,\n  recordType!AIA Extraction Instance.validations,\n  ac!ProcessInfo.pv.Validation\n)\n\n// Output: ?\n#\"urn:appian:function:v1:a:update\"(\n  pv!ClassificationInstance,\n  recordType!AIA Classification Instance.validations,\n  ac!ProcessInfo.pv.Validation\n)\n\n// Output: ?\n#\"urn:appian:translation-string:v1:bba13b0f-c7f8-4e60-bf06-25b99f367464\"\n\n// Output: ?\ntrue"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_182545": {
      "name": "AIA_FormatEmailAsText",
      "type": "Expression Rule",
      "sail_code": "\"From: \" & ri!mailMap.from & char(10) & \nif(\n  a!isNotNullOrEmpty(ri!mailMap.to),\n  \"To: \" & ri!mailMap.to & char(10),\n  \"\"\n) & \n\"Subject: \" & ri!mailMap.subject & char(10) & \n\"Date: \" & ri!mailMap.sentDate & char(10) & char(10) &\nrule!SHRD_CleanHmtl(\n  inputText: ri!mailMap.body\n)"
    },
    "_a-0000ecf1-11b9-8000-9c4e-011c48011c48_217904": {
      "name": "AIA_NameFromInstance",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!fields: if(\n    runtimetypeof(ri!Instance) = typeof(recordType!AIA Extraction Instance()),\n    a!map(\n      documentId: recordType!AIA Extraction Instance.documentId,\n      sourceDocumentId: recordType!AIA Extraction Instance.sourceDocumentId,\n      inputText: recordType!AIA Extraction Instance.inputText,\n    ),\n    a!map(\n      documentId: recordType!AIA Classification Instance.documentId,\n      sourceDocumentId: recordType!AIA Classification Instance.sourceDocumentId,\n      inputText: recordType!AIA Classification Instance.inputText,\n    ),\n  ),\n  rule!SHRD_CleanForFilename(\n    input: if(\n      and(\n        a!isNullOrEmpty(ri!Instance[local!fields.documentId]),\n        a!isNullOrEmpty(ri!Instance[local!fields.sourceDocumentId]),\n        a!isNotNullOrEmpty(ri!Instance[local!fields.inputText])\n      ),\n      substitute(\n        substitute(\n          left(ri!Instance[local!fields.inputText], 25),\n          char(10),\n          \" \"\n        ),\n        char(13),\n        \"\"\n      ),\n      document(\n        a!defaultValue(\n          ri!Instance[local!fields.documentId],\n          ri!Instance[local!fields.sourceDocumentId]\n        ),\n        \"name\"\n      )\n    )\n  )\n)"
    },
    "_a-0000ecf1-11b9-8000-9c4e-011c48011c48_218800": {
      "name": "AIA_FormatEmlAsText",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!mailMap: #\"SYSTEM_SYSRULES_fromJson_v1\"(\n    reademlfile(\n      ri!document\n    )\n  ),\n  rule!AIA_FormatEmailAsText(\n    mailMap: local!mailMap\n  )\n)"
    }
  }
}