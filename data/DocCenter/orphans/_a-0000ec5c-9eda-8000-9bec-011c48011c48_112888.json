{
  "uuid": "_a-0000ec5c-9eda-8000-9bec-011c48011c48_112888",
  "name": "AIA_Extraction_ReconcileTableRows",
  "type": "Expression Rule",
  "description": "Reconcile table rows",
  "sail_code": "if(\n  /* Table Type */\n  ri!tableField[recordType!AIA Extraction Model Version Field.type] = cons!AIA_EXTRACTION_FIELD_TYPE_TABLE,\n  /* ForEach of the returned results, create a row with the columns */\n  a!localVariables(\n    local!field: ri!tableField,\n    local!extractedRows: #\"SYSTEM_SYSRULES_forEach\"(\n      ri!ExtractedData[ri!tableField[recordType!AIA Extraction Model Version Field.key]],\n      recordType!AIA Extraction Instance Field Row(\n        recordType!AIA Extraction Instance Field Row.cells: a!localVariables(\n          local!row: fv!item,\n          #\"SYSTEM_SYSRULES_forEach\"(\n            items: local!field[recordType!AIA Extraction Model Version Field.columns],\n            expression: recordType!AIA Extraction Instance Field Row Cell(\n              recordType!AIA Extraction Instance Field Row Cell.modelVersionFieldId: fv!item[recordType!AIA Extraction Model Version Field.fieldId],\n              recordType!AIA Extraction Instance Field Row Cell.extractedValue: rule!AIA_TypeHelper(\n                value: local!row[fv!item[recordType!AIA Extraction Model Version Field.key]],\n                field: fv!item\n              )\n            )\n          )\n        )\n      )\n    ),\n    local!reconciledRows: #\"SYSTEM_SYSRULES_forEach\"(\n      ri!ReconciledData[ri!tableField[recordType!AIA Extraction Model Version Field.key]],\n      recordType!AIA Extraction Instance Field Row(\n        recordType!AIA Extraction Instance Field Row.cells: a!localVariables(\n          local!row: fv!item,\n          #\"SYSTEM_SYSRULES_forEach\"(\n            items: local!field[recordType!AIA Extraction Model Version Field.columns],\n            expression: recordType!AIA Extraction Instance Field Row Cell(\n              recordType!AIA Extraction Instance Field Row Cell.modelVersionFieldId: fv!item[recordType!AIA Extraction Model Version Field.fieldId],\n              recordType!AIA Extraction Instance Field Row Cell.overrideValue: rule!AIA_TypeHelper(\n                value: local!row[fv!item[recordType!AIA Extraction Model Version Field.key]],\n                field: fv!item\n              )\n            )\n          )\n        )\n      )\n    ),\n    if(\n      a!isNullOrEmpty(\n        local!reconciledRows\n      ),\n      local!extractedRows,\n      a!flatten(\n        {\n          #\"SYSTEM_SYSRULES_forEach\"(\n            items: local!extractedRows,\n            expression: a!localVariables(\n              local!extractedRow: fv!item,\n              local!reconciledRow: index(\n                local!reconciledRows,\n                fv!index,\n                null\n              ),\n              if(\n                a!isNullOrEmpty(\n                  local!reconciledRow\n                ),\n                #\"urn:appian:function:v1:a:update\"(\n                  local!extractedRow,\n                  recordType!AIA Extraction Instance Field Row.overrideValue,\n                  cons!AIA_ROW_REMOVED\n                ),\n                a!localVariables(\n                  local!cells: #\"SYSTEM_SYSRULES_forEach\"(\n                    items: local!extractedRow[recordType!AIA Extraction Instance Field Row.cells],\n                    expression: a!localVariables(\n                      local!extractedCell: fv!item,\n                      local!reconciledCell: local!reconciledRow[recordType!AIA Extraction Instance Field Row.cells][fv!index],\n                      if(\n                        local!extractedCell[recordType!AIA Extraction Instance Field Row Cell.extractedValue] = local!reconciledCell[recordType!AIA Extraction Instance Field Row Cell.overrideValue],\n                        local!extractedCell,\n                        if(\n                          and(\n                            a!isNotNullOrEmpty(\n                              local!extractedCell[recordType!AIA Extraction Instance Field Row Cell.extractedValue]\n                            ),\n                            a!isNullOrEmpty(\n                              local!reconciledCell[recordType!AIA Extraction Instance Field Row Cell.overrideValue]\n                            )\n                          ),\n                          #\"urn:appian:function:v1:a:update\"(\n                            local!extractedCell,\n                            recordType!AIA Extraction Instance Field Row Cell.overrideNull,\n                            true\n                          ),\n                          if(\n                            and(\n                              a!isNotNullOrEmpty(\n                                local!extractedCell[recordType!AIA Extraction Instance Field Row Cell.extractedValue]\n                              ),\n                              a!isNotNullOrEmpty(\n                                local!reconciledCell[recordType!AIA Extraction Instance Field Row Cell.overrideValue]\n                              )\n                            ),\n                            #\"urn:appian:function:v1:a:update\"(\n                              local!extractedCell,\n                              recordType!AIA Extraction Instance Field Row Cell.overrideValue,\n                              local!reconciledCell[recordType!AIA Extraction Instance Field Row Cell.overrideValue]\n                            ),\n                            local!extractedCell\n                          )\n                        )\n                      )\n                    )\n                  ),\n                  #\"urn:appian:function:v1:a:update\"(\n                    #\"urn:appian:function:v1:a:update\"(\n                      local!extractedRow,\n                      recordType!AIA Extraction Instance Field Row.cells,\n                      local!cells\n                    ),\n                    recordType!AIA Extraction Instance Field Row.overrideValue,\n                    if(\n                      a!isNotNullOrEmpty(\n                        reject(\n                          fn!isnull,\n                          a!flatten(\n                            {\n                              local!cells[recordType!AIA Extraction Instance Field Row Cell.overrideNull],\n                              local!cells[recordType!AIA Extraction Instance Field Row Cell.overrideValue]\n                            }\n                          )\n                        )\n                      ),\n                      cons!AIA_ROW_OVERRIDDEN,\n                      null\n                    )\n                  )\n                )\n              )\n            )\n          ),\n          if(\n            length(\n              local!reconciledRows\n            ) > length(\n              local!extractedRows\n            ),\n            #\"SYSTEM_SYSRULES_forEach\"(\n              items: ldrop(\n                local!reconciledRows,\n                length(\n                  local!extractedRows\n                )\n              ),\n              expression: #\"urn:appian:function:v1:a:update\"(\n                fv!item,\n                recordType!AIA Extraction Instance Field Row.overrideValue,\n                cons!AIA_ROW_ADDED\n              )\n            ),\n            {}\n          )\n        }\n      )\n    )\n  ),\n  null\n)",
  "calls": [
    {
      "name": "AIA_TypeHelper",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AIA_EXTRACTION_FIELD_TYPE_TABLE",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "AIA_ROW_REMOVED",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "AIA_ROW_OVERRIDDEN",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "AIA_ROW_ADDED",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    }
  ],
  "called_by": []
}