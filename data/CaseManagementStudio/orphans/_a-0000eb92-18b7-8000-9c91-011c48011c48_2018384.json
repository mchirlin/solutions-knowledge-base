{
  "uuid": "_a-0000eb92-18b7-8000-9c91-011c48011c48_2018384",
  "name": "CMGT_CB_Case_SetMetaData",
  "type": "Expression Rule",
  "description": "Set meta data fields for CMGT_Case while using studio",
  "sail_code": "/*Drop the entity writes to force dedupe process in the process model*/\nrule!CMGT_CB_Case_WriteRecordsProperties(\n  isInput: true,\n  cases: #\"SYSTEM_SYSRULES_forEach\"(\n    items: ri!cases,\n    expression: rule!CMGT_UTIL_SetRecordFields(\n      record: fv!item,\n      alwaysOverwrite: {\n        a!map(\n          field: recordType!CMGT_Case.modifiedOn,\n          value: now()\n        ),\n        a!map(\n          field: recordType!CMGT_Case.modifiedBy,\n          value: ri!initiator\n        ),\n        /* If the status is closed and the completedOn is empty then update to current time stamp, otherwise use the existing completedOn value     */\n        a!map(\n          field: recordType!CMGT_Case.completedOn,\n          value: a!match(\n            value: tointeger(\n              fv!item[recordType!CMGT_Case.statusId]\n            ),\n            whenTrue: and(\n              fv!value = cons!CMGT_REFID_STATUS_CASE_CLOSED,\n              a!isNullOrEmpty(\n                fv!item[recordType!CMGT_Case.completedOn]\n              )\n            ),\n            then: now(),\n            whenTrue: and(\n              fv!value <> cons!CMGT_REFID_STATUS_CASE_CLOSED,\n              a!isNotNullOrEmpty(\n                fv!item[recordType!CMGT_Case.completedOn]\n              )\n            ),\n            then: null,\n            default: fv!item[recordType!CMGT_Case.completedOn]\n          )\n        )\n      },\n      neverOverwrite: {\n        a!map(\n          field: recordType!CMGT_Case.isActive,\n          value: true\n        ),\n        a!map(\n          field: recordType!CMGT_Case.createdOn,\n          value: now()\n        ),\n        a!map(\n          field: recordType!CMGT_Case.createdBy,\n          value: ri!initiator\n        ),\n        a!map(\n          field: recordType!CMGT_Case.friendlyId,\n          value: rule!CMGT_Case_GenerateFriendlyIdentifier_Logic(case: fv!item)\n        ),\n        a!map(\n          field: recordType!CMGT_Case.dueOn,\n          value: rule!CMGT_UTIL_CalculateDueDateBasedOnSLA(\n            SLA: fv!item[recordType!CMGT_Case.caseType.caseTypeMetadata.sla],\n            dateTime: now()\n          ),\n          applyWhen: ri!eventType = \"CREATE\"\n        ),\n        a!map(\n          field: recordType!CMGT_Case.priorityId,\n          value: a!defaultValue(\n            fv!item[recordType!CMGT_Case.caseType.caseTypeMetadata.priorityId],\n            cons!CMGT_REFID_PRIORITY_NONE\n          )\n        ),\n        a!map(\n          field: recordType!CMGT_Case.statusId,\n          value: cons!CMGT_REFID_STATUS_CASE_OPEN\n        )\n      }\n    )\n  )\n)",
  "calls": [
    {
      "name": "CMGT_CB_Case_WriteRecordsProperties",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_UTIL_SetRecordFields",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_Case_GenerateFriendlyIdentifier_Logic",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_UTIL_CalculateDueDateBasedOnSLA",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_REFID_STATUS_CASE_CLOSED",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "CMGT_REFID_PRIORITY_NONE",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "CMGT_REFID_STATUS_CASE_OPEN",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "CMGT_Case",
      "type": "Record Type",
      "dep_type": "USES_RECORD_TYPE"
    }
  ],
  "called_by": []
}