{
  "uuid": "_a-0000ec87-8877-8000-9ce8-011c48011c48_3023144",
  "name": "CMGT_WFL_Automation_RuleSection",
  "type": "Interface",
  "description": "Interface for rule section",
  "sail_code": "a!localVariables(\n  local!indexOfSelected: wherecontains(\n    ri!selectedCaseTypeWorkflowTask[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid],\n    ri!conditionSets[recordType!CMGT_CFG_ConditionSet.caseTypeWorkflowTaskUuid]\n  ),\n  {\n    #\"SYSTEM_SYSRULES_forEach\"(\n      items: ri!conditionSets[local!indexOfSelected],\n      expression: {\n        a!localVariables(\n          local!countOfRules: rule!CMGT_UTIL_Filter(\n            records: fv!item[recordType!CMGT_CFG_ConditionSet.childConditionSet],\n            field: recordType!CMGT_CFG_ConditionSet.isActive,\n            value: true,\n            filterType: \"MATCH_COUNT\"\n          ),\n          local!activeChildConditionSetIndex: rule!CMGT_UTIL_Filter(\n            records: fv!item[recordType!CMGT_CFG_ConditionSet.childConditionSet],\n            field: recordType!CMGT_CFG_ConditionSet.isActive,\n            value: true,\n            filterType: \"MATCH_INDICES\"\n          ),\n          /*Rules Section*/\n          #\"SYSTEM_SYSRULES_sectionLayout_v1\"(\n            contents: {\n              #\"SYSTEM_SYSRULES_forEach\"(\n                items: rule!CMGT_UTIL_Filter(\n                  records: fv!item[recordType!CMGT_CFG_ConditionSet.childConditionSet],\n                  field: recordType!CMGT_CFG_ConditionSet.isActive,\n                  value: true\n                ),\n                expression: {\n                  a!localVariables(\n                    local!index: fv!index + 1,\n                    local!afterTaskBranchMapIndices: intersection(\n                      ri!afterTaskBranchMapIndices,\n                      rule!CMGT_UTIL_Filter(\n                        records: ri!caseTypeWorkflowTaskBranchMaps,\n                        field: \"conditionSetUUID\",\n                        value: fv!item[recordType!CMGT_CFG_ConditionSet.conditionSetUuid],\n                        filterType: \"MATCH_INDICES\"\n                      )\n                    ),\n                    local!activeConditions: rule!CMGT_UTIL_Filter(\n                      filterType: \"REJECT\",\n                      records: fv!item[recordType!CMGT_CFG_ConditionSet.condition],\n                      field: recordType!CMGT_CFG_Condition.isActive,\n                      value: false\n                    ),\n                    local!isAnyInvalidCondition: rule!CMGT_UTIL_Filter(\n                      filterType: \"MATCH_COUNT\",\n                      records: local!activeConditions,\n                      field: recordType!CMGT_CFG_Condition.isValid,\n                      value: false\n                    ),\n                    local!conditionSetUuid,\n                    #\"SYSTEM_SYSRULES_cardLayout\"(\n                      contents: {\n                        /*Add Condition*/\n                        #\"SYSTEM_SYSRULES_columnsLayout\"(\n                          columns: {\n                            #\"SYSTEM_SYSRULES_columnLayout\"(\n                              contents: #\"SYSTEM_SYSRULES_ButtonArrayLayout\"(\n                                buttons: #\"SYSTEM_SYSRULES_buttonWidget_v1\"(\n                                  label: #\"urn:appian:translation-string:v1:ce175f4e-fa40-4fd2-a8e1-ed76c9854df3\",\n                                  icon: \"plus-circle\",\n                                  value: \"ADD_CONDITIONS\",\n                                  saveInto: {\n                                    a!save(\n                                      ri!currentWorkflowStep,\n                                      \"ADD_CONDITIONS\"\n                                    ),\n                                    a!save(\n                                      ri!selectedChildConditionSetUuid,\n                                      fv!item[recordType!CMGT_CFG_ConditionSet.conditionSetUuid]\n                                    )\n                                  },\n                                  style: \"OUTLINE\",\n                                  color: ri!brandingMap.SecondaryTextColor\n                                ),\n                                align: \"START\",\n                                marginBelow: \"EVEN_LESS\"\n                              ),\n                              showWhen: a!isNullOrEmpty(\n                                fv!item[recordType!CMGT_CFG_ConditionSet.condition.fieldPathJson]\n                              )\n                            ),\n                            #\"SYSTEM_SYSRULES_columnLayout\"(\n                              /*Display conditions*/\n                              contents: {\n                                rule!CMGT_WFL_Automation_FormatConditionSet(\n                                  conditionSet: fv!item,\n                                  fieldDetails: ri!fieldDetails,\n                                  brandingMap: ri!brandingMap,\n                                  conditions: local!activeConditions,\n                                  isAnyInvalidCondition: local!isAnyInvalidCondition\n                                )\n                              },\n                              width: \"10X\",\n                              showWhen: a!isNotNullOrEmpty(\n                                fv!item[recordType!CMGT_CFG_ConditionSet.condition.fieldPathJson]\n                              )\n                            ),\n                            #\"SYSTEM_SYSRULES_columnLayout\"(\n                              contents: #\"SYSTEM_SYSRULES_sideBySideLayout\"(\n                                items: {\n                                  #\"SYSTEM_SYSRULES_sideBySideItem\"(\n                                    item: #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n                                      labelPosition: \"COLLAPSED\",\n                                      value: {\n                                        #\"SYSTEM_SYSRULES_richTextIcon\"(\n                                          icon: \"pencil\",\n                                          caption: #\"urn:appian:translation-string:v1:06dbafc7-e085-40de-a68a-c83054c1d7ec\",\n                                          link: #\"SYSTEM_SYSRULES_dynamicLink\"(\n                                            saveInto: {\n                                              a!save(\n                                                ri!currentWorkflowStep,\n                                                \"UPDATE_CONDITIONS\"\n                                              ),\n                                              a!save(\n                                                ri!selectedChildConditionSetUuid,\n                                                fv!item[recordType!CMGT_CFG_ConditionSet.conditionSetUuid]\n                                              )\n                                            }\n                                          ),\n                                          linkStyle: \"STANDALONE\",\n                                          color: ri!brandingMap.AccentColor,\n                                          showWhen: if(\n                                            local!isAnyInvalidCondition > 0,\n                                            false,\n                                            a!isNotNullOrEmpty(\n                                              fv!item[recordType!CMGT_CFG_ConditionSet.condition.fieldPathJson]\n                                            )\n                                          ),\n                                          altText: #\"urn:appian:translation-string:v1:15d88c07-b8c9-427f-b31a-0b006db8eecb\"(\n                                            #\"urn:appian:translation-variable:v1:a5ac7e4a-6448-4348-8ea7-00d692ec99a7\": fv!index,\n                                            #\"urn:appian:translation-variable:v1:1c43018a-cb5d-4f0b-a78e-0c326f400973\": local!countOfRules\n                                          )\n                                        ),\n                                        #\"SYSTEM_SYSRULES_richTextIcon\"(\n                                          icon: \"pencil\",\n                                          caption: #\"urn:appian:translation-string:v1:06dbafc7-e085-40de-a68a-c83054c1d7ec\",\n                                          color: ri!brandingMap.SecondaryTextColor,\n                                          showWhen: local!isAnyInvalidCondition > 0,\n                                          altText: #\"urn:appian:translation-string:v1:15d88c07-b8c9-427f-b31a-0b006db8eecb\"(\n                                            #\"urn:appian:translation-variable:v1:a5ac7e4a-6448-4348-8ea7-00d692ec99a7\": fv!index,\n                                            #\"urn:appian:translation-variable:v1:1c43018a-cb5d-4f0b-a78e-0c326f400973\": local!countOfRules\n                                          )\n                                        )\n                                      },\n                                      align: \"RIGHT\"\n                                    )\n                                  ),\n                                  /*Remove the section as well as the conditions and task branches associated*/\n                                  #\"SYSTEM_SYSRULES_sideBySideItem\"(\n                                    item: #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n                                      labelPosition: \"COLLAPSED\",\n                                      value: {\n                                        #\"SYSTEM_SYSRULES_richTextIcon\"(\n                                          icon: \"times\",\n                                          caption: #\"urn:appian:translation-string:v1:2402af6c-0ece-49ed-abec-bc79c881c8d6\",\n                                          link: #\"SYSTEM_SYSRULES_dynamicLink\"(\n                                            value: false(),\n                                            saveInto: {\n                                              a!localVariables(\n                                                local!taskBranchMapIndex: wherecontains(\n                                                  fv!item[recordType!CMGT_CFG_ConditionSet.conditionSetUuid],\n                                                  ri!caseTypeWorkflowTaskBranchMaps.conditionSetUUID\n                                                ),\n                                                /* Adding index plus 1 as the we will be having an additional default conditionset*/\n                                                {\n                                                  ri!caseTypeWorkflowTaskBranchMaps[local!taskBranchMapIndex].isActive,\n                                                  a!save(\n                                                    ri!conditionSets[local!indexOfSelected][recordType!CMGT_CFG_ConditionSet.childConditionSet],\n                                                    #\"urn:appian:function:v1:a:update\"(\n                                                      ri!conditionSets[local!indexOfSelected][recordType!CMGT_CFG_ConditionSet.childConditionSet][1],\n                                                      local!activeChildConditionSetIndex[fv!index],\n                                                      #\"urn:appian:function:v1:a:update\"(\n                                                        data: ri!conditionSets[local!indexOfSelected][recordType!CMGT_CFG_ConditionSet.childConditionSet][1][local!activeChildConditionSetIndex[fv!index]],\n                                                        index: recordType!CMGT_CFG_ConditionSet.isActive,\n                                                        value: false\n                                                      )\n                                                    )\n                                                  ),\n                                                  a!save(\n                                                    ri!caseTypeWorkflowTaskBranchMaps[local!taskBranchMapIndex].afterCaseTypeWorkflowTaskBranches,\n                                                    if(\n                                                      rule!CMGT_UTIL_IsNotBlank(\n                                                        input: ri!caseTypeWorkflowTaskBranchMaps[local!taskBranchMapIndex].afterCaseTypeWorkflowTaskBranches\n                                                      ),\n                                                      #\"urn:appian:function:v1:a:update\"(\n                                                        a!flatten(\n                                                          ri!caseTypeWorkflowTaskBranchMaps[local!taskBranchMapIndex].afterCaseTypeWorkflowTaskBranches\n                                                        ),\n                                                        recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch.isActive,\n                                                        false\n                                                      ),\n                                                      ri!caseTypeWorkflowTaskBranchMaps[local!taskBranchMapIndex].afterCaseTypeWorkflowTaskBranches\n                                                    )\n                                                  )\n                                                }\n                                              ),\n                                              if(\n                                                local!isAnyInvalidCondition > 0,\n                                                {\n                                                  a!save(\n                                                    local!conditionSetUuid,\n                                                    rule!CMGT_UTIL_GenerateUuid_NonPlugin()\n                                                  ),\n                                                  a!save(\n                                                    ri!conditionSets[local!indexOfSelected][recordType!CMGT_CFG_ConditionSet.childConditionSet][1],\n                                                    insert(\n                                                      ri!conditionSets[local!indexOfSelected][recordType!CMGT_CFG_ConditionSet.childConditionSet][1],\n                                                      recordType!CMGT_CFG_ConditionSet(\n                                                        recordType!CMGT_CFG_ConditionSet.parentConditionSetUuid: ri!conditionSets[local!indexOfSelected][recordType!CMGT_CFG_ConditionSet.conditionSetUuid][1],\n                                                        recordType!CMGT_CFG_ConditionSet.conditionSetUuid: local!conditionSetUuid,\n                                                        recordType!CMGT_CFG_ConditionSet.operatorCode: cons!CMGT_TXT_SET_OPERATOR_AND,\n                                                        recordType!CMGT_CFG_ConditionSet.isActive: true,\n                                                        recordType!CMGT_CFG_ConditionSet.condition: {}\n                                                      ),\n                                                      local!activeChildConditionSetIndex[fv!index]\n                                                    )\n                                                  ),\n                                                  a!save(\n                                                    ri!caseTypeWorkflowTaskBranchMaps,\n                                                    append(\n                                                      ri!caseTypeWorkflowTaskBranchMaps,\n                                                      rule!CMGT_WFL_ConstructCaseTypeWorkflowTaskBranchMap(\n                                                        taskUUID: ri!selectedCaseTypeWorkflowTask[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid],\n                                                        taskResponseOptionUUID: fn!tointeger(null),\n                                                        isRequired: true,\n                                                        conditionSetUUId: local!conditionSetUuid,\n                                                        afterCaseTypeWorkflowTaskBranches: recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch(\n                                                          recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch.conditionSetUuid: local!conditionSetUuid,\n                                                          recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch.beforeCaseTypeWorkflowTaskUuid: ri!selectedCaseTypeWorkflowTask[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid],\n                                                          recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch.isRequired: true,\n                                                          /*Note, defaulting this to NULL until an actual selection is made so that the network renderer doesn't think there's a task*/\n                                                          recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch.isActive: null\n                                                        ),\n                                                        isActive: true\n                                                      )\n                                                    )\n                                                  )\n                                                },\n                                                {}\n                                              )\n                                            }\n                                          ),\n                                          linkStyle: \"STANDALONE\",\n                                          color: ri!brandingMap.NegativeAccentColor,\n                                          size: \"MEDIUM\",\n                                          showWhen: if(\n                                            local!isAnyInvalidCondition > 0,\n                                            true,\n                                            local!countOfRules > 1\n                                          ),\n                                          altText: #\"urn:appian:translation-string:v1:15d88c07-b8c9-427f-b31a-0b006db8eecb\"(\n                                            #\"urn:appian:translation-variable:v1:a5ac7e4a-6448-4348-8ea7-00d692ec99a7\": fv!index,\n                                            #\"urn:appian:translation-variable:v1:1c43018a-cb5d-4f0b-a78e-0c326f400973\": local!countOfRules\n                                          )\n                                        ),\n                                        #\"SYSTEM_SYSRULES_richTextIcon\"(\n                                          icon: \"times\",\n                                          caption: #\"urn:appian:translation-string:v1:2402af6c-0ece-49ed-abec-bc79c881c8d6\",\n                                          color: ri!brandingMap.SecondaryTextColor,\n                                          size: \"MEDIUM\",\n                                          showWhen: if(\n                                            local!isAnyInvalidCondition > 0,\n                                            false,\n                                            local!countOfRules <= 1\n                                          ),\n                                          altText: #\"urn:appian:translation-string:v1:15d88c07-b8c9-427f-b31a-0b006db8eecb\"(\n                                            #\"urn:appian:translation-variable:v1:a5ac7e4a-6448-4348-8ea7-00d692ec99a7\": fv!index,\n                                            #\"urn:appian:translation-variable:v1:1c43018a-cb5d-4f0b-a78e-0c326f400973\": local!countOfRules\n                                          )\n                                        )\n                                      },\n                                      align: \"RIGHT\"\n                                    )\n                                  )\n                                },\n                                marginBelow: \"NONE\"\n                              ),\n                              width: \"1X\"\n                            )\n                          },\n                          marginAbove: \"LESS\",\n                          marginBelow: \"LESS\"\n                        ),\n                        #\"SYSTEM_SYSRULES_sectionLayout_v1\"(\n                          contents: {\n                            rule!CMGT_WFL_CaseType_ConfigureTask_ListOfDependents(\n                              afterTaskBranchMapIndices: local!afterTaskBranchMapIndices,\n                              taskBehaviorTypeId: cons!CMGT_REFID_TASK_BEHAVIOR_TYPE_AUTOMATION,\n                              caseType: ri!caseType,\n                              visibleCaseTypeWorkflowTaskIndices: ri!visibleCaseTypeWorkflowTaskIndices,\n                              availableTasks: ri!availableTasks,\n                              previousTasks: ri!previousTasks,\n                              brandingMap: ri!brandingMap,\n                              taskResponseOptions: null,\n                              isStartTask: false,\n                              uniqueAfterTaskUuidsInViolation: ri!uniqueAfterTaskUuidsInViolation,\n                              /*only for disabling leads into in rules section*/\n                              isDisabled: a!isNullOrEmpty(\n                                fv!item[recordType!CMGT_CFG_ConditionSet.condition]\n                              ),\n                              caseTypeWorkflowTaskBranchMaps: ri!caseTypeWorkflowTaskBranchMaps,\n                              displayIndex: fv!index,\n                              countOfRules: local!countOfRules,\n                              selectedCaseTypeWorkflowTask: ri!selectedCaseTypeWorkflowTask\n                            )\n                          },\n                          marginBelow: \"NONE\"\n                        )\n                      },\n                      style: ri!brandingMap.ConfigBackgroundColor,\n                      padding: \"LESS\",\n                      marginBelow: \"STANDARD\",\n                      showBorder: false,\n                      shape: \"SEMI_ROUNDED\"\n                    )\n                  )\n                }\n              ),\n              /*Add Rule button*/\n              #\"SYSTEM_SYSRULES_ButtonArrayLayout\"(\n                buttons: #\"SYSTEM_SYSRULES_buttonWidget_v1\"(\n                  label: #\"urn:appian:translation-string:v1:06ebc8a5-0eaa-403a-84af-33caa725860b\",\n                  icon: \"plus-circle\",\n                  value: recordType!CMGT_CFG_ConditionSet(\n                    recordType!CMGT_CFG_ConditionSet.parentConditionSetUuid: fv!item[recordType!CMGT_CFG_ConditionSet.conditionSetUuid],\n                    recordType!CMGT_CFG_ConditionSet.conditionSetUuid: rule!CMGT_UTIL_GenerateUuid_NonPlugin(),\n                    recordType!CMGT_CFG_ConditionSet.operatorCode: cons!CMGT_TXT_SET_OPERATOR_AND,\n                    recordType!CMGT_CFG_ConditionSet.isActive: true,\n                    recordType!CMGT_CFG_ConditionSet.condition: {}\n                  ),\n                  saveInto: {\n                    a!save(\n                      fv!item[recordType!CMGT_CFG_ConditionSet.childConditionSet],\n                      append(\n                        fv!item[recordType!CMGT_CFG_ConditionSet.childConditionSet],\n                        save!value\n                      )\n                    ),\n                    a!save(\n                      ri!caseTypeWorkflowTaskBranchMaps,\n                      append(\n                        ri!caseTypeWorkflowTaskBranchMaps,\n                        rule!CMGT_WFL_ConstructCaseTypeWorkflowTaskBranchMap(\n                          taskUUID: ri!selectedCaseTypeWorkflowTask[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid],\n                          taskResponseOptionUUID: fn!tointeger(null),\n                          isRequired: true,\n                          conditionSetUUId: save!value[recordType!CMGT_CFG_ConditionSet.conditionSetUuid],\n                          afterCaseTypeWorkflowTaskBranches: recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch(\n                            recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch.beforeCaseTypeWorkflowTaskUuid: ri!selectedCaseTypeWorkflowTask[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid],\n                            recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch.isRequired: true,\n                            recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch.conditionSetUuid: save!value[recordType!CMGT_CFG_ConditionSet.conditionSetUuid],\n                            /*Note, defaulting this to NULL until an actual selection is made so that the network renderer doesn't think there's a task*/\n                            recordType!CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch.isActive: null\n                          ),\n                          isActive: true\n                        )\n                      )\n                    )\n                  },\n                  style: \"LINK\",\n                  color: ri!brandingMap.StandardTextColor,\n                  showWhen: local!countOfRules < 5\n                ),\n                align: \"START\",\n                marginBelow: \"NONE\"\n              )\n            },\n            marginAbove: \"STANDARD\"\n          )\n        )\n      }\n    )\n  }\n)",
  "calls": [
    {
      "name": "CMGT_UTIL_Filter",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_WFL_Automation_FormatConditionSet",
      "type": "Interface",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_UTIL_IsNotBlank",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_UTIL_GenerateUuid_NonPlugin",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_WFL_ConstructCaseTypeWorkflowTaskBranchMap",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_WFL_CaseType_ConfigureTask_ListOfDependents",
      "type": "Interface",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_TXT_SET_OPERATOR_AND",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "CMGT_REFID_TASK_BEHAVIOR_TYPE_AUTOMATION",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "CMGT_WFL_CFG_CaseTypeWorkflowTask",
      "type": "Record Type",
      "dep_type": "USES_RECORD_TYPE"
    },
    {
      "name": "CMGT_CFG_ConditionSet",
      "type": "Record Type",
      "dep_type": "USES_RECORD_TYPE"
    },
    {
      "name": "CMGT_CFG_Condition",
      "type": "Record Type",
      "dep_type": "USES_RECORD_TYPE"
    },
    {
      "name": "CMGT_WFL_CFG_CaseTypeWorkflowTaskBranch",
      "type": "Record Type",
      "dep_type": "USES_RECORD_TYPE"
    },
    {
      "name": "Unknown",
      "type": "Translation String",
      "dep_type": "CALLS"
    },
    {
      "name": "Unknown",
      "type": "Translation String",
      "dep_type": "CALLS"
    },
    {
      "name": "Unknown",
      "type": "Translation String",
      "dep_type": "CALLS"
    },
    {
      "name": "Unknown",
      "type": "Translation String",
      "dep_type": "CALLS"
    },
    {
      "name": "Unknown",
      "type": "Translation String",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_CB_UTIL_LoadBrandingMap",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_CFG_TaskBehaviorType",
      "type": "Record Type",
      "dep_type": "USES_RECORD_TYPE"
    },
    {
      "name": "CMGT_WFL_CFG_CaseTypeWorkflowTaskResponseOption",
      "type": "Record Type",
      "dep_type": "USES_RECORD_TYPE"
    },
    {
      "name": "CMGT_WFL_CFG_TaskResponseOption",
      "type": "Record Type",
      "dep_type": "USES_RECORD_TYPE"
    }
  ],
  "called_by": [
    {
      "name": "CMGT_WFL_CaseType_ConfigureTask_Task_ConditionalWorkflowRulesSection",
      "type": "Interface",
      "dep_type": "CALLS"
    }
  ]
}