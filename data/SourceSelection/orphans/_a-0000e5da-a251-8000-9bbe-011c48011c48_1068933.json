{
  "uuid": "_a-0000e5da-a251-8000-9bbe-011c48011c48_1068933",
  "name": "AS_GSS_BL_validateStartEvaluation",
  "type": "Expression Rule",
  "description": "validates whether an evaluation is ready to be started",
  "sail_code": "a!localVariables(\n  local!evaluationCriteria: filter(\n    rule!AS_CO_UT_isNotBlank,\n    {\n      ri!evaluationFactors,\n      ri!evaluationSubFactors\n    }\n  ),\n  local!missingItems: {\n    /*  is Evaluation Summary incomplete?  */\n    if(\n      or(\n        rule!AS_CO_UT_isBlank(ri!evaluation.evaluationTitle),\n        rule!AS_CO_UT_isBlank(ri!evaluation.evaluationNumber),\n        rule!AS_CO_UT_isBlank(ri!evaluation.evaluationDesc),\n        rule!AS_CO_UT_isBlank(ri!evaluation.evaluationStartDate),\n        rule!AS_CO_UT_isBlank(ri!evaluation.evaluationDueDate),\n        rule!AS_CO_UT_isBlank(ri!evaluation.evaluationMethod),\n        and(\n          cons!AS_GSS_TOGGLE_EVALUATION_CHIEF_VISIBILITY,\n          rule!AS_CO_UT_isBlank(ri!evaluation.evaluationChief)\n        )\n      ),\n      {\n        activeStep: 1,\n        message: \"Complete the evaluation details\",\n        \n      },\n      {}\n    ),\n    /*  is at least one phase completed and filled out  */\n    if(\n      or(\n        /* add extra phase related logic here */\n        rule!AS_CO_UT_isBlank(\n          rule!AS_CO_UT_filterCdtByField(\n            cdt: ri!evaluationPhases,\n            field: \"isActive\",\n            value: true\n          )\n        ),\n        \n      ),\n      {\n        activeStep: 2,\n        message: \"Add at least one evaluation phase\",\n        \n      },\n      {}\n    ),\n    /*   is at least one criterion created and filled out    */\n    if(\n      /* add extra criteria related logic here */\n      or(\n        rule!AS_CO_UT_isBlank(\n          rule!AS_CO_UT_filterCdtByField(\n            cdt: local!evaluationCriteria,\n            field: \"isActive\",\n            value: true\n          )\n        ),\n        if(\n          rule!AS_CO_UT_isNotBlank(\n            rule!AS_CO_UT_filterCdtByField(\n              cdt: local!evaluationCriteria,\n              field: \"isActive\",\n              value: true\n            )\n          ),\n          or(\n            #\"SYSTEM_SYSRULES_forEach\"(\n              items: rule!AS_CO_UT_filterCdtByField(\n                cdt: local!evaluationCriteria,\n                field: \"isActive\",\n                value: true\n              ),\n              expression: or(\n                rule!AS_CO_UT_isBlank(fv!item.factorNumber),\n                rule!AS_CO_UT_isBlank(fv!item.criteriaName),\n                rule!AS_CO_UT_isBlank(fv!item.criteriaDesc),\n                rule!AS_CO_UT_isBlank(fv!item.refRatingType),\n                rule!AS_CO_UT_isBlank(fv!item.criteriaChair),\n                rule!AS_CO_UT_isBlank(fv!item.dueDate),\n                \n              )\n            ),\n            \n          ),\n          {}\n        )\n      ),\n      {\n        activeStep: 3,\n        message: \"Setup at least one evaluation factor and provide information for added factors/subfactors\"\n      },\n      {}\n    ),\n    /* Is any of the factor/subfactor weight is blank */\n    /* Is factor weight does not equal 100            */\n    /* Is any subfactors do not equal to the factor weights*/\n    #\"SYSTEM_SYSRULES_forEach\"(\n      items: if(\n        ri!evaluation.isWeightedFactorsRequired,\n        rule!AS_GSS_VD_validateFactorWeights(\n          evaluationFactors: ri!evaluationFactors,\n          evaluationSubFactors: ri!evaluationSubfactors,\n          bundle: ri!bundle,\n          checkForBlankWeights: true()\n        ),\n        {}\n      ),\n      expression: { activeStep: 4, message: fv!item }\n    ),\n    /* is at least one vendor created with an associated document  */\n    if(\n      or(\n        rule!AS_CO_UT_isBlank(\n          rule!AS_CO_UT_filterCdtByField(\n            cdt: ri!evaluationVendors,\n            field: \"isActive\",\n            value: true\n          )\n        ),\n        rule!AS_CO_UT_isBlank(\n          rule!AS_CO_UT_filterCdtByField(\n            cdt: ri!vendorDocs,\n            field: \"isDeleted\",\n            value: false\n          )\n        ),\n        if(\n          and(\n            rule!AS_CO_UT_isNotBlank(\n              rule!AS_CO_UT_filterCdtByField(\n                cdt: ri!evaluationVendors,\n                field: \"isActive\",\n                value: true\n              )\n            ),\n            rule!AS_CO_UT_isNotBlank(\n              rule!AS_CO_UT_filterCdtByField(\n                cdt: ri!vendorDocs,\n                field: \"isDeleted\",\n                value: false\n              )\n            )\n          ),\n          or(\n            #\"SYSTEM_SYSRULES_forEach\"(\n              items: rule!AS_CO_UT_filterCdtByField(\n                cdt: ri!evaluationVendors,\n                field: \"isActive\",\n                value: true\n              ),\n              expression: rule!AS_CO_UT_isBlank(\n                wherecontains(\n                  fv!item.vendorId,\n                  rule!AS_CO_UT_filterCdtByField(\n                    cdt: ri!vendorDocs,\n                    field: \"isDeleted\",\n                    value: false\n                  ).vendorId\n                )\n              ),\n              \n            )\n          ),\n          {}\n        ),\n        \n      ),\n      {\n        activeStep: if(\n          ri!evaluation.isWeightedFactorsRequired,\n          5,\n          4\n        ),\n        message: \"Select at least one vendor and provide the requisite documents\",\n        \n      },\n      {}\n    ),\n    /* is at least one evaluator present in the evaluation team*/\n    if(\n      or(\n        rule!AS_CO_UT_isBlank(\n          rule!AS_CO_UT_filterCdtByField(\n            cdt: ri!evaluatorTeams,\n            field: \"isActive\",\n            value: true\n          )\n        ),\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: rule!AS_CO_UT_filterCdtByField(\n            cdt: ri!evaluatorTeams,\n            field: \"isActive\",\n            value: true\n          ),\n          expression: rule!AS_CO_UT_isBlank(\n            rule!AS_CO_UT_filterCdtByField(\n              cdt: fv!item.teamMembership,\n              field: \"isActive\",\n              value: true\n            )\n          ),\n          \n        )\n      ),\n      {\n        activeStep: if(\n          ri!evaluation.isWeightedFactorsRequired,\n          6,\n          5\n        ),\n        message: \"Add at least one evaluator to the evaluation team\",\n        \n      },\n      {}\n    ),\n    /* all created criteria have an assigned due date and evaluator WHEN USE EVAL TEAMS IS SELECTED */\n    if(\n      or(\n        rule!AS_CO_UT_isBlank(\n          rule!AS_CO_UT_filterCdtByField(\n            cdt: local!evaluationCriteria,\n            field: \"isActive\",\n            value: true\n          )\n        ),\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: rule!AS_CO_UT_filterCdtByField(\n            cdt: local!evaluationCriteria,\n            field: \"isActive\",\n            value: true\n          ),\n          expression: rule!AS_CO_UT_isBlank(\n            rule!AS_CO_UT_filterCdtByField(\n              cdt: fv!item.assignments,\n              field: \"isActive\",\n              value: true\n            )\n          ),\n          \n        ),\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: rule!AS_CO_UT_filterCdtByField(\n            cdt: local!evaluationCriteria,\n            field: \"isActive\",\n            value: true\n          ),\n          expression: a!localVariables(\n            local!evaluationCriterion: fv!item,\n            or(\n              #\"SYSTEM_SYSRULES_forEach\"(\n                items: rule!AS_CO_UT_filterCdtByField(\n                  cdt: local!evaluationCriterion.assignments,\n                  field: \"isActive\",\n                  value: true\n                ),\n                expression: rule!AS_CO_UT_isBlank(fv!item.assignee)\n              )\n            )\n          )\n        ),\n        \n      ),\n      {\n        activeStep: if(\n          ri!evaluation.isWeightedFactorsRequired,\n          7,\n          6\n        ),\n        message: \"Assign a due date and evaluator to each factor and sub-factor\",\n        \n      },\n      {}\n    ),\n    /*     one of the three owner fields is populated  */\n    if(\n      and(\n        rule!AS_CO_UT_isBlank(ri!evaluation.contractingOfficer),\n        rule!AS_CO_UT_isBlank(ri!evaluation.contractingSpecialist),\n        \n      ),\n      {\n        activeStep: 1,\n        message: \"Add either a contracting officer or contract specialist\",\n        \n      },\n      {}\n    )\n  },\n  {\n    disableButton: not(\n      rule!AS_CO_UT_isBlank(local!missingItems)\n    ),\n    missingItems: { local!missingItems }\n  }\n)",
  "calls": [
    {
      "name": "AS_CO_UT_isBlank",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AS_CO_UT_filterCdtByField",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AS_CO_UT_isNotBlank",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AS_GSS_VD_validateFactorWeights",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AS_GSS_TOGGLE_EVALUATION_CHIEF_VISIBILITY",
      "type": "Constant",
      "dep_type": "USES_CONSTANT"
    },
    {
      "name": "AS_GSS_CO_UT_loadBundleFromFolder",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    }
  ],
  "called_by": []
}