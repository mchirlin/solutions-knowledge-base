{
  "_metadata": {
    "bundle_id": "AS_GAM_Sync_Internal_User_Data"
  },
  "objects": {
    "_a-0000e5da-a251-8000-9bbe-011c48011c48_1020929": {
      "name": "AS_GAM_UT_GetUsersForSyncProcess",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*The maximum number of users one loop can process*/\n  /*-- For instance, if we were using a batch size of 25 with a max of 1,000 processes per loop*/\n  /*this would return 25,000*/\n  local!maxNumOfUsersOneLoopCanProcess: cons!AS_GAM_INT_USER_SYNC_USERNAME_BATCH_SIZE * cons!AS_GAM_INT_USER_SYNC_MNI_BATCH_SIZE,\n  /*Calculates the start index to use based on the loopIncrement and the instanceIndex*/\n  /*For instance, if we did a batch of 25 users per sub process and 1,000 per loop*/\n  /*-- If this was loop 1, instanceIndex 1: Return 1*/\n  /*-- If this was loop 1, instanceIndex 2: Return 26*/\n  /*-- If this was loop 2, instanceIndex 1: Return 25,001*/\n  /*-- If this was loop 2, instanceIndex 2: Return 25,026*/\n  local!startIndexToUse: (ri!loopIncrement - 1) * local!maxNumOfUsersOneLoopCanProcess + (ri!instanceIndex - 1) * cons!AS_GAM_INT_USER_SYNC_USERNAME_BATCH_SIZE + 1,\n  /*Return the username list to process based on the startIndex*/\n  if(\n    ri!returnDeactivatedUsers,\n    rule!AS_GAM_UT_getAllDeactivatedAppianUsers(\n      startIndex: local!startIndexToUse,\n      batchSize: cons!AS_GAM_INT_USER_SYNC_USERNAME_BATCH_SIZE,\n      entityMap: ri!entityMap\n    ),\n    a!groupMembers(\n      group: ri!group,\n      memberType: \"USER\",\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: local!startIndexToUse,\n        batchSize: cons!AS_GAM_INT_USER_SYNC_USERNAME_BATCH_SIZE,\n        sort: #\"SYSTEM_SYSRULES_sortInfo\"(field: \"username\", ascending: true)\n      )\n    ).data\n  )\n)"
    },
    "_a-0000e5da-a251-8000-9bbe-011c48011c48_1020935": {
      "name": "AS_GAM_UT_getAllDeactivatedAppianUsers",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*Need plug-in function to get in bulk. We get users from DB to check status*/\n  local!allUsers: rule!AS_GAM_QE_getUser(\n    returnType: cons!AS_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET,\n    pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n      startIndex: if(\n        rule!AS_CO_UT_isBlank(ri!startIndex),\n        1,\n        ri!startIndex\n      ),\n      batchSize: if(\n        rule!AS_CO_UT_isBlank(ri!batchSize),\n        cons!AS_CO_INT_QUERY_MAX_BATCH_SIZE,\n        ri!batchSize\n      )\n    ),\n    entityMap: ri!entityMap\n  ).identifiers,\n  /*Status by user. If 0, deactivated in Appian*/\n  rule!AS_CO_UT_rejectNullValuesFromArray(\n    #\"SYSTEM_SYSRULES_forEach\"(\n      items: local!allUsers,\n      expression: if(\n        user(touser(fv!item), \"status\") = 1,\n        null,\n        touser(fv!item)\n      )\n    )\n  )\n)"
    },
    "_a-0000e3e6-fb42-8000-9ba5-011c48011c48_157870": {
      "name": "AS_CO_UT_queryEntity",
      "type": "Expression Rule",
      "sail_code": "/*\n\nPLEASE REFER TO THE BOTTOM OF THIS RULE FOR INSTRUCTIONS ON HOW TO USE\n\nPlease DO NOT auto-format this rule\n\n*/\n/*Error handling for invalid returnType or entityType*/\nif(\n  rule!AS_CO_UT_isBlank(ri!returnType),\n  fn!error(\n    concat(\n      \"Null `returnType` passed to AS_CO_UT_queryEntity for entityType `\",\n      ri!entityType,\n      \"`.  See documentation in AS_CO_UT_queryEntity for further information on how to use this parameter.\"\n    )\n  ),\n  if(\n    not(\n      contains(\n        rule!AS_CO_CONS_QE_RETURN_TYPES(),\n        ri!returnType\n      )\n    ),\n    fn!error(\n      concat(\n        \"Unknown `returnType` (\",\n        ri!returnType,\n        \") passed to AS_CO_UT_queryEntity for entityType `\",\n        ri!entityType,\n        \"`.  See documentation in AS_CO_UT_queryEntity for further information on how to use this parameter.\"\n      )\n    ),\n    if(\n      rule!AS_CO_UT_isBlank(ri!entityType),\n      fn!error(\n        concat(\n          \"Null `entityType` passed to AS_CO_UT_queryEntity for entity `\",\n          ri!entity,\n          \"`.  See documentation in AS_CO_UT_queryEntity for further information on how to use this parameter.\"\n        )\n      ),\n      if(\n        and(\n          ri!returnType = cons!AS_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET,\n          rule!AS_CO_UT_isBlank(ri!pagingInfo)\n        ),\n        fn!error(\n          concat(\n            \"`pagingInfo` is required (cannot be null) for `returnType` DATA_SUBSET\"\n          )\n        ),\n        if(\n          and(\n            ri!returnType <> cons!AS_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET,\n            rule!AS_CO_UT_isNotBlank(ri!pagingInfo)\n          ),\n          fn!error(\n            concat(\n              \"`pagingInfo` must be null when the `returnType` is not DATA_SUBSET, instead use `sort` to pass custom sorting, `batchSize` to pass custom batch size, and `startIndex` & `batchSize` (if null) will be automatically calculated for you\"\n            )\n          ),\n          if(\n            and(\n              ri!returnType = cons!AS_CO_ENUM_QE_RETURN_TYPE_AGGREGATION,\n              rule!AS_CO_UT_isBlank(ri!aggregation)\n            ),\n            fn!error(\n              \"You must provide an input for `aggregation` when `returnType` is AGGREGATION\"\n            ),\n            if(\n              and(\n                not(\n                  contains(\n                    {\n                      cons!AS_CO_ENUM_QE_RETURN_TYPE_AGGREGATION,\n                      cons!AS_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET\n                    },\n                    ri!returnType\n                  )\n                ),\n                rule!AS_CO_UT_isNotBlank(ri!aggregation)\n              ),\n              fn!error(\n                \"You cannot provide an input for `aggregation` when `returnType` is not AGGREGATION or DATA_SUBSET\"\n              ),\n              a!localVariables(\n                /*Determine the castResultToType*/\n                local!castResultToType: rule!AS_CO_UT_displayValue(\n                  value: ri!returnType,\n                  inArray: rule!AS_CO_CONS_QE_RETURN_TYPES(),\n                  replacement: {\n                    /*DATA_SUBSET*/'type!{http://www.appian.com/ae/types/2009}DataSubset',\n                    /*SINGLE_OBJECT*/ri!entityType,\n                    /*OBJECT_ARRAY*/rule!AS_CO_UT_returnArrayTypeNumber(type: ri!entityType),\n                    /*AGGREGATION*/'type!{http://www.appian.com/ae/types/2009}Map?list',\n                    /*TOTAL_COUNT*/'type!{http://www.appian.com/ae/types/2009}Integer',\n                    \n                  }\n                ),\n                /*Determine the batchSize*/\n                local!batchSize: rule!AS_CO_UT_displayValue(\n                  value: ri!returnType,\n                  inArray: rule!AS_CO_CONS_QE_RETURN_TYPES(),\n                  replacement: {\n                    /*DATA_SUBSET*/ri!pagingInfo.batchSize,\n                    /*SINGLE_OBJECT*/1,\n                    /*OBJECT_ARRAY*/rule!AS_CO_UT_replaceNull(\n                      nullableValue: ri!batchSize,\n                      replacementValue: cons!AS_CO_INT_QUERY_MAX_BATCH_SIZE\n                    ),\n                    /*AGGREGATION*/rule!AS_CO_UT_replaceNull(\n                      nullableValue: ri!batchSize,\n                      replacementValue: cons!AS_CO_INT_QUERY_MAX_BATCH_SIZE\n                    ),\n                    /*TOTAL_COUNT*/0,\n                    \n                  }\n                ),\n                /*Determine the sort*/\n                local!sort: rule!AS_CO_UT_zInternal_queryEntity_determineSort(\n                  entityType: ri!entityType,\n                  returnType: ri!returnType,\n                  pagingInfo: ri!pagingInfo,\n                  sort: ri!sort,\n                  isAggregation: rule!AS_CO_UT_isNotBlank(ri!aggregation)\n                ),\n                /*Determine the pagingInfo*/\n                local!pagingInfo: if(\n                  ri!returnType = cons!AS_CO_ENUM_QE_RETURN_TYPE_DATA_SUBSET,\n                  /*Use specific pagingInfo for DATA_SUBSET*/\n                  #\"SYSTEM_SYSRULES_pagingInfo\"(\n                    startIndex: ri!pagingInfo.startIndex,\n                    batchSize: ri!pagingInfo.batchSize,\n                    sort: local!sort\n                  ),\n                  /*Otherwise calculate pagingInfo for all other returnTypes*/\n                  #\"SYSTEM_SYSRULES_pagingInfo\"(\n                    startIndex: 1,\n                    batchSize: local!batchSize,\n                    sort: local!sort\n                  )\n                ),\n                /*Determine the fetchTotalCount*/\n                local!fetchTotalCount: rule!AS_CO_UT_displayValue(\n                  value: ri!returnType,\n                  inArray: rule!AS_CO_CONS_QE_RETURN_TYPES(),\n                  replacement: {\n                    /*DATA_SUBSET*/true,\n                    /*SINGLE_OBJECT*/false,\n                    /*OBJECT_ARRAY*/false,\n                    /*AGGREGATION*/false,\n                    /*TOTAL_COUNT*/true,\n                    \n                  }\n                ),\n                /*Execute the query*/\n                local!queryResult: a!refreshVariable(\n                  value: if(\n                    ri!executeWhen = false,\n                    null,\n                    #\"SYSTEM_SYSRULES_queryEntity_v1\"(\n                      entity: ri!entity,\n                      fetchTotalCount: local!fetchTotalCount,\n                      query: #\"SYSTEM_SYSRULES_query\"(\n                        pagingInfo: local!pagingInfo,\n                        aggregation: ri!aggregation,\n                        selection: if(\n                          and(\n                            ri!excludeNestedCdts = true,\n                            rule!AS_CO_UT_isBlank(ri!aggregation)\n                          ),\n                          #\"SYSTEM_SYSRULES_querySelection\"(\n                            columns: #\"SYSTEM_SYSRULES_forEach\"(\n                              items: rule!AS_CO_UT_returnCdtFields(\n                                type: ri!entityType,\n                                onlyPrimitiveFields: true\n                              ),\n                              expression: #\"SYSTEM_SYSRULES_queryColumn\"(field: fv!item)\n                            )\n                          ),\n                          null\n                        ),\n                        logicalExpression: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                          operator: \"AND\",\n                          logicalExpressions: {\n                            #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                              operator: \"AND\",\n                              ignoreFiltersWithEmptyValues: true,\n                              filters: rule!AS_CO_UT_replaceNull(\n                                nullableValue: ri!filters,\n                                replacementValue: {}\n                              )\n                            ),\n                            rule!AS_CO_UT_replaceNull(\n                              nullableValue: ri!logicalExpression,\n                              replacementValue: {}\n                            )\n                          }\n                        )\n                      )\n                    )\n                  ),\n                  refreshOnVarChange: ri!triggerRefresh,\n                  refreshAfter: { \"RECORD_ACTION\" }\n                ),\n                /*Parse the queryResult*/\n                local!queryResultParse: choose(\n                  rule!AS_CO_UT_chooseWherecontainsHelper(\n                    value: ri!returnType,\n                    inArray: rule!AS_CO_CONS_QE_RETURN_TYPES()\n                  ),\n                  /*Default, required value based on how AS_CO_UT_chooseWherecontainsHelper operates*/\"\",\n                  /*DATA_SUBSET*/local!queryResult,\n                  /*SINGLE_OBJECT*/local!queryResult.data,\n                  /*OBJECT_ARRAY*/local!queryResult.data,\n                  /*AGGREGATION*/local!queryResult.data,\n                  /*TOTAL_COUNT*/local!queryResult.totalCount,\n                  \n                ),\n                rule!AS_CO_UT_cast(\n                  type: local!castResultToType,\n                  value: local!queryResultParse\n                )\n              )\n            )\n          )\n        )\n      )\n    )\n  )\n)/*\n\nDOCUMENTATION\n\nThis rule is designed to minimize the overhead with querying data and then casting the result\n\n\nRequired Inputs:\n\n1. entity \n- This is the data store entity you are querying\n-- e.g. cons!AS_DATA_STORE_ENTITY_CASES\n\n2. entityType\n- This is a type! input of the data type which maps to the underlying data store entity\n- Note that your type! input should not end in parenthesis; this is NOT designed to take in an empty CDT\n-- e.g. 'type!{urn:com:appian:types}Case'\n\n3. returnType\n- This depends on the purpose for the query, and should be one of the returnTypes in rule!AS_CO_CONS_QE_RETURN_TYPES\n-- DATA_SUBSET - This will return a DataSubset; pagingInfo is required\n-- SINGLE_OBJECT - This will return a single CDT whose type is the entityType; pagingInfo must be null\n-- OBJECT_ARRAY - This will return an array of CDTs whos type is an array of the entityType; pagingInfo must be null\n-- AGGREGATION - This will return an array of Dictionaries; pagingInfo must be null\n---- NOTE: If you need Aggregation with paging controls, such as for a grid, use returnType DATA_SUBSET\n-- TOTAL_COUNT - This will return an Integer of the total count; pagingInfo must be null\n\n\nOptional Inputs:\n\n4. executeWhen\n- The query will not execute if this is false, the query will execute if this is true or null\n-- This is meant to operate in a similar manner to the showWhen parameter of components\n- Usethistoskipexecutionofaquerywithoutneedingtowrapif()statementsaroundtherule\n-- Examples of this would be to skip querying if your filter value is a null ID\n- If the query does not execute, this will return a null value whose type is based on the returnType input\n\n5. triggerRefresh\n- By default, the query will always re-execute whenever any inputs change\n- However, by updating the value of triggerRefresh, you can also trigger a re-execution even if none of the other inputs change\n\n6. excludeNestedCdts\n- When true, this will exclude all nested CDTs from the query selection, and only include primitive fields\n- When false or null, all fields will be included in the query, including all nested CDTs\n\n7. filters\n- Array of filters to apply to the query, built with a!queryFilter()\n- These filters will be applied with an AND operator\n- These filters will apply in addition to the logicalExpression input, combining both with an AND operator\n\n8. logicalExpression\n- A logical expression to apply to the query, built with a!queryLogicalExpression()\n- This logical expression will apply in addition to the filters input, combining both with an AND operator\n\n9. aggregation\n- Aggregation to apply to the query, built with a!queryAggregation()\n\n10. pagingInfo\n- Paging info to apply to the query, built with a!pagingInfo() or derived from fv!pagingInfo in grids\n- This is required if passing returnType DATA_SUBSET, otherwise it must be null\n- For returnTypes that are not DATA_SUBSET, the batch size will be automatically calculated depending on the returnType\n-- For example, passing SINGLE_OBJECT will automatically apply a batch size of 1, whereas OBJECT_ARRAY and AGGREGATION will automatically apply a batch size of -1\n\n11. sort\n- Array of sort to apply to the query, built with a!sortInfo()\n- This is meant to be used with returnType OBJECT_ARRAY and AGGREGATION, since pagingInfo is not required for these, but a specified sort may be used\n\n12. batchSize\n- Batch size to apply to the query\n- This is meant to be used with returnType OBJECT_ARRAY and AGGREGATION, since pagingInfo is not required for these, but a specified batchSize may be used\n\n*/"
    },
    "_a-0000e5da-a251-8000-9bbe-011c48011c48_1034442": {
      "name": "AS_GAM_QE_getUser",
      "type": "Expression Rule",
      "sail_code": "/* ri!entityMap should have the fields \"entity\" and \"entityType\" */\n\nrule!AS_CO_UT_queryEntity(\n  entity: ri!entityMap.entity,\n  entityType: ri!entityMap.entityType,\n  returnType: ri!returnType,\n  executeWhen: ri!executeWhen,\n  triggerRefresh: ri!triggerRefresh,\n  logicalExpression: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n    operator: \"AND\",\n    logicalExpressions: {\n      #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n        operator: \"AND\",\n        ignoreFiltersWithEmptyValues: true,\n        filters: {\n          #\"SYSTEM_SYSRULES_queryFilter\"(\n            field: \"username\",\n            operator: \"in\",\n            value: ri!usernames\n          )\n        }\n      ),\n      ri!logicalExpression\n    }\n  ),\n  pagingInfo: ri!pagingInfo,\n  sort: #\"SYSTEM_SYSRULES_sortInfo\"(field: \"firstName\", ascending: true)\n)"
    },
    "_a-0000e5da-a251-8000-9bbe-011c48011c48_1020638": {
      "name": "AS_GAM_UT_GetNumOfLoopsForSync",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*The total number of users to sync*/\n  local!totalNumOfUsers: ri!totalNumOfUsers,\n\n  /*The total number of child processes we will need to run to sync these*/\n  local!totalNumOfChildProcessesToRun: ceiling(\n    local!totalNumOfUsers / cons!AS_GAM_INT_USER_SYNC_USERNAME_BATCH_SIZE\n  ),\n\n  /*The total number of loops to run, considering we cannot run more than 1,000 nodes in one MNI call*/\n  local!totalNumOfProcessLoops: ceiling(\n    local!totalNumOfChildProcessesToRun / cons!AS_GAM_INT_USER_SYNC_MNI_BATCH_SIZE\n  ),\n\n  local!totalNumOfProcessLoops\n)"
    },
    "_a-0000e2ad-62e7-8000-9ba2-011c48011c48_75782": {
      "name": "AS_CO_UT_isNotBlank",
      "type": "Expression Rule",
      "sail_code": "cast(\n   'type!{http://www.appian.com/ae/types/2009}Boolean',\n  not(rule!AS_CO_UT_isBlank(ri!input))\n)"
    },
    "000ae5f6-3f4e-8000-0f94-7f0000014e7a": {
      "name": "AS GAM Sync Internal User Data",
      "type": "Process Model",
      "sail_code": "// Output: ?\npv!loopIncrement+1\n\n// Output: ?\npv!loopIncrement+1\n\n// Input: ?\n=rule!AS_GAM_UT_GetNumOfUsersForGroup(group: pv!group)\n\n// Output: ?\n0\n\n// Output: ?\nrule!AS_GAM_UT_GetNumOfLoopsForSync(\n  totalNumOfUsers: ac!numActiveUsers\n)\n\n// Input: ?\n=rule!AS_GAM_UT_getAllDeactivatedAppianUsers( startIndex: 1, batchSize: -1, entityMap: pv!entityMap)\n\n// Output: ?\nrule!AS_GAM_UT_GetNumOfLoopsForSync(\n  totalNumOfUsers: rule!AS_GAM_UT_ArrayLength(ac!inactiveUsers)\n)\n\n// Output: ?\n0\n\n// Output: ?\nrule!AS_GAM_UT_ArrayLength(ac!inactiveUsers)\n\n// Input: ?\n=cons!AS_GAM_PM_ADD_USERS\n\n// Input: ?\n= { usernameList: index( pv!inactiveUsers, enumerate( min( cons!AS_GAM_INT_USER_SYNC_USERNAME_BATCH_SIZE, rule!AS_GAM_UT_ArrayLength(pv!inactiveUsers) - ( (pv!loopIncrement - 1) * (cons!AS_GAM_INT_USER_SYNC_MNI_BATCH_SIZE * cons!AS_GAM_INT_USER_SYNC_MNI_BATCH_SIZE) + (tp!instanceindex - 1) * cons!AS_GAM_INT_USER_SYNC_USERNAME_BATCH_SIZE ) )) + (pv!loopIncrement - 1) * cons!AS_GAM_INT_USER_SYNC_MNI_BATCH_SIZE * cons!AS_GAM_INT_USER_SYNC_USERNAME_BATCH_SIZE + 1, {} ), entityMap: pv!entityMap}\n\n// Input: ?\n=cons!AS_GAM_PM_ADD_USERS\n\n// Input: ?\n= { usernameList: rule!AS_GAM_UT_GetUsersForSyncProcess( returnDeactivatedUsers: false, instanceIndex: tp!instanceIndex, loopIncrement: pv!loopIncrement, entityMap: pv!entityMap, group: pv!group ), entityMap: pv!entityMap}"
    },
    "_a-0000e5da-a251-8000-9bbe-011c48011c48_1012177": {
      "name": "AS_GAM_UT_GetNumOfUsersForGroup",
      "type": "Expression Rule",
      "sail_code": "if(\n  rule!AS_CO_UT_isBlank(ri!group),\n  {},\n  a!groupMembers(\n    group: ri!group,\n    memberType: \"USER\",\n    pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(startIndex: 1, batchSize: 0)\n  ).totalCount\n)\n"
    },
    "_a-0000e5da-a251-8000-9bbe-011c48011c48_1021202": {
      "name": "AS_GAM_UT_ArrayLength",
      "type": "Expression Rule",
      "sail_code": "if(\n  rule!AS_CO_UT_isBlank(ri!array),\n  0,\n  length(ri!array)\n)"
    },
    "_a-0000e2ad-62e7-8000-9ba2-011c48011c48_73536": {
      "name": "AS_CO_UT_isBlank",
      "type": "Expression Rule",
      "sail_code": "cast(\n  'type!{http://www.appian.com/ae/types/2009}Boolean',\n  length(a!flatten(ri!value)) = 0\n)"
    },
    "_a-0000e2ad-62e7-8000-9ba2-011c48011c48_76367": {
      "name": "AS_CO_UT_rejectNullValuesFromArray",
      "type": "Expression Rule",
      "sail_code": "cast(\n  typeof(ri!array),\n  reject(\n    rule!AS_CO_UT_isBlank(_),\n    a!flatten(ri!array)\n  )\n)"
    }
  }
}