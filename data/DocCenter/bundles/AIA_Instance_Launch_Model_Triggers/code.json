{
  "_metadata": {
    "bundle_id": "AIA_Instance_Launch_Model_Triggers"
  },
  "objects": {
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_85019": {
      "name": "AIA_IsExtractionInstance",
      "type": "Expression Rule",
      "sail_code": "runtimetypeof(\n  ri!Instance\n) = typeof(\n  recordType!AIA Extraction Instance()\n)"
    },
    "_a-0000ec44-cb49-8000-9be6-011c48011c48_87243": {
      "name": "SHRD_ConvertProcessModelId",
      "type": "Expression Rule",
      "sail_code": "extract(\n  getprocessmodeldetailsbyuuid(\n    ri!id\n  ),\n  if(\n    ri!type = \"id\",\n    \"UUID:\",\n    \"Id:\"\n  ),\n  if(\n    ri!type = \"id\",\n    \", C\",\n    \", U\"\n  ),\n)"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_182518": {
      "name": "AIA_IsDocumentExtension",
      "type": "Expression Rule",
      "sail_code": "and(\n  a!isNotNullOrEmpty(ri!document),\n  contains(\n    lower(ri!extensions),\n    lower(document(\n      ri!document,\n      \"extension\"\n    ))\n  )\n)"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_83881": {
      "name": "AIA_HasCriticalErrors",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!relationship: if(\n    rule!AIA_IsExtractionInstance(Instance: ri!Instance),\n    recordType!AIA Extraction Instance.validations,\n    recordType!AIA Classification Instance.validations\n  ),\n  local!criticalErrors: rule!AIA_UTIL_Filter(\n    records: a!defaultValue(ri!Validations, ri!Instance[local!relationship]),\n    field: recordType!AIA Instance Validation Error.severity,\n    value: cons!AIA_SEVERITY_CRITICAL,\n    filterType: \"FILTER\"\n  ),\n  and(\n    a!isNotNullOrEmpty(\n      local!criticalErrors\n    ),\n    length(\n      local!criticalErrors\n    ) > 0\n  )\n)"
    },
    "0002ee65-70dc-8000-fb24-7f0000014e7a": {
      "name": "AIA Instance Launch Model Triggers",
      "type": "Process Model",
      "sail_code": "// Input: ?\nrule!SHRD_UTIL_getPmIdFromProcessModelUuid(uuid: pv!modelTrigger[recordType!AIA Model Trigger.processModelUuid])\n\n// Input: ?\npv!inputMap.instance\n\n// Input: ?\nrule!SHRD_UTIL_getPmIdFromProcessModelUuid(\n  uuid: pv!modelTrigger[recordType!AIA Model Trigger.processModelUuid]\n)\n\n// Input: ?\npv!inputMap.instance\n\n// Output: ?\nif(\n  a!isNullOrEmpty(pv!inputMap.uuid),\n  error(\n    \"instance.modelVersion.modelId must be populated to determine relevant trigger\"\n  ),\n  rule!AIA_QR_getModelTrigger(\n    returnType: \"SINGLE_OBJECT\",\n    uuid: pv!inputMap.uuid,\n    triggerTypeIds: pv!triggerTypeId\n  )\n)"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_36272": {
      "name": "AIA_QR_getModelTrigger",
      "type": "Expression Rule",
      "sail_code": "rule!SHRD_UTIL_QueryRecord(\n  recordType: recordType!AIA Model Trigger,\n  returnType: ri!returnType,\n  fields: ri!fields,\n  executeWhen: ri!executeWhen,\n  filters: {\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Trigger.uuid,\n      operator: \"=\",\n      value: ri!uuid,\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Trigger.modelTriggerId,\n      operator: \"in\",\n      value: ri!ids\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Trigger.modelTriggerId,\n      operator: \"not in\",\n      value: ri!idsToExclude\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Model Trigger.triggerTypeId,\n      operator: \"in\",\n      value: ri!triggerTypeIds\n    )\n  },\n  sort: #\"SYSTEM_SYSRULES_sortInfo\"(\n    field: recordType!AIA Model Trigger.modelTriggerId,\n    ascending: true\n  )\n)"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_36163": {
      "name": "SHRD_UTIL_QueryRecord",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!maxBatchSize: 5000,\n  /*Chosen return type*/\n  local!returnType: a!defaultValue(ri!returnType, \"OBJECT_ARRAY\"),\n  /*Determine the query parameters to use by the return type*/\n  local!queryParams: a!match(\n    value: local!returnType,\n    equals: \"OBJECT_ARRAY\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        #\"urn:appian:function:v1:a:listtype?okey=a!listType\"(ri!recordType),\n        'type!{http://www.appian.com/ae/types/2009}Map?list'\n      ),\n      fetchTotalCount: false,\n      isArray: true,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          local!maxBatchSize\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"SINGLE_OBJECT\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        ri!recordType,\n        'type!{http://www.appian.com/ae/types/2009}Map'\n      ),\n      fetchTotalCount: false,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"RECORD_BY_ID\",\n    then: a!map(\n      castToType: ri!recordType,\n      fetchTotalCount: false,\n      isArray: false,\n      queryRecordByIdentifier: true,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"DATA_SUBSET\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}DataSubset',\n      fetchTotalCount: true,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: a!defaultValue(ri!pagingInfo.startIndex, 1),\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          local!maxBatchSize\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"TOTAL_COUNT\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}Integer',\n      fetchTotalCount: true,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(startIndex: 1, batchSize: 0)\n    ),\n    default: fn!error(\n      \"Invalid returnType, must be one of: OBJECT_ARRAY, SINGLE_OBJECT, RECORD_BY_ID, DATA_SUBSET, TOTAL_COUNT\"\n    )\n  ),\n  if(\n    /*Early exit for skip execution*/\n    ri!executeWhen = false,\n    cast(\n      local!queryParams.castToType,\n      if(local!queryParams.isArray, {}, null)\n    ),\n    a!localVariables(\n      /*Run the query*/\n      local!queryResult: a!refreshVariable(\n        value: if(\n          local!queryParams.queryRecordByIdentifier,\n          #\"SYSTEM_SYSRULES_queryRecordByIdentifier\"(\n            recordType: ri!recordType,\n            identifier: index({ri!identifier},1,null),\n            /*If fields is sent in using a!selectionFields(), then adding the fields contained in ri!relatedRecordData will break the query*/\n            fields: reject(\n              a!isNullOrEmpty,\n              a!flatten(\n                {\n                  ri!fields,\n                  if(\n                    or(\n                      typeof(ri!fields) = typeof(#\"SYSTEM_SYSRULES_selectionFields\"()),\n                      typeof(ri!fields) = typeof({#\"SYSTEM_SYSRULES_selectionFields\"()})\n                    ),\n                    {},\n                    index(ri!relatedRecordData, \"relationship\", {})\n                  )\n                }\n              )\n            ),\n            relatedRecordData: ri!relatedRecordData\n          ),\n          #\"SYSTEM_SYSRULES_queryRecordType_v1\"(\n            recordType: ri!recordType,\n            fields: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              reject(\n                a!isNullOrEmpty,\n                a!flatten(\n                  {\n                    ri!fields,\n                    index(ri!relatedRecordData, \"relationship\", {})\n                  }\n                )\n              ),\n              #\"SYSTEM_SYSRULES_aggregationFields\"(\n                groupings: #\"SYSTEM_SYSRULES_forEach\"(\n                  items: ri!groupByFields,\n                  expression: #\"SYSTEM_SYSRULES_grouping\"(field: fv!item, alias: tostring(fv!item))\n                ),\n                measures: #\"SYSTEM_SYSRULES_measure\"(\n                  field: ri!groupByFields[1],\n                  function: \"COUNT\",\n                  alias: \"count\"\n                )\n              )\n            ),\n            filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n              operator: \"AND\",\n              ignoreFiltersWithEmptyValues: true,\n              logicalExpressions: {\n                ri!logicalExpressions,\n                if(\n                  and(\n                    a!isNotNullOrEmpty(ri!searchFields),\n                    a!isNotNullOrEmpty(ri!searchTerm)\n                  ),\n                  #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                    operator: \"AND\",\n                    logicalExpressions: #\"SYSTEM_SYSRULES_forEach\"(\n                      items: split(trim(ri!searchTerm), \" \"),\n                      expression: a!localVariables(\n                        local!splitSearchTerm: fv!item,\n                        /*   Initiate filter for each field by the value provided in searchTerm   */\n                        #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                          operator: \"OR\",\n                          filters: #\"SYSTEM_SYSRULES_forEach\"(\n                            items: ri!searchFields,\n                            expression: #\"SYSTEM_SYSRULES_queryFilter\"(\n                              field: fv!item,\n                              operator: \"includes\",\n                              value: local!splitSearchTerm\n                            )\n                          )\n                        )\n                      )\n                    )\n                  ),\n                  {}\n                )\n              },\n              filters: ri!filters\n            ),\n            pagingInfo: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              local!queryParams.pagingInfo,\n              #\"urn:appian:function:v1:a:update\"(\n                local!queryParams.pagingInfo,\n                \"sort\",\n                null\n              )\n            ),\n            fetchTotalCount: local!queryParams.fetchTotalCount,\n            relatedRecordData: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              ri!relatedRecordData,\n              {}\n            )\n          )\n        ),\n        refreshOnVarChange: ri!triggerRefresh,\n        refreshAfter: { \"RECORD_ACTION\" }\n      ),\n      /*Format the output*/\n      local!output: a!match(\n        value: local!returnType,\n        equals: \"OBJECT_ARRAY\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"data\",{})\n        ),\n        equals: \"SINGLE_OBJECT\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"data\",{})\n        ),\n        equals: \"RECORD_BY_ID\",\n        /*do not need to cast for queryRecordByIdentifier*/\n        then: local!queryResult,\n        equals: \"DATA_SUBSET\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult\n        ),\n        equals: \"TOTAL_COUNT\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"totalCount\",{})\n        ),\n        default: null\n      ),\n      local!output\n    )\n  )\n)"
    },
    "_a-0000ed69-99d8-8000-9ba6-011c48011c48_55250": {
      "name": "AIA_Extraction_ShouldRunAdvancedIdp",
      "type": "Expression Rule",
      "sail_code": "and(\n  cons!AIA_ADVANCED_IDP_ENABLED,\n  or(\n    ri!ExtractionInstance[recordType!AIA Extraction Instance.modelVersion.extractionModel.useAdvancedLayout] = true,\n    ri!ExtractionInstance[recordType!AIA Extraction Instance.modelVersion.extractionModel.useBoundingBoxes] = true\n  ),\n  or(\n    a!isNullOrEmpty(ri!useAdvancedIdp),\n    ri!useAdvancedIdp = true\n  ),\n  rule!AIA_IsDocumentExtension(\n    document: ri!ExtractionInstance[recordType!AIA Extraction Instance.documentId],\n    extensions: cons!AIA_AI_SUPPORTED_DOC_TYPES\n  ) \n)"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_37527": {
      "name": "SHRD_UTIL_getPmIdFromProcessModelUuid",
      "type": "Expression Rule",
      "sail_code": "cast(\n  'type!{http://www.appian.com/ae/types/2009}Integer',\n  rule!SHRD_ConvertProcessModelId(\n    id: ri!uuid,\n    type: \"uuid\"\n  )\n)"
    },
    "dad961d1-ef89-4f6b-9fcc-384ab2e78755": {
      "name": "AIA Extraction Run Model Version",
      "type": "Process Model",
      "sail_code": "// Input: ?\n=pv!ExtractionInstance\n\n// Output: ?\nac!ProcessInfo.pv.ExtractionInstance\n\n// Output: ?\nac!ProcessInfo.pv.responseJson\n\n// Input: ?\n=pv!ExtractionInstance\n\n// Output: ?\nac!ProcessInfo.pv.ExtractionInstance\n\n// Output: ?\nac!ProcessInfo.pv.responseJson\n\n// Input: ?\n=pv!ExtractionInstance\n\n// Input: ?\n=pv!responseJson\n\n// Output: ?\nac!ProcessInfo.pv.json\n\n// Output: ?\nac!ProcessInfo.pv.ExtractionInstance\n\n// Input: ?\n=pv!ExtractionInstance\n\n// Input: ?\npv!document\n\n// Input: ?\nfalse\n\n// Input: ?\nfalse\n\n// Input: ?\n=pv!modelKey\n\n// Input: ?\n=pv!responseJson\n\n// Output: ?\nac!ProcessInfo.pv.ExtractionInstance\n\n// Input: ?\n=pv!document\n\n// Input: ?\n=pv!input\n\n// Input: ?\n=pv!isDocumentTestCase\n\n// Input: ?\n=pv!modelKey\n\n// Input: ?\n=pv!modelVersionId\n\n// Input: ?\n=pv!testRunProcessId\n\n// Input: ?\n=pv!testSuiteRunId\n\n// Output: ?\nac!ProcessInfo.pv.ExtractionInstance"
    },
    "_a-0000ed46-3c8c-8000-9bac-011c48011c48_26889": {
      "name": "AIA_UTIL_Filter",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!fieldValuePairs: a!defaultValue(\n    ri!fieldValuePairs,\n    #\"SYSTEM_SYSRULES_forEach\"(\n      items: a!flatten(ri!field),\n      expression: a!map(\n        field: fv!item,\n        value: if(\n          fv!itemCount = 1,\n          ri!value,\n          index(a!flatten(ri!value), fv!index, null)\n        )\n      )\n    )\n  ),\n  local!matchIndices: if(\n    a!isNullOrEmpty(a!flatten(ri!records)),\n    tointeger({}),\n    reduce(\n      rule!AIA_UTIL_Filter_Reducer(\n        previousIndices: _,\n        records: a!flatten(ri!records),\n        fieldValuePair: _\n      ),\n      enumerate(count(a!flatten(ri!records))) + 1,\n      local!fieldValuePairs\n    )\n  ),\n  local!rejectIndices: difference(\n    if(\n      a!isNullOrEmpty(ri!records),\n      tointeger({}),\n      enumerate(count(a!flatten(ri!records))) + 1\n    ),\n    local!matchIndices\n  ),\n  local!matches: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!matchIndices, {})\n  ),\n  local!rejects: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!rejectIndices, {})\n  ),\n  a!match(\n    value: a!defaultValue(ri!filterType, \"FILTER\"),\n    equals: \"FILTER\",\n    then: local!matches,\n    equals: \"REJECT\",\n    then: local!rejects,\n    equals: \"FIRST_MATCH\",\n    then: index(local!matches, 1, null),\n    equals: \"FIRST_REJECT\",\n    then: index(local!rejects, 1, null),\n    equals: \"MATCH_COUNT\",\n    then: count(local!matchIndices),\n    equals: \"REJECT_COUNT\",\n    then: count(local!rejectIndices),\n    equals: \"MATCH_INDICES\",\n    then: local!matchIndices,\n    equals: \"REJECT_INDICES\",\n    then: local!rejectIndices,\n    equals: \"FULL_RESULT\",\n    then: a!map(\n      matches: local!matches,\n      rejects: local!rejects,\n      firstMatch: index(local!matches, 1, null),\n      firstReject: index(local!rejects, 1, null),\n      matchCount: count(local!matchIndices),\n      rejectCount: count(local!rejectIndices),\n      matchIndices: local!matchIndices,\n      rejectIndices: local!rejectIndices\n    ),\n    default: fn!error(\n      \"Invalid filterType, must be one of: FILTER, REJECT, FIRST_MATCH, FIRST_REJECT, MATCH_COUNT, REJECT_COUNT, MATCH_INDICES, REJECT_INDICES, FULL_RESULT\"\n    )\n  )\n)"
    }
  }
}