{
  "_metadata": {
    "bundle_id": "CMGT_SELF_UserAccount_Create"
  },
  "objects": {
    "_a-0000ea26-2ced-8000-9bf1-011c48011c48_583958": {
      "name": "CMGT_UTIL_FillDocumentTemplate",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!output: reduce(\n    substitute(_, _, _),\n    rule!CMGT_PLUGIN_ReadDocumentContent(document: ri!document),\n    merge(\n      apply(\n        concat(\"###\", _, \"###\"),\n        ri!replacementParams.find\n      ),\n      touniformstring(ri!replacementParams.replace)\n    )\n  ),\n  local!output\n)"
    },
    "_a-0000ea26-2ced-8000-9bf1-011c48011c48_583989": {
      "name": "CMGT_PLUGIN_ReadDocumentContent",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!documentContent: readdocumentcontent(ri!document),\n  if(\n    local!documentContent = \"null\",\n    \"\",\n    local!documentContent\n  )\n)"
    },
    "0002ec1f-90f4-8000-1366-7f0000014e7a": {
      "name": "CMGT_SELF_UserAccount_Create",
      "type": "Process Model",
      "sail_code": "// Input: ?\n=rule!CMGT_SELF_Email_EmailSettingMap_UserAccountExists(email: pv!email)\n\n// Input: ?\n=pv!user\n\n// Input: ?\n=cons!CMGT_LA_GRP_EXTERNAL_USERS\n\n// Input: ?\n=pv!email\n\n// Input: ?\n=pv!firstName\n\n// Input: ?\n=pv!lastName\n\n// Input: ?\n=pv!email\n\n// Input: ?\n=rule!CMGT_SELF_MTR_NewUserRegistration()\n\n// Output: ?\nAC!NewUsername"
    },
    "_a-0000ec18-c982-8000-9cd0-011c48011c48_2648901": {
      "name": "CMGT_SELF_Email_EmailSettingMap_UserAccountExists",
      "type": "Expression Rule",
      "sail_code": "a!map(\n  recipients: toemailaddress(ri!email),\n  subject: #\"urn:appian:translation-string:v1:8e7fdc73-b782-41f8-ac01-afb1b6a6ca73\",\n  recipientEmailAddress: null,\n  replacementParams: rule!CMGT_SELF_Email_UserAccountExists_ReplacementParamsMap(email: ri!email)\n)"
    },
    "_a-0000ea2f-ac11-8000-9bf4-011c48011c48_598077": {
      "name": "CMGT_Email_BaseTemplate_ReplacementParamsMap",
      "type": "Expression Rule",
      "sail_code": "{\n  /* Header   */\n  {\n    find: \"headerBackgroundColor\",\n    replace: ri!brandingMap.DefaultBackgroundColor\n  },\n  {\n    find: \"logo\",\n    replace: ri!brandingMap.PublicLogoUrl\n  },\n  {\n    find: \"applicationNameColor\",\n    replace: ri!brandingMap.AccentColor\n  },\n  {\n    find: \"applicationName\",\n    replace: #\"urn:appian:translation-string:v1:311735dd-c418-42b1-9019-b3f175959489\"\n  },\n  /* Body   */\n  {\n    find: \"backgroundColor\",\n    replace: ri!brandingMap.DefaultBackgroundColor\n  },\n  {\n    find: \"contentBorderColor\",\n    replace: ri!brandingMap.DividerColor\n  },\n  {\n    find: \"instructionSize\",\n    replace: ri!instructionSize\n  },\n  {\n    find: \"instructionColor\",\n    replace: a!defaultValue(\n      value: ri!instructionColor,\n      default: ri!brandingMap.StandardTextColor\n    )\n  },\n  {\n    find: \"instruction\",\n    replace: ri!instruction\n  },\n  /* Button   */\n  {\n    find: \"buttonBackgroundColor\",\n    replace: ri!brandingMap.AccentColor\n  },\n  {\n    find: \"buttonLabelColor\",\n    replace: ri!brandingMap.WhiteColor\n  },\n  {\n    find: \"buttonLabel\",\n    replace: ri!buttonLabel\n  },\n  {\n    find: \"buttonLinkUrl\",\n    replace: ri!buttonLinkUrl\n  },\n  /*  Footer        */\n  {\n    find: \"footerTextColor\",\n    replace: ri!brandingMap.SecondaryTextColor\n  },\n  {\n    find: \"footerText\",\n    replace: ri!footerText\n  }\n}"
    },
    "_a-0000e9d3-70bf-8000-9bbd-011c48011c48_180568": {
      "name": "CMGT_UTIL_IsNotBlank",
      "type": "Expression Rule",
      "sail_code": "not(rule!CMGT_UTIL_IsBlank(ri!input))"
    },
    "_a-0000e9f4-1323-8000-9bd3-011c48011c48_267840": {
      "name": "CMGT_UTIL_LoadBrandingMap",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!branding: getbrandingconfig(\n    cons!CMGT_DOC_DEFAULT_BRANDING_CONFIG,\n    true\n  ),\n  local!output: reduce(\n    #\"urn:appian:function:v1:a:update\"(_, _, _),\n    a!map(),\n    merge(\n      {\n        local!branding.defaultBranding.key,\n        local!branding.customBranding.key\n      },\n      {\n        local!branding.defaultBranding.value,\n        local!branding.customBranding.value\n      }\n    )\n  ),\n  local!output\n)"
    },
    "_a-0000e9ca-3659-8000-9bb8-011c48011c48_145648": {
      "name": "CMGT_UTIL_GetSiteUrl",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!authedPath: cast(\n    'type!{http://www.appian.com/ae/types/2009}Text',\n    extract(linktodocument(0, \"doc\"), \"\"\"\", \"/doc/\")\n  ),\n  local!subdomainWithDomain: extract(local!authedPath, \"//\", \"/suite\")[1],\n  local!subdomain: split(local!subdomainWithDomain, \".\")[1],\n  a!map(\n    subdomain: local!subdomain,\n    authedPath: local!authedPath,\n    subdomainWithDomain: local!subdomainWithDomain\n  )\n)"
    },
    "af326a29-a1c8-4399-a28d-996f85819d9e": {
      "name": "CMGT_UTIL_Filter",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!fieldValuePairs: a!defaultValue(\n    ri!fieldValuePairs,\n    apply(\n      rule!CMGT_UTIL_Filter_CreateFieldValuePair(\n        field: _,\n        value: ri!value,\n        allFields: a!flatten(ri!field)\n      ),\n      a!flatten(ri!field)\n    )\n  ),\n  local!matchingCriteria: a!defaultValue(\n    value: ri!matchingCriteria,\n    default: \"ALL\"\n  ),\n  local!matchType: a!defaultValue(value: ri!matchType, default: \"EXACT\"),\n  local!matchIndices: if(\n    a!isNullOrEmpty(a!flatten(ri!records)),\n    tointeger({}),\n    reduce(\n      rule!CMGT_UTIL_Filter_Reducer(\n        matchingCriteria: local!matchingCriteria,\n        previousIndices: _,\n        records: a!flatten(ri!records),\n        fieldValuePair: _,\n        matchType: local!matchType\n      ),\n      a!match(\n        value: local!matchingCriteria,\n        equals: \"ALL\",\n        then: enumerate(count(a!flatten(ri!records))) + 1,\n        equals: \"ANY\",\n        then: {},\n        default: fn!error(\n          \"Invalid matchingCriteria, must be one of: ALL, ANY\"\n        )\n      ),\n      local!fieldValuePairs\n    )\n  ),\n  local!rejectIndices: difference(\n    if(\n      a!isNullOrEmpty(ri!records),\n      tointeger({}),\n      enumerate(count(a!flatten(ri!records))) + 1\n    ),\n    local!matchIndices\n  ),\n  local!matches: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!matchIndices, {})\n  ),\n  local!rejects: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!rejectIndices, {})\n  ),\n  local!output: a!match(\n    value: a!defaultValue(ri!filterType, \"FILTER\"),\n    equals: \"FILTER\",\n    then: local!matches,\n    equals: \"REJECT\",\n    then: local!rejects,\n    equals: \"FIRST_MATCH\",\n    then: index(local!matches, 1, null),\n    equals: \"FIRST_REJECT\",\n    then: index(local!rejects, 1, null),\n    equals: \"MATCH_COUNT\",\n    then: count(local!matchIndices),\n    equals: \"REJECT_COUNT\",\n    then: count(local!rejectIndices),\n    equals: \"MATCH_INDICES\",\n    then: local!matchIndices,\n    equals: \"REJECT_INDICES\",\n    then: local!rejectIndices,\n    equals: \"FULL_RESULT\",\n    then: a!map(\n      matches: local!matches,\n      rejects: local!rejects,\n      firstMatch: index(local!matches, 1, null),\n      firstReject: index(local!rejects, 1, null),\n      matchCount: count(local!matchIndices),\n      rejectCount: count(local!rejectIndices),\n      matchIndices: local!matchIndices,\n      rejectIndices: local!rejectIndices\n    ),\n    default: fn!error(\n      \"Invalid filterType, must be one of: FILTER, REJECT, FIRST_MATCH, FIRST_REJECT, MATCH_COUNT, REJECT_COUNT, MATCH_INDICES, REJECT_INDICES, FULL_RESULT\"\n    )\n  ),\n  local!output\n)"
    },
    "_a-0000ec18-c982-8000-9cd0-011c48011c48_2649683": {
      "name": "CMGT_SELF_Email_UserAccountExists_ReplacementParamsMap",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!brandingMap: rule!CMGT_UTIL_LoadBrandingMap(),\n  local!loginUrl: rule!CMGT_UTIL_GetSiteUrl().authedPath & \"?signin=native\",\n  {\n    /*Base Template Parameters*/\n    rule!CMGT_Email_BaseTemplate_ReplacementParamsMap(\n      brandingMap: local!brandingMap,\n      footerText: concat(\n        \"<em>\",\n        #\"urn:appian:translation-string:v1:25b7bb99-b180-4b8b-9c97-91ba0348e0bd\",\n        \"</em>\"\n      ),\n      buttonLabel: #\"urn:appian:translation-string:v1:c8e5903f-1534-4202-9283-07f5879a6675\",\n      /*link to login*/\n      buttonLinkUrl: local!loginUrl\n    ),\n    /*Body*/\n    {\n      find: \"body\",\n      replace: rule!CMGT_UTIL_FillDocumentTemplate(\n        document: cons!CMGT_SELF_USER_ACCOUNT_EXISTS_EMAIL_TEMPLATE,\n        replacementParams: {\n          {\n            find: \"primaryTextColor\",\n            replace: local!brandingMap.StandardTextColor\n          },\n          {\n            find: \"primaryText\",\n            replace: #\"urn:appian:translation-string:v1:8e7fdc73-b782-41f8-ac01-afb1b6a6ca73\"\n          },\n          {\n            find: \"secondaryTextColor\",\n            replace: local!brandingMap.StandardTextColor\n          },\n          {\n            find: \"secondaryText\",\n            replace: #\"urn:appian:translation-string:v1:eeea2c32-0773-4fbf-a62f-e588da8ed86b\"(\n              #\"urn:appian:translation-variable:v1:b5d6a16a-58b2-4b54-809a-b80a8a37b7a5\": ri!email\n            )\n          }\n        }\n      )\n    }\n  }\n)"
    },
    "0004ea31-0987-8000-0334-7f0000014e7a": {
      "name": "CMGT_SUB_SendEmail",
      "type": "Process Model",
      "sail_code": "// Input: ?\n= rule!CMGT_UTIL_Filter( records: pv!emailSettingMap, fieldValuePairs: { { field: \"recipients\", value: a!groupMembers( group: cons!CMGT_GRP_SERVICE_ACCOUNTS, direct: true, memberType: \"USER\" ).data }, }, filterType: \"REJECT\")\n\n// Output: ?\nrule!CMGT_UTIL_Filter(\n  records: ac!rejectServiceAccounts,\n  fieldValuePairs: {\n    { field: \"recipients\", value: null },\n    {\n      field: \"recipientEmailAddress\",\n      value: null\n    },\n    { field: \"bccRecipients\", value: null },\n    { field: \"ccRecipients\", value: null }\n  },\n  filterType: \"REJECT\"\n)\n\n// Input: ?\n= a!defaultValue( value: index( pv!emailSettingMap[tp!instanceindex], \"senderEmail\", null() ), default: concat( \"no-reply@\", rule!CMGT_UTIL_GetSiteUrl().subdomainWithDomain ))\n\n// Input: ?\n= toemailrecipient( a!defaultValue( value: pv!emailSettingMap[tp!instanceindex].recipients, default: pv!emailSettingMap[tp!instanceindex].recipientEmailAddress ))\n\n// Input: ?\n= index( pv!emailSettingMap[tp!instanceindex], \"ccRecipients\", null)\n\n// Input: ?\n=index( pv!emailSettingMap[tp!instanceindex], \"bccRecipients\", null)\n\n// Input: ?\n=pv!emailSettingMap.subject\n\n// Input: ?\n=todocument(pv!emailSettingMap.attachments)\n\n// Input: ?\n= a!defaultValue( value: index( pv!emailSettingMap[tp!instanceindex], \"customSenderDisplayName\", null ), default: #\"urn:appian:translation-string:v1:311735dd-c418-42b1-9019-b3f175959489\")\n\n// Input: ?\n= rule!CMGT_EmailBody( replacementParams: pv!emailSettingMap[tp!instanceindex].replacementParams, document: pv!emailSettingMap[tp!instanceindex].document)"
    },
    "_a-0000ec34-784f-8000-9cd6-011c48011c48_2769144": {
      "name": "CMGT_SELF_MTR_NewUserRegistration",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ea26-2ced-8000-9bf1-011c48011c48_583935": {
      "name": "CMGT_EmailBody",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_FillDocumentTemplate(\n  document: a!defaultValue(\n    value: ri!document,\n    default: cons!CMGT_DOC_EMAIL_BASE_TEMPLATE\n  ),\n  replacementParams: { ri!replacementParams }\n)"
    }
  }
}