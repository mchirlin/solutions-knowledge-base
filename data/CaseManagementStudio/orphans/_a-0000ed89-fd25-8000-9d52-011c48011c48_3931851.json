{
  "uuid": "_a-0000ed89-fd25-8000-9d52-011c48011c48_3931851",
  "name": "CMGT_WFL_SetTrackAutomationRuleChanges",
  "type": "Expression Rule",
  "description": "updates the map based on the inputs",
  "sail_code": "if(\n  ri!isAddNew,\n  /* if ri!isAddNew = true, then the record will be net new so no need to check if it exists already*/\n  a!save(\n    ri!trackAutomationRuleChanges.new,\n    append(\n      ri!trackAutomationRuleChanges.new,\n      ri!recordsUpdated\n    )\n  ),\n  /*Identify Tasks which are not currently being tracked and add them to the list*/\n  a!localVariables(\n    local!tasksToAdd: rule!CMGT_UTIL_Filter(\n      records: ri!recordsUpdated,\n      field: recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid,\n      value: rule!CMGT_UTIL_cast(\n        value: a!flatten(\n          rule!CMGT_UTIL_RejectBlank(\n            {\n              a!flatten(\n                ri!trackAutomationRuleChanges.existing.original\n              ),\n              ri!trackAutomationRuleChanges.new\n            }\n          )\n        ),\n        typeOf: ri!allAutomationCaseTypeWorkflowTasks\n      )[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid],\n      filterType: \"REJECT\"\n    ),\n    /*Determines if there are any changes that were made to the existing record since the original update and updates with latest version    */\n    local!tasksToUpdate: rule!CMGT_UTIL_Filter(\n      records: ri!recordsUpdated,\n      field: recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid,\n      value: rule!CMGT_UTIL_cast(\n        value: a!flatten(\n          rule!CMGT_UTIL_RejectBlank(\n            {\n              a!flatten(\n                ri!trackAutomationRuleChanges.existing.original\n              ),\n\n            }\n          )\n        ),\n        typeOf: ri!allAutomationCaseTypeWorkflowTasks\n      )[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid],\n      filterType: \"FILTER\"\n    ),\n    local!trackAutomationRuleChangesExisting: if(\n      or(\n        rule!CMGT_UTIL_IsNotBlank(local!tasksToAdd),\n        rule!CMGT_UTIL_IsNotBlank(local!tasksToUpdate)\n      ),\n      rule!CMGT_UTIL_RejectBlank(\n        a!flatten(\n          {\n            if(\n              rule!CMGT_UTIL_IsNotBlank(local!tasksToAdd),\n              #\"SYSTEM_SYSRULES_forEach\"(\n                items: local!tasksToAdd,\n                expression: a!map(\n                  original: rule!CMGT_UTIL_Filter(\n                    records: ri!allAutomationCaseTypeWorkflowTasks,\n                    field: recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid,\n                    value: fv!item[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid]\n                  )[1],\n                  updated: fv!item\n                )\n              ),\n              null\n            ),\n            if(\n              rule!CMGT_UTIL_IsNotBlank(local!tasksToUpdate),\n              #\"SYSTEM_SYSRULES_forEach\"(\n                items: ri!trackAutomationRuleChanges.existing,\n                expression: if(\n                  contains(\n                    touniformstring(\n                      local!tasksToUpdate[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid]\n                    ),\n                    fv!item.original[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid]\n                  ),\n                  #\"urn:appian:function:v1:a:update\"(\n                    data: fv!item,\n                    index: \"updated\",\n                    value: rule!CMGT_UTIL_Filter(\n                      records: local!tasksToUpdate,\n                      field: recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid,\n                      value: fv!item.original[recordType!CMGT_WFL_CFG_CaseTypeWorkflowTask.caseTypeWorkflowTaskUuid]\n                    )[1]\n                  ),\n                  fv!item\n                )\n              ),\n              ri!trackAutomationRuleChanges.existing\n            )\n          }\n        )\n      ),\n      null\n    ),\n    a!save(\n      ri!trackAutomationRuleChanges.existing,\n      a!defaultValue(\n        local!trackAutomationRuleChangesExisting,\n        ri!trackAutomationRuleChanges.existing,\n\n      )\n    )\n\n  )\n)",
  "calls": [
    {
      "name": "CMGT_UTIL_Filter",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_UTIL_cast",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_UTIL_RejectBlank",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_UTIL_IsNotBlank",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "CMGT_WFL_CFG_CaseTypeWorkflowTask",
      "type": "Record Type",
      "dep_type": "USES_RECORD_TYPE"
    }
  ],
  "called_by": [
    {
      "name": "CMGT_WFL_CaseType_ConfigureTask_Task_SingleRuleConfig",
      "type": "Interface",
      "dep_type": "CALLS"
    }
  ]
}