{
  "_metadata": {
    "bundle_id": "CMGT_Entity_-_urnappiantranslation-stringv12562fb7a-bfbf-4cc1-adbe-7c480276f1ac"
  },
  "objects": {
    "9248008e-2c2c-4eea-bb28-4a3c89838403": {
      "name": "CMGT_UTIL_RemoveRecordRelationshipsWithSingleKey_Reducer",
      "type": "Expression Rule",
      "sail_code": "if(\n  runtimetypeof(ri!key) <> 'type!{http://www.appian.com/ae/types/2009}RecordRelationship',\n  ri!record,\n  a!match(\n    value: index(ri!record, ri!key, null),\n    whenTrue: count(fv!value) = 1,\n    then: with(\n      local!indexedValue: index(\n        ri!record,\n        ri!key,\n        1,\n        index(ri!record, ri!key, null)\n      ),\n      local!subKeys: a!keys(local!indexedValue),\n      if(\n        length(local!subKeys) = 1,\n        remove(ri!record, ri!key),\n        #\"urn:appian:function:v1:a:update\"(\n          ri!record,\n          ri!key,\n          reduce(\n            rule!CMGT_UTIL_RemoveRecordRelationshipsWithSingleKey_Reducer(record: _, key: _),\n            local!indexedValue,\n            local!subKeys\n          )\n        )\n      )\n    ),\n    default: ri!record\n  )\n)"
    },
    "_a-0000eaa7-a5c0-8000-9c22-011c48011c48_973190": {
      "name": "CMGT_UTIL_MergeWriteRecordIdsToProcessVariable",
      "type": "Expression Rule",
      "sail_code": "/*\nThe main rule to merge the ID-output of a WriteRecords SS node back to the input process variable.\n\nSTANDARD USAGE:\n- Use this in tandem with rule CMGT_UTIL_DropNonWritableRelationshipsFromRecord (see that description)\n- In the output of a WriteRecords SS, do:\n  A - New Custom Output\n  B - rule!CMGT_UTIL_MergeWriteRecordIdsToProcessVariable(\n        processData: pv![the pv your wrote],\n        recordsUpdated: ac!RecordsUpdated,\n        fksToParent: {list of record fields that are FKs to the primary PK you wrote}\n      )\n  C - Save this back to the pv you wrote\n\nMAPPING FKS:\n- Using this rule in the current state, child-FKs can only be set \nwhere they map back to the primary record type, using input \"fksToParent\".\n  -> For example, if you are writing \"Case\", \n    - you could set \"Case.Comment.caseId\"\n    - you could set \"Case.Comment.Replies.caseId\"\n    - but not \"Case.Comment.Replies.commentId\" (since the FK \"commentId\" is not the PK of \"Case\")\n- To set other foreign keys, you would have to run manual update rules using the result of this.\nNote:\n- \"fksToParent\" is optimized for 1:M relationships.\n  - Setting an fkToParent for a 1:1 will create an instance of that child record if it is null.\n\nIMPORTANT GENERAL NOTES: \n- The result of THIS rule will have data that IS considered changed, \nso a designer should be cautious about re-writing this later in process \nas it could cause race condition and performance side affects.\n\n- Also, the result of this WILL NOT have custom-fields calculated, \nsince they can be changed as a result of the write, but this rule is not re-querying.\nIf you need these, then re-query.\n\n- This should generally only be used for downstream flows that don't write it directly again, \nsuch as document processing, emails, etc.\n*/\nif(\n  or(\n    runtimetypeof(ri!recordsUpdated) = runtimetypeof(a!flatten(ri!recordsUpdated)),\n    runtimetypeof(ri!recordsUpdated) = 'type!{http://www.appian.com/ae/types/2009}Variant?list'\n  ),\n  if(\n    count(a!flatten(ri!recordsUpdated)) = 0,\n    ri!processData,\n    #\"SYSTEM_SYSRULES_forEach\"(\n      items: enumerate(count(a!flatten(ri!recordsUpdated))),\n      expression: rule!CMGT_UTIL_MergeWriteRecordIdsToProcessVariable(\n        processData: a!flatten(ri!processData)[fv!index],\n        recordsUpdated: cast(\n          runtimetypeof(a!flatten(ri!processData)),\n          ri!recordsUpdated\n        )[fv!index],\n        fksToParent: ri!fksToParent\n      )\n    )\n  ),\n  a!localVariables(\n    local!keys: #\"SYSTEM_SYSRULES_forEach\"(\n      items: a!keys(ri!recordsUpdated),\n      expression: a!map(\n        key: fv!item,\n        isPrimaryKey: runtimetypeof(fv!item) = 'type!{http://www.appian.com/ae/types/2009}RecordField'\n      )\n    ),\n    local!keysOrganized: rule!CMGT_UTIL_Filter(\n      records: local!keys,\n      field: \"isPrimaryKey\",\n      value: true,\n      filterType: \"FULL_RESULT\"\n    ),\n    local!primaryKeyField: local!keysOrganized.firstMatch.key,\n    local!updates: rule!CMGT_UTIL_SetRecordFields(\n      record: ri!processData,\n      neverOverwrite: {\n        a!map(\n          field: local!primaryKeyField,\n          value: ri!recordsUpdated[local!primaryKeyField]\n        ),\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: ri!fksToParent,\n          expression: a!map(\n            field: fv!item,\n            value: ri!recordsUpdated[local!primaryKeyField],\n            /*Children get complicated, and an update should only run if a child is actually attached*/\n            applyWhen: a!match(\n              value: runtimetypeof(ri!processData[fv!item]),\n              equals: runtimetypeof(a!flatten(ri!processData[fv!item])),\n              then: count(ri!processData[fv!item]) > 0,\n              equals: tointeger(\n                'type!{http://www.appian.com/ae/types/2009}Variant?list'\n              ),\n              then: or(\n                #\"SYSTEM_SYSRULES_forEach\"(\n                  items: ri!processData[fv!item],\n                  expression: a!isNotNullOrEmpty(fv!item)\n                )\n              ),\n              default: a!isNotNullOrEmpty(ri!processData[fv!item])\n            )\n          )\n        )\n      },\n      childRelationships: #\"SYSTEM_SYSRULES_forEach\"(\n        items: local!keysOrganized.rejects,\n        expression: a!map(\n          field: fv!item.key,\n          value: if(\n            rule!CMGT_UTIL_IsBlank(ri!processData[fv!item.key]),\n            ri!recordsUpdated[fv!item.key],\n            rule!CMGT_UTIL_MergeWriteRecordIdsToProcessVariable(\n              processData: ri!processData[fv!item.key],\n              recordsUpdated: ri!recordsUpdated[fv!item.key],\n              fksToParent: {}\n            )\n          )\n        )\n      )\n    ),\n    /*reduce over updates to remove any relationships that were incorrectly created with just an fk*/\n    if(\n      a!isNullOrEmpty(ri!fksToParent),\n      local!updates,\n      reduce(\n        rule!CMGT_UTIL_RemoveRecordRelationshipsWithSingleKey_Reducer(record: _, key: _),\n        local!updates,\n        a!keys(local!updates)\n      )\n    )\n  )\n)"
    },
    "000be9f1-c02b-8000-fff7-7f0000014e7a": {
      "name": "CMGT_SUB_SetCaseFolderSecurity",
      "type": "Process Model",
      "sail_code": "// Output: ?\nrule!CMGT_SUB_SetCaseFolderSecurity_Logic(cases: pv!cases)\n\n// Input: ?\n=pv!changes[tp!instanceindex].admins\n\n// Input: ?\n=pv!changes[tp!instanceindex].editors\n\n// Input: ?\n=pv!changes[tp!instanceindex].folder\n\n// Input: ?\n=pv!changes[tp!instanceindex].viewers\n\n// Input: ?\n=pv!changes[tp!instanceindex].removes\n\n// Input: ?\n=/*Get folder details for the given case ids*/rule!CMGT_QR_GetCase( caseId: pv!caseIds, executeWhen: a!isNotNullOrEmpty(pv!caseIds), additionalFilters: #\"SYSTEM_SYSRULES_queryFilter\"( field: recordType!CMGT_Case.folderId, operator: \"not null\" ), excludeRelatedRecords: true, fields: recordType!CMGT_Case.folderId)\n\n// Input: ?\n= rule!CMGT_QR_GetRole( caseId: pv!caseIds, additionalFilters: #\"SYSTEM_SYSRULES_queryFilter\"( field: recordType!CMGT_Role.usernameUser, operator: \"not null\" ) )\n\n// Output: ?\n#\"SYSTEM_SYSRULES_forEach\"(\n  ac!cases,\n  #\"urn:appian:function:v1:a:update\"(\n    fv!item,\n    recordType!CMGT_Case.roles,\n    rule!CMGT_UTIL_Filter(\n      records: ac!roles,\n      field: recordType!CMGT_Role.caseId,\n      value: fv!item[recordType!CMGT_Case.caseId]\n    )\n  )\n)"
    },
    "5871189e-5b69-4276-978a-e1c5e4263102": {
      "name": "CMGT_QR_GetEntity",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_Entity,\n  returnType: ri!returnType,\n  triggerRefresh: ri!triggerRefresh,\n  executeWhen: ri!executeWhen,\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Entity.entityId,\n      operator: \"in\",\n      value: ri!entityId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Entity.isActive,\n      operator: \"=\",\n      value: true,\n      applyWhen: not(\n        a!defaultValue(ri!includeInactive, false)\n      )\n    )\n  },\n  logicalExpressions: ri!additionalLogicalExpression,\n  fields: {\n    ri!fields,\n    if(\n      ri!excludeRelatedRecords,\n      {},\n      {\n        recordType!CMGT_Entity.entityType,\n        recordType!CMGT_Entity.entityCategory,\n        recordType!CMGT_Entity.person\n      }\n    )\n  },\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  relatedRecordData: ri!relatedRecordData,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_25474": {
      "name": "CMGT_QR_GetRelatedEntityMap",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_RelatedEntityMap,\n  returnType: ri!returnType,\n  triggerRefresh: ri!triggerRefresh,\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_RelatedEntityMap.relatedEntityMapId,\n      operator: \"in\",\n      value: ri!relatedEntityMapId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_RelatedEntityMap.entityId,\n      operator: \"in\",\n      value: ri!entityId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_RelatedEntityMap.relatedEntityId,\n      operator: \"in\",\n      value: ri!relatedEntityId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_RelatedEntityMap.relationshipMapTypeId,\n      operator: \"=\",\n      value: ri!relationshipMapTypeId\n    )\n  },\n  executeWhen: ri!executeWhen,\n  logicalExpressions: ri!additionalLogicalExpression,\n  fields: {\n    ri!fields,\n    recordType!CMGT_RelatedEntityMap.entity,\n    recordType!CMGT_RelatedEntityMap.relatedEntity,\n    recordType!CMGT_RelatedEntityMap.relatedEntity,\n    recordType!CMGT_RelatedEntityMap.relatedEntity,\n    recordType!CMGT_RelatedEntityMap.relationshipMapType,\n    recordType!CMGT_RelatedEntityMap.relationshipMapType\n  },\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  relatedRecordData: ri!relatedRecordData,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000eaab-5303-8000-9c24-011c48011c48_994738": {
      "name": "CMGT_formatEventInitiator",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!user: rule!CMGT_QR_GetUser(\n    username: ri!initiator,\n    returnType: \"SINGLE_OBJECT\"\n  ),\n  if(\n    rule!CMGT_UTIL_IsBlank(local!user),\n    ri!initiator,\n    if(\n      or(\n        local!user[#\"urn:appian:record-field:v1:SYSTEM_RECORD_TYPE_USER/SYSTEM_RECORD_TYPE_USER_FIELD_isServiceAccount\"] = true,\n        #\"urn:appian:function:v1:a:isusermemberofgroup?okey=a!isUserMemberOfGroup\"(\n          username: ri!initiator,\n          groups: cons!CMGT_GRP_SERVICE_ACCOUNTS\n        )\n      ),\n      cons!CMGT_TXT_AUTOMATED_SYSTEM,\n      ri!initiator\n    )\n  )\n)"
    },
    "4fccc861-fd6e-4069-86d9-448ce54b84f3": {
      "name": "CMGT_RelatedEntityMap_Delete",
      "type": "Process Model",
      "sail_code": "// Input: ?\n=append(pv!relatedEntityMaps, rule!CMGT_RelatedEntityMap_GenerateRelationshipPermutations_Logic(relatedEntityMaps: pv!relatedEntityMaps))\n\n// Output: ?\n#\"urn:appian:function:v1:a:update\"(\n  data: ac!existingRelatedEntityMaps,\n  index: recordType!CMGT_RelatedEntityMap.isActive,\n  value: false\n)\n\n// Output: ?\nrule!CMGT_RelatedEntityMap_SetMetaData(\n  relatedEntityMaps: pv!relatedEntityMaps,\n  initiator: pp!initiator\n)\n\n// Input: ?\nrule!CMGT_RelatedEntityMap_SetEvents(\n  relatedEntityMaps: pv!relatedEntityMaps,\n  initiator: pp!initiator,\n  eventType: \"DELETE\"\n)\n\n// Input: ?\n=recordType!CMGT_EventHistory_Entity\n\n// Input: ?\nrule!CMGT_RelatedEntityMap_WriteRecordsProperties(\n  relatedEntityMaps: pv!relatedEntityMaps,\n  recordsUpdated: ac!RecordsUpdated,\n  isInput: true\n)\n\n// Input: ?\n=recordType!CMGT_RelatedEntityMap\n\n// Output: ?\nrule!CMGT_RelatedEntityMap_WriteRecordsProperties(\n  relatedEntityMaps: pv!relatedEntityMaps,\n  recordsUpdated: ac!RecordsUpdated,\n  isInput: false\n)"
    },
    "_a-0000e9f4-1323-8000-9bd3-011c48011c48_268364": {
      "name": "CMGT_RelatedEntityMap_RecordAction_Manage",
      "type": "Interface",
      "sail_code": "a!localVariables(\n  local!brandingMap: rule!CMGT_UTIL_LoadBrandingMap(),\n  local!relatedEntities: rule!CMGT_QR_GetRelatedEntityMap(\n    entityId: ri!entity[recordType!CMGT_Entity.entityId],\n    executeWhen: a!isNotNullOrEmpty(\n      ri!entity[recordType!CMGT_Entity.entityId]\n    )\n  ),\n  local!relatedEntitiesAvailableForRemoval,\n  local!relationshipTypes: rule!CMGT_QR_GetRelationshipMapType(\n    returnType: null,\n    type: \"ENTITY_TO_ENTITY\",\n    /*Pull only the relationship types applicable for current entity*/\n    additionalLogicalExpression: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n      operator: \"OR\",\n      filters: {\n        #\"SYSTEM_SYSRULES_queryFilter\"(\n          field: recordType!CMGT_CFG_RelationshipMapType.parentEntityCategoryId,\n          operator: \"=\",\n          value: ri!entity[recordType!CMGT_Entity.entityCategoryId]\n        ),\n        #\"SYSTEM_SYSRULES_queryFilter\"(\n          field: recordType!CMGT_CFG_RelationshipMapType.parentEntityCategoryId,\n          operator: \"is null\"\n        )\n      }\n    )\n  ),\n  local!distinctChildEntityCategories: rule!CMGT_UTIL_Distinct(\n    value: local!relationshipTypes[recordType!CMGT_CFG_RelationshipMapType.childEntityCategoryId]\n  ),\n  local!selectedValues,\n  local!removedEntityIds,\n  #\"SYSTEM_SYSRULES_formLayout_v1\"(\n    label: #\"urn:appian:translation-string:v1:71965910-65df-46c2-a625-916bb98bfbe4\",\n    contents: {\n      #\"SYSTEM_SYSRULES_columnsLayout\"(\n        columns: {\n          #\"SYSTEM_SYSRULES_columnLayout\"(\n            contents: {\n              #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n                value: #\"SYSTEM_SYSRULES_richTextHeader\"(\n                  text: #\"urn:appian:translation-string:v1:0590052e-4f8d-4cc7-8513-018911a195cb\"\n                )\n              ),\n              rule!CMGT_Entity_RecordGrid(\n                labelPosition: \"COLLAPSED\",\n                additionalFilters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                  operator: \"AND\",\n                  filters: {\n                    #\"SYSTEM_SYSRULES_queryFilter\"(\n                      field: recordType!CMGT_Entity.isActive,\n                      operator: \"=\",\n                      value: true\n                    ),\n                    #\"SYSTEM_SYSRULES_queryFilter\"(\n                      field: recordType!CMGT_Entity.entityId,\n                      operator: \"<>\",\n                      value: ri!entity[recordType!CMGT_Entity.entityId]\n                    ),\n                    #\"SYSTEM_SYSRULES_queryFilter\"(\n                      field: recordType!CMGT_Entity.entityCategoryId,\n                      operator: \"in\",\n                      value: local!distinctChildEntityCategories,\n                      /*If the child entity type has null atleast one relationship is\n                      applicable to all entity types so filter shouldn't be applied*/\n                      applyWhen: not(\n                        contains(\n                          local!distinctChildEntityCategories,\n                          tointeger(null)\n                        )\n                      )\n                    )\n                  }\n                ),\n                context: \"COMPACT_LIST\",\n                pageSize: cons!CMGT_INT_BATCH_SIZE_MEDIUM,\n                isSelectable: true,\n                selectionSaves: {\n                  /*Check if any existing maps have been removed */\n                  local!selectedValues,\n                  a!save(\n                    local!relatedEntitiesAvailableForRemoval,\n                    rule!CMGT_UTIL_Filter(\n                      records: local!relatedEntities,\n                      field: recordType!CMGT_RelatedEntityMap.relatedEntityMapId,\n                      value: null,\n                      filterType: \"REJECT\"\n                    )\n                  ),\n                  a!save(\n                    local!removedEntityIds,\n                    if(\n                      rule!CMGT_UTIL_IsBlank(\n                        local!relatedEntitiesAvailableForRemoval\n                      ),\n                      null,\n                      difference(\n                        tointeger(\n                          local!relatedEntitiesAvailableForRemoval[recordType!CMGT_RelatedEntityMap.relatedEntityId]\n                        ),\n                        tointeger(local!selectedValues)\n                      )\n                    )\n                  ),\n                  if(\n                    a!isNotNullOrEmpty(local!removedEntityIds),\n                    a!save(\n                      ri!relatedEntityMapsToDelete,\n                      append(\n                        ri!relatedEntityMapsToDelete,\n                        rule!CMGT_UTIL_Filter(\n                          records: local!relatedEntities,\n                          field: recordType!CMGT_RelatedEntityMap.relatedEntityId,\n                          value: local!removedEntityIds\n                        )\n                      )\n                    ),\n                    {}\n                  ),\n                  a!save(\n                    local!relatedEntities,\n                    a!flatten(\n                      #\"SYSTEM_SYSRULES_forEach\"(\n                        items: local!selectedValues,\n                        expression: if(\n                          rule!CMGT_UTIL_IsNotBlank(\n                            rule!CMGT_UTIL_Filter(\n                              records: local!relatedEntities,\n                              field: recordType!CMGT_RelatedEntityMap.relatedEntityId,\n                              value: fv!item\n                            )\n                          ),\n                          rule!CMGT_UTIL_Filter(\n                            records: local!relatedEntities,\n                            field: recordType!CMGT_RelatedEntityMap.relatedEntityId,\n                            value: fv!item\n                          ),\n                          recordType!CMGT_RelatedEntityMap(\n                            recordType!CMGT_RelatedEntityMap.entityId: ri!entity[recordType!CMGT_Entity.entityId],\n                            recordType!CMGT_RelatedEntityMap.relatedEntity: rule!CMGT_QR_GetEntity(\n                              entityId: fv!item,\n                              returnType: \"SINGLE_OBJECT\"\n                            ),\n                            recordType!CMGT_RelatedEntityMap.entity: ri!entity,\n                            recordType!CMGT_RelatedEntityMap.relatedEntityId: fv!item\n                          )\n                        )\n                      )\n                    )\n                  )\n                },\n                selectionValue: if(\n                  a!isNullOrEmpty(local!relatedEntities),\n                  null,\n                  local!relatedEntities[recordType!CMGT_RelatedEntityMap.relatedEntityId]\n                ),\n                showExportButton: false,\n                showRefreshButton: false,\n                shadeAlternateRows: false,\n                userFilters: {\n                  #\"urn:appian:user-filter:v1:ad3b988c-faba-4c39-9bda-be1ad52b4019/8413fe9c-1381-43a9-9aff-c855a928cafc\"\n                },\n                brandingMap: local!brandingMap\n              )\n            }\n          ),\n          #\"SYSTEM_SYSRULES_columnLayout\"(\n            contents: {\n              #\"SYSTEM_SYSRULES_sideBySideLayout\"(\n                items: {\n                  #\"SYSTEM_SYSRULES_sideBySideItem\"(\n                    item: #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n                      value: #\"SYSTEM_SYSRULES_richTextHeader\"(\n                        text: #\"urn:appian:translation-string:v1:d2c4bdab-52a4-460f-b380-0747e3009102\"\n                      )\n                    ),\n                    width: \"MINIMIZE\"\n                  ),\n                  #\"SYSTEM_SYSRULES_sideBySideItem\"(\n                    item: #\"SYSTEM_SYSRULES_tagField\"(\n                      tags: #\"SYSTEM_SYSRULES_tagItem\"(\n                        text: count(local!relatedEntities),\n                        backgroundColor: local!brandingMap.TagBackgroundColor,\n                        textColor: local!brandingMap.TagTextColor\n                      ),\n                      align: \"START\"\n                    )\n                  )\n                },\n                marginAbove: \"STANDARD\"\n              ),\n              #\"SYSTEM_SYSRULES_gridLayout\"(\n                labelPosition: \"COLLAPSED\",\n                emptyGridMessage: #\"urn:appian:translation-string:v1:67c3a484-2091-4108-8527-5db4e80767d4\",\n                headerCells: {\n                  #\"SYSTEM_SYSRULES_gridLayoutHeaderCell\"(\n                    label: #\"urn:appian:translation-string:v1:217c6e5b-8992-40d7-a602-c55682524bd7\",\n\n                  ),\n                  #\"SYSTEM_SYSRULES_gridLayoutHeaderCell\"(\n                    label: #\"urn:appian:translation-string:v1:b8e8db5e-80b7-4598-afe2-901a9aff8168\",\n\n                  ),\n                  #\"SYSTEM_SYSRULES_gridLayoutHeaderCell\"(\n                    label: #\"urn:appian:translation-string:v1:cfd938d0-1c74-423e-89ee-f71a530aaec0\",\n\n                  ),\n                  #\"SYSTEM_SYSRULES_gridLayoutHeaderCell\"(),\n                  #\"SYSTEM_SYSRULES_gridLayoutHeaderCell\"()\n                },\n                columnConfigs: {\n                  #\"SYSTEM_SYSRULES_gridLayoutColumnConfig\"(),\n                  #\"SYSTEM_SYSRULES_gridLayoutColumnConfig\"(),\n                  #\"SYSTEM_SYSRULES_gridLayoutColumnConfig\"(),\n                  #\"SYSTEM_SYSRULES_gridLayoutColumnConfig\"(width: \"ICON\"),\n                  #\"SYSTEM_SYSRULES_gridLayoutColumnConfig\"(width: \"ICON\")\n                },\n                rows: #\"SYSTEM_SYSRULES_forEach\"(\n                  items: local!relatedEntities,\n                  expression: a!localVariables(\n                    #\"SYSTEM_SYSRULES_gridRowLayout\"(\n                      contents: {\n                        #\"SYSTEM_SYSRULES_dropdownField_v1\"(\n                          placeholder: #\"urn:appian:translation-string:v1:3831f890-1fc6-41e0-8732-dedfe0749174\",\n                          data: #\"SYSTEM_SYSRULES_recordData\"(\n                            recordType: recordType!CMGT_CFG_RelationshipMapType,\n                            filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                              operator: \"AND\",\n                              filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n                                field: recordType!CMGT_CFG_RelationshipMapType.type,\n                                operator: \"=\",\n                                value: \"ENTITY_TO_ENTITY\"\n                              ),\n                              logicalExpressions: {\n                                #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                                  operator: \"OR\",\n                                  filters: {\n                                    #\"SYSTEM_SYSRULES_queryFilter\"(\n                                      field: recordType!CMGT_CFG_RelationshipMapType.parentEntityCategoryId,\n                                      operator: \"=\",\n                                      value: ri!entity[recordType!CMGT_Entity.entityCategoryId]\n                                    ),\n                                    #\"SYSTEM_SYSRULES_queryFilter\"(\n                                      field: recordType!CMGT_CFG_RelationshipMapType.parentEntityCategoryId,\n                                      operator: \"is null\"\n                                    )\n                                  }\n                                ),\n                                #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                                  operator: \"OR\",\n                                  filters: {\n                                    #\"SYSTEM_SYSRULES_queryFilter\"(\n                                      field: recordType!CMGT_CFG_RelationshipMapType.childEntityCategoryId,\n                                      operator: \"=\",\n                                      value: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntity.entityCategoryId]\n                                    ),\n                                    #\"SYSTEM_SYSRULES_queryFilter\"(\n                                      field: recordType!CMGT_CFG_RelationshipMapType.childEntityCategoryId,\n                                      operator: \"is null\"\n                                    )\n                                  }\n                                )\n                              }\n                            )\n                          ),\n                          choiceLabels: recordType!CMGT_CFG_RelationshipMapType.relationship.label,\n                          choiceValues: recordType!CMGT_CFG_RelationshipMapType.relationshipMapTypeId,\n                          value: fv!item[recordType!CMGT_RelatedEntityMap.relationshipMapTypeId],\n                          saveInto: if(\n                            a!isNotNullOrEmpty(\n                              fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityMapId]\n                            ),\n                            {\n                              a!save(\n                                ri!relatedEntityMapsToDelete,\n                                append(ri!relatedEntityMapsToDelete, fv!item)\n                              ),\n                              a!save(\n                                {\n                                  fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityMapId],\n                                  fv!item[recordType!CMGT_RelatedEntityMap.relationshipMapType],\n                                  fv!item[recordType!CMGT_RelatedEntityMap.createdOn],\n                                  fv!item[recordType!CMGT_RelatedEntityMap.createdBy]\n                                },\n                                null\n                              ),\n                              fv!item[recordType!CMGT_RelatedEntityMap.relationshipMapTypeId]\n                            },\n                            {\n                              fv!item[recordType!CMGT_RelatedEntityMap.relationshipMapTypeId],\n                              /*This essentially checks if the user removed the relationship\n                              but then added it back before submission */\n                              a!localVariables(\n                                local!previouslyDeletedMatch: rule!CMGT_UTIL_Filter(\n                                  records: ri!relatedEntityMapsToDelete,\n                                  fieldValuePairs: {\n                                    a!map(\n                                      field: recordType!CMGT_RelatedEntityMap.entityId,\n                                      value: fv!item[recordType!CMGT_RelatedEntityMap.entityId]\n                                    ),\n                                    a!map(\n                                      field: recordType!CMGT_RelatedEntityMap.relatedEntityId,\n                                      value: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityId]\n                                    ),\n                                    a!map(\n                                      field: recordType!CMGT_RelatedEntityMap.relationshipMapTypeId,\n                                      value: fv!item[recordType!CMGT_RelatedEntityMap.relationshipMapTypeId]\n                                    )\n                                  }\n                                ),\n                                if(\n                                  a!isNotNullOrEmpty(local!previouslyDeletedMatch),\n                                  {\n                                    a!save(fv!item, local!previouslyDeletedMatch),\n                                    a!save(\n                                      ri!relatedEntityMapsToDelete,\n                                      rule!CMGT_UTIL_Filter(\n                                        records: ri!relatedEntityMapsToDelete,\n                                        field: recordType!CMGT_RelatedEntityMap.relatedEntityId,\n                                        value: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityId],\n                                        filterType: \"REJECT\"\n                                      )\n                                    )\n                                  },\n                                  null\n                                )\n                              )\n                            }\n                          ),\n                          required: true,\n                          requiredMessage:#\"urn:appian:translation-string:v1:4fab94dc-fcb1-427a-af9f-1239079b2897\"(#\"urn:appian:translation-variable:v1:3e31b6d5-df20-4d17-80a7-81f3c83ff370\": #\"urn:appian:translation-string:v1:217c6e5b-8992-40d7-a602-c55682524bd7\" )\n                        ),\n                        #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n                          value: {\n                            #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n                              text: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntity.title],\n                              link: #\"SYSTEM_SYSRULES_recordLink\"(\n                                recordType: recordType!CMGT_Entity,\n                                identifier: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityId]\n                              ),\n                              linkStyle: \"STANDALONE\",\n                              color: local!brandingMap.StandardTextColor,\n                              style: \"STRONG\"\n                            ),\n                            char(10),\n                            #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n                              text: rule!CMGT_UTIL_TruncateText(\n                                text: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntity.identifyingAttribute1],\n                                maxLength: 15\n                              ),\n                              color: local!brandingMap.SecondaryTextColor,\n                              size: \"SMALL\"\n                            )\n                          }\n                        ),\n                        #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n                          labelPosition: \"COLLAPSED\",\n                          value: {\n                            #\"SYSTEM_SYSRULES_richTextIcon\"(\n                              icon: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntity.entityCategory.icon],\n                              caption: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntity.entityCategory.label],\n                              color: local!brandingMap.SecondaryTextColor\n                            ),\n                            char(32),\n                            #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n                              text: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntity.entityType.label]\n                            )\n                          }\n                        ),\n                        #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n                          value: {\n                            #\"SYSTEM_SYSRULES_richTextIcon\"(\n                              icon: \"clone\",\n                              caption: #\"urn:appian:translation-string:v1:860919b3-d98c-45ca-9148-46808215f518\",\n                              link: #\"SYSTEM_SYSRULES_dynamicLink\"(\n                                saveInto: {\n                                  a!save(\n                                    local!relatedEntities,\n                                    append(\n                                      local!relatedEntities,\n                                      recordType!CMGT_RelatedEntityMap(\n                                        recordType!CMGT_RelatedEntityMap.entityId: fv!item[recordType!CMGT_RelatedEntityMap.entityId],\n                                        recordType!CMGT_RelatedEntityMap.relatedEntityId: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityId],\n                                        recordType!CMGT_RelatedEntityMap.entity: fv!item[recordType!CMGT_RelatedEntityMap.entity],\n                                        recordType!CMGT_RelatedEntityMap.relatedEntity: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntity]\n                                      )\n                                    )\n                                  )\n                                }\n                              ),\n                              linkStyle: \"STANDALONE\",\n                              color: local!brandingMap.AccentColor\n                            )\n                          }\n                        ),\n                        #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n                          value: {\n                            #\"SYSTEM_SYSRULES_richTextIcon\"(\n                              icon: \"times\",\n                              caption: #\"urn:appian:translation-string:v1:2294a4f0-5962-42cc-9142-be3d51cac37e\",\n                              link: #\"SYSTEM_SYSRULES_dynamicLink\"(\n                                saveInto: {\n                                  if(\n                                    a!isNullOrEmpty(\n                                      fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityMapId]\n                                    ),\n                                    null,\n                                    a!save(\n                                      ri!relatedEntityMapsToDelete,\n                                      append(ri!relatedEntityMapsToDelete, fv!item)\n                                    )\n                                  ),\n                                  a!save(\n                                    local!relatedEntities,\n                                    remove(local!relatedEntities, fv!index)\n                                  )\n                                }\n                              ),\n                              linkStyle: \"STANDALONE\",\n                              color: \"ACCENT\"\n                            )\n                          }\n                        )\n                      }\n                    )\n                  )\n                ),\n                validations: if(\n                  a!isNotNullOrEmpty(value: local!relatedEntities),\n                  if(\n                    length(local!relatedEntities) > length(\n                      rule!CMGT_UTIL_DistinctRecords(\n                        records: local!relatedEntities,\n                        fields: {\n                          recordType!CMGT_RelatedEntityMap.relatedEntityId,\n                          recordType!CMGT_RelatedEntityMap.relationshipMapTypeId\n                        }\n                      )\n                    ),\n                    #\"urn:appian:translation-string:v1:6a09daf3-74a6-4ad6-9921-2d8fce1716e4\",\n                    \"\"\n                  ),\n                  \"\"\n                ),\n                shadeAlternateRows: false,\n                borderStyle: \"LIGHT\",\n                rowHeader: 1\n              )\n            }\n          )\n        },\n        spacing: \"SPARSE\",\n        showDividers: true\n      )\n    },\n    buttons: {\n      #\"SYSTEM_SYSRULES_ButtonLayout\"(\n        primaryButtons: {\n          #\"SYSTEM_SYSRULES_buttonWidget_v1\"(\n            label: #\"urn:appian:translation-string:v1:06dbafc7-e085-40de-a68a-c83054c1d7ec\",\n            saveInto: {\n              a!save(\n                ri!relatedEntityMaps,\n                local!relatedEntities\n              )\n            },\n            submit: true,\n            style: \"SOLID\",\n            validate: true\n          )\n        },\n        secondaryButtons: {\n          #\"SYSTEM_SYSRULES_buttonWidget_v1\"(\n            label: #\"urn:appian:translation-string:v1:651cf177-f30b-485b-900f-8aaf47805737\",\n            saveInto: {\n              a!save(ri!relatedEntityMaps, null),\n              a!save(ri!relatedEntityMapsToDelete, null)\n            },\n            submit: true,\n            style: \"OUTLINE\",\n            validate: false\n          )\n        }\n      )\n    },\n    skipAutoFocus: true\n  )\n)"
    },
    "_a-0000eaba-1e20-8000-9c2a-011c48011c48_1039920": {
      "name": "CMGT_RelatedEntityMap_WriteRecordsProperties",
      "type": "Expression Rule",
      "sail_code": "if(\n  ri!isInput,\n  rule!CMGT_UTIL_DropNonWritableRelationshipsFromRecord(\n    records: ri!relatedEntityMaps,\n    relationships: {\n      recordType!CMGT_RelatedEntityMap.entity,\n      recordType!CMGT_RelatedEntityMap.relatedEntity,\n      recordType!CMGT_RelatedEntityMap.relationshipMapType\n    }\n  ),\n  rule!CMGT_UTIL_MergeWriteRecordIdsToProcessVariable(\n    processData: ri!relatedEntityMaps,\n    recordsUpdated: ri!recordsUpdated,\n    fksToParent: {\n    }\n  )\n)"
    },
    "_a-0000e99c-1217-8000-9ba9-011c48011c48_58807": {
      "name": "CMGT_UTIL_TruncateText",
      "type": "Expression Rule",
      "sail_code": "if(\n  or(isnull(ri!text), isnull(ri!maxLength)),\n  ri!text,\n  if(\n    len(ri!text) > ri!maxLength,\n    left(\n      ri!text,\n      max(\n        search(\" \", ri!text, ri!maxLength + 1) - 1,\n        ri!maxLength\n      )\n    ) & \"...\",\n    ri!text\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_25890": {
      "name": "CMGT_UTIL_IsBlank",
      "type": "Expression Rule",
      "sail_code": "length(a!flatten(ri!value)) = 0"
    },
    "_a-0000eaba-1e20-8000-9c2a-011c48011c48_1039881": {
      "name": "CMGT_RelatedEntityMap_SetEvents",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!relatedEntityMaps,\n  expression: /*EVENTS THAT ARE PROCESS-SPECIFIC (based on \"eventType\" input)*/\n  a!match(\n    value: ri!eventType,\n    equals: \"DELETE\",\n    then: rule!CMGT_EntityEventHistory_Constructor(\n      entityId: fv!item[recordType!CMGT_RelatedEntityMap.entityId],\n      initiator: ri!initiator,\n      eventTypeId: cons!CMGT_REFID_EVENT_TYPE_ENTITY_REMOVE_RELATED_ENTITY,\n      details: a!map(\n        relatedEntityId: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityId],\n        relationshipTypeId: fv!item[recordType!CMGT_RelatedEntityMap.relationshipMapTypeId]\n      )\n    ),\n    equals: \"CREATE\",\n    then: rule!CMGT_EntityEventHistory_Constructor(\n      entityId: fv!item[recordType!CMGT_RelatedEntityMap.entityId],\n      initiator: ri!initiator,\n      eventTypeId: cons!CMGT_REFID_EVENT_TYPE_ENTITY_ADD_RELATED_ENTITY,\n      details: a!map(\n        relatedEntityId: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityId],\n        relationshipTypeId: fv!item[recordType!CMGT_RelatedEntityMap.relationshipMapTypeId]\n      )\n    ),\n    default: {}\n  )\n)"
    },
    "_a-0000e9fd-9441-8000-9bdc-011c48011c48_312992": {
      "name": "CMGT_EntityEventHistory_Constructor",
      "type": "Expression Rule",
      "sail_code": "recordType!CMGT_EventHistory_Entity(\n  recordType!CMGT_EventHistory_Entity.entityId: ri!entityId,\n  recordType!CMGT_EventHistory_Entity.timestamp: a!defaultValue(value: ri!timestamp, default: now()),\n  recordType!CMGT_EventHistory_Entity.username: rule!CMGT_formatEventInitiator(initiator: ri!initiator),\n  recordType!CMGT_EventHistory_Entity.entityEventTypeId: ri!eventTypeId,\n  recordType!CMGT_EventHistory_Entity.details: if(\n    a!isNotNullOrEmpty(ri!details),\n    #\"SYSTEM_SYSRULES_toJson_v1\"(value: ri!details),\n    null\n  )\n)"
    },
    "_a-0000e9ae-873e-8000-9baf-011c48011c48_97439": {
      "name": "CMGT_QR_GetUser",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: #\"urn:appian:record-type:v1:SYSTEM_RECORD_TYPE_USER\",\n  returnType: ri!returnType,\n  executeWhen: ri!executeWhen,\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: #\"urn:appian:record-field:v1:SYSTEM_RECORD_TYPE_USER/SYSTEM_RECORD_TYPE_USER_FIELD_username\",\n      operator: \"in\",\n      value: ri!username\n    )\n  },\n  fields: ri!fields,\n  relatedRecordData: ri!relatedRecordData,\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  triggerRefresh: ri!triggerRefresh,\n  logicalExpressions: ri!additionalLogicalExpression,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000e9d3-70bf-8000-9bbd-011c48011c48_180568": {
      "name": "CMGT_UTIL_IsNotBlank",
      "type": "Expression Rule",
      "sail_code": "not(rule!CMGT_UTIL_IsBlank(ri!input))"
    },
    "_a-0000e98b-cfe0-8000-9ba5-011c48011c48_20922": {
      "name": "CMGT_QR_GetCaseEntityMap",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_CaseEntityMap,\n  returnType: ri!returnType,\n  triggerRefresh: ri!triggerRefresh,\n  logicalExpressions: {\n    ri!additionalLogicalExpressions,\n    #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n      operator: \"OR\",\n      ignoreFiltersWithEmptyValues: true,\n      filters: {\n        #\"SYSTEM_SYSRULES_queryFilter\"(\n          field: recordType!CMGT_CaseEntityMap.entityId,\n          operator: \"in\",\n          value: ri!entityId\n        ),\n        #\"SYSTEM_SYSRULES_queryFilter\"(\n          field: recordType!CMGT_CaseEntityMap.case.caseEntityMap.entity.relatedEntityMapChildren.relatedEntityId,\n          operator: \"in\",\n          value: ri!entityId,\n          applyWhen: ri!searchChildrenEntities = true\n        )\n      }\n    )\n  },\n  executeWhen: a!defaultValue(ri!executeWhen, true),\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CaseEntityMap.caseEntityMapId,\n      operator: \"in\",\n      value: ri!caseEntityMapId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CaseEntityMap.caseId,\n      operator: \"=\",\n      value: ri!caseId\n    )\n  },\n  fields: {\n    ri!fields,\n    recordType!CMGT_CaseEntityMap.entity,\n    recordType!CMGT_CaseEntityMap.entity,\n    recordType!CMGT_CaseEntityMap.entity,\n    recordType!CMGT_CaseEntityMap.case,\n    recordType!CMGT_CaseEntityMap.case,\n    recordType!CMGT_CaseEntityMap.case\n  },\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  relatedRecordData: ri!relatedRecordData,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000e9e5-e5dd-8000-9bc7-011c48011c48_232566": {
      "name": "CMGT_UTIL_GetSubFolderByType",
      "type": "Expression Rule",
      "sail_code": "if(\n  a!isNullOrEmpty(ri!parentFolderId),\n  tofolder(null),\n  tofolder(\n    a!localVariables(\n      local!allFolders: #\"SYSTEM_SYSRULES_forEach\"(\n        items: {\n          ri!parentFolderId,\n          folder(ri!parentFolderId, \"folderChildren\")\n        },\n        expression: a!map(\n          name: folder(fv!item, \"name\"),\n          folderId: fv!item\n        )\n      ),\n      local!filterForType: index(\n        a!flatten(\n          #\"SYSTEM_SYSRULES_forEach\"(\n            items: local!allFolders,\n            expression: if(\n              search(ri!folderType, fv!item.name),\n              fv!item.folderId,\n              {}\n            )\n          )\n        ),\n        1,\n        null\n      ),\n      a!defaultValue(local!filterForType, ri!parentFolderId)\n    )\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_33778": {
      "name": "CMGT_UTIL_SetRecordFields",
      "type": "Expression Rule",
      "sail_code": "/*\nFuture enhancement ideas:\n1 Parameter to skip update if the field isn't present in the object\n--- This would also apply to nested fields, as in, don't set a relationship field if the entire relationship object isn't there because it will instantiate it\n2 Parameter to overwrite based on more enhanced logic\n3 Allow list types for the `value`\n4 Allow reuse to apply setting metadata for nested relationships, but using their own set metadata rule\n--- e.g. CMGT_Entity_SetMetaData can be used in both the Case process and the individual Entity process\n*/\nif(\n  a!isNullOrEmpty(ri!record),\n  ri!record,\n  a!localVariables(\n    local!allUpdates: rule!CMGT_UTIL_RejectBlank(a!flatten(\n      {\n        ri!alwaysOverwrite,\n        ri!childRelationships,\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: ri!neverOverwrite,\n          expression: #\"urn:appian:function:v1:a:update\"(\n            fv!item,\n            \"value\",\n            /*Specifically using this instead of a!defaultValue() to account for the `{null}` value*/\n            if(\n              rule!CMGT_UTIL_IsBlank(ri!record[fv!item.field]),\n              fv!item.value,\n              ri!record[fv!item.field]\n            )\n          )\n        )\n      }\n    )),\n    local!onlyChangedUpdates: a!flatten(\n      #\"SYSTEM_SYSRULES_forEach\"(\n        items: local!allUpdates,\n        expression: if(\n          or(\n            tostring(ri!record[fv!item.field]) = tostring(fv!item.value),\n            toboolean(fv!item.applyWhen) = false\n          ),\n          {},\n          fv!item\n        )\n      )\n    ),\n    if(\n      a!isNullOrEmpty(local!onlyChangedUpdates),\n      ri!record,\n      #\"urn:appian:function:v1:a:update\"(\n        data: ri!record,\n        index: local!onlyChangedUpdates.field,\n        value: local!onlyChangedUpdates.value\n      )\n    )\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_25707": {
      "name": "CMGT_RelatedEntityMap_SetMetaData",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!relatedEntityMaps,\n  expression: rule!CMGT_UTIL_SetRecordFields(\n    record: fv!item,\n    alwaysOverwrite: {\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.modifiedOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.modifiedBy,\n        value: ri!initiator\n      )\n    },\n    neverOverwrite: {\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.createdOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.createdBy,\n        value: ri!initiator\n      ),\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.isActive,\n        value: true\n      ),\n      /*\n      In case the ID of parent/child is on the object instead of the direct field itself, tie it to the direct field itself\n        e.g. `.parentEntity.entityId` is populated, so then we populate `.parentEntityId`\n      */\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.entityId,\n        value: fv!item[recordType!CMGT_RelatedEntityMap.entity.entityId]\n      ),\n      a!map(\n        field: recordType!CMGT_RelatedEntityMap.relatedEntityId,\n        value: fv!item[recordType!CMGT_RelatedEntityMap.relatedEntity.entityId]\n      )\n    }\n  )\n)"
    },
    "_a-0000e98b-cfe0-8000-9ba5-011c48011c48_22352": {
      "name": "CMGT_UTIL_QueryRecord",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*Chosen return type*/\n  local!returnType: a!defaultValue(ri!returnType, \"OBJECT_ARRAY\"),\n  /*Determine the query parameters to use by the return type*/\n  local!queryParams: a!match(\n    value: local!returnType,\n    equals: \"OBJECT_ARRAY\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        #\"urn:appian:function:v1:a:listtype?okey=a!listType\"(ri!recordType),\n        'type!{http://www.appian.com/ae/types/2009}Map?list'\n      ),\n      fetchTotalCount: false,\n      isArray: true,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          cons!CMGT_INT_BATCH_SIZE_MAX\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"SINGLE_OBJECT\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        ri!recordType,\n        'type!{http://www.appian.com/ae/types/2009}Map'\n      ),\n      fetchTotalCount: false,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"DATA_SUBSET\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}DataSubset',\n      fetchTotalCount: true,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: a!defaultValue(ri!pagingInfo.startIndex, 1),\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          cons!CMGT_INT_BATCH_SIZE_MAX\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"TOTAL_COUNT\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}Integer',\n      fetchTotalCount: true,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(startIndex: 1, batchSize: 0)\n    ),\n    default: fn!error(\n      \"Invalid returnType, must be one of: OBJECT_ARRAY, SINGLE_OBJECT, DATA_SUBSET, TOTAL_COUNT\"\n    )\n  ),\n  if(\n    /*Early exit for skip execution*/\n    ri!executeWhen = false,\n    cast(\n      local!queryParams.castToType,\n      if(local!queryParams.isArray, {}, null)\n    ),\n    a!localVariables(\n      /*Run the query*/\n      local!queryResult: a!refreshVariable(\n        value: #\"SYSTEM_SYSRULES_queryRecordType_v2\"(\n          recordType: ri!recordType,\n          fields: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            reject(\n              a!isNullOrEmpty,\n              a!flatten(\n                {\n                  ri!fields,\n                  index(ri!relatedRecordData, \"relationship\", {})\n                }\n              )\n            ),\n            #\"SYSTEM_SYSRULES_aggregationFields\"(\n              groupings: #\"SYSTEM_SYSRULES_forEach\"(\n                items: ri!groupByFields,\n                expression: #\"SYSTEM_SYSRULES_grouping\"(field: fv!item, alias: tostring(fv!item))\n              ),\n              measures: #\"SYSTEM_SYSRULES_measure\"(\n                field: ri!groupByFields[1],\n                function: \"COUNT\",\n                alias: \"count\"\n              )\n            )\n          ),\n          filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n            operator: \"AND\",\n            ignoreFiltersWithEmptyValues: true,\n            logicalExpressions: {\n              ri!logicalExpressions,\n              if(\n                and(\n                  a!isNotNullOrEmpty(ri!searchFields),\n                  a!isNotNullOrEmpty(ri!searchTerm)\n                ),\n                #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                  operator: \"AND\",\n                  logicalExpressions: #\"SYSTEM_SYSRULES_forEach\"(\n                    items: split(trim(ri!searchTerm), \" \"),\n                    expression: a!localVariables(\n                      local!splitSearchTerm: fv!item,\n                      #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                        operator: \"OR\",\n                        filters: #\"SYSTEM_SYSRULES_forEach\"(\n                          items: ri!searchFields,\n                          expression: #\"SYSTEM_SYSRULES_queryFilter\"(\n                            field: fv!item,\n                            operator: \"includes\",\n                            value: local!splitSearchTerm\n                          )\n                        )\n                      )\n                    )\n                  )\n                ),\n                {}\n              )\n            },\n            filters: ri!filters\n          ),\n          pagingInfo: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            local!queryParams.pagingInfo,\n            #\"urn:appian:function:v1:a:update\"(\n              local!queryParams.pagingInfo,\n              \"sort\",\n              null\n            )\n          ),\n          fetchTotalCount: local!queryParams.fetchTotalCount,\n          relatedRecordData: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            ri!relatedRecordData,\n            {}\n          )\n        ),\n        refreshOnVarChange: ri!triggerRefresh,\n        refreshAfter: { \"RECORD_ACTION\" }\n      ),\n      /*Format the output*/\n      local!output: a!match(\n        value: local!returnType,\n        equals: \"OBJECT_ARRAY\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult.data\n        ),\n        equals: \"SINGLE_OBJECT\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult.data\n        ),\n        equals: \"DATA_SUBSET\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult\n        ),\n        equals: \"TOTAL_COUNT\",\n        then: local!queryResult.totalCount,\n        default: null\n      ),\n      local!output\n    )\n  )\n)"
    },
    "_a-0000e9ca-3659-8000-9bb8-011c48011c48_137280": {
      "name": "CMGT_UTIL_DistinctRecords",
      "type": "Expression Rule",
      "sail_code": "if(\n  or(\n    a!isNullOrEmpty(ri!records),\n    a!isNullOrEmpty(ri!fields)\n  ),\n  ri!records,\n  with(\n    local!indexed: #\"SYSTEM_SYSRULES_forEach\"(\n      items: a!flatten(ri!records),\n      expression: a!map(\n        record: fv!item,\n        distinct: joinarray(\n          apply(\n            index(fv!item, _, null),\n            a!flatten(ri!fields)\n          ),\n          \"|\"\n        )\n      )\n    ),\n    local!distinctItems: union(\n      local!indexed.distinct,\n      local!indexed.distinct\n    ),\n    apply(\n      displayvalue(\n        _,\n        local!indexed.distinct,\n        local!indexed.record,\n        null\n      ),\n      local!distinctItems\n    )\n  )\n)"
    },
    "_a-0000e9dc-ab93-8000-9bc2-011c48011c48_184972": {
      "name": "CMGT_Entity_RecordGrid",
      "type": "Interface",
      "sail_code": "#\"SYSTEM_SYSRULES_gridField_v2\"(\n  label: ri!label,\n  labelPosition: if(\n    rule!CMGT_UTIL_IsBlank(value: ri!labelPosition),\n    \"ABOVE\",\n    ri!labelPosition\n  ),\n  helpTooltip: ri!helpToolTip,\n  emptyGridMessage: #\"urn:appian:translation-string:v1:80c74347-3a46-4f46-b8f7-3ab7b9f07b03\",\n  data: #\"SYSTEM_SYSRULES_recordData\"(\n    recordType: recordType!CMGT_Entity,\n    filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n      operator: \"AND\",\n      logicalExpressions: ri!additionalFilters,\n      filters: {\n        #\"SYSTEM_SYSRULES_queryFilter\"(\n          field: recordType!CMGT_Entity.entityCategoryId,\n          operator: \"=\",\n          value: ri!entityCategoryId\n        )\n      },\n      ignoreFiltersWithEmptyValues: true\n    ),\n    fields: {\n      recordType!CMGT_Entity.title,\n      recordType!CMGT_Entity.entityId,\n      recordType!CMGT_Entity.isActive,\n      recordType!CMGT_Entity.identifyingAttribute1,\n      recordType!CMGT_Entity.entityCategory.icon,\n      recordType!CMGT_Entity.entityCategory.label,\n      recordType!CMGT_Entity.entityType.label,\n      recordType!CMGT_Entity.totalCaseCount,\n      recordType!CMGT_Entity.createdOn,\n      recordType!CMGT_Entity.createdByUser,\n      recordType!CMGT_Entity.createdBy,\n      recordType!CMGT_Entity.modifiedOn,\n      recordType!CMGT_Entity.modifiedByUser,\n      recordType!CMGT_Entity.modifiedBy\n    }\n  ),\n  columns: {\n    /*All Entities*/\n    #\"SYSTEM_SYSRULES_gridColumn\"(\n      label: if(\n        ri!context = \"RECORD_LIST\",\n        #\"urn:appian:translation-string:v1:b6952414-89c9-41ca-b623-3904e55c50b0\",\n        #\"urn:appian:translation-string:v1:b8e8db5e-80b7-4598-afe2-901a9aff8168\"\n      ),\n      sortField: recordType!CMGT_Entity.title,\n      value: #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n        value: {\n          #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n            text: fv!row[recordType!CMGT_Entity.title],\n            link: #\"SYSTEM_SYSRULES_recordLink\"(\n              recordType: recordType!CMGT_Entity,\n              identifier: fv!row[recordType!CMGT_Entity.entityId],\n              openLinkIn: if(\n                contains({ \"CASE_CREATION\" }, ri!context),\n                \"NEW_TAB\",\n                \"SAME_TAB\"\n              )\n            ),\n            linkStyle: \"STANDALONE\",\n            color: ri!brandingMap.StandardTextColor,\n            style: \"STRONG\"\n          ),\n          #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n            text: \" \" & #\"urn:appian:translation-string:v1:61203e58-0f38-464a-b414-c84844d9b15a\",\n            showWhen: fv!row[recordType!CMGT_Entity.isActive] = false,\n            color: ri!brandingMap.SecondaryTextColor,\n            size: \"SMALL\",\n            style: \"EMPHASIS\"\n          ),\n          char(10),\n          #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n            text: fv!row[recordType!CMGT_Entity.identifyingAttribute1],\n            color: ri!brandingMap.SecondaryTextColor,\n            size: \"SMALL\"\n          )\n        }\n      ),\n      width: if(\n        contains({ \"RECORD_LIST\" }, ri!context),\n        \"MEDIUM_PLUS\",\n        \"AUTO\"\n      )\n    ),\n    /*Type*/\n    #\"SYSTEM_SYSRULES_gridColumn\"(\n      label: #\"urn:appian:translation-string:v1:cfd938d0-1c74-423e-89ee-f71a530aaec0\",\n      value: #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n        labelPosition: \"COLLAPSED\",\n        value: {\n          #\"SYSTEM_SYSRULES_richTextIcon\"(\n            icon: fv!row[recordType!CMGT_Entity.entityCategory.icon],\n            caption: fv!row[recordType!CMGT_Entity.entityCategory.label],\n            color: ri!brandingMap.SecondaryTextColor\n          ),\n          char(32),\n          #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n            text: if(\n              a!isNullOrEmpty(\n                fv!row[recordType!CMGT_Entity.entityType.label]\n              ),\n              \" \",\n              fv!row[recordType!CMGT_Entity.entityType.label]\n            )\n          )\n        }\n      )\n    ),\n    /*Related cases*/\n    #\"SYSTEM_SYSRULES_gridColumn\"(\n      label: #\"urn:appian:translation-string:v1:fb7bc3fe-c4a0-4dd5-82fb-77c9c21f348a\",\n      sortField: recordType!CMGT_Entity.totalCaseCount,\n      value: fv!row[recordType!CMGT_Entity.totalCaseCount],\n      showWhen: contains({ \"RECORD_LIST\" }, ri!context),\n      align: \"END\"\n    ),\n    /*Create date*/\n    #\"SYSTEM_SYSRULES_gridColumn\"(\n      label: #\"urn:appian:translation-string:v1:09205f3c-0c91-4e16-a1b5-c8085716bf98\",\n      sortField: recordType!CMGT_Entity.createdOn,\n      value: #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n        labelPosition: \"COLLAPSED\",\n        value: {\n          #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n            text: rule!CMGT_UTIL_FormatDateTime(\n              dateTime: fv!row[recordType!CMGT_Entity.createdOn],\n              includeTime: false()\n            ),\n            color: ri!brandingMap.StandardTextColor\n          ),\n          #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n            text: {\n              char(10),\n              rule!CMGT_UTIL_DisplayUser(\n                userRecord: fv!row[recordType!CMGT_Entity.createdByUser],\n                user: fv!row[recordType!CMGT_Entity.createdBy]\n              )\n            },\n            color: ri!brandingMap.SecondaryTextColor,\n            size: \"SMALL\"\n          )\n        }\n      ),\n      showWhen: contains({ \"RECORD_LIST\" }, ri!context),\n      align: \"END\"\n    ),\n    /*Updated Date*/\n    #\"SYSTEM_SYSRULES_gridColumn\"(\n      label: #\"urn:appian:translation-string:v1:11bd60d9-131f-4409-8bf0-7ef9c57dd366\",\n      sortField: recordType!CMGT_Entity.modifiedOn,\n      value: #\"SYSTEM_SYSRULES_richTextDisplayField\"(\n        labelPosition: \"COLLAPSED\",\n        value: {\n          #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n            text: rule!CMGT_UTIL_FormatDateTime(\n              dateTime: fv!row[recordType!CMGT_Entity.modifiedOn],\n              includeTime: false()\n            ),\n            color: ri!brandingMap.StandardTextColor\n          ),\n          #\"SYSTEM_SYSRULES_richTextItem_v1\"(\n            text: {\n              char(10),\n              rule!CMGT_UTIL_DisplayUser(\n                userRecord: fv!row[recordType!CMGT_Entity.modifiedByUser],\n                user: fv!row[recordType!CMGT_Entity.modifiedBy]\n              )\n            },\n            color: ri!brandingMap.SecondaryTextColor,\n            size: \"SMALL\"\n          )\n        }\n      ),\n      showWhen: contains({ \"RECORD_LIST\" }, ri!context),\n      align: \"END\"\n    )\n  },\n  pageSize: a!defaultValue(\n    ri!pageSize,\n    cons!CMGT_INT_BATCH_SIZE_LARGE\n  ),\n  initialSorts: {\n    #\"SYSTEM_SYSRULES_sortInfo\"(\n      field: recordType!CMGT_Entity.title,\n      ascending: true\n    )\n  },\n  showWhen: ri!showWhen,\n  selectable: a!defaultValue(ri!isSelectable, false),\n  selectionValue: ri!selectionValue,\n  selectionSaveInto: ri!selectionSaves,\n  selectionRequired: a!defaultValue(ri!selectionRequired, false),\n  borderStyle: \"LIGHT\",\n  shadeAlternateRows: a!defaultValue(ri!shadeAlternateRows, true),\n  /*\n  Used in accessibility;\n  if the first column shown is a new field, it must be added here\n  */\n  rowHeader: 1,\n  refreshAfter: \"RECORD_ACTION\",\n  userFilters: ri!userFilters,\n  showSearchBox: ri!showSearchBox,\n  showRefreshButton: a!defaultValue(ri!showRefreshButton, true),\n  showExportButton: a!defaultValue(ri!showExportButton, true),\n  recordActions: {\n    if(\n      contains({ \"COMPACT_LIST\" }, ri!context),\n      #\"SYSTEM_SYSRULES_recordActionItem\"(\n        action: #\"urn:appian:record-action:v1:ad3b988c-faba-4c39-9bda-be1ad52b4019/2fed3bba-1935-43a0-830a-55428610423c\"\n      ),\n      null\n    )\n  }\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_24901": {
      "name": "CMGT_QR_GetRelationshipMapType",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_CFG_RelationshipMapType,\n  returnType: ri!returnType,\n  triggerRefresh: ri!triggerRefresh,\n  executeWhen: ri!executeWhen,\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_RelationshipMapType.relationshipMapTypeId,\n      operator: \"in\",\n      value: ri!relatedRelationshipTypeId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_RelationshipMapType.parentEntityCategoryId,\n      operator: \"=\",\n      value: ri!parentEntityTypeId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_RelationshipMapType.type,\n      operator: \"=\",\n      value: ri!type\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_RelationshipMapType.isActive,\n      operator: \"=\",\n      value: ri!isActive\n    )\n  },\n  fields: {\n    ri!fields,\n    if(\n      ri!excludeRelatedRecords,\n      {},\n      {\n        recordType!CMGT_CFG_RelationshipMapType.relatedRelationshipMapType,\n        recordType!CMGT_CFG_RelationshipMapType.relatedRelationshipMapType\n      }\n    ),\n    recordType!CMGT_CFG_RelationshipMapType.relationship\n  },\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  relatedRecordData: ri!relatedRecordData,\n  logicalExpressions: ri!additionalLogicalExpression,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "0002e9fb-b785-8000-007c-7f0000014e7a": {
      "name": "CMGT_RelatedEntityMap_Manage",
      "type": "Process Model",
      "sail_code": "// Input: ?\n=relatedEntityMapsToDelete\n\n// Input: ?\n=relatedEntityMaps"
    },
    "_a-0000eab0-e049-8000-9c27-011c48011c48_1011527": {
      "name": "CMGT_UTIL_DropNonWritableRelationshipsFromRecord",
      "type": "Expression Rule",
      "sail_code": "/*\nThe main rule to \"cleanse\" the input of a WriteRecords SS node to remove non-writable relationships.\n\nSTANDARD USAGE:\n- Use this in tandem with rule CMGT_UTIL_MergeWriteRecordIdsToProcessVariable (see that description)\n- In the input of a WriteRecords SS (NOT in a previous script task), do:\n  A - Expressionable input to \"Records\" intput\n  B - rule!CMGT_UTIL_DropNonWritableRelationshipsFromRecord(\n        records: pv![the pv to write],\n        relationships: {list of record relationships that are not allowed to be written}\n      )\n\nIMPORTANT GENERAL NOTES: \n- The reason to run this in the input of the WriteRecords SS instead of a previous script task\nis that, when used with CMGT_UTIL_MergeWriteRecordIdsToProcessVariable, you can maintain the relationships\nthat you had to drop before writing.\n  -> For example, if you are writing \"Case\" but it has a child-relationship \"Address\" that cannot be written,\n    - this will drop \"Address\" before attempting to write\n    - if the output is configured properly it will reattach \"Address\" in the output\n    - the overall result is that you basically ran the node as if \"Address\" was ignored, \n      so that you can use it later in the process flow\n*/\n#\"SYSTEM_SYSRULES_forEach\"(\n  items: a!flatten(ri!records),\n  expression: reduce(\n    rule!CMGT_UTIL_DropNonWritableRelationshipsFromRecord_Reducer(\n      record: _,\n      relationship: _\n    ),\n    fv!item,\n    ri!relationships\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_25724": {
      "name": "CMGT_RelatedEntityMap_GenerateRelationshipPermutations_Logic",
      "type": "Expression Rule",
      "sail_code": "if(\n  a!isNullOrEmpty(ri!relatedEntityMaps),\n  {},\n  a!localVariables(\n    local!permutations: rule!CMGT_QR_GetRelationshipMapType(\n      returnType: null,\n      type: \"ENTITY_TO_ENTITY\"\n    ),\n    local!existingConverseRelateEntityMaps: rule!CMGT_QR_GetRelatedEntityMap(\n      entityId: rule!CMGT_UTIL_Distinct(\n        ri!relatedEntityMaps[recordType!CMGT_RelatedEntityMap.relatedEntityId]\n      ),\n      relatedEntityId: rule!CMGT_UTIL_Distinct(\n        ri!relatedEntityMaps[recordType!CMGT_RelatedEntityMap.entityId]\n      )\n    ),\n    a!flatten(\n      #\"SYSTEM_SYSRULES_forEach\"(\n        items: ri!relatedEntityMaps,\n        expression: a!localVariables(\n          local!applicablePermutationId: index(\n            rule!CMGT_UTIL_Filter(\n              records: local!permutations,\n              fieldValuePairs: {\n                a!map(\n                  field: recordType!CMGT_CFG_RelationshipMapType.relationshipMapTypeId,\n                  value: fv!item[recordType!CMGT_RelatedEntityMap.relationshipMapTypeId]\n                )\n              }\n            ),\n            recordType!CMGT_CFG_RelationshipMapType.oppositeRelationshipMapTypeId,\n            null\n          ),\n          local!originalEntityId: a!defaultValue(\n            fv!item[recordType!CMGT_RelatedEntityMap.entityId],\n            fv!item[recordType!CMGT_RelatedEntityMap.entity.entityId]\n          ),\n          local!originalRelatedEntityId: a!defaultValue(\n            fv!item[recordType!CMGT_RelatedEntityMap.relatedEntityId],\n            fv!item[recordType!CMGT_RelatedEntityMap.relatedEntity.entityId]\n          ),\n          /*Checks to see if the permutation is in list        */\n          local!permutationInList: rule!CMGT_UTIL_Filter(\n            records: ri!relatedEntityMaps,\n            fieldValuePairs: {\n              a!map(\n                field: recordType!CMGT_RelatedEntityMap.entityId,\n                value: local!originalRelatedEntityId\n              ),\n              a!map(\n                field: recordType!CMGT_RelatedEntityMap.relatedEntityId,\n                value: local!originalEntityId\n              ),\n              a!map(\n                field: recordType!CMGT_RelatedEntityMap.relationshipMapTypeId,\n                value: local!applicablePermutationId\n              )\n            }\n          ),\n          /*Checks to see if the permutation exists in the DB        */\n          local!permutationInDB: rule!CMGT_UTIL_Filter(\n            records: local!existingConverseRelateEntityMaps,\n            fieldValuePairs: {\n              a!map(\n                field: recordType!CMGT_RelatedEntityMap.entityId,\n                value: local!originalRelatedEntityId\n              ),\n              a!map(\n                field: recordType!CMGT_RelatedEntityMap.relatedEntityId,\n                value: local!originalEntityId\n              ),\n              a!map(\n                field: recordType!CMGT_RelatedEntityMap.relationshipMapTypeId,\n                value: local!applicablePermutationId\n              )\n            }\n          ),\n          /*If the permutation exists in the passed in list or there isn't a permutation, then skip,\n        if there's an existing permutation return the existing permutation  otherwise make a new one     */\n          if(\n            or(\n              a!isNullOrEmpty(local!applicablePermutationId),\n              rule!CMGT_UTIL_IsNotBlank(local!permutationInList)\n            ),\n            {},\n            if(\n              rule!CMGT_UTIL_IsNotBlank(local!permutationInDB),\n              local!permutationInDB,\n              recordType!CMGT_RelatedEntityMap(\n                recordType!CMGT_RelatedEntityMap.relationshipMapTypeId: local!applicablePermutationId,\n                recordType!CMGT_RelatedEntityMap.relatedEntityId: local!originalEntityId,\n                recordType!CMGT_RelatedEntityMap.entityId: local!originalRelatedEntityId\n              )\n            )\n          )\n        )\n      )\n    )\n  )\n)"
    },
    "_a-0000e9fa-aa45-8000-9bda-011c48011c48_301090": {
      "name": "CMGT_UTIL_DisplayUser",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!user,\n  expression: a!localVariables(\n    local!currentUserRecord: if(\n      isusernametaken(fv!item),\n      rule!CMGT_UTIL_Filter(\n        records: ri!userRecord,\n        field: #\"urn:appian:record-field:v1:SYSTEM_RECORD_TYPE_USER/SYSTEM_RECORD_TYPE_USER_FIELD_username\",\n        value: fv!item\n      ),\n      null()\n    ),\n    cast(\n      'type!{http://www.appian.com/ae/types/2009}Text',\n      if(\n        rule!CMGT_UTIL_IsNotBlank(input: local!currentUserRecord),\n        if(\n          or(\n            local!currentUserRecord[#\"urn:appian:record-field:v1:SYSTEM_RECORD_TYPE_USER/SYSTEM_RECORD_TYPE_USER_FIELD_isServiceAccount\"] = true,\n            #\"urn:appian:function:v1:a:isusermemberofgroup?okey=a!isUserMemberOfGroup\"(\n              username: fv!item,\n              groups: cons!CMGT_GRP_SERVICE_ACCOUNTS\n            )\n          ),\n          cons!CMGT_TXT_AUTOMATED_SYSTEM,\n          local!currentUserRecord[#\"urn:appian:record-field:v1:SYSTEM_RECORD_TYPE_USER/SYSTEM_RECORD_TYPE_USER_FIELD_firstAndLastName\"]\n        ),\n        if(\n          isnull(fv!item),\n          if(\n            ri!returnNullForEmpty,\n            null,\n            cons!CMGT_TXT_EMPTY_VALUE\n          ),\n          fv!item\n        )\n      )\n    )\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_24762": {
      "name": "CMGT_QR_GetRole",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_Role,\n  returnType: ri!returnType,\n  triggerRefresh: ri!triggerRefresh,\n  executeWhen: ri!executeWhen,\n  fields: {\n    ri!fields,\n    recordType!CMGT_Role.usernameUser,\n    recordType!CMGT_Role.roleType,\n    recordType!CMGT_Role.createdByUser,\n    recordType!CMGT_Role.modifiedByUser,\n    recordType!CMGT_Role.case,\n    recordType!CMGT_Role.task\n  },\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Role.caseId,\n      operator: \"in\",\n      value: ri!caseId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Role.taskId,\n      operator: \"=\",\n      value: ri!taskId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Role.roleTypeId,\n      operator: \"in\",\n      value: ri!roleTypeId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Role.username,\n      operator: \"in\",\n      value: ri!usernames\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Role.groupId,\n      operator: \"in\",\n      value: ri!groupIds\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Role.roleId,\n      operator: \"in\",\n      value: ri!roleId\n    )\n  },\n  pagingInfo: ri!pagingInfo,\n  groupByFields: ri!groupByFields,\n  sort: a!defaultValue(\n    ri!sort,\n    #\"SYSTEM_SYSRULES_sortInfo\"(\n      field: recordType!CMGT_Role.modifiedOn,\n      ascending: false\n    )\n  ),\n  relatedRecordData: ri!relatedRecordData,\n  logicalExpressions: ri!additionalLogicalExpression,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000e99c-1217-8000-9ba9-011c48011c48_56349": {
      "name": "CMGT_UTIL_FormatDateTime",
      "type": "Expression Rule",
      "sail_code": "if(\n  a!isNullOrEmpty(ri!dateTime),\n  \"\",\n  a!localVariables(\n    /*Converting dateTime to system time zone if  convertToSystemTimeZone is passed true */\n    local!dateTimeToFormat: if(\n      ri!convertToSystemTimeZone,\n      rule!CMGT_UTIL_ConvertDateTimeToTimezone(\n        dateTime: ri!dateTime,\n        timezone: rule!CMGT_UTIL_SystemTimezone()\n      ),\n      ri!dateTime\n    ),\n    if(\n      ri!returnTime,\n      text(local!dateTimeToFormat, \"h:mm a\"),\n      if(\n        ri!includeTime,\n        text(\n          local!dateTimeToFormat,\n          \"mmm d, yyyy h:mm a\"\n        ),\n        if(\n          ri!returnMonthAndDay,\n          text(local!dateTimeToFormat, \"mmm.d\"),\n          text(local!dateTimeToFormat, \"mmm d, yyyy\")\n        )\n      )\n    )\n  )\n)"
    },
    "_a-0000e9ef-12e0-8000-9bce-011c48011c48_258837": {
      "name": "CMGT_SUB_SetCaseFolderSecurity_Logic",
      "type": "Expression Rule",
      "sail_code": "a!flatten(\n  #\"SYSTEM_SYSRULES_forEach\"(\n    items: ri!cases,\n    expression: a!localVariables(\n      /*Get the public folder for the case (the one with runtime security)*/\n      local!folder: rule!CMGT_UTIL_GetSubFolderByType(\n        parentFolderId: fv!item[recordType!CMGT_Case.folderId],\n        folderType: cons!CMGT_TXT_CASE_SUB_FOLDERS[2]\n      ),\n      /*Get the current security*/\n      local!folderSecurity: rule!CMGT_PLUGIN_ReturnContentRoleMap(folder: local!folder),\n      local!currentEditorUsers: touser(\n        a!flatten(local!folderSecurity.editorUsers)\n      ),\n      /*Determine all users who should be in the security role map*/\n      /* 1) All roles for the case - roles will never be null*/\n      local!userRolesForCase: fv!item[recordType!CMGT_Case.roles.username],\n      local!usersWhoAreNotInternal: touser(\n        reject(\n          #\"urn:appian:function:v1:a:isusermemberofgroup?okey=a!isUserMemberOfGroup\"(\n            username: _,\n            groups: cons!CMGT_GRP_INTERNAL_USERS\n          ),\n          local!userRolesForCase\n        )\n      ),\n      if(\n        and(\n          a!isNullOrEmpty(local!usersWhoAreNotInternal),\n          a!isNullOrEmpty(local!currentEditorUsers)\n        ),\n        {},\n        a!localVariables(\n          /*Calculate the diff between current and desired security role map*/\n          local!userEditorsToAddToFolder: difference(\n            local!usersWhoAreNotInternal,\n            local!currentEditorUsers\n          ),\n          local!usersToRemoveFromFolder: difference(\n            local!currentEditorUsers,\n            local!usersWhoAreNotInternal\n          ),\n          /*Create an output of modifications to make, if there are some to make*/\n          if(\n            and(\n              a!isNullOrEmpty(local!userEditorsToAddToFolder),\n              a!isNullOrEmpty(local!usersToRemoveFromFolder)\n            ),\n            {},\n            {\n              a!map(\n                caseId: fv!item[recordType!CMGT_Case.caseId],\n                folder: local!folder,\n                editors: local!userEditorsToAddToFolder,\n                removes: local!usersToRemoveFromFolder,\n                admins: {},\n                viewers: {}\n              )\n            }\n          )\n        )\n      )\n    )\n  )\n)"
    },
    "_a-0000e9ca-3659-8000-9bb8-011c48011c48_145917": {
      "name": "CMGT_UTIL_Distinct",
      "type": "Expression Rule",
      "sail_code": "cast(\n  runtimetypeof(ri!value),\n  union(\n    a!flatten(ri!value),\n    a!flatten(ri!value)\n  )\n)"
    },
    "bbdef440-99fd-470f-b188-bcf11184a141": {
      "name": "CMGT_RelatedEntityMap_Create",
      "type": "Process Model",
      "sail_code": "// Output: ?\nrule!CMGT_RelatedEntityMap_SetMetaData(\n  relatedEntityMaps: pv!relatedEntityMaps,\n  initiator: pp!initiator\n)\n\n// Output: ?\nrule!CMGT_RelatedEntityMap_GenerateRelationshipPermutations_Logic(\n  relatedEntityMaps: pv!relatedEntityMaps\n)\n\n// Input: ?\n=rule!CMGT_QR_GetCaseEntityMap(\n  entityId: pv!relatedEntityMaps[recordType!CMGT_RelatedEntityMap.entityId],\n  searchChildrenEntities: true\n)[recordType!CMGT_CaseEntityMap.caseId]\n\n// Input: ?\nrule!CMGT_RelatedEntityMap_WriteRecordsProperties(\n  relatedEntityMaps: pv!relatedEntityMaps,\n  recordsUpdated: ac!RecordsUpdated,\n  isInput: true\n)\n\n// Input: ?\n=recordType!CMGT_RelatedEntityMap\n\n// Output: ?\nrule!CMGT_RelatedEntityMap_WriteRecordsProperties(\n  relatedEntityMaps: pv!relatedEntityMaps,\n  recordsUpdated: ac!RecordsUpdated,\n  isInput: false\n)\n\n// Input: ?\nrule!CMGT_RelatedEntityMap_SetEvents(\n  relatedEntityMaps: pv!relatedEntityMaps,\n  initiator: pp!initiator,\n  eventType: \"CREATE\"\n)\n\n// Input: ?\n=recordType!CMGT_EventHistory_Entity\n\n// Output: ?\nrule!CMGT_UTIL_Filter(\n  records: pv!relatedEntityMaps,\n  field: recordType!CMGT_RelatedEntityMap.relatedEntityMapId,\n  value: null\n)"
    },
    "_a-0000e9f4-1323-8000-9bd3-011c48011c48_267840": {
      "name": "CMGT_UTIL_LoadBrandingMap",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!branding: getbrandingconfig(\n    cons!CMGT_DOC_DEFAULT_BRANDING_CONFIG,\n    true\n  ),\n  local!output: reduce(\n    #\"urn:appian:function:v1:a:update\"(_, _, _),\n    a!map(),\n    merge(\n      {\n        local!branding.defaultBranding.key,\n        local!branding.customBranding.key\n      },\n      {\n        local!branding.defaultBranding.value,\n        local!branding.customBranding.value\n      }\n    )\n  ),\n  local!output\n)"
    },
    "af326a29-a1c8-4399-a28d-996f85819d9e": {
      "name": "CMGT_UTIL_Filter",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!fieldValuePairs: a!defaultValue(\n    ri!fieldValuePairs,\n    apply(\n      rule!CMGT_UTIL_Filter_CreateFieldValuePair(\n        field: _,\n        value: ri!value,\n        allFields: a!flatten(ri!field)\n      ),\n      a!flatten(ri!field)\n    )\n  ),\n  local!matchingCriteria: a!defaultValue(\n    value: ri!matchingCriteria,\n    default: \"ALL\"\n  ),\n  local!matchType: a!defaultValue(value: ri!matchType, default: \"EXACT\"),\n  local!matchIndices: if(\n    a!isNullOrEmpty(a!flatten(ri!records)),\n    tointeger({}),\n    reduce(\n      rule!CMGT_UTIL_Filter_Reducer(\n        matchingCriteria: local!matchingCriteria,\n        previousIndices: _,\n        records: a!flatten(ri!records),\n        fieldValuePair: _,\n        matchType: local!matchType\n      ),\n      a!match(\n        value: local!matchingCriteria,\n        equals: \"ALL\",\n        then: enumerate(count(a!flatten(ri!records))) + 1,\n        equals: \"ANY\",\n        then: {},\n        default: fn!error(\n          \"Invalid matchingCriteria, must be one of: ALL, ANY\"\n        )\n      ),\n      local!fieldValuePairs\n    )\n  ),\n  local!rejectIndices: difference(\n    if(\n      a!isNullOrEmpty(ri!records),\n      tointeger({}),\n      enumerate(count(a!flatten(ri!records))) + 1\n    ),\n    local!matchIndices\n  ),\n  local!matches: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!matchIndices, {})\n  ),\n  local!rejects: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!rejectIndices, {})\n  ),\n  local!output: a!match(\n    value: a!defaultValue(ri!filterType, \"FILTER\"),\n    equals: \"FILTER\",\n    then: local!matches,\n    equals: \"REJECT\",\n    then: local!rejects,\n    equals: \"FIRST_MATCH\",\n    then: index(local!matches, 1, null),\n    equals: \"FIRST_REJECT\",\n    then: index(local!rejects, 1, null),\n    equals: \"MATCH_COUNT\",\n    then: count(local!matchIndices),\n    equals: \"REJECT_COUNT\",\n    then: count(local!rejectIndices),\n    equals: \"MATCH_INDICES\",\n    then: local!matchIndices,\n    equals: \"REJECT_INDICES\",\n    then: local!rejectIndices,\n    equals: \"FULL_RESULT\",\n    then: a!map(\n      matches: local!matches,\n      rejects: local!rejects,\n      firstMatch: index(local!matches, 1, null),\n      firstReject: index(local!rejects, 1, null),\n      matchCount: count(local!matchIndices),\n      rejectCount: count(local!rejectIndices),\n      matchIndices: local!matchIndices,\n      rejectIndices: local!rejectIndices\n    ),\n    default: fn!error(\n      \"Invalid filterType, must be one of: FILTER, REJECT, FIRST_MATCH, FIRST_REJECT, MATCH_COUNT, REJECT_COUNT, MATCH_INDICES, REJECT_INDICES, FULL_RESULT\"\n    )\n  ),\n  local!output\n)"
    },
    "_a-0000e98b-cfe0-8000-9ba5-011c48011c48_19509": {
      "name": "CMGT_QR_GetCase",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_Case,\n  returnType: ri!returnType,\n  triggerRefresh: ri!triggerRefresh,\n  executeWhen: ri!executeWhen,\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Case.caseId,\n      operator: \"in\",\n      value: ri!caseId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Case.dueOn,\n      operator: \">\",\n      value: rule!CMGT_UTIL_ConvertDatetoDatetime(\n        date: ri!dueOnDate - 1,\n        useSystemTimeZone: a!defaultValue(ri!useSystemTimeZoneForDueOn,true)\n      )\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_Case.dueOn,\n      operator: \"<=\",\n      value: rule!CMGT_UTIL_ConvertDatetoDatetime(\n        date: ri!dueOnDate,\n        useSystemTimeZone: a!defaultValue(ri!useSystemTimeZoneForDueOn,true)\n      )\n    )\n  },\n  logicalExpressions: ri!additionalLogicalExpression,\n  fields: {\n    ri!fields,\n    if(\n      ri!excludeRelatedRecords,\n      {},\n      {\n        recordType!CMGT_Case.status,\n        recordType!CMGT_Case.priority,\n        recordType!CMGT_Case.caseType\n      }\n    ),\n    if(\n      ri!includeAssignees,\n      {\n        recordType!CMGT_Case.roles,\n        recordType!CMGT_Case.roles\n      },\n      {}\n    ),\n    if(\n      ri!includePrimaryContact,\n      {\n        recordType!CMGT_Case.caseEntityMap,\n        #\"urn:appian:record-relationship:v1:d81cdd0e-c54d-4b8e-beec-b7ae37fefe7f/9455b8a8-142d-4976-8b8d-83403eedad6a/043457e2-ee0b-4c7a-8210-8671bbe73128/2a2b64c2-0530-4e0a-a173-d26a396e3cc9\"\n      },\n      {}\n    )\n  },\n  relatedRecordData: {\n    ri!relatedRecordData,\n    if(\n      ri!includePrimaryContact,\n      #\"SYSTEM_SYSRULES_relatedRecordData\"(\n        relationship: recordType!CMGT_Case.caseEntityMap,\n        limit: 1,\n        filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n          field: recordType!CMGT_CaseEntityMap.entity.entityTypeId,\n          operator: \"=\",\n          value: cons!CMGT_REFID_ENTITY_TYPE_CONTACT\n        )\n      ),\n      {}\n    ),\n    if(\n      ri!includeAssignees,\n      #\"SYSTEM_SYSRULES_relatedRecordData\"(\n        relationship: recordType!CMGT_Case.roles,\n        filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n          field: recordType!CMGT_Role.roleTypeId,\n          operator: \"in\",\n          value: {\n            cons!CMGT_REFID_ROLE_TYPE_USER_ASSIGNEE,\n            cons!CMGT_REFID_ROLE_TYPE_GROUP_ASSIGNEE\n          }\n        )\n      ),\n      {}\n    )\n  },\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000ea26-2ced-8000-9bf1-011c48011c48_568470": {
      "name": "CMGT_PLUGIN_ReturnContentRoleMap",
      "type": "Expression Rule",
      "sail_code": "returncontentrolemap(\n  a!defaultValue(ri!folder, ri!document),\n  false\n)"
    }
  }
}