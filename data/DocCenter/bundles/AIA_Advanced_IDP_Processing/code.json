{
  "_metadata": {
    "bundle_id": "AIA_Advanced_IDP_Processing"
  },
  "objects": {
    "_a-0000eeb3-c7af-8000-9c01-011c48011c48_157749": {
      "name": "AIA_PLG_IsAutoscaleEnabled",
      "type": "Expression Rule",
      "sail_code": "a!defaultValue(\n  toboolean(getenvironmentconfigs().isAutscaleEnabled),\n  false\n)"
    },
    "ac252937-6391-4e9f-a15d-fd8c7cb9c020": {
      "name": "AIA Advanced IDP Processing",
      "type": "Process Model",
      "sail_code": "// Input: ?\n=pv!ExtractionInstance\n\n// Output: ?\n#\"urn:appian:function:v1:a:update\"(\n  #\"urn:appian:function:v1:a:update\"(\n    ac!ProcessInfo.pv.ExtractionInstance,\n    recordType!AIA Extraction Instance.sections,\n    ac!ProcessInfo.pv.SectionInstances\n  ),\n  recordType!AIA Extraction Instance.hasBoundingBoxes,\n  true\n)\n\n// Input: ?\n=pv!ExtractionInstance\n\n// Input: ?\n=recordType!AIA Extraction Instance\n\n// Output: ?\nAC!RecordsUpdated\n\n// Output: ?\nappian:record-field:v1:64322398-e457-4695-87d5-09794164cf77/29678053-763f-4511-afb9-9e5f13e1ec05\"]:rule!AIA_PLG_WriteFile(\n  content: rule!AIA_Extraction_GetAllBoundingBoxes( ExtractionInstance: pv!ExtractionInstance),\n  name: \"bounding-boxes\",\n  extension: \"json\",\n  folder: pv!ExtractionInstance[recordType!AIA Extraction Instance.documentFolderId]\n).document\n\n// Input: ?\n=pv!ExtractionInstance\n\n// Input: ?\n1\n\n// Input: ?\n=pv!ExtractionInstance[recordType!AIA Extraction Instance.documentId]\n\n// Output: ?\nac!ProcessInfo.pv.ExtractionInstance\n\n// Input: ?\nrule!AIA_UTIL_ProcessModelForEach()\n\n// Input: ?\na!map(\n  processModel: cons!AIA_PM_PROCESS_BOUNDING_BOXES,\n  processParameters: #\"SYSTEM_SYSRULES_forEach\"(\n    items: pv!ExtractionInstance[recordType!AIA Extraction Instance.sections],\n    expression: a!map(\n      ExtractionInstance: pv!ExtractionInstance,\n      SectionInstance: fv!item,\n      batch: 1,\n      document: fv!item[recordType!AIA Extraction Instance Section.documentId]\n    )\n  )\n)"
    },
    "_a-0000eeb8-377a-8000-9c16-011c48011c48_167255": {
      "name": "AIA_UTIL_ProcessModelForEach",
      "type": "Expression Rule",
      "sail_code": "if(\n  rule!AIA_PLG_IsAutoscaleEnabled(),\n  cons!AIA_PM_FOR_EACH_LOOP,\n  cons!AIA_PM_FOR_EACH_MNI\n)"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_184766": {
      "name": "AIA_PLG_WriteFile",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!result: writefile(\n    ri!content,\n    ri!name,\n    ri!extension,\n    ri!folder,\n    ri!description\n  ),\n  if(\n    local!result.success,\n    local!result,\n    fn!error(local!result.error)\n  )\n)"
    },
    "_a-0000ecea-6c5f-8000-9c4b-011c48011c48_189602": {
      "name": "AIA_Extraction_GetAllBoundingBoxes",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!boundingBoxes: a!defaultValue(\n    ri!ExtractionInstance[recordType!AIA Extraction Instance.boundingBoxes],\n    rule!AIA_Extraction_GetBoundingBoxesForExtraction(\n      ExtractionInstance: ri!ExtractionInstance\n    )\n  ),\n  a!localVariables(\n    #\"SYSTEM_SYSRULES_toJson_v1\"(\n      a!flatten(\n        #\"SYSTEM_SYSRULES_forEach\"(\n          local!boundingBoxes,\n          a!localVariables(\n            local!json: rule!SHRD_ReadDocumentContent(\n              document: fv!item[recordType!AIA Extraction Bounding Boxes.boundingBoxesDocumentId]\n            ),\n            rule!AIA_ExtractJson(json: local!json)\n          )\n        )\n      )\n    )\n  )\n)"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_158769": {
      "name": "AIA_Extraction_GetBoundingBoxesForExtraction",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_queryRecordType_v1\"(\n  recordType: recordType!AIA Extraction Bounding Boxes,\n  filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n    field: recordType!AIA Extraction Bounding Boxes.extractionId,\n    operator: \"=\",\n    value: ri!ExtractionInstance[recordType!AIA Extraction Instance.id]\n  ),\n  pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n    startIndex: 1,\n    batchSize: 1000,\n    sort: #\"SYSTEM_SYSRULES_sortInfo\"(\n      field: recordType!AIA Extraction Bounding Boxes.minPage,\n      ascending: true\n    )\n  )\n).data"
    },
    "_a-0000ec2d-5396-8000-9bdc-011c48011c48_40909": {
      "name": "AIA_ExtractJson",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!firstTry: rule!AIA_ExtractJsonInner(\n    json: ri!json\n  ),\n  local!result: if(\n    a!isNotNullOrEmpty(local!firstTry),\n    local!firstTry,\n    a!localVariables(\n      local!secondTry: rule!AIA_ExtractJsonInner(\n        json: index(split(ri!json, \"Appian's private AI\"), 1, null),\n      ),\n      if(\n        a!isNotNullOrEmpty(local!secondTry),\n        local!secondTry,\n        a!localVariables(\n          local!thirdTry: rule!AIA_ExtractJsonInner(\n            json: index(split(ri!json, \"Appian's private AI\"), 2, null),\n          ),\n          if(\n            a!isNotNullOrEmpty(local!thirdTry),\n            local!thirdTry,\n            a!localVariables(\n              local!forthTry: rule!AIA_ExtractJsonInner(\n                json: index(split(ri!json, \"<output>\"), 1, null),\n              ),\n              if(\n                a!isNotNullOrEmpty(local!forthTry),\n                local!forthTry,\n                a!localVariables(\n                  local!fifthTry: rule!AIA_ExtractJsonInner(\n                    json: index(split(ri!json, \"</entities>\"), 1, null),\n                  ),\n                  local!fifthTry\n                )\n              )\n            )\n          )\n        )\n      )\n    )\n  ),\n  local!finalResult: if(\n    a!isNullOrEmpty(local!result),\n    null,\n    if(\n      a!defaultValue(ri!returnList, true),\n      local!result,\n      if(\n        rule!SHRD_IsList(local!result),\n        null,\n        local!result\n      )\n    )\n  ),\n  /* Handle scenario where the result comes back as properties of a $schema */\n  if(\n    or(\n      a!defaultValue(ri!returnList, true),\n      a!isNullOrEmpty(local!finalResult),\n      not(contains(\n        a!keys(local!finalResult),\n        \"$schema\"\n      ))\n    ),\n    local!finalResult,\n    local!finalResult.properties\n  )\n)"
    },
    "_a-0000ee3e-060c-8000-9bb8-011c48011c48_203441": {
      "name": "SHRD_ReadDocumentContent",
      "type": "Expression Rule",
      "sail_code": "/*readdocumentcontent(ri!document)*/\n\nqueryfile(\n  ri!document,\n  \"TEXT\",\n  now()\n).result"
    }
  }
}