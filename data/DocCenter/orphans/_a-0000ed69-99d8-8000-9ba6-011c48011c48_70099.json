{
  "uuid": "_a-0000ed69-99d8-8000-9ba6-011c48011c48_70099",
  "name": "AIA_ExtractionModel_GetDataForHomePage",
  "type": "Expression Rule",
  "description": "Expression rule to get Data for Home Page",
  "sail_code": "a!localVariables(\n  /*Extraction Model Data (Includes First and Second KPI)*/\n  local!extractionModelData: index(\n    #\"SYSTEM_SYSRULES_queryRecordType_v1\"(\n      recordType: recordType!AIA Extraction Model,\n      fields: #\"SYSTEM_SYSRULES_aggregationFields\"(\n        measures: {\n          #\"SYSTEM_SYSRULES_measure\"(\n            field: recordType!AIA Extraction Model.modelId,\n            function: \"COUNT\",\n            alias: \"activeModelCount\",\n            filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n              field: recordType!AIA Extraction Model.createdOn,\n              operator: \"between\",\n              value: {\n                ri!selectedInterval.currrentStartDate,\n                ri!selectedInterval.currentEndDate\n              }\n            )\n          ),\n          #\"SYSTEM_SYSRULES_measure\"(\n            field: recordType!AIA Extraction Model.publishedVersionAccuracy,\n            function: \"AVG\",\n            alias: \"accuracyAvg\",\n            filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n              field: recordType!AIA Extraction Model.createdOn,\n              operator: \"between\",\n              value: {\n                ri!selectedInterval.currrentStartDate,\n                ri!selectedInterval.currentEndDate\n              }\n            )\n          ),\n          #\"SYSTEM_SYSRULES_measure\"(\n            alias: \"lastMonthOrYearAccuracyAvg\",\n            field: recordType!AIA Extraction Model.publishedVersionAccuracy,\n            function: \"AVG\",\n            filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n              field: recordType!AIA Extraction Model.createdOn,\n              operator: \"between\",\n              value: {\n                ri!selectedInterval.previousStartDate,\n                ri!selectedInterval.previousEndDate\n              }\n            )\n          ),\n          \n        }\n      ),\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(1, 1)\n    ).data,\n    1,\n    null()\n  ),\n  /*Extraction Instance Data (Third KPI)*/\n  local!extractionInstanceData: index(\n    #\"SYSTEM_SYSRULES_queryRecordType_v1\"(\n      recordType: recordType!AIA Extraction Instance,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(1, 1),\n      fields: #\"SYSTEM_SYSRULES_aggregationFields\"(\n        measures: {\n          #\"SYSTEM_SYSRULES_measure\"(\n            field: recordType!AIA Extraction Instance.id,\n            function: \"COUNT\",\n            alias: \"instanceCount\",\n            filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n              field: recordType!AIA Extraction Instance.createdOn,\n              operator: \"between\",\n              value: {\n                ri!selectedInterval.currrentStartDate,\n                ri!selectedInterval.currentEndDate\n              }\n            )\n          ),\n          #\"SYSTEM_SYSRULES_measure\"(\n            field: recordType!AIA Extraction Instance.id,\n            function: \"COUNT\",\n            alias: \"LastMonthOrYearInstanceCount\",\n            filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n              field: recordType!AIA Extraction Instance.createdOn,\n              operator: \"between\",\n              value: {\n                ri!selectedInterval.previousStartDate,\n                ri!selectedInterval.previousEndDate\n              }\n            )\n          ),\n          #\"SYSTEM_SYSRULES_measure\"(\n            field: recordType!AIA Extraction Instance.inputTokens,\n            function: \"SUM\",\n            alias: \"inputTokens\",\n            filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n              field: recordType!AIA Extraction Instance.createdOn,\n              operator: \"between\",\n              value: {\n                ri!selectedInterval.currrentStartDate,\n                ri!selectedInterval.currentEndDate\n              }\n            )\n          ),\n          #\"SYSTEM_SYSRULES_measure\"(\n            field: recordType!AIA Extraction Instance.outputTokens,\n            function: \"SUM\",\n            alias: \"outputTokens\",\n            filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n              field: recordType!AIA Extraction Instance.createdOn,\n              operator: \"between\",\n              value: {\n                ri!selectedInterval.currrentStartDate,\n                ri!selectedInterval.currentEndDate\n              }\n            )\n          ),\n          #\"SYSTEM_SYSRULES_measure\"(\n            field: recordType!AIA Extraction Instance.pageCount,\n            function: \"SUM\",\n            alias: \"pageCount\",\n            filters: #\"SYSTEM_SYSRULES_queryFilter\"(\n              field: recordType!AIA Extraction Instance.createdOn,\n              operator: \"between\",\n              value: {\n                ri!selectedInterval.currrentStartDate,\n                ri!selectedInterval.currentEndDate\n              }\n            )\n          )\n        }\n      )\n    ).data,\n    1,\n    null\n  ),\n  {\n    a!map(\n      kpiLabel:\"Active Model\",\n      kpiValue:local!extractionModelData.activeModelCount,\n      isDisplay:false()\n    ),\n    a!map(\n      kpiLabel: #\"urn:appian:translation-string:v1:c85d75d0-b3cb-48e8-8f2e-0d67a65fe1eb\",\n      kpiValue: sum(\n        a!defaultValue(local!extractionInstanceData.inputTokens, 0),\n        a!defaultValue(local!extractionInstanceData.outputTokens, 0)\n      ),\n      kpiSecondaryValue: 0,\n      kpiForthValue: a!defaultValue(local!extractionInstanceData.pageCount, 0),\n      KpiFithValue: local!extractionInstanceData.inputTokens,\n      KpiSixthValue:   local!extractionInstanceData.outputTokens,\n      actualValue: sum(\n        a!defaultValue(local!extractionInstanceData.inputTokens, 0),\n        a!defaultValue(local!extractionInstanceData.outputTokens, 0)\n      )\n    ),\n    a!map(\n      kpiLabel: #\"urn:appian:translation-string:v1:231c53d0-2ae0-4819-ae0a-372d31b4c766\",\n      kpiValue: local!extractionInstanceData.instanceCount,\n      kpiSecondaryValue: a!defaultValue(\n        rule!AIA_UTIL_findAverageRaiseGivenInputNumbers(\n          lastMonthYear: a!defaultValue(\n            local!extractionInstanceData.LastMonthOrYearInstanceCount,\n            0\n          ),\n          thisMonthYear: a!defaultValue(\n            local!extractionInstanceData.instanceCount,\n            0\n          )\n        ),\n        0\n      ),\n      actualValue: local!extractionInstanceData.instanceCount\n    ),\n    a!map(\n      kpiLabel: #\"urn:appian:translation-string:v1:e7433e50-d077-40d2-b8d7-ece73c0d8e16\",\n      kpiValue: rule!AIA_DisplayPercentage(\n        value: if(\n          a!isNotNullOrEmpty(local!extractionModelData.accuracyAvg),\n          round(\n            local!extractionModelData.accuracyAvg,\n            2\n          ),\n          0\n        )\n      ),\n      kpiSecondaryValue: a!defaultValue(\n        rule!AIA_UTIL_findAverageRaiseGivenInputNumbers(\n          lastMonthYear: a!defaultValue(\n            local!extractionModelData.lastMonthOrYearAccuracyAvg,\n            0\n          ),\n          thisMonthYear: a!defaultValue(\n            local!extractionModelData.accuracyAvg,\n            0\n          )\n        ),\n        0\n      ),\n      KpiThirdValue: local!extractionModelData.activeModelCount,\n      actualValue: local!extractionModelData.accuracyAvg\n    )\n  }\n)",
  "calls": [
    {
      "name": "AIA_UTIL_findAverageRaiseGivenInputNumbers",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "AIA_DisplayPercentage",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    },
    {
      "name": "Total Tokens Consumed",
      "type": "Translation String",
      "dep_type": "CALLS"
    },
    {
      "name": "Label for Extraction Instances Run",
      "type": "Translation String",
      "dep_type": "CALLS"
    },
    {
      "name": "Label for Average Extraction Accuracy",
      "type": "Translation String",
      "dep_type": "CALLS"
    }
  ],
  "called_by": []
}