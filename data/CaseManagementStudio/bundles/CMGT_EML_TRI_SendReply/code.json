{
  "_metadata": {
    "bundle_id": "CMGT_EML_TRI_SendReply"
  },
  "objects": {
    "_a-0000e99c-1217-8000-9ba9-011c48011c48_56349": {
      "name": "CMGT_UTIL_FormatDateTime",
      "type": "Expression Rule",
      "sail_code": "if(\n  a!isNullOrEmpty(ri!dateTime),\n  \"\",\n  a!localVariables(\n    /*Converting dateTime to system time zone if  convertToSystemTimeZone is passed true */\n    local!dateTimeToFormat: if(\n      ri!convertToSystemTimeZone,\n      rule!CMGT_UTIL_ConvertDateTimeToTimezone(\n        dateTime: ri!dateTime,\n        timezone: rule!CMGT_UTIL_SystemTimezone()\n      ),\n      ri!dateTime\n    ),\n    if(\n      ri!returnTime,\n      text(local!dateTimeToFormat, \"h:mm a\"),\n      if(\n        ri!includeTime,\n        text(\n          local!dateTimeToFormat,\n          \"mmm d, yyyy h:mm a\"\n        ),\n        if(\n          ri!returnMonthAndDay,\n          text(local!dateTimeToFormat, \"mmm.d\"),\n          text(local!dateTimeToFormat, \"mmm d, yyyy\")\n        )\n      )\n    )\n  )\n)"
    },
    "_a-0000e98b-cfe0-8000-9ba5-011c48011c48_22352": {
      "name": "CMGT_UTIL_QueryRecord",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*Chosen return type*/\n  local!returnType: a!defaultValue(ri!returnType, \"OBJECT_ARRAY\"),\n  /*Determine the query parameters to use by the return type*/\n  local!queryParams: a!match(\n    value: local!returnType,\n    equals: \"OBJECT_ARRAY\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        #\"urn:appian:function:v1:a:listtype?okey=a!listType\"(ri!recordType),\n        'type!{http://www.appian.com/ae/types/2009}Map?list'\n      ),\n      fetchTotalCount: false,\n      isArray: true,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          cons!CMGT_INT_BATCH_SIZE_MAX\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"SINGLE_OBJECT\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        ri!recordType,\n        'type!{http://www.appian.com/ae/types/2009}Map'\n      ),\n      fetchTotalCount: false,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"DATA_SUBSET\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}DataSubset',\n      fetchTotalCount: true,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: a!defaultValue(ri!pagingInfo.startIndex, 1),\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          cons!CMGT_INT_BATCH_SIZE_MAX\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"TOTAL_COUNT\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}Integer',\n      fetchTotalCount: true,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(startIndex: 1, batchSize: 0)\n    ),\n    default: fn!error(\n      \"Invalid returnType, must be one of: OBJECT_ARRAY, SINGLE_OBJECT, DATA_SUBSET, TOTAL_COUNT\"\n    )\n  ),\n  if(\n    /*Early exit for skip execution*/\n    ri!executeWhen = false,\n    cast(\n      local!queryParams.castToType,\n      if(local!queryParams.isArray, {}, null)\n    ),\n    a!localVariables(\n      /*Run the query*/\n      local!queryResult: a!refreshVariable(\n        value: #\"SYSTEM_SYSRULES_queryRecordType_v2\"(\n          recordType: ri!recordType,\n          fields: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            reject(\n              a!isNullOrEmpty,\n              a!flatten(\n                {\n                  ri!fields,\n                  index(ri!relatedRecordData, \"relationship\", {})\n                }\n              )\n            ),\n            #\"SYSTEM_SYSRULES_aggregationFields\"(\n              groupings: #\"SYSTEM_SYSRULES_forEach\"(\n                items: ri!groupByFields,\n                expression: #\"SYSTEM_SYSRULES_grouping\"(field: fv!item, alias: tostring(fv!item))\n              ),\n              measures: #\"SYSTEM_SYSRULES_measure\"(\n                field: ri!groupByFields[1],\n                function: \"COUNT\",\n                alias: \"count\"\n              )\n            )\n          ),\n          filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n            operator: \"AND\",\n            ignoreFiltersWithEmptyValues: true,\n            logicalExpressions: {\n              ri!logicalExpressions,\n              if(\n                and(\n                  a!isNotNullOrEmpty(ri!searchFields),\n                  a!isNotNullOrEmpty(ri!searchTerm)\n                ),\n                #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                  operator: \"AND\",\n                  logicalExpressions: #\"SYSTEM_SYSRULES_forEach\"(\n                    items: split(trim(ri!searchTerm), \" \"),\n                    expression: a!localVariables(\n                      local!splitSearchTerm: fv!item,\n                      #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                        operator: \"OR\",\n                        filters: #\"SYSTEM_SYSRULES_forEach\"(\n                          items: ri!searchFields,\n                          expression: #\"SYSTEM_SYSRULES_queryFilter\"(\n                            field: fv!item,\n                            operator: \"includes\",\n                            value: local!splitSearchTerm\n                          )\n                        )\n                      )\n                    )\n                  )\n                ),\n                {}\n              )\n            },\n            filters: ri!filters\n          ),\n          pagingInfo: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            local!queryParams.pagingInfo,\n            #\"urn:appian:function:v1:a:update\"(\n              local!queryParams.pagingInfo,\n              \"sort\",\n              null\n            )\n          ),\n          fetchTotalCount: local!queryParams.fetchTotalCount,\n          relatedRecordData: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            ri!relatedRecordData,\n            {}\n          )\n        ),\n        refreshOnVarChange: ri!triggerRefresh,\n        refreshAfter: { \"RECORD_ACTION\" }\n      ),\n      /*Format the output*/\n      local!output: a!match(\n        value: local!returnType,\n        equals: \"OBJECT_ARRAY\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult.data\n        ),\n        equals: \"SINGLE_OBJECT\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult.data\n        ),\n        equals: \"DATA_SUBSET\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult\n        ),\n        equals: \"TOTAL_COUNT\",\n        then: local!queryResult.totalCount,\n        default: null\n      ),\n      local!output\n    )\n  )\n)"
    },
    "_a-0000e99c-1217-8000-9ba9-011c48011c48_56355": {
      "name": "CMGT_UTIL_SystemTimezone",
      "type": "Expression Rule",
      "sail_code": "usertimezone(\"Administrator\")"
    },
    "_a-0000ea26-2ced-8000-9bf1-011c48011c48_583958": {
      "name": "CMGT_UTIL_FillDocumentTemplate",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!output: reduce(\n    substitute(_, _, _),\n    rule!CMGT_PLUGIN_ReadDocumentContent(document: ri!document),\n    merge(\n      apply(\n        concat(\"###\", _, \"###\"),\n        ri!replacementParams.find\n      ),\n      touniformstring(ri!replacementParams.replace)\n    )\n  ),\n  local!output\n)"
    },
    "_a-0000ea26-2ced-8000-9bf1-011c48011c48_583989": {
      "name": "CMGT_PLUGIN_ReadDocumentContent",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!documentContent: readdocumentcontent(ri!document),\n  if(\n    local!documentContent = \"null\",\n    \"\",\n    local!documentContent\n  )\n)"
    },
    "_a-0000ee54-f700-8000-9d97-011c48011c48_4558403": {
      "name": "CMGT_EML_TRI_Message_SetMetaData",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!message,\n  expression: rule!CMGT_UTIL_SetRecordFields(\n    record: fv!item,\n    alwaysOverwrite: {\n      a!map(\n        field: recordType!CMGT_EML_TRI_Message.modifiedOn,\n        value: now()\n      ),\n      a!map(\n        field:  recordType!CMGT_EML_TRI_Message.modifiedBy,\n        value: ri!initiator\n      )\n    },\n    neverOverwrite: {\n      a!map(\n        field:  recordType!CMGT_EML_TRI_Message.isActive,\n        value: true()\n      ),\n      a!map(\n        field: recordType!CMGT_EML_TRI_Message.createdOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_EML_TRI_Message.createdBy,\n        value: ri!initiator\n      )\n    }\n  )\n)"
    },
    "_a-0000ecbe-e702-8000-9cf8-011c48011c48_3232661": {
      "name": "CMGT_EML_TRI_Reply_ReplacementParamsMap",
      "type": "Expression Rule",
      "sail_code": "{\n  {\n    find: \"messageText\",\n    replace: ri!messageText[recordType!CMGT_EML_TRI_MessageText.message]\n  },\n  {\n    find: \"threadUUID\",\n    replace: ri!threadUUID\n  },\n  {\n    find: \"threadMessages\",\n    replace: ri!threadMessages\n  }\n}"
    },
    "_a-0000e9d3-70bf-8000-9bbd-011c48011c48_180568": {
      "name": "CMGT_UTIL_IsNotBlank",
      "type": "Expression Rule",
      "sail_code": "not(rule!CMGT_UTIL_IsBlank(ri!input))"
    },
    "0002ecc1-bd0e-8000-1977-7f0000014e7a": {
      "name": "CMGT_EML_TRI_SendReply",
      "type": "Process Model",
      "sail_code": "// Input: ?\n={rule!CMGT_EML_TRI_Message_SetMetaData(\n  message: pv!message,\n  initiator: pp!initiator\n)}\n\n// Input: ?\n={recordType!CMGT_EML_TRI_Message}\n\n// Output: ?\nAC!RecordsUpdated\n\n// Input: ?\n= rule!CMGT_EML_TRI_EmailSettingMap_Reply(\n  thread: pv!thread,\n  message: pv!message\n)"
    },
    "_a-0000eccd-140e-8000-9d02-011c48011c48_3324853": {
      "name": "CMGT_EML_TRI_FormatThreadMessagesForReply",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!messages: rule!CMGT_EML_TRI_QR_getMessages(\n    threadIds: ri!threadId,\n    returnType: cons!CMGT_EML_TRI_CO_ENUM_QE_RETURN_TYPE_OBJECT_ARRAY,\n    sort: #\"SYSTEM_SYSRULES_sortInfo\"(\n      field: recordType!CMGT_EML_TRI_Message.modifiedOn,\n      ascending: false\n    ),\n    executeWhen: a!isNotNullOrEmpty(value: ri!threadId),\n    excludeMessageIds: ri!currentMessageId\n  ),\n  local!messageRecipients: rule!CMGT_EML_TRI_QR_GetMessageRecipients(\n    returnType: \"OBJECT_ARRAY\",\n    messageIds: local!messages[recordType!CMGT_EML_TRI_Message.messageId],\n    fields: {\n      recordType!CMGT_EML_TRI_MessageRecipient.recipient,\n      recordType!CMGT_EML_TRI_MessageRecipient.recipientEmail,\n      recordType!CMGT_EML_TRI_MessageRecipient.isSender,\n      recordType!CMGT_EML_TRI_MessageRecipient.messageId\n    },\n    sort: {\n      #\"SYSTEM_SYSRULES_sortInfo\"(\n        field: recordType!CMGT_EML_TRI_MessageRecipient.recipient,\n        ascending: true()\n      )\n    },\n    executeWhen: rule!CMGT_UTIL_IsNotBlank(local!messages)\n  ),\n  concat(\n    #\"SYSTEM_SYSRULES_forEach\"(\n      items: local!messages,\n      expression: a!localVariables(\n        local!sender: rule!CMGT_UTIL_Filter(\n          records: local!messageRecipients,\n          fieldValuePairs: {\n            a!map(\n              field: recordType!CMGT_EML_TRI_MessageRecipient.messageId,\n              value: fv!item[recordType!CMGT_EML_TRI_Message.messageId]\n            ),\n            a!map(\n              field: recordType!CMGT_EML_TRI_MessageRecipient.isSender,\n              value: true\n            )\n          }\n        ),\n        local!recipients: rule!CMGT_UTIL_Filter(\n          records: local!messageRecipients,\n          fieldValuePairs: {\n            a!map(\n              field: recordType!CMGT_EML_TRI_MessageRecipient.messageId,\n              value: fv!item[recordType!CMGT_EML_TRI_Message.messageId]\n            ),\n            a!map(\n              field: recordType!CMGT_EML_TRI_MessageRecipient.isSender,\n              value: false\n            )\n          }\n        ),\n        concat(\n          \"<hr>\n<br>\",\n          \"<b>\",\n          /* Sender Name */\n          if(\n            local!sender[recordType!CMGT_EML_TRI_MessageRecipient.recipientEmail] = cons!CMGT_EML_TRI_MAILBOX_EMAIL_ADDRESS,\n            #\"urn:appian:translation-string:v1:90e85704-fd61-4549-b907-6867e4cad74d\",\n            local!sender[recordType!CMGT_EML_TRI_MessageRecipient.recipient]\n          ),\n          \"</b>\",\n          /* Sender Email */\n          \"&lt;\",\n          local!sender[recordType!CMGT_EML_TRI_MessageRecipient.recipientEmail],\n          \"&gt;\",\n          \"<br>\nto \",\n          /* Recipients */joinarray(\n            #\"SYSTEM_SYSRULES_forEach\"(\n              items: local!recipients,\n              expression: fv!item[recordType!CMGT_EML_TRI_MessageRecipient.recipient] & \"&lt;\" & fv!item[recordType!CMGT_EML_TRI_MessageRecipient.recipientEmail] & \"&gt;\"\n            ),\n            \",\"\n          ),\n          \"<br>\",\n          /* sent datetime */rule!CMGT_UTIL_FormatDateTime(\n            dateTime: fv!item[recordType!CMGT_EML_TRI_Message.modifiedOn],\n            includeTime: true,\n            convertToSystemTimeZone: true\n          ),\n          \" \",\n          rule!CMGT_UTIL_SystemTimezone(),\n          /* Message text */\n          fv!item[recordType!CMGT_EML_TRI_Message.messageText.message],\n          \n        )\n      )\n    )\n  )\n)"
    },
    "_a-0000e9ca-3659-8000-9bb8-011c48011c48_145648": {
      "name": "CMGT_UTIL_GetSiteUrl",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!authedPath: cast(\n    'type!{http://www.appian.com/ae/types/2009}Text',\n    extract(linktodocument(0, \"doc\"), \"\"\"\", \"/doc/\")\n  ),\n  local!subdomainWithDomain: extract(local!authedPath, \"//\", \"/suite\")[1],\n  local!subdomain: split(local!subdomainWithDomain, \".\")[1],\n  a!map(\n    subdomain: local!subdomain,\n    authedPath: local!authedPath,\n    subdomainWithDomain: local!subdomainWithDomain\n  )\n)"
    },
    "af326a29-a1c8-4399-a28d-996f85819d9e": {
      "name": "CMGT_UTIL_Filter",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!fieldValuePairs: a!defaultValue(\n    ri!fieldValuePairs,\n    apply(\n      rule!CMGT_UTIL_Filter_CreateFieldValuePair(\n        field: _,\n        value: ri!value,\n        allFields: a!flatten(ri!field)\n      ),\n      a!flatten(ri!field)\n    )\n  ),\n  local!matchingCriteria: a!defaultValue(\n    value: ri!matchingCriteria,\n    default: \"ALL\"\n  ),\n  local!matchType: a!defaultValue(value: ri!matchType, default: \"EXACT\"),\n  local!matchIndices: if(\n    a!isNullOrEmpty(a!flatten(ri!records)),\n    tointeger({}),\n    reduce(\n      rule!CMGT_UTIL_Filter_Reducer(\n        matchingCriteria: local!matchingCriteria,\n        previousIndices: _,\n        records: a!flatten(ri!records),\n        fieldValuePair: _,\n        matchType: local!matchType\n      ),\n      a!match(\n        value: local!matchingCriteria,\n        equals: \"ALL\",\n        then: enumerate(count(a!flatten(ri!records))) + 1,\n        equals: \"ANY\",\n        then: {},\n        default: fn!error(\n          \"Invalid matchingCriteria, must be one of: ALL, ANY\"\n        )\n      ),\n      local!fieldValuePairs\n    )\n  ),\n  local!rejectIndices: difference(\n    if(\n      a!isNullOrEmpty(ri!records),\n      tointeger({}),\n      enumerate(count(a!flatten(ri!records))) + 1\n    ),\n    local!matchIndices\n  ),\n  local!matches: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!matchIndices, {})\n  ),\n  local!rejects: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!rejectIndices, {})\n  ),\n  local!output: a!match(\n    value: a!defaultValue(ri!filterType, \"FILTER\"),\n    equals: \"FILTER\",\n    then: local!matches,\n    equals: \"REJECT\",\n    then: local!rejects,\n    equals: \"FIRST_MATCH\",\n    then: index(local!matches, 1, null),\n    equals: \"FIRST_REJECT\",\n    then: index(local!rejects, 1, null),\n    equals: \"MATCH_COUNT\",\n    then: count(local!matchIndices),\n    equals: \"REJECT_COUNT\",\n    then: count(local!rejectIndices),\n    equals: \"MATCH_INDICES\",\n    then: local!matchIndices,\n    equals: \"REJECT_INDICES\",\n    then: local!rejectIndices,\n    equals: \"FULL_RESULT\",\n    then: a!map(\n      matches: local!matches,\n      rejects: local!rejects,\n      firstMatch: index(local!matches, 1, null),\n      firstReject: index(local!rejects, 1, null),\n      matchCount: count(local!matchIndices),\n      rejectCount: count(local!rejectIndices),\n      matchIndices: local!matchIndices,\n      rejectIndices: local!rejectIndices\n    ),\n    default: fn!error(\n      \"Invalid filterType, must be one of: FILTER, REJECT, FIRST_MATCH, FIRST_REJECT, MATCH_COUNT, REJECT_COUNT, MATCH_INDICES, REJECT_INDICES, FULL_RESULT\"\n    )\n  ),\n  local!output\n)"
    },
    "0004ea31-0987-8000-0334-7f0000014e7a": {
      "name": "CMGT_SUB_SendEmail",
      "type": "Process Model",
      "sail_code": "// Input: ?\n= rule!CMGT_UTIL_Filter( records: pv!emailSettingMap, fieldValuePairs: { { field: \"recipients\", value: a!groupMembers( group: cons!CMGT_GRP_SERVICE_ACCOUNTS, direct: true, memberType: \"USER\" ).data }, }, filterType: \"REJECT\")\n\n// Output: ?\nrule!CMGT_UTIL_Filter(\n  records: ac!rejectServiceAccounts,\n  fieldValuePairs: {\n    { field: \"recipients\", value: null },\n    {\n      field: \"recipientEmailAddress\",\n      value: null\n    },\n    { field: \"bccRecipients\", value: null },\n    { field: \"ccRecipients\", value: null }\n  },\n  filterType: \"REJECT\"\n)\n\n// Input: ?\n= a!defaultValue( value: index( pv!emailSettingMap[tp!instanceindex], \"senderEmail\", null() ), default: concat( \"no-reply@\", rule!CMGT_UTIL_GetSiteUrl().subdomainWithDomain ))\n\n// Input: ?\n= toemailrecipient( a!defaultValue( value: pv!emailSettingMap[tp!instanceindex].recipients, default: pv!emailSettingMap[tp!instanceindex].recipientEmailAddress ))\n\n// Input: ?\n= index( pv!emailSettingMap[tp!instanceindex], \"ccRecipients\", null)\n\n// Input: ?\n=index( pv!emailSettingMap[tp!instanceindex], \"bccRecipients\", null)\n\n// Input: ?\n=pv!emailSettingMap.subject\n\n// Input: ?\n=todocument(pv!emailSettingMap.attachments)\n\n// Input: ?\n= a!defaultValue( value: index( pv!emailSettingMap[tp!instanceindex], \"customSenderDisplayName\", null ), default: #\"urn:appian:translation-string:v1:311735dd-c418-42b1-9019-b3f175959489\")\n\n// Input: ?\n= rule!CMGT_EmailBody( replacementParams: pv!emailSettingMap[tp!instanceindex].replacementParams, document: pv!emailSettingMap[tp!instanceindex].document)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_33778": {
      "name": "CMGT_UTIL_SetRecordFields",
      "type": "Expression Rule",
      "sail_code": "/*\nFuture enhancement ideas:\n1 Parameter to skip update if the field isn't present in the object\n--- This would also apply to nested fields, as in, don't set a relationship field if the entire relationship object isn't there because it will instantiate it\n2 Parameter to overwrite based on more enhanced logic\n3 Allow list types for the `value`\n4 Allow reuse to apply setting metadata for nested relationships, but using their own set metadata rule\n--- e.g. CMGT_Entity_SetMetaData can be used in both the Case process and the individual Entity process\n*/\nif(\n  a!isNullOrEmpty(ri!record),\n  ri!record,\n  a!localVariables(\n    local!allUpdates: rule!CMGT_UTIL_RejectBlank(a!flatten(\n      {\n        ri!alwaysOverwrite,\n        ri!childRelationships,\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: ri!neverOverwrite,\n          expression: #\"urn:appian:function:v1:a:update\"(\n            fv!item,\n            \"value\",\n            /*Specifically using this instead of a!defaultValue() to account for the `{null}` value*/\n            if(\n              rule!CMGT_UTIL_IsBlank(ri!record[fv!item.field]),\n              fv!item.value,\n              ri!record[fv!item.field]\n            )\n          )\n        )\n      }\n    )),\n    local!onlyChangedUpdates: a!flatten(\n      #\"SYSTEM_SYSRULES_forEach\"(\n        items: local!allUpdates,\n        expression: if(\n          or(\n            tostring(ri!record[fv!item.field]) = tostring(fv!item.value),\n            toboolean(fv!item.applyWhen) = false\n          ),\n          {},\n          fv!item\n        )\n      )\n    ),\n    if(\n      a!isNullOrEmpty(local!onlyChangedUpdates),\n      ri!record,\n      #\"urn:appian:function:v1:a:update\"(\n        data: ri!record,\n        index: local!onlyChangedUpdates.field,\n        value: local!onlyChangedUpdates.value\n      )\n    )\n  )\n)"
    },
    "_a-0000ecbe-e702-8000-9cf8-011c48011c48_3232413": {
      "name": "CMGT_EML_TRI_EmailSettingMap_Reply",
      "type": "Expression Rule",
      "sail_code": "if(\n  or(\n    a!isNullOrEmpty(\n      ri!message[recordType!CMGT_EML_TRI_Message.messageRecipients]\n    ),\n    a!isNullOrEmpty(\n      ri!message[recordType!CMGT_EML_TRI_Message.messageText.message]\n    )\n  ),\n  {},\n  a!map(\n    senderEmail: cons!CMGT_EML_TRI_MAILBOX_EMAIL_ADDRESS,\n    recipientEmailAddress: toemailaddress(\n      rule!CMGT_UTIL_Filter(\n        records: ri!message[recordType!CMGT_EML_TRI_Message.messageRecipients],\n        field: recordType!CMGT_EML_TRI_MessageRecipient.isSender,\n        value: false\n      )[recordType!CMGT_EML_TRI_MessageRecipient.recipientEmail]\n    ),\n    replacementParams: rule!CMGT_EML_TRI_Reply_ReplacementParamsMap(\n      messageText: ri!message[recordType!CMGT_EML_TRI_Message.messageText],\n      threadUUID: ri!thread[recordType!CMGT_EML_TRI_Thread.threadUuid],\n      threadMessages: rule!CMGT_EML_TRI_FormatThreadMessagesForReply(\n        threadId: ri!thread[recordType!CMGT_EML_TRI_Thread.threadId],\n        currentMessageId: ri!message[recordType!CMGT_EML_TRI_Message.messageId]\n      )\n    ),\n    subject: #\"urn:appian:translation-string:v1:affa3573-d193-432b-8183-a9d900e67ef6\"(\n      #\"urn:appian:translation-variable:v1:d75f6ad1-243f-4ff9-b512-897f204e627e\": ri!thread[recordType!CMGT_EML_TRI_Thread.subject]\n    ),\n    document: cons!CMGT_EML_TRI_EMAIL_TEMPLATE_REPLY\n  )\n)"
    },
    "_a-0000e882-ff68-8000-9bb2-011c48011c48_34992-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_QR_getMessages",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_EML_TRI_Message,\n  filters: {\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.threadId,\n      operator: \"in\",\n      value: ri!threadIds,\n      applywhen: rule!CMGT_UTIL_IsNotBlank(ri!threadIds)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.createdBy,\n      operator: \"includes\",\n      value: ri!createdBy,\n      applywhen: rule!CMGT_UTIL_IsNotBlank(ri!createdBy)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.messageId,\n      operator: \"in\",\n      value: ri!messageIds,\n      applywhen: rule!CMGT_UTIL_IsNotBlank(ri!messageIds)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.messageId,\n      operator: \"not in\",\n      value: ri!excludeMessageIds,\n      applywhen: rule!CMGT_UTIL_IsNotBlank(ri!excludeMessageIds)\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.messageRecipients.recipient,\n      operator: \"in\",\n      value: ri!recipients\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_Message.isActive,\n      operator: \"in\",\n      value: { a!defaultValue(ri!isActive, true) }\n    ),\n    ri!additionalFilters\n  },\n  logicalExpressions: { ri!additionalLogicalExpressions },\n  fields: {\n    ri!fields,\n    recordType!CMGT_EML_TRI_Message.messageText\n  },\n  returnType: ri!returnType,\n  executeWhen: ri!executeWhen,\n  triggerRefresh: ri!triggerRefresh,\n  sort: ri!sort,\n  pagingInfo: ri!pagingInfo,\n  relatedRecordData: ri!relatedRecordData,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000ea26-2ced-8000-9bf1-011c48011c48_583935": {
      "name": "CMGT_EmailBody",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_FillDocumentTemplate(\n  document: a!defaultValue(\n    value: ri!document,\n    default: cons!CMGT_DOC_EMAIL_BASE_TEMPLATE\n  ),\n  replacementParams: { ri!replacementParams }\n)"
    },
    "_a-0000e87b-f03a-8000-9bac-011c48011c48_31514-cmgt_eml_tri": {
      "name": "CMGT_EML_TRI_QR_GetMessageRecipients",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_EML_TRI_MessageRecipient,\n  returnType: ri!returnType,\n  executeWhen: ri!executeWhen,\n  triggerRefresh: ri!triggerRefresh,\n  filters: {\n    ri!additionalFilter,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_MessageRecipient.message.threadId,\n      operator: \"in\",\n      value: ri!threadIds\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_MessageRecipient.messageId,\n      operator: \"in\",\n      value: ri!messageIds\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_MessageRecipient.recipient,\n      operator: \"in\",\n      value: ri!recipients\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_MessageRecipient.recipient,\n      operator: \"not in\",\n      value: ri!recipientsToIgnore\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_EML_TRI_MessageRecipient.message.isActive,\n      operator: \"in\",\n      value: { a!defaultValue(ri!isActive, true) }\n    ),\n    \n  },\n  logicalExpressions: { ri!additionalLogicalExpressions },\n  fields: ri!fields,\n  relatedRecordData: ri!relatedRecordData,\n  sort: ri!sort,\n  pagingInfo: ri!pagingInfo,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    }
  }
}