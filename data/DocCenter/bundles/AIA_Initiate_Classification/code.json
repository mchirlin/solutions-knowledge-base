{
  "_metadata": {
    "bundle_id": "AIA_Initiate_Classification"
  },
  "objects": {
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92467": {
      "name": "AIA_MTR_ClassificationInstanceClassifiedWithErrors",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000eec9-5676-8000-9c92-011c48011c48_179359": {
      "name": "AIA_MTR_ConfidenceThresholdDisabled",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000eeb2-df20-8000-9bfe-011c48011c48_154565": {
      "name": "AIA_MTR_InstanceValidationAiRuleOccurance",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_184766": {
      "name": "AIA_PLG_WriteFile",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!result: writefile(\n    ri!content,\n    ri!name,\n    ri!extension,\n    ri!folder,\n    ri!description\n  ),\n  if(\n    local!result.success,\n    local!result,\n    fn!error(local!result.error)\n  )\n)"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180846": {
      "name": "AIA_MTR_ClassificationModelCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000eeca-c121-8000-9cab-011c48011c48_182002": {
      "name": "AIA_MTR_ClassificationModelVersionRestore",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180860": {
      "name": "AIA_MTR_ClassificationInstanceCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180853": {
      "name": "AIA_MTR_ExtractionInstanceCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ef46-744c-8000-9fed-011c48011c48_483964": {
      "name": "AIA_MTR_ModelTestRunInitiated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180874": {
      "name": "AIA_MTR_ClassificationInstanceReconciled",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ef46-744c-8000-9fed-011c48011c48_483991": {
      "name": "AIA_MTR_ModelTestSuiteUpdated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ef55-14e0-8000-a041-011c48011c48_505670": {
      "name": "AIA_MTR_MultipleOutputsClassificationInstanceReconciled",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180834": {
      "name": "AIA_MTR_ExtractionModelCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92592": {
      "name": "AIA_MTR_ExtractionInstanceValidationIgnore",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000edb0-f009-8000-9ba8-011c48011c48_97164": {
      "name": "AIA_UTIL_isBlank",
      "type": "Expression Rule",
      "sail_code": "cast(\n  'type!{http://www.appian.com/ae/types/2009}Boolean',\n  length(a!flatten(ri!value)) = 0\n)"
    },
    "_a-0000ed74-17c4-8000-9c8d-011c48011c48_403026": {
      "name": "SHRD_CleanForFilename",
      "type": "Expression Rule",
      "sail_code": "stripwith(substitute(\n  substitute(\n    left(ri!input, 25),\n    char(10),\n    \" \"\n  ),\n  char(13),\n  \"\"\n), \"\\/;:\"\"|?'><*]\"),"
    },
    "_a-0000ef55-14e0-8000-a041-011c48011c48_505575": {
      "name": "AIA_MTR_MultipleOutputsClassificationModelVersionCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ef46-744c-8000-9fed-011c48011c48_483943": {
      "name": "AIA_MTR_ModelTestSuiteCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92585": {
      "name": "AIA_MTR_ExtractionInstanceValidationAccept",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180867": {
      "name": "AIA_MTR_ExtractionInstanceReconciled",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92474": {
      "name": "AIA_MTR_ClassificationInstanceError",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "0009ec67-6bfa-8000-01c2-7f0000014e7a": {
      "name": "AIA Initiate Classification",
      "type": "Process Model",
      "sail_code": "// Output: ?\na!defaultValue(\n  pv!convertedDoc,\n  pv!inputDoc\n)\n\n// Input: ?\n=pv!ClassificationInstance\n\n// Input: ?\n=recordType!AIA Classification Instance\n\n// Output: ?\nAC!RecordsUpdated\n\n// Input: ?\n=rule!AIA_NameFromInstance( Instance: pv!ClassificationInstance)\n\n// Output: ?\nappian:record-field:v1:bba819fb-55a0-47e1-bb74-e385f32b6916/c6c41115-e9db-4f36-8cd4-d12dea21a901\"]:ac!NewFolder\n\n// Output: ?\nrule!AIA_Classification_CreateUpdateInstance(\n  inputDoc: pv!inputDoc,\n  convertedDoc: pv!convertedDoc,\n  modelVersionId: pv!ModelVersion[recordType!AIA Classification Model Version.modelVersionId],\n  initiator: pp!initiator,\n  isDocumentTestCase:pv!isDocumentTestCase,\n  ClassificationInstance: pv!ClassificationInstance\n)\n\n// Input: ?\n=pv!ClassificationInstance\n\n// Input: ?\n=recordType!AIA Classification Instance\n\n// Output: ?\nAC!RecordsUpdated\n\n// Input: ?\n=pv!ClassificationInstance\n\n// Input: ?\n=pv!inputDoc\n\n// Input: ?\n=pv!inputText\n\n// Output: ?\nac!ProcessInfo.pv.convertedDocument\n\n// Output: ?\nac!ProcessInfo.pv.ClassificationInstance\n\n// Input: ?\n=rule!AIA_LogMetric( name: cons!AIA_MTR_CLASSIFICATION_INSTANCE_CREATED)\n\n// Output: ?\nrule!AIA_Classification_CreateUpdateInstance(\n  inputDoc: pv!inputDoc,\n  inputText: pv!inputText,\n  initiator: pp!initiator,\n  isDocumentTestCase:pv!isDocumentTestCase\n)\n\n// Output: ?\nrule!AIA_QR_getClassificationModelVersion(\n  returnType: \"RECORD_BY_ID\",\n  modelVersionId: if(\n    and(\n      a!isNotNullOrEmpty(pv!modelKey),\n      pv!modelVersionId < 1\n    ),\n    rule!AIA_Classification_GetLatestModelVersionIdByKey(modelKey: pv!modelKey),\n    pv!modelVersionId\n  ),\n  fields: #\"SYSTEM_SYSRULES_selectionFields\"(\n    allFieldsFromRecordType: {\n      recordType!AIA Classification Model Version,\n      recordType!AIA Classification Model Version.categories,\n      recordType!AIA Classification Model Version.examples,\n      recordType!AIA Classification Model Version.model\n    },\n    includeRealTimeCustomFields: false\n  ),\n  relatedRecordData: #\"SYSTEM_SYSRULES_relatedRecordData\"(\n    relationship: recordType!AIA Classification Model Version.categories,\n    sort: #\"SYSTEM_SYSRULES_sortInfo\"(\n      field: recordType!AIA Classification Model Version Category.sortOrder,\n      ascending: true\n    )\n  )\n)\n\n// Input: ?\n=if( pv!ModelVersion[recordType!AIA Classification Model Version.allowMultipleOutputs], rule!AIA_LogMetric( name: cons!AIA_MTR_MULTIPLE_OUTPUTS_CLASSIFICATION_INSTANCE_CREATED ), null)\n\n// Output: ?\npv!ClassificationInstance[recordType!AIA Classification Instance.id]\n\n// Output: ?\nappian:record-relationship:v1:bba819fb-55a0-47e1-bb74-e385f32b6916/35ad02e9-44ce-4800-8e27-c5e3373fb868\"]:pv!ModelVersion"
    },
    "_a-0000eea3-15ee-8000-9bd4-011c48011c48_138762": {
      "name": "AIA_UTIL_SetRecordFields",
      "type": "Expression Rule",
      "sail_code": "/*\nFuture enhancement ideas:\n1 Parameter to skip update if the field isn't present in the object\n--- This would also apply to nested fields, as in, don't set a relationship field if the entire relationship object isn't there because it will instantiate it\n2 Parameter to overwrite based on more enhanced logic\n3 Allow list types for the `value`\n4 Allow reuse to apply setting metadata for nested relationships, but using their own set metadata rule\n--- e.g. CCM_Comment_SetMetaData can be used in both the Claim process and the individual Comment process\n*/\nif(\n  a!isNullOrEmpty(ri!record),\n  ri!record,\n  a!localVariables(\n    local!allUpdates: rule!AIA_UTIL_rejectNullValuesFromArray(a!flatten(\n      {\n        ri!alwaysOverwrite,\n        ri!childRelationships,\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: ri!neverOverwrite,\n          expression: #\"urn:appian:function:v1:a:update\"(\n            fv!item,\n            \"value\",\n            /*Specifically using this instead of a!defaultValue() to account for the `{null}` value*/\n            if(\n              rule!AIA_UTIL_isBlank(ri!record[fv!item.field]),\n              fv!item.value,\n              ri!record[fv!item.field]\n            )\n          )\n        )\n      }\n    )),\n    local!onlyChangedUpdates: a!flatten(\n      #\"SYSTEM_SYSRULES_forEach\"(\n        items: local!allUpdates,\n        expression: if(\n          or(\n            tostring(ri!record[fv!item.field]) = tostring(fv!item.value),\n            toboolean(fv!item.applyWhen) = false\n          ),\n          {},\n          fv!item\n        )\n      )\n    ),\n    if(\n      a!isNullOrEmpty(local!onlyChangedUpdates),\n      ri!record,\n      #\"urn:appian:function:v1:a:update\"(\n        data: ri!record,\n        index: local!onlyChangedUpdates.field,\n        value: local!onlyChangedUpdates.value\n      )\n    )\n  )\n)"
    },
    "_a-0000ee52-8983-8000-9ba6-011c48011c48_27887": {
      "name": "AIA_GetDocumentMetadata",
      "type": "Expression Rule",
      "sail_code": "try(\n  a!match(\n    value: lower(document(ri!document, \"extension\")),\n    equals: \"pdf\",\n    then: getpdfmetadata(document: ri!document),\n    equals: \"eml\",\n    then: a!map(\n      pageCount: try(\n        tointeger(\n          len(\n            #\"SYSTEM_SYSRULES_fromJson_v1\"(reademlfile(ri!document)).body\n          ) / cons!AIA_EML_PAGE_CHAR_COUNT\n        ),\n        1\n      )\n    ),\n    default: a!map(pageCount: 1)\n  ),\n  a!map(pageCount: 1)\n)"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92571": {
      "name": "AIA_MTR_ExtractionInstanceAiReview",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ef39-a43c-8000-9ecf-011c48011c48_429114": {
      "name": "AIA_QR_getClassificationModelVersion",
      "type": "Expression Rule",
      "sail_code": "rule!SHRD_UTIL_QueryRecord(\n  recordType: recordType!AIA Classification Model Version,\n  fields: {\n    ri!fields\n  },\n  returnType: ri!returnType,\n  executeWhen: ri!executeWhen,\n  relatedRecordData: ri!relatedRecordData,\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  identifier: ri!modelVersionId,\n  filters: {\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Classification Model Version.modelVersionId,\n      operator: \"=\",\n      value: ri!modelVersionId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Classification Model Version.modelId,\n      operator: \"=\",\n      value: ri!modelId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Classification Model Version.status,\n      operator: \"=\",\n      value: ri!status\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!AIA Classification Model Version.model.key,\n      operator: \"=\",\n      value: ri!modelKey\n    ),\n    ri!additionalFilters\n  }\n)"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92578": {
      "name": "AIA_MTR_ExtractionModelVersionAiReview",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_36163": {
      "name": "SHRD_UTIL_QueryRecord",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!maxBatchSize: 5000,\n  /*Chosen return type*/\n  local!returnType: a!defaultValue(ri!returnType, \"OBJECT_ARRAY\"),\n  /*Determine the query parameters to use by the return type*/\n  local!queryParams: a!match(\n    value: local!returnType,\n    equals: \"OBJECT_ARRAY\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        #\"urn:appian:function:v1:a:listtype?okey=a!listType\"(ri!recordType),\n        'type!{http://www.appian.com/ae/types/2009}Map?list'\n      ),\n      fetchTotalCount: false,\n      isArray: true,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          local!maxBatchSize\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"SINGLE_OBJECT\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        ri!recordType,\n        'type!{http://www.appian.com/ae/types/2009}Map'\n      ),\n      fetchTotalCount: false,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"RECORD_BY_ID\",\n    then: a!map(\n      castToType: ri!recordType,\n      fetchTotalCount: false,\n      isArray: false,\n      queryRecordByIdentifier: true,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"DATA_SUBSET\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}DataSubset',\n      fetchTotalCount: true,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: a!defaultValue(ri!pagingInfo.startIndex, 1),\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          local!maxBatchSize\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"TOTAL_COUNT\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}Integer',\n      fetchTotalCount: true,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(startIndex: 1, batchSize: 0)\n    ),\n    default: fn!error(\n      \"Invalid returnType, must be one of: OBJECT_ARRAY, SINGLE_OBJECT, RECORD_BY_ID, DATA_SUBSET, TOTAL_COUNT\"\n    )\n  ),\n  if(\n    /*Early exit for skip execution*/\n    ri!executeWhen = false,\n    cast(\n      local!queryParams.castToType,\n      if(local!queryParams.isArray, {}, null)\n    ),\n    a!localVariables(\n      /*Run the query*/\n      local!queryResult: a!refreshVariable(\n        value: if(\n          local!queryParams.queryRecordByIdentifier,\n          #\"SYSTEM_SYSRULES_queryRecordByIdentifier\"(\n            recordType: ri!recordType,\n            identifier: index({ri!identifier},1,null),\n            /*If fields is sent in using a!selectionFields(), then adding the fields contained in ri!relatedRecordData will break the query*/\n            fields: reject(\n              a!isNullOrEmpty,\n              a!flatten(\n                {\n                  ri!fields,\n                  if(\n                    or(\n                      typeof(ri!fields) = typeof(#\"SYSTEM_SYSRULES_selectionFields\"()),\n                      typeof(ri!fields) = typeof({#\"SYSTEM_SYSRULES_selectionFields\"()})\n                    ),\n                    {},\n                    index(ri!relatedRecordData, \"relationship\", {})\n                  )\n                }\n              )\n            ),\n            relatedRecordData: ri!relatedRecordData\n          ),\n          #\"SYSTEM_SYSRULES_queryRecordType_v1\"(\n            recordType: ri!recordType,\n            fields: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              reject(\n                a!isNullOrEmpty,\n                a!flatten(\n                  {\n                    ri!fields,\n                    index(ri!relatedRecordData, \"relationship\", {})\n                  }\n                )\n              ),\n              #\"SYSTEM_SYSRULES_aggregationFields\"(\n                groupings: #\"SYSTEM_SYSRULES_forEach\"(\n                  items: ri!groupByFields,\n                  expression: #\"SYSTEM_SYSRULES_grouping\"(field: fv!item, alias: tostring(fv!item))\n                ),\n                measures: #\"SYSTEM_SYSRULES_measure\"(\n                  field: ri!groupByFields[1],\n                  function: \"COUNT\",\n                  alias: \"count\"\n                )\n              )\n            ),\n            filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n              operator: \"AND\",\n              ignoreFiltersWithEmptyValues: true,\n              logicalExpressions: {\n                ri!logicalExpressions,\n                if(\n                  and(\n                    a!isNotNullOrEmpty(ri!searchFields),\n                    a!isNotNullOrEmpty(ri!searchTerm)\n                  ),\n                  #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                    operator: \"AND\",\n                    logicalExpressions: #\"SYSTEM_SYSRULES_forEach\"(\n                      items: split(trim(ri!searchTerm), \" \"),\n                      expression: a!localVariables(\n                        local!splitSearchTerm: fv!item,\n                        /*   Initiate filter for each field by the value provided in searchTerm   */\n                        #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                          operator: \"OR\",\n                          filters: #\"SYSTEM_SYSRULES_forEach\"(\n                            items: ri!searchFields,\n                            expression: #\"SYSTEM_SYSRULES_queryFilter\"(\n                              field: fv!item,\n                              operator: \"includes\",\n                              value: local!splitSearchTerm\n                            )\n                          )\n                        )\n                      )\n                    )\n                  ),\n                  {}\n                )\n              },\n              filters: ri!filters\n            ),\n            pagingInfo: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              local!queryParams.pagingInfo,\n              #\"urn:appian:function:v1:a:update\"(\n                local!queryParams.pagingInfo,\n                \"sort\",\n                null\n              )\n            ),\n            fetchTotalCount: local!queryParams.fetchTotalCount,\n            relatedRecordData: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              ri!relatedRecordData,\n              {}\n            )\n          )\n        ),\n        refreshOnVarChange: ri!triggerRefresh,\n        refreshAfter: { \"RECORD_ACTION\" }\n      ),\n      /*Format the output*/\n      local!output: a!match(\n        value: local!returnType,\n        equals: \"OBJECT_ARRAY\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"data\",{})\n        ),\n        equals: \"SINGLE_OBJECT\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"data\",{})\n        ),\n        equals: \"RECORD_BY_ID\",\n        /*do not need to cast for queryRecordByIdentifier*/\n        then: local!queryResult,\n        equals: \"DATA_SUBSET\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult\n        ),\n        equals: \"TOTAL_COUNT\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"totalCount\",{})\n        ),\n        default: null\n      ),\n      local!output\n    )\n  )\n)"
    },
    "_a-0000ec44-cb49-8000-9be6-011c48011c48_82400": {
      "name": "AIA_GetPageCount",
      "type": "Expression Rule",
      "sail_code": "rule!AIA_GetDocumentMetadata(\n  document: ri!document\n).pageCount"
    },
    "_a-0000ef55-14e0-8000-a041-011c48011c48_505631": {
      "name": "AIA_MTR_MultipleOutputsClassificationInstanceCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ec5c-9eda-8000-9bec-011c48011c48_119664": {
      "name": "AIA_Classification_GetLatestModelVersionIdByKey",
      "type": "Expression Rule",
      "sail_code": "index(\n  rule!AIA_QR_getClassificationModelVersion(\n    returnType: \"SINGLE_OBJECT\",\n    fields: {\n      recordType!AIA Classification Model Version.modelVersionId\n    },\n    modelKey: ri!modelKey,\n    modelId: ri!modelId,\n    status: cons!AIA_MODEL_VERSION_STATUS_PUBLISHED,\n    sort: #\"SYSTEM_SYSRULES_sortInfo\"(\n      field: recordType!AIA Classification Model Version.versionId,\n      ascending: false\n    )\n  ),\n  recordType!AIA Classification Model Version.modelVersionId,\n  tointeger(null)\n)"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92481": {
      "name": "AIA_MTR_ExtractionInstanceExtractedWithErrors",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92488": {
      "name": "AIA_MTR_ExtractionInstanceError",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000eea3-15ee-8000-9bd4-011c48011c48_137447": {
      "name": "AIA_MTR_ModelVersionConfigureSampling",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000eec9-5676-8000-9c92-011c48011c48_179352": {
      "name": "AIA_MTR_ConfidenceThresholdEnabled",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ec67-5f00-8000-9bf0-011c48011c48_125297": {
      "name": "AIA_Classification_CreateUpdateInstance",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!isStatusEmpty: a!isNullOrEmpty(\n    ri!ClassificationInstance[recordType!AIA Classification Instance.statusId]\n  ),\n  local!statusId: tointeger(if(\n    local!isStatusEmpty,\n    cons!AIA_INSTANCE_STATUS_INITIATED,\n    a!match(\n      value: ri!ClassificationInstance[recordType!AIA Classification Instance.statusId],\n      equals: cons!AIA_INSTANCE_STATUS_RECONCILED_MANUALLY,\n      equals: cons!AIA_INSTANCE_STATUS_RECONCILED_AUTOMATICALLY,\n      equals: cons!AIA_INSTANCE_STATUS_CLASSIFIED,\n      then: fv!value,\n      whenTrue: and(\n        or(\n          fv!value = cons!AIA_INSTANCE_STATUS_INITIATED,\n          a!isNullOrEmpty(fv!value)\n        ),\n        a!isNotNullOrEmpty(ri!responseJson)\n      ),\n      then: cons!AIA_INSTANCE_STATUS_CLASSIFIED,\n      default: fv!value\n    )\n  )),\n  rule!AIA_UTIL_SetRecordFields(\n    record: a!defaultValue(\n      value: ri!ClassificationInstance,\n      default: recordType!AIA Classification Instance()\n    ),\n    neverOverwrite: {\n      a!map(\n        field: recordType!AIA Classification Instance.documentId,\n        value: ri!convertedDoc\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.sourceDocumentId,\n        value: ri!inputDoc\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.inputText,\n        value: ri!inputText\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.modelVersionId,\n        value: ri!modelVersionId\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.createdOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.createdBy,\n        value: ri!initiator\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.pageCount,\n        applyWhen: or(\n          a!isNotNullOrEmpty(ri!ClassificationInstance[recordType!AIA Classification Instance.documentId]),\n          a!isNotNullOrEmpty(ri!convertedDoc)\n        ),\n        value: rule!AIA_GetPageCount(\n          document: a!defaultValue(\n            ri!ClassificationInstance[recordType!AIA Classification Instance.documentId],\n            ri!convertedDoc\n          )\n        )\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.responseDocumentId,\n        value: if(\n          a!isNullOrEmpty(ri!responseJson),\n          null,\n          rule!AIA_PLG_WriteFile(\n            content: ri!responseJson,\n            name: \"response\",\n            extension: \"json\",\n            folder: ri!ClassificationInstance[recordType!AIA Classification Instance.documentFolderId]\n          ).document\n        )\n      )\n    },\n    alwaysOverwrite: {\n      a!map(\n        field: recordType!AIA Classification Instance.modifiedOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.modifiedBy,\n        value: ri!initiator\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.reconciledBy,\n        value: if(\n          local!isStatusEmpty,\n          null,\n          if(\n            contains(\n              {\n                cons!AIA_INSTANCE_STATUS_RECONCILED_AUTOMATICALLY,\n                cons!AIA_INSTANCE_STATUS_RECONCILED_MANUALLY\n              },\n              local!statusId\n            ),\n            a!defaultValue(\n              ri!ClassificationInstance[recordType!AIA Classification Instance.reconciledBy],\n              ri!initiator\n            ),\n            \"\"\n          )\n        )\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.reconciledOn,\n        value: if(\n          local!isStatusEmpty,\n          null,\n          if(\n            contains(\n              {\n                cons!AIA_INSTANCE_STATUS_RECONCILED_AUTOMATICALLY,\n                cons!AIA_INSTANCE_STATUS_RECONCILED_MANUALLY\n              },\n              local!statusId\n            ),\n            a!defaultValue(\n              ri!ClassificationInstance[recordType!AIA Classification Instance.reconciledOn],\n              now()\n            ),\n            \"\"\n          )\n        )\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.testInstance,\n        value: a!defaultValue(\n          if(\n            a!isNullOrEmpty(ri!isDocumentTestCase),\n            ri!ClassificationInstance[recordType!AIA Classification Instance.testInstance],\n            ri!isDocumentTestCase\n          ),\n          false()\n        )\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.statusId,\n        value: local!statusId\n      ),\n      a!map(\n        field: recordType!AIA Classification Instance.isSamplingRequired,\n        value: false,\n        applyWhen: ri!isReconciliation = true()\n      )\n    }\n  )\n)"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92564": {
      "name": "AIA_MTR_ExtractionInstanceFieldAiReview",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000edb0-f009-8000-9ba8-011c48011c48_97176": {
      "name": "AIA_UTIL_rejectNullValuesFromArray",
      "type": "Expression Rule",
      "sail_code": "cast(\n  typeof(ri!array),\n  reject(\n    rule!AIA_UTIL_isBlank(_),\n    a!flatten(ri!array)\n  )\n)"
    },
    "_a-0000eeca-c121-8000-9cab-011c48011c48_181995": {
      "name": "AIA_MTR_ExtractionModelVersionRestore",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee35-0ca2-8000-9ba6-011c48011c48_13646": {
      "name": "AIA_LogMetric",
      "type": "Expression Rule",
      "sail_code": "a!match(\n  value: ri!name,\n  /* Classification Model Created */\n  equals: cons!AIA_MTR_CLASSIFICATION_MODEL_CREATED,\n  then: rule!AIA_MTR_ClassificationModelCreated(),\n  /* Classification Instance Created */\n  equals: cons!AIA_MTR_CLASSIFICATION_INSTANCE_CREATED,\n  then: rule!AIA_MTR_ClassificationInstanceCreated(),\n  /* Classification Instance Reconciled */\n  equals: cons!AIA_MTR_CLASSIFICATION_INSTANCE_RECONCILED,\n  then: rule!AIA_MTR_ClassificationInstanceReconciled(),\n  /* Classification Instance with Validation Errors */\n  equals: cons!AIA_MTR_INSTANCE_STATUS_CLASSIFIED_WITH_ERRORS,\n  then: rule!AIA_MTR_ClassificationInstanceClassifiedWithErrors(),\n  /* Classification Instance with Critical Error */\n  equals: cons!AIA_MTR_INSTANCE_STATUS_CLASSIFICATION_CRITICAL_ERROR,\n  then: rule!AIA_MTR_ClassificationInstanceError(),\n  \n  /* Extraction Model Created */\n  equals: cons!AIA_MTR_EXTRACTION_MODEL_CREATED,\n  then: rule!AIA_MTR_ExtractionModelCreated(),\n  /* Extraction Instance Created */\n  equals: cons!AIA_MTR_EXTRACTION_INSTANCE_CREATED,\n  then: rule!AIA_MTR_ExtractionInstanceCreated(),\n  /* Extraction Instance Reconciled */\n  equals: cons!AIA_MTR_EXTRACTION_INSTANCE_RECONCILED,\n  then: rule!AIA_MTR_ExtractionInstanceReconciled(),\n  /* Extraction Instance with Validation Errors */\n  equals: cons!AIA_MTR_INSTANCE_STATUS_EXTRACTED_WITH_ERRORS,\n  then: rule!AIA_MTR_ExtractionInstanceExtractedWithErrors(),\n  /* Extraction Instance with Critical Error */\n  equals: cons!AIA_MTR_INSTANCE_STATUS_EXTRACTION_CRITICAL_ERROR,\n  then: rule!AIA_MTR_ExtractionInstanceError(),\n  \n  /* Triggered when AI review raises an error (field level) */\n  equals: cons!AIA_MTR_AI_REVIEW_FIELD,\n  then: rule!AIA_MTR_ExtractionInstanceFieldAiReview(),\n  /* Triggered when AI review raises an error (instance level, this instance has 1 or more errors raised by AI review) */\n  equals: cons!AIA_MTR_AI_REVIEW_INSTANCE,\n  then: rule!AIA_MTR_ExtractionInstanceAiReview(),\n  /* Triggered when model is created with AI review turned on OR AI review is turned on for a model */\n  equals: cons!AIA_MTR_AI_REVIEW_MODEL_VERSION,\n  then: rule!AIA_MTR_ExtractionModelVersionAiReview(),\n  /* Triggered when user clicks accept */\n  equals: cons!AIA_MTR_AI_REVIEW_ACCEPT,\n  then: rule!AIA_MTR_ExtractionInstanceValidationAccept(),\n  /* Triggered when user clicks ignored */\n  equals: cons!AIA_MTR_AI_REVIEW_IGNORE,\n  then: rule!AIA_MTR_ExtractionInstanceValidationIgnore(),\n  /*triggered when spot check ocnfigured*/\n  equals: cons!AIA_MTR_SPOT_CHECK_MODEL_VERSION,\n  then: rule!AIA_MTR_ModelVersionConfigureSampling(),\n  /* Triggered when a model validation rule of type AI validation creates a validation instance */\n  equals: cons!AIA_MTR_AI_VALIDATION_RULE_OCCURANCE,\n  then: rule!AIA_MTR_InstanceValidationAiRuleOccurance(),\n  /*Confidence Threshold Enabled*/\n  equals: cons!AIA_MTR_CONFIDENCE_THRESHOLD_ENABLED,\n  then: rule!AIA_MTR_ConfidenceThresholdEnabled(),\n  /*Confidence Threshold Disabled*/\n  equals: cons!AIA_MTR_CONFIDENCE_THRESHOLD_DISABLED,\n  then: rule!AIA_MTR_ConfidenceThresholdDisabled(),\n  /*Extraction Model Version Restored*/\n  equals: cons!AIA_MTR_EXTRACTION_MODEL_VERSION_RESTORE,\n  then: rule!AIA_MTR_ExtractionModelVersionRestore(),\n  /*Classification Model Version Restored*/\n  equals: cons!AIA_MTR_CLASSIFICATION_MODEL_VERSION_RESTORE,\n  then: rule!AIA_MTR_ClassificationModelVersionRestore(),\n  /*Model Test Suite Created*/\n  equals: cons!AIA_MTR_MODEL_TEST_SUITE_CREATED,\n  then: rule!AIA_MTR_ModelTestSuiteCreated(),\n  /*Model Test Suite Updated*/\n  equals: cons!AIA_MTR_MODEL_TEST_SUITE_UPDATED,\n  then: rule!AIA_MTR_ModelTestSuiteUpdated(),\n  /*Model Test Run Initiated*/\n  equals: cons!AIA_MTR_MODEL_TEST_RUN_INITIATED,\n  then: rule!AIA_MTR_ModelTestRunInitiated(),\n  /*Classification Model Version Created with Multiple Outputs*/\n  equals: cons!AIA_MTR_MULTIPLE_OUTPUTS_CLASSIFICATION_MODEL_VERSION_CREATED,\n  then: rule!AIA_MTR_MultipleOutputsClassificationModelVersionCreated(),\n  /*Classification Instance Created for a Model Version that Allows Multiple Outputs*/\n  equals: cons!AIA_MTR_MULTIPLE_OUTPUTS_CLASSIFICATION_INSTANCE_CREATED,\n  then: rule!AIA_MTR_MultipleOutputsClassificationInstanceCreated(),\n  /*Classification Instance Reconciled for a Model Version that Allows Multiple Outputs*/\n  equals: cons!AIA_MTR_MULTIPLE_OUTPUTS_CLASSIFICATION_INSTANCE_RECONCILED,\n  then: rule!AIA_MTR_MultipleOutputsClassificationInstanceReconciled(),\n  default: null\n)"
    },
    "_a-0000ecf1-11b9-8000-9c4e-011c48011c48_217904": {
      "name": "AIA_NameFromInstance",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!fields: if(\n    runtimetypeof(ri!Instance) = typeof(recordType!AIA Extraction Instance()),\n    a!map(\n      documentId: recordType!AIA Extraction Instance.documentId,\n      sourceDocumentId: recordType!AIA Extraction Instance.sourceDocumentId,\n      inputText: recordType!AIA Extraction Instance.inputText,\n    ),\n    a!map(\n      documentId: recordType!AIA Classification Instance.documentId,\n      sourceDocumentId: recordType!AIA Classification Instance.sourceDocumentId,\n      inputText: recordType!AIA Classification Instance.inputText,\n    ),\n  ),\n  rule!SHRD_CleanForFilename(\n    input: if(\n      and(\n        a!isNullOrEmpty(ri!Instance[local!fields.documentId]),\n        a!isNullOrEmpty(ri!Instance[local!fields.sourceDocumentId]),\n        a!isNotNullOrEmpty(ri!Instance[local!fields.inputText])\n      ),\n      substitute(\n        substitute(\n          left(ri!Instance[local!fields.inputText], 25),\n          char(10),\n          \" \"\n        ),\n        char(13),\n        \"\"\n      ),\n      document(\n        a!defaultValue(\n          ri!Instance[local!fields.documentId],\n          ri!Instance[local!fields.sourceDocumentId]\n        ),\n        \"name\"\n      )\n    )\n  )\n)"
    }
  }
}