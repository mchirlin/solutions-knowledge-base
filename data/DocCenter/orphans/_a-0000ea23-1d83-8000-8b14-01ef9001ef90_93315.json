{
  "uuid": "_a-0000ea23-1d83-8000-8b14-01ef9001ef90_93315",
  "name": "SHRD_ChoiceRuleValidations",
  "type": "Expression Rule",
  "description": "Returns error if invalid choice rule",
  "sail_code": "reject(\n  fn!isnull,\n  a!flatten(\n    {\n      a!localVariables(\n        local!rule: a!refreshVariable(\n          value: getrulereferencebyname(\n            index(\n              ri!rule,\n              \"name\",\n              null\n            )\n          ),\n          refreshAlways: true\n        ),\n        if(\n          a!isNullOrEmpty(\n            local!rule\n          ),\n          null,\n          try(\n            a!localVariables(\n              local!choices: a!refreshVariable(\n                value: local!rule(),\n                refreshAlways: true\n              ),\n              {\n                if(\n                  length(\n                    local!choices\n                  ) = 0,\n                  \"Rule must return more than 0 results\",\n                  null\n                ),\n                if(\n                  typeof(\n                    local!choices\n                  ) <> #\"urn:appian:function:v1:a:listtype?okey=a!listType\"(\n                    typeof(\n                      index(\n                        local!choices,\n                        1,\n                        null\n                      )\n                    )\n                  ),\n                  \"Rule must return list\",\n                  null\n                ),\n                if(\n                  and(\n                    or(\n                      typeof(\n                        index(\n                          local!choices,\n                          1,\n                          null\n                        )\n                      ) = 'type!{http://www.appian.com/ae/types/2009}Dictionary',\n                      typeof(\n                        index(\n                          local!choices,\n                          1,\n                          null\n                        )\n                      ) = 'type!{http://www.appian.com/ae/types/2009}Map'\n                    ),\n                    or(\n                      a!isNullOrEmpty(\n                        index(\n                          index(\n                            local!choices,\n                            1,\n                            null\n                          ),\n                          \"label\",\n                          null\n                        )\n                      ),\n                      a!isNullOrEmpty(\n                        index(\n                          index(\n                            local!choices,\n                            1,\n                            null\n                          ),\n                          \"value\",\n                          null\n                        )\n                      )\n                    )\n                  ),\n                  \"Rule returning List of Dictionary/Map must contains both keys of \"\"label\"\" and \"\"value\"\"\",\n                  null\n                )\n              }\n            ),\n            \"Rule must take in no parameters\"\n          )\n        )\n      )\n    }\n  )\n)",
  "calls": [
    {
      "name": "SHRD_ChoicesRuleRefToDictionary",
      "type": "Expression Rule",
      "dep_type": "CALLS"
    }
  ],
  "called_by": []
}