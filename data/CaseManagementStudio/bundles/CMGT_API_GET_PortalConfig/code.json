{
  "_metadata": {
    "bundle_id": "CMGT_API_GET_PortalConfig"
  },
  "objects": {
    "65a371c4-0747-4b09-8992-169d2a052461": {
      "name": "CMGT_API_GET_PortalConfig",
      "type": "Web API",
      "sail_code": "a!localVariables(\n  local!brandingMap: rule!CMGT_UTIL_Portal_LoadBrandingMap(),\n  /*Since document objects cast to JSON turn into {id: _} objects, we are converting to integers before passing over portal*/\n  local!brandingMapUpdate: reduce(\n    #\"urn:appian:function:v1:a:update\"(_, _, _),\n    local!brandingMap,\n    merge(\n      a!keys(local!brandingMap),\n      #\"SYSTEM_SYSRULES_forEach\"(\n        items: local!brandingMap[a!keys(local!brandingMap)],\n        expression: if(\n          runtimetypeof(fv!item) = 'type!{http://www.appian.com/ae/types/2009}CollaborationDocument',\n          tointeger(fv!item),\n          fv!item\n        )\n      )\n    )\n  ),\n  local!config: a!map(\n    brandingMap: local!brandingMapUpdate,\n    urlInfo: rule!CMGT_UTIL_GetPortalURL()\n  ),\n  #\"SYSTEM_SYSRULES_httpResponse_v1\"(\n    statusCode: 200,\n    headers: {\n      #\"SYSTEM_SYSRULES_httpHeader\"(\n        name: \"Content-Type\",\n        value: \"application/json\"\n      )\n    },\n    body: #\"SYSTEM_SYSRULES_toJson_v1\"(local!config)\n  )\n)"
    },
    "_a-0000ea0a-c1f5-8000-9be3-011c48011c48_427386": {
      "name": "CMGT_UTIL_Portal_LoadBrandingMap",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_MergeMaps(\n  map1: rule!CMGT_UTIL_LoadBrandingMap(),\n  map2: a!localVariables(\n    local!portalBranding: getbrandingconfig(\n      cons!CMGT_DOC_PORTAL_DEFAULT_BRANDING_CONFIG,\n      true\n    ),\n    local!output: reduce(\n      #\"urn:appian:function:v1:a:update\"(_, _, _),\n      a!map(),\n      merge(\n        {\n          local!portalBranding.defaultBranding.key,\n          local!portalBranding.customBranding.key\n        },\n        {\n          local!portalBranding.defaultBranding.value,\n          local!portalBranding.customBranding.value\n        }\n      )\n    ),\n    local!output\n  )\n)"
    },
    "_a-0000e9ca-3659-8000-9bb8-011c48011c48_145648": {
      "name": "CMGT_UTIL_GetSiteUrl",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!authedPath: cast(\n    'type!{http://www.appian.com/ae/types/2009}Text',\n    extract(linktodocument(0, \"doc\"), \"\"\"\", \"/doc/\")\n  ),\n  local!subdomainWithDomain: extract(local!authedPath, \"//\", \"/suite\")[1],\n  local!subdomain: split(local!subdomainWithDomain, \".\")[1],\n  a!map(\n    subdomain: local!subdomain,\n    authedPath: local!authedPath,\n    subdomainWithDomain: local!subdomainWithDomain\n  )\n)"
    },
    "8af695e2-f3e1-4fe7-9755-ff66a47ce843": {
      "name": "CMGT_UTIL_MergeMaps",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!value1_keyed: if(\n    isnull(ri!key),\n    ri!map1,\n    index(ri!map1, ri!key, null)\n  ),\n  local!value2_keyed: if(\n    isnull(ri!key),\n    ri!map2,\n    index(ri!map2, ri!key, null)\n  ),\n  local!newValue: if(\n    and(\n      runtimetypeof(local!value1_keyed) = 'type!{http://www.appian.com/ae/types/2009}Map',\n      runtimetypeof(local!value2_keyed) = 'type!{http://www.appian.com/ae/types/2009}Map'\n    ),\n    reduce(\n      rule!CMGT_UTIL_MergeMaps(\n        previous: _,\n        key: _,\n        map1: local!value1_keyed,\n        map2: local!value2_keyed\n      ),\n      a!map(),\n      union(\n        a!keys(local!value1_keyed),\n        a!keys(local!value2_keyed)\n      )\n    ),\n    a!defaultValue(local!value2_keyed, local!value1_keyed)\n  ),\n  if(\n    isnull(ri!key),\n    local!newValue,\n    #\"urn:appian:function:v1:a:update\"(ri!previous, ri!key, local!newValue)\n  )\n)"
    },
    "_a-0000e9f4-1323-8000-9bd3-011c48011c48_267840": {
      "name": "CMGT_UTIL_LoadBrandingMap",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!branding: getbrandingconfig(\n    cons!CMGT_DOC_DEFAULT_BRANDING_CONFIG,\n    true\n  ),\n  local!output: reduce(\n    #\"urn:appian:function:v1:a:update\"(_, _, _),\n    a!map(),\n    merge(\n      {\n        local!branding.defaultBranding.key,\n        local!branding.customBranding.key\n      },\n      {\n        local!branding.defaultBranding.value,\n        local!branding.customBranding.value\n      }\n    )\n  ),\n  local!output\n)"
    },
    "_a-0000ea26-2ced-8000-9bf1-011c48011c48_581570": {
      "name": "CMGT_UTIL_GetPortalURL",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!siteUrlInfo: rule!CMGT_UTIL_GetSiteUrl(),\n  local!portalPath: concat(\n    joinarray(\n      {\n        cons!CMGT_PORTAL_TXT_URL_UUID,\n        cons!CMGT_PORTAL_TXT_PORTAL_URL_ADDRESS_IDENTIFIER\n      },\n      \"-\"\n    )\n  ),\n  local!portalFullDomain: concat(\n    \"https://\",\n    local!siteUrlInfo.subdomain,\n    \".appianportals.com/\",\n    local!portalPath\n  ),\n  #\"urn:appian:function:v1:a:update\"(\n    local!siteUrlInfo,\n    \"portalPath\",\n    local!portalFullDomain\n  )\n)"
    }
  }
}