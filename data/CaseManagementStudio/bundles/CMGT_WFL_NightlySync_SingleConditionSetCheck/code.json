{
  "_metadata": {
    "bundle_id": "CMGT_WFL_NightlySync_SingleConditionSetCheck"
  },
  "objects": {
    "0007ecc4-b2d2-8000-19d7-7f0000014e7a": {
      "name": "CMGT_WFL_NightlySync_SingleConditionSetCheck",
      "type": "Process Model",
      "sail_code": "// Output: ?\nrule!CMGT_WFL_Condition_FieldDetailsAndValidation(conditionSet: pv!conditionSet)\n\n// Output: ?\nrule!CMGT_WFL_ConditionSet_SetMetaData(\n  conditionSets: #\"urn:appian:function:v1:a:update\"(\n    data: pv!conditionSet,\n    index: recordType!CMGT_CFG_ConditionSet.isValid,\n    value: false\n    ),\n  initiator: pp!initiator\n  )\n\n// Input: ?\n=pv!conditionSet\n\n// Input: ?\n=recordType!CMGT_CFG_ConditionSet\n\n// Output: ?\nAC!RecordsUpdated"
    },
    "_a-0000e98b-cfe0-8000-9ba5-011c48011c48_22352": {
      "name": "CMGT_UTIL_QueryRecord",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*Chosen return type*/\n  local!returnType: a!defaultValue(ri!returnType, \"OBJECT_ARRAY\"),\n  /*Determine the query parameters to use by the return type*/\n  local!queryParams: a!match(\n    value: local!returnType,\n    equals: \"OBJECT_ARRAY\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        #\"urn:appian:function:v1:a:listtype?okey=a!listType\"(ri!recordType),\n        'type!{http://www.appian.com/ae/types/2009}Map?list'\n      ),\n      fetchTotalCount: false,\n      isArray: true,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          cons!CMGT_INT_BATCH_SIZE_MAX\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"SINGLE_OBJECT\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        ri!recordType,\n        'type!{http://www.appian.com/ae/types/2009}Map'\n      ),\n      fetchTotalCount: false,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"DATA_SUBSET\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}DataSubset',\n      fetchTotalCount: true,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: a!defaultValue(ri!pagingInfo.startIndex, 1),\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          cons!CMGT_INT_BATCH_SIZE_MAX\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"TOTAL_COUNT\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}Integer',\n      fetchTotalCount: true,\n      isArray: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(startIndex: 1, batchSize: 0)\n    ),\n    default: fn!error(\n      \"Invalid returnType, must be one of: OBJECT_ARRAY, SINGLE_OBJECT, DATA_SUBSET, TOTAL_COUNT\"\n    )\n  ),\n  if(\n    /*Early exit for skip execution*/\n    ri!executeWhen = false,\n    cast(\n      local!queryParams.castToType,\n      if(local!queryParams.isArray, {}, null)\n    ),\n    a!localVariables(\n      /*Run the query*/\n      local!queryResult: a!refreshVariable(\n        value: #\"SYSTEM_SYSRULES_queryRecordType_v2\"(\n          recordType: ri!recordType,\n          fields: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            reject(\n              a!isNullOrEmpty,\n              a!flatten(\n                {\n                  ri!fields,\n                  index(ri!relatedRecordData, \"relationship\", {})\n                }\n              )\n            ),\n            #\"SYSTEM_SYSRULES_aggregationFields\"(\n              groupings: #\"SYSTEM_SYSRULES_forEach\"(\n                items: ri!groupByFields,\n                expression: #\"SYSTEM_SYSRULES_grouping\"(field: fv!item, alias: tostring(fv!item))\n              ),\n              measures: #\"SYSTEM_SYSRULES_measure\"(\n                field: ri!groupByFields[1],\n                function: \"COUNT\",\n                alias: \"count\"\n              )\n            )\n          ),\n          filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n            operator: \"AND\",\n            ignoreFiltersWithEmptyValues: true,\n            logicalExpressions: {\n              ri!logicalExpressions,\n              if(\n                and(\n                  a!isNotNullOrEmpty(ri!searchFields),\n                  a!isNotNullOrEmpty(ri!searchTerm)\n                ),\n                #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                  operator: \"AND\",\n                  logicalExpressions: #\"SYSTEM_SYSRULES_forEach\"(\n                    items: split(trim(ri!searchTerm), \" \"),\n                    expression: a!localVariables(\n                      local!splitSearchTerm: fv!item,\n                      #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                        operator: \"OR\",\n                        filters: #\"SYSTEM_SYSRULES_forEach\"(\n                          items: ri!searchFields,\n                          expression: #\"SYSTEM_SYSRULES_queryFilter\"(\n                            field: fv!item,\n                            operator: \"includes\",\n                            value: local!splitSearchTerm\n                          )\n                        )\n                      )\n                    )\n                  )\n                ),\n                {}\n              )\n            },\n            filters: ri!filters\n          ),\n          pagingInfo: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            local!queryParams.pagingInfo,\n            #\"urn:appian:function:v1:a:update\"(\n              local!queryParams.pagingInfo,\n              \"sort\",\n              null\n            )\n          ),\n          fetchTotalCount: local!queryParams.fetchTotalCount,\n          relatedRecordData: if(\n            a!isNullOrEmpty(ri!groupByFields),\n            ri!relatedRecordData,\n            {}\n          )\n        ),\n        refreshOnVarChange: ri!triggerRefresh,\n        refreshAfter: { \"RECORD_ACTION\" }\n      ),\n      /*Format the output*/\n      local!output: a!match(\n        value: local!returnType,\n        equals: \"OBJECT_ARRAY\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult.data\n        ),\n        equals: \"SINGLE_OBJECT\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult.data\n        ),\n        equals: \"DATA_SUBSET\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult\n        ),\n        equals: \"TOTAL_COUNT\",\n        then: local!queryResult.totalCount,\n        default: null\n      ),\n      local!output\n    )\n  )\n)"
    },
    "_a-0000ecbe-e702-8000-9cf8-011c48011c48_3255145": {
      "name": "CMGT_WFL_Condition_FieldDetailsAndValidation",
      "type": "Expression Rule",
      "sail_code": "if(\n  rule!CMGT_UTIL_IsBlank(ri!conditionSet),\n  {},\n  a!localVariables(\n    local!conditions: ri!conditionSet[recordType!CMGT_CFG_ConditionSet.condition],\n    local!conditionSetCaseType: rule!CMGT_WFL_QR_GetConditionSet(\n      cfgConditionSetUuid: ri!conditionSet[recordType!CMGT_CFG_ConditionSet.parentConditionSetUuid],\n      fields: {\n        recordType!CMGT_CFG_ConditionSet.caseTypeWorkflowTask\n      }\n    ),\n    local!caseType: rule!CMGT_QR_GetCaseType(\n      caseTypeUuId: local!conditionSetCaseType[recordType!CMGT_CFG_ConditionSet.caseTypeWorkflowTask.caseType.uuid]\n    ),\n    local!allAvailableFields: rule!CMGT_returnAvailableFields(\n      caseTypeRecordTypeUuid: local!caseType[recordType!CMGT_CFG_CaseType.uuid],\n      parentCaseTypeRecordTypeUuid: local!caseType[recordType!CMGT_CFG_CaseType.parentUuid],\n      scope: \"TASK\"\n    ),\n    local!fieldDetails: rule!CMGT_UTIL_Filter(\n      records: local!allAvailableFields,\n      fieldValuePairs: {\n        a!map(\n          field: \"uuid\",\n          value: rule!CMGT_ENUM_Automation_ootbCaseRecordFieldsToReject(context: null)\n        )\n      },\n      filterType: \"REJECT\"\n    ),\n    local!validations: a!flatten(rule!CMGT_WFL_Condition_Validations(\n      conditions: local!conditions,\n      fieldDetails: local!fieldDetails\n    )),\n    if(\n      a!isNullOrEmpty(local!validations),\n      {},\n      {\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: local!validations,\n          expression: if(\n            a!isNullOrEmpty(fv!item),\n            {},\n            #\"urn:appian:function:v1:a:update\"(\n              data: ri!conditionSet,\n              index: recordType!CMGT_CFG_ConditionSet.condition,\n              value: #\"urn:appian:function:v1:a:update\"(\n                data: ri!conditionSet[recordType!CMGT_CFG_ConditionSet.condition],\n                index: fv!index,\n                value: fv!item\n              )\n            ),\n            \n          )\n        )\n      }\n    )\n  )\n)"
    },
    "_a-0000ecbe-e702-8000-9cf8-011c48011c48_3255122": {
      "name": "CMGT_WFL_Condition_Validations",
      "type": "Expression Rule",
      "sail_code": "if(\n  /*if there are no conditions return nothing*/\n  a!isNullOrEmpty(ri!conditions),\n  {},\n  /*field json and value details of all the fields configured in all conditions*/\n  #\"SYSTEM_SYSRULES_forEach\"(\n    items: reject(a!isNullOrEmpty, ri!conditions),\n    expression: \n    if(\n      rule!CMGT_Condition_ConditionInvalid(\n        valueJson: fv!item[recordType!CMGT_CFG_Condition.valueJson], \n        fieldDetails: ri!fieldDetails, \n        fieldPathJson: fv!item[recordType!CMGT_CFG_Condition.fieldPathJson]\n      ),\n      #\"urn:appian:function:v1:a:update\"(\n        fv!item,\n        recordType!CMGT_CFG_Condition.isValid,\n        false\n      ),\n      {}\n    )\n  )\n)"
    },
    "97297ba5-64ee-4b21-bf08-5901e134901e": {
      "name": "CMGT_returnAvailableFieldFromFieldPathJson",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!customFieldCode: rule!CMGT_UTIL_CastJsonToMap(\n    jsonText: ri!fieldPathJson\n  ).customFieldCode,\n  local!fieldUuid: rule!CMGT_UTIL_CastJsonToMap(\n    jsonText: ri!fieldPathJson\n  ).uuid,\n index(\n    if(\n      rule!CMGT_UTIL_IsBlank(local!customFieldCode),\n      rule!CMGT_UTIL_Filter(\n        records: ri!availableFields,\n        field: \"uuid\",\n        value: local!fieldUuid\n      ),\n      rule!CMGT_UTIL_Filter(\n        records: ri!availableFields,\n        field: \"customFieldCode\",\n        value: local!customFieldCode\n      )\n    ),\n    1,\n    null\n  )\n)"
    },
    "_a-0000e9d3-70bf-8000-9bbd-011c48011c48_180568": {
      "name": "CMGT_UTIL_IsNotBlank",
      "type": "Expression Rule",
      "sail_code": "not(rule!CMGT_UTIL_IsBlank(ri!input))"
    },
    "_a-0000ecbe-e702-8000-9cf8-011c48011c48_3255108": {
      "name": "CMGT_WFL_QR_GetConditionSet",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_CFG_ConditionSet,\n  returnType: ri!returnType,\n  triggerRefresh: ri!triggerRefresh,\n  executeWhen: ri!executeWhen,\n  logicalExpressions: ri!additionalLogicalExpression,\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_ConditionSet.conditionSetId,\n      operator: \"in\",\n      value: ri!cfgConditionSetId\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_ConditionSet.conditionSetUuid,\n      operator: \"in\",\n      value: ri!cfgConditionSetUuid\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_ConditionSet.isActive,\n      operator: \"=\",\n      value: ri!isActive,\n      applyWhen: a!isNotNullOrEmpty(ri!isActive)\n    )\n  },\n  fields: {\n    ri!fields,\n    recordType!CMGT_CFG_ConditionSet.childConditionSet,\n    recordType!CMGT_CFG_ConditionSet.childConditionSet\n  },\n  relatedRecordData: { ri!relatedRecordData },\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000ecac-72b0-8000-9cf2-011c48011c48_3152780": {
      "name": "CMGT_returnAvailableFields",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!availableCaseFieldsCustomizations: rule!CMGT_AUTO_EVAL_AvailableFieldsCustomizationsWrapper_Case(),\n  local!availableTaskFieldsCustomizations: rule!CMGT_AUTO_EVAL_AvailableFieldsCustomizationsWrapper_Task(),\n  local!studioParentRecordTypeUuid: a!defaultValue(\n    ri!caseTypeRecordTypeUuid,\n    ri!parentCaseTypeRecordTypeUuid\n  ),\n  local!caseFields: append(\n    rule!CMGT_UTIL_RejectBlank(\n      a!flatten(\n        local!availableCaseFieldsCustomizations.fieldMapsToAdd\n      )\n    ),\n    a!flatten(\n      local!availableCaseFieldsCustomizations.customFieldsToAdd\n    )\n  ),\n  local!taskFields: if(\n    ri!scope = \"TASK\",\n    append(\n      rule!CMGT_UTIL_RejectBlank(\n        a!flatten(\n          local!availableTaskFieldsCustomizations.fieldMapsToAdd\n        )\n      ),\n      a!flatten(\n        local!availableTaskFieldsCustomizations.customFieldsToAdd\n      )\n    ),\n    null()\n  ),\n  local!controlPanelHierarchy: #\"SYSTEM_SYSRULES_controlPanelRecordHierarchyMetadata\"(\n    controlPanel: #\"urn:appian:control-panel:v1:1b82dc2b-d4df-44ed-ac7c-3cce3b4ee0e0\",\n    recordUuid: local!studioParentRecordTypeUuid\n  ),\n  local!studioFields: rule!CMGT_formatStudioFieldHierarchy(\n    controlPanelHierarchy: local!controlPanelHierarchy\n  ),\n  local!allFields: rule!CMGT_UTIL_RejectBlank(\n    a!flatten(\n      {\n        local!studioFields,\n        local!caseFields,\n        local!taskFields\n      }\n    )\n  ),\n  local!containsDuplicateNames: count(local!allFields.displayName) <> count(\n    rule!CMGT_UTIL_Distinct(local!allFields.displayName)\n  ),\n  local!formatFieldLabels: #\"SYSTEM_SYSRULES_forEach\"(\n    items: local!allFields,\n    expression: #\"urn:appian:function:v1:a:update\"(\n      data: fv!item,\n      index: \"label\",\n      value: if(\n        and(\n          local!containsDuplicateNames,\n          /*Determines is the field is a duplicate   */\n          count(\n            wherecontains(\n              fv!item.displayName,\n              local!allFields.displayName\n            )\n          ) > 1\n        ),\n        a!match(\n          value: fv!item.parentRecordTypeUuid,\n          equals: cons!CMGT_UUID_RECORD_TYPE_CASE,\n          then: concat(\"Case \", fv!item.displayName),\n          equals: cons!CMGT_UUID_RECORD_TYPE_TASK,\n          then: concat(\"Task \", fv!item.displayName),\n          default: fv!item.displayName,\n          \n        ),\n        fv!item.displayName\n      )\n    )\n  ),\n  local!formatFieldLabels\n)"
    },
    "_a-0000e9d3-70bf-8000-9bbd-011c48011c48_180481": {
      "name": "CMGT_UTIL_RejectBlank",
      "type": "Expression Rule",
      "sail_code": "cast(\n  runtimetypeof(a!flatten(ri!array)),\n  reject(a!isNullOrEmpty(_), a!flatten(ri!array))\n)"
    },
    "_a-0000ec97-0cde-8000-9cec-011c48011c48_3058148": {
      "name": "CMGT_WFL_ConditionSet_SetMetaData",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!conditionSets,\n  expression: rule!CMGT_UTIL_SetRecordFields(\n    record: fv!item,\n    /*Always set these fields with each update*/\n    alwaysOverwrite: {\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.modifiedOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.modifiedBy,\n        value: ri!initiator\n      )\n    },\n    /*Only modify these fields if they are currently null*/\n    neverOverwrite: {\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.createdBy,\n        value: ri!initiator\n      ),\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.createdOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.isActive,\n        value: true\n      )\n    },\n    childRelationships: {\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.childConditionSet,\n        value: rule!CMGT_WFL_ChildConditionSet_SetMetaData(\n          conditionSets: fv!item[recordType!CMGT_CFG_ConditionSet.childConditionSet],\n          initiator: ri!initiator\n        )\n      ),\n      \n    }\n  )\n)"
    },
    "_a-0000ed6e-4eb8-8000-9d48-011c48011c48_3781469": {
      "name": "CMGT_Condition_ConditionInvalid",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!jsonValue: rule!CMGT_UTIL_CastJsonToMap(jsonText: ri!valueJson).value,\n  local!fieldDetails: rule!CMGT_returnAvailableFieldFromFieldPathJson(\n    fieldPathJson: ri!fieldPathJson,\n    availableFields: ri!fieldDetails\n  ),\n  /*Check for choice field condition, then choices are active or not*/\n  local!isInactiveValueOrField: a!match(\n    value: local!fieldDetails,\n    whenTrue: rule!CMGT_UTIL_IsBlank(local!fieldDetails),\n    then: true,\n    whenTrue: and(\n      or(\n        tostring(fv!value.type) = \"RecordType\",\n        tostring(fv!value.type) = \"USERNAME\"\n      ),\n      rule!CMGT_UTIL_IsNotBlank(local!jsonValue)\n    ),\n    then: a!localVariables(\n      local!extraConfigs: rule!CMGT_UTIL_CastJsonToMap(jsonText:ri!fieldPathJson).extraConfigurations,\n      a!match(\n        value: local!extraConfigs,\n        whenTrue: rule!CMGT_UTIL_IsBlank(local!extraConfigs),\n        then: false,\n        whenTrue: or(\n          local!extraConfigs.code = \"USER\",\n          local!fieldDetails.type = \"USERNAME\"\n        ),\n        then: if(\n          isusernametaken(local!jsonValue.id),\n          not(\n            #\"SYSTEM_SYSRULES_queryRecordByIdentifier\"(\n              recordType: #\"urn:appian:record-type:v1:SYSTEM_RECORD_TYPE_USER\",\n              identifier: tostring(local!jsonValue.id)\n            )[#\"urn:appian:record-field:v1:SYSTEM_RECORD_TYPE_USER/SYSTEM_RECORD_TYPE_USER_FIELD_active\"]\n          ),\n          true\n        ),\n        whenTrue: local!extraConfigs.code = \"ROLE\",\n        then: a!localVariables(\n          local!roleData: #\"SYSTEM_SYSRULES_queryRecordByIdentifier\"(\n            recordType: recordType!CMGT_Role,\n            identifier: local!jsonValue\n          ),\n          a!match(\n            value: local!roleData,\n            whenTrue: rule!CMGT_UTIL_IsBlank(local!roleData),\n            then: true,\n            default: not(local!roleData[recordType!CMGT_Role.isActive])\n          )\n        ),\n        default: false\n      )\n      ),\n    whentrue: typename(typeof(fv!value.type)) = \"RecordType\",\n    then: a!localVariables(\n      local!jsonData: if(\n        a!isNotNullOrEmpty(local!jsonValue),\n        cast(\n          typeof(a!map()),\n          #\"SYSTEM_SYSRULES_queryRecordByIdentifier\"(\n            recordType: fv!value.type,\n            identifier: local!jsonValue\n          )\n        ),\n        \"\"\n      ),\n      a!match(\n        value: local!jsonData,\n        /*If no data is returned, then the value does not exist  */\n        whenTrue: rule!CMGT_UTIL_IsBlank(local!jsonData),\n        then: true,\n        /*If the isActive field is not found, then considered valid        */\n        whenTrue: a!isNullOrEmpty(index(local!jsonData, \"isActive\", \"\")),\n        then: false,\n        /*If the data is active then the condition is not invalid        */\n        default: not(index(local!jsonData, \"isActive\", \"\"))\n      )\n    ),\n    whenTrue: and(\n      tostring(fv!value.type) = \"GROUP\",\n      rule!CMGT_UTIL_IsNotBlank(local!jsonValue)\n    ),\n    then: not(\n      a!doesGroupExist(groupId: local!jsonValue.id)\n    ),\n    default: false\n  ),\n  local!isInactiveValueOrField\n)"
    },
    "af326a29-a1c8-4399-a28d-996f85819d9e": {
      "name": "CMGT_UTIL_Filter",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!fieldValuePairs: a!defaultValue(\n    ri!fieldValuePairs,\n    apply(\n      rule!CMGT_UTIL_Filter_CreateFieldValuePair(\n        field: _,\n        value: ri!value,\n        allFields: a!flatten(ri!field)\n      ),\n      a!flatten(ri!field)\n    )\n  ),\n  local!matchingCriteria: a!defaultValue(\n    value: ri!matchingCriteria,\n    default: \"ALL\"\n  ),\n  local!matchType: a!defaultValue(value: ri!matchType, default: \"EXACT\"),\n  local!matchIndices: if(\n    a!isNullOrEmpty(a!flatten(ri!records)),\n    tointeger({}),\n    reduce(\n      rule!CMGT_UTIL_Filter_Reducer(\n        matchingCriteria: local!matchingCriteria,\n        previousIndices: _,\n        records: a!flatten(ri!records),\n        fieldValuePair: _,\n        matchType: local!matchType\n      ),\n      a!match(\n        value: local!matchingCriteria,\n        equals: \"ALL\",\n        then: enumerate(count(a!flatten(ri!records))) + 1,\n        equals: \"ANY\",\n        then: {},\n        default: fn!error(\n          \"Invalid matchingCriteria, must be one of: ALL, ANY\"\n        )\n      ),\n      local!fieldValuePairs\n    )\n  ),\n  local!rejectIndices: difference(\n    if(\n      a!isNullOrEmpty(ri!records),\n      tointeger({}),\n      enumerate(count(a!flatten(ri!records))) + 1\n    ),\n    local!matchIndices\n  ),\n  local!matches: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!matchIndices, {})\n  ),\n  local!rejects: cast(\n    runtimetypeof(ri!records),\n    index(ri!records, local!rejectIndices, {})\n  ),\n  local!output: a!match(\n    value: a!defaultValue(ri!filterType, \"FILTER\"),\n    equals: \"FILTER\",\n    then: local!matches,\n    equals: \"REJECT\",\n    then: local!rejects,\n    equals: \"FIRST_MATCH\",\n    then: index(local!matches, 1, null),\n    equals: \"FIRST_REJECT\",\n    then: index(local!rejects, 1, null),\n    equals: \"MATCH_COUNT\",\n    then: count(local!matchIndices),\n    equals: \"REJECT_COUNT\",\n    then: count(local!rejectIndices),\n    equals: \"MATCH_INDICES\",\n    then: local!matchIndices,\n    equals: \"REJECT_INDICES\",\n    then: local!rejectIndices,\n    equals: \"FULL_RESULT\",\n    then: a!map(\n      matches: local!matches,\n      rejects: local!rejects,\n      firstMatch: index(local!matches, 1, null),\n      firstReject: index(local!rejects, 1, null),\n      matchCount: count(local!matchIndices),\n      rejectCount: count(local!rejectIndices),\n      matchIndices: local!matchIndices,\n      rejectIndices: local!rejectIndices\n    ),\n    default: fn!error(\n      \"Invalid filterType, must be one of: FILTER, REJECT, FIRST_MATCH, FIRST_REJECT, MATCH_COUNT, REJECT_COUNT, MATCH_INDICES, REJECT_INDICES, FULL_RESULT\"\n    )\n  ),\n  local!output\n)"
    },
    "_a-0000ec97-0cde-8000-9cec-011c48011c48_3058161": {
      "name": "CMGT_WFL_Condition_SetMetaData",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!conditions,\n  expression: rule!CMGT_UTIL_SetRecordFields(\n    record: fv!item,\n    /*Always set these fields with each update*/\n    alwaysOverwrite: {\n      a!map(\n        field:recordType!CMGT_CFG_Condition.modifiedOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_CFG_Condition.modifiedBy,\n        value: ri!initiator\n      )\n    },\n    /*Only modify these fields if they are currently null*/\n    neverOverwrite: {\n      a!map(\n        field:recordType!CMGT_CFG_Condition.createdBy,\n        value: ri!initiator\n      ),\n      a!map(\n        field:recordType!CMGT_CFG_Condition.createdOn,\n        value: now()\n      ),\n      a!map(\n        field:recordType!CMGT_CFG_Condition.isActive,\n        value: true\n      ),\n      a!map(\n        field:recordType!CMGT_CFG_Condition.isValid,\n        value: true\n      )\n    }\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_33778": {
      "name": "CMGT_UTIL_SetRecordFields",
      "type": "Expression Rule",
      "sail_code": "/*\nFuture enhancement ideas:\n1 Parameter to skip update if the field isn't present in the object\n--- This would also apply to nested fields, as in, don't set a relationship field if the entire relationship object isn't there because it will instantiate it\n2 Parameter to overwrite based on more enhanced logic\n3 Allow list types for the `value`\n4 Allow reuse to apply setting metadata for nested relationships, but using their own set metadata rule\n--- e.g. CMGT_Entity_SetMetaData can be used in both the Case process and the individual Entity process\n*/\nif(\n  a!isNullOrEmpty(ri!record),\n  ri!record,\n  a!localVariables(\n    local!allUpdates: rule!CMGT_UTIL_RejectBlank(a!flatten(\n      {\n        ri!alwaysOverwrite,\n        ri!childRelationships,\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: ri!neverOverwrite,\n          expression: #\"urn:appian:function:v1:a:update\"(\n            fv!item,\n            \"value\",\n            /*Specifically using this instead of a!defaultValue() to account for the `{null}` value*/\n            if(\n              rule!CMGT_UTIL_IsBlank(ri!record[fv!item.field]),\n              fv!item.value,\n              ri!record[fv!item.field]\n            )\n          )\n        )\n      }\n    )),\n    local!onlyChangedUpdates: a!flatten(\n      #\"SYSTEM_SYSRULES_forEach\"(\n        items: local!allUpdates,\n        expression: if(\n          or(\n            tostring(ri!record[fv!item.field]) = tostring(fv!item.value),\n            toboolean(fv!item.applyWhen) = false\n          ),\n          {},\n          fv!item\n        )\n      )\n    ),\n    if(\n      a!isNullOrEmpty(local!onlyChangedUpdates),\n      ri!record,\n      #\"urn:appian:function:v1:a:update\"(\n        data: ri!record,\n        index: local!onlyChangedUpdates.field,\n        value: local!onlyChangedUpdates.value\n      )\n    )\n  )\n)"
    },
    "_a-0000ed6c-5326-8000-9d46-011c48011c48_3743692": {
      "name": "CMGT_ENUM_Automation_ootbCaseRecordFieldsToReject",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  /*If Context is passed then these are the default fields to reject  */\n  local!defaultContextFieldsToReject: {\n    /*Created By User*/\"a5ede28b-dcb0-48e4-8a37-12ea5d27ee76\",\n    /*Created On*/\"4db722a4-2e1f-4d17-a168-0ae254a83407\",\n    /*Modified On */\"12a54b35-6aad-4cf0-b04a-700cc54a4917\",\n    \n  },\n  local!contextFieldsToReject: a!match(\n    value: ri!context,\n    /*If no context is passed, then it's assumed to be used when configuring a condition, which rejects Due On & Completed On    */\n    whenTrue: rule!CMGT_UTIL_IsBlank(ri!context),\n    then: {\n      /*Due On*/\"dd6a7d01-9f60-4e65-b322-da301c36bcbb\",\n      /*Completed On*/\"71e2da70-92e0-4ace-93b2-67247ad82b96\"\n    },\n    default: a!flatten(\n      {\n        local!defaultContextFieldsToReject,\n        a!match(\n          value: ri!context,\n          /*If the context is blank then should    */\n          whenTrue: rule!CMGT_UTIL_IsBlank(ri!context),\n          /*fields to hide within the fields dropdown of the case field is updated trigger*/\n          equals: cons!CMGT_TXT_AVAILABLE_FIELDS_FOR_CASE_FIELD_UPDATED_TRIGGER_CONTEXT,\n          then: { null },\n          /*fields to ignore when checking for updated fields within the CMGT_Case_UpdateProperty PM*/\n          equals: tostring(cons!CMGT_PM_UPDATE_CASE_PROPERTY),\n          then: {\n            /*Description*/\"1282844c-ffee-4473-a3b4-3e2c8f94cf0e\",\n            /*Case Assignee/Case Watcher*/\"7576a553-bb91-4848-962a-c7a23a9f3b2d\",\n            /*Group Assignee*/\"980ec52a-b916-409f-9cdf-1752ce399f6d\",\n            /*Title*/\"cc5741b7-43ad-438b-844e-8da8538c9cae\"\n          },\n          /*fields to ignore when checking for updated fields within the CMGT_Case_Update PM*/\n          equals: tostring(cons!CMGT_PM_UPDATE_CASE),\n          then: {\n            /*Case Assignee/Case Watcher*/\"7576a553-bb91-4848-962a-c7a23a9f3b2d\",\n            /*Group Assignee*/\"980ec52a-b916-409f-9cdf-1752ce399f6d\",\n            /*Due On*/\"dd6a7d01-9f60-4e65-b322-da301c36bcbb\",\n            /*Completed On*/\"71e2da70-92e0-4ace-93b2-67247ad82b96\",\n            /*Status*/\"43305b8c-b670-44fe-be8a-90fe7dd78436\",\n            /*Priority*/\"e50c4ea6-59fc-475d-bc19-998a2428555e\"\n          },\n          /*fields to ignore when checking for updated fields within the CMGT_Case_bulkUpdate PM*/\n          equals: tostring(cons!CMGT_PM_BULK_UPDATE_CASE),\n          then: {\n            /*Completed On*/\"71e2da70-92e0-4ace-93b2-67247ad82b96\",\n            /*Title*/\"cc5741b7-43ad-438b-844e-8da8538c9cae\",\n            /*Description*/\"1282844c-ffee-4473-a3b4-3e2c8f94cf0e\",\n            \n          },\n          equals: cons!CMGT_TXT_AVAILABLE_FIELDS_FOR_UPDATE_CASE_ASSIGNEE_FIELD_TRIGGER_CONTEXT,\n          then: {\n            /*Due On*/\"dd6a7d01-9f60-4e65-b322-da301c36bcbb\",\n            /*Completed On*/\"71e2da70-92e0-4ace-93b2-67247ad82b96\",\n            /*Title*/\"cc5741b7-43ad-438b-844e-8da8538c9cae\",\n            /*Status*/\"43305b8c-b670-44fe-be8a-90fe7dd78436\",\n            /*Priority*/\"e50c4ea6-59fc-475d-bc19-998a2428555e\",\n            /*Description*/\"1282844c-ffee-4473-a3b4-3e2c8f94cf0e\",\n            \n          },\n          equals: cons!CMGT_TXT_AVAILABLE_FIELDS_FOR_UPDATE_CASE_WATCHER_FIELD_TRIGGER_CONTEXT,\n          then: {\n            /*Due On*/\"dd6a7d01-9f60-4e65-b322-da301c36bcbb\",\n            /*Group Assignee*/\"980ec52a-b916-409f-9cdf-1752ce399f6d\",\n            /*Completed On*/\"71e2da70-92e0-4ace-93b2-67247ad82b96\",\n            /*Title*/\"cc5741b7-43ad-438b-844e-8da8538c9cae\",\n            /*Status*/\"43305b8c-b670-44fe-be8a-90fe7dd78436\",\n            /*Priority*/\"e50c4ea6-59fc-475d-bc19-998a2428555e\",\n            /*Description*/\"1282844c-ffee-4473-a3b4-3e2c8f94cf0e\",\n            \n          },\n          default: null\n        )\n      }\n    )\n  ),\n  rule!CMGT_UTIL_RejectBlank(\n    local!contextFieldsToReject\n  )\n)"
    },
    "_a-0000e990-c462-8000-9ba7-011c48011c48_25890": {
      "name": "CMGT_UTIL_IsBlank",
      "type": "Expression Rule",
      "sail_code": "length(a!flatten(ri!value)) = 0"
    },
    "_a-0000e98b-cfe0-8000-9ba5-011c48011c48_19651": {
      "name": "CMGT_QR_GetCaseType",
      "type": "Expression Rule",
      "sail_code": "rule!CMGT_UTIL_QueryRecord(\n  recordType: recordType!CMGT_CFG_CaseType,\n  returnType: ri!returnType,\n  triggerRefresh: ri!triggerRefresh,\n  executeWhen: ri!executeWhen,\n  filters: {\n    ri!additionalFilters,\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_CaseType.uuid,\n      operator: \"in\",\n      value: ri!caseTypeUuid\n    ),\n    #\"SYSTEM_SYSRULES_queryFilter\"(\n      field: recordType!CMGT_CFG_CaseType.isCategory,\n      operator: \"=\",\n      value: ri!isCaseCategory\n    )\n  },\n  fields: {\n    ri!fields,\n    if(\n      ri!excludeRelatedRecords,\n      {},\n      recordType!CMGT_CFG_CaseType.parentCaseType\n    )\n  },\n  relatedRecordData: ri!relatedRecordData,\n  pagingInfo: ri!pagingInfo,\n  sort: ri!sort,\n  logicalExpressions: {\n    ri!additionalLogicalExpression,\n    rule!CMGT_CaseTypeActiveLogicalExpression(includeInactive: ri!includeInactive)\n  },\n  groupByFields: ri!groupByFields,\n  searchTerm: ri!searchTerm,\n  searchFields: ri!searchFields\n)"
    },
    "_a-0000ec99-fdab-8000-9cee-011c48011c48_3087732": {
      "name": "CMGT_WFL_ChildConditionSet_SetMetaData",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_forEach\"(\n  items: ri!conditionSets,\n  expression: rule!CMGT_UTIL_SetRecordFields(\n    record: fv!item,\n    /*Always set these fields with each update*/\n    alwaysOverwrite: {\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.modifiedOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.modifiedBy,\n        value: ri!initiator\n      )\n    },\n    /*Only modify these fields if they are currently null*/\n    neverOverwrite: {\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.createdBy,\n        value: ri!initiator\n      ),\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.createdOn,\n        value: now()\n      ),\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.isActive,\n        value: true\n      )\n    },\n    childRelationships: {\n      a!map(\n        field: recordType!CMGT_CFG_ConditionSet.condition,\n        value: rule!CMGT_WFL_Condition_SetMetaData(\n          conditions: fv!item[recordType!CMGT_CFG_ConditionSet.condition],\n          initiator: ri!initiator\n        )\n      )\n    }\n  )\n)"
    },
    "_a-0000ecac-72b0-8000-9cf2-011c48011c48_3153660": {
      "name": "CMGT_UTIL_CastJsonToMap",
      "type": "Expression Rule",
      "sail_code": "cast(\n  typeof(a!map()),\n  #\"SYSTEM_SYSRULES_fromJson_v1\"(\n    jsonText: a!defaultValue(\n      value: ri!jsonText,\n      default: \"{}\"\n    )\n  )\n)"
    }
  }
}