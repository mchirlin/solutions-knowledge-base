{
  "_metadata": {
    "bundle_id": "AIA_Extraction_Instance_AI_Review"
  },
  "objects": {
    "_a-0000ecfc-48c9-8000-9c55-011c48011c48_234937": {
      "name": "AIA_ENUM_LlmVersions",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!allModels: a!flatten(\n    {\n      a!map(\n        label: \"Anthropic Claude Haiku 3.0 (Fast)\",\n        value: cons!AIA_MODEL_HAIKU_3,\n      ),\n      a!map(\n        label: \"Anthropic Claude Haiku 4.5 (Fast)\",\n        value: cons!AIA_MODEL_HAIKU_4_5,\n      ),\n      a!map(\n        label: \"Anthropic Claude Sonnet 3.0 (Legacy, Reasoning)\",\n        value: cons!AIA_MODEL_SONNET_3,\n      ),\n      a!map(\n        label: \"Anthropic Claude Sonnet 3.5 (Reasoning)\",\n        value: cons!AIA_MODEL_SONNET_3_5\n      ),\n      a!map(\n        label: \"Anthropic Claude Sonnet 3.7 (Reasoning)\",\n        value: cons!AIA_MODEL_SONNET_3_7\n      ),\n      a!map(\n        label: \"Anthropic Claude Sonnet 4.5 (Reasoning)\",\n        value: cons!AIA_MODEL_SONNET_4_5\n      ),\n      if(\n        ri!includeVision,\n        {\n          /*model values iwth | to split name and mode are used in AI Reviewer/Judge*/\n          a!map(\n            label: \"Anthropic Claude Haiku 4.5 (Vision)\",\n            value: cons!AIA_MODEL_HAIKU_4_5_MULTIMODAL,\n          ),\n          a!map(\n            label: \"Anthropic Claude Sonnet 3.5 (Vision)\",\n            value: cons!AIA_MODEL_SONNET_3_5_MULTIMODAL\n          ),\n          a!map(\n            label: \"Anthropic Claude Sonnet 3.7 (Vision)\",\n            value: cons!AIA_MODEL_SONNET_3_7_MULTIMODAL\n          ),\n          a!map(\n            label: \"Anthropic Claude Sonnet 4.5 (Vision)\",\n            value: cons!AIA_MODEL_SONNET_4_5_MULTIMODAL\n          )\n        },\n        null\n      )\n    }\n  ),\n  if(\n    a!defaultValue(ri!returnOnlySupportedLlms, true),\n    a!localVariables(\n      local!supportedModels: a!genAiModels(),\n      reject(\n        fn!isnull,\n        #\"SYSTEM_SYSRULES_forEach\"(\n          items: local!allModels,\n          expression: if(\n            or(\n              a!isNullOrEmpty(fv!item.value),\n              contains(\n                touniformstring(local!supportedModels.id),\n                tostring(split(fv!item.value,\"|\")[1])\n              )\n            ),\n            fv!item,\n            null\n          )\n        )\n      )\n    ),\n    local!allModels\n  )\n)"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92467": {
      "name": "AIA_MTR_ClassificationInstanceClassifiedWithErrors",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000eec9-5676-8000-9c92-011c48011c48_179359": {
      "name": "AIA_MTR_ConfidenceThresholdDisabled",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee66-4fc0-8000-9baa-011c48011c48_48115": {
      "name": "AIA_AiReviewMode",
      "type": "Expression Rule",
      "sail_code": "if(\n  a!isNullOrEmpty(ri!ExtractionInstance[recordType!AIA Extraction Instance.modelVersion.aiReviewLlm]),\n  cons!AIA_PROMPT_OPERATION_MODE_MULTIMODAL,\n  index(split(ri!ExtractionInstance[recordType!AIA Extraction Instance.modelVersion.aiReviewLlm], \"|\"), 2, cons!AIA_PROMPT_OPERATION_MODE_MULTIMODAL)\n)\n"
    },
    "_a-0000eeca-c121-8000-9cab-011c48011c48_182002": {
      "name": "AIA_MTR_ClassificationModelVersionRestore",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180853": {
      "name": "AIA_MTR_ExtractionInstanceCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000eed9-05f0-8000-9d10-011c48011c48_194872": {
      "name": "AIA_DefaultModel",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!default: cons!AIA_MODEL_HAIKU_4_5,\n  if(\n    /*check default model is enabled in env*/\n    contains(\n      a!genAiModels().id,\n      local!default\n    ),\n    /*if so, use default*/\n    local!default,\n    /*else default to first available model*/\n    tostring(index(a!genAiModels().id,1,\"\"))\n  )\n)"
    },
    "_a-0000ef46-744c-8000-9fed-011c48011c48_483991": {
      "name": "AIA_MTR_ModelTestSuiteUpdated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92592": {
      "name": "AIA_MTR_ExtractionInstanceValidationIgnore",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ef46-744c-8000-9fed-011c48011c48_483964": {
      "name": "AIA_MTR_ModelTestRunInitiated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_31384": {
      "name": "AIA_FieldJsonSchema",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!isMultiple: a!defaultValue(\n    ri!item.isMultiple,\n    false\n  ),\n  local!baseType: #\"53aa98e0-80da-4eb1-88f9-a989a8fe1aee\"(\n    type: ri!item.type\n  ),\n  local!baseField: a!map(\n    title: ri!item.label,\n    description: ri!item.description,\n    type: local!baseType.type,\n    format: local!baseType.format\n  ),\n  local!schemaType: displayValue(\n    ri!mode,\n    rule!AIA_ENUM_FieldSchemas().name,\n    rule!AIA_ENUM_FieldSchemas(),\n    null\n  ),\n  local!type: #\"53aa98e0-80da-4eb1-88f9-a989a8fe1aee\"(\n    type: ri!item.type,\n    isMultiple: local!isMultiple,\n    includeArrays: ri!includeArrays,\n    mode: ri!mode\n  ),\n  local!enum: rule!AIA_Extraction_GetFieldOptions(ModelVersionField: ri!item),\n  local!columns: reject(\n    fn!isnull,\n    #\"SYSTEM_SYSRULES_forEach\"(\n      ri!item.columns,\n      a!match(\n        value: fv!item,\n        whenTrue: a!isNullOrEmpty(index(fv!value, \"key\", null)),\n        then: null,\n        whenTrue: and(\n          ri!operation = cons!AIA_PROMPT_OPERATION_MODE_MULTIMODAL,\n          a!defaultValue(fv!value.useVision, false) = true\n        ),\n        then: fv!item,\n        whenTrue: and(\n          ri!operation = cons!AIA_PROMPT_OPERATION_MODE_TEXT,\n          a!defaultValue(fv!value.useVision, false) = false\n        ),\n        then: fv!item,\n        default: fv!item\n      )\n    )\n  ),\n  local!properties: if(\n    and(\n      a!isNotNullOrEmpty(local!schemaType.fields),\n      or(\n        and(\n          not(local!isMultiple),\n          a!isNullOrEmpty(local!columns),\n        ),\n        not(a!defaultValue(ri!includeArrays, true))\n      )\n    ),\n    reduce(\n      #\"urn:appian:function:v1:a:update\",\n      a!map(),\n      merge(\n        local!schemaType.fields.key,\n        a!flatten({\n          #\"SYSTEM_SYSRULES_forEach\"(\n            local!schemaType.fields,\n            a!map(\n              type: a!defaultValue(fv!item.type, local!baseField.type),\n              description: fv!item.description,\n              format: if(\n                fv!item.useFormat,\n                local!baseField.format,\n                null\n              ),\n              items: if(\n                and(\n                  a!isNullOrEmpty(fv!item.type),\n                  ri!includeArrays = false\n                ),\n                rule!AIA_FieldJsonSchema(\n                  item: ri!item,\n                  mode: cons!AIA_SCHEMA_MODE_PLAIN,\n                  operation: ri!operation,\n                  includeArrays: true\n                ).items,\n                null\n              ),\n              enum: if(\n                fv!item.useFormat,\n                index(local!enum, \"options\", null),\n                null\n              ),\n            )\n          )\n        })\n      )\n    ),\n    null\n  ),\n  local!required: if(\n    and(\n      a!isNotNullOrEmpty(local!schemaType.fields),\n      a!isNullOrEmpty(local!columns),\n      not(local!isMultiple)\n    ),\n    reject(\n      fn!isnull,\n      index(\n        local!schemaType.fields.key,\n        where(local!schemaType.fields.required)\n      )\n    ),\n    null\n  ),\n  local!items: a!match(\n    value: ri!includeArrays,\n    equals: false,\n    then: null,\n    whenTrue: and(\n      a!isNotNullOrEmpty(local!columns),\n      ri!includeArrays\n    ),\n    then: a!map(\n      type: \"object\",\n      properties: reduce(\n        #\"urn:appian:function:v1:a:update\",\n        a!map(),\n        merge(\n          local!columns.key,\n          #\"SYSTEM_SYSRULES_forEach\"(\n            local!columns,\n            rule!AIA_FieldJsonSchema(\n              item: fv!item,\n              mode: ri!mode\n            )\n          )\n        )\n      ),\n      required: reject(\n        fn!isnull,\n        index(\n          local!columns.key,\n          where(local!columns.required)\n        )\n      )\n    ),\n    whenTrue: local!isMultiple,\n    then: a!localVariables(\n      local!item: rule!AIA_FieldJsonSchema(\n        item: #\"urn:appian:function:v1:a:update\"(\n          ri!item, \n          {\"label\", \"description\", \"isMultiple\"},\n          {null, null, false}\n        ),\n        mode: ri!mode\n      ),\n      if(\n        and(\n          a!isNullOrEmpty(local!schemaType.fields),\n          a!isNotNullOrEmpty(local!enum)\n        ),\n        #\"urn:appian:function:v1:a:update\"(\n          local!item,\n          \"enum\",\n          index(local!enum, \"options\", null),\n        ),\n        local!item\n      )\n    ),\n    default: null\n  ),\n  a!map(\n    title: local!baseField.title,\n    description: local!baseField.description,\n    type: local!type.type,\n    format: local!type.format,\n    properties: local!properties,\n    items: local!items,\n    required: local!required\n  )\n)"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92585": {
      "name": "AIA_MTR_ExtractionInstanceValidationAccept",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_33322": {
      "name": "AIA_AiReviewLlmInput",
      "type": "Expression Rule",
      "sail_code": "a!map(\n  document: a!defaultValue(\n    ri!document,\n    ri!ExtractionInstance[recordType!AIA Extraction Instance.documentId]\n  )\n)"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_76725": {
      "name": "AIA_CreateMaxPageValidation",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!feature: displayvalue(\n    ri!feature,\n    rule!AIA_ENUM_Features().id,\n    rule!AIA_ENUM_Features(),\n    null\n  ),\n  rule!AIA_CreateValidation(\n    instance: ri!Instance,\n    typeId: cons!AIA_VALIDATION_TYPE_ID_EXECUTION,\n    message: rule!AIA_CreateValidationErrorMessage(\n      type: #\"urn:appian:translation-string:v1:25266106-b29b-4b80-9261-5c5b2e4b0aa3\",\n      error: #\"urn:appian:translation-string:v1:73bdf5e0-f073-4e93-aa40-bdbfabbff2d3\"(\n        #\"urn:appian:translation-variable:v1:aac5d80e-8573-4620-81a7-245a7684ce13\": local!feature.label,\n        #\"urn:appian:translation-variable:v1:881cf1e3-d211-453b-b21c-24f0ad928cd1\": a!defaultValue(\n          ri!maxPages,\n          local!feature.maxPages\n        )\n      )\n    ),\n    severity: local!feature.severity\n  )\n)"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92578": {
      "name": "AIA_MTR_ExtractionModelVersionAiReview",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ec2d-5396-8000-9bdc-011c48011c48_43077": {
      "name": "AIA_Extraction_GetInstanceById",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_queryRecordByIdentifier\"(\n  recordType: recordType!AIA Extraction Instance,\n  identifier: ri!identifier,\n  fields: a!flatten(\n    {\n      /* Extraction Instance */\n      recordType!AIA Extraction Instance.modelVersionId,\n      recordType!AIA Extraction Instance.documentId,\n      recordType!AIA Extraction Instance.statusId,\n      recordType!AIA Extraction Instance.hasBoundingBoxes,\n      recordType!AIA Extraction Instance.boundingBoxesDocumentId,\n      recordType!AIA Extraction Instance.validationErrors,\n      recordType!AIA Extraction Instance.accuracy,\n      recordType!AIA Extraction Instance.precision,\n      recordType!AIA Extraction Instance.f1,\n      recordType!AIA Extraction Instance.recall,\n      recordType!AIA Extraction Instance.createdOn,\n      /* Extraction Fields */\n      recordType!AIA Extraction Instance.fields.modelVersionFieldId,\n      recordType!AIA Extraction Instance.fields.extractedValue,\n      recordType!AIA Extraction Instance.fields.overrideValue,\n      recordType!AIA Extraction Instance.fields.overrideNull,\n      recordType!AIA Extraction Instance.fields.boundingBox,\n      recordType!AIA Extraction Instance.fields.confidence,\n      /* Extraction Fields > Rows */\n      recordType!AIA Extraction Instance.fields.rows.overrideValue,\n      recordType!AIA Extraction Instance.fields.rows.boundingBox,\n      /* Extraction Fields > Rows > Cells */\n      recordType!AIA Extraction Instance.fields.rows.cells.modelVersionFieldId,\n      recordType!AIA Extraction Instance.fields.rows.cells.extractedValue,\n      recordType!AIA Extraction Instance.fields.rows.cells.overrideValue,\n      recordType!AIA Extraction Instance.fields.rows.cells.overrideNull,\n      recordType!AIA Extraction Instance.fields.rows.cells.confidence,\n      /* Extraction Fields > Model Field */\n      recordType!AIA Extraction Instance.fields.modelVersionField.key,\n      recordType!AIA Extraction Instance.fields.modelVersionField.columns.key,\n      /* Extraction Fields > Rows > Cells > Column */\n      recordType!AIA Extraction Instance.fields.rows.cells.column.key,\n      a!defaultValue(ri!additionalFields, {})\n    },\n    \n  )\n)"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_76731": {
      "name": "AIA_ENUM_Features",
      "type": "Expression Rule",
      "sail_code": "{\n  a!map(\n    id: cons!AIA_FEATURE_VISION,\n    label: #\"urn:appian:translation-string:v1:6e2f4447-827f-48a4-bb10-10b6c2a028b8\",\n    maxPages: cons!AIA_VISION_PAGE_MAX,\n    severity: cons!AIA_SEVERITY_HIGH\n  ),\n  a!map(\n    id: cons!AIA_FEATURE_ANALYZE_EXPENSE,\n    label: #\"urn:appian:translation-string:v1:4b200656-fadb-4ecc-98d6-fa93e9152840\",\n    maxPages: cons!AIA_ADVANCED_IDP_PAGE_MAX,\n    severity: cons!AIA_SEVERITY_HIGH\n  ),\n  a!map(\n    id: cons!AIA_FEATURE_AI_REVIEW,\n    label: #\"urn:appian:translation-string:v1:a67c9f85-f682-4191-bed6-c4912e7d88b4\",\n    severity: cons!AIA_SEVERITY_MEDIUM\n  ),\n  a!map(\n    id: cons!AIA_FEATURE_SEARCH_QUERY,\n    label: #\"urn:appian:translation-string:v1:7d663cf5-06ab-4445-979d-17074d9928f9\",\n    maxPages: cons!AIA_ADVANCED_IDP_PAGE_MAX,\n    severity: cons!AIA_SEVERITY_HIGH\n  ),\n  a!map(\n    id: cons!AIA_FEATURE_CLASSIFICATION,\n    label: #\"urn:appian:translation-string:v1:f04e5814-41aa-4705-bb0e-968fe8fc8ec5\",\n    maxPages: cons!AIA_CLASSIFICATION_MAX_PAGE_COUNT,\n    severity: cons!AIA_SEVERITY_HIGH\n  ),\n  a!map(\n    id: cons!AIA_FEATURE_AI_VALIDATION_RULE,\n    label: #\"urn:appian:translation-string:v1:8375b3de-d2a7-415d-983d-71e16d015d7e\",\n    severity: cons!AIA_SEVERITY_MEDIUM\n  )\n}"
    },
    "_a-0000ee66-4fc0-8000-9baa-011c48011c48_46312": {
      "name": "AIA_AiReviewModel",
      "type": "Expression Rule",
      "sail_code": "if(\n  a!isNullOrEmpty(ri!ExtractionInstance[recordType!AIA Extraction Instance.modelVersion.aiReviewLlm]),\n  index(split(rule!AIA_AiReviewDefaultModel(), \"|\"), 1),\n  index(split(ri!ExtractionInstance[recordType!AIA Extraction Instance.modelVersion.aiReviewLlm], \"|\"), 1)\n)\n"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92488": {
      "name": "AIA_MTR_ExtractionInstanceError",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_38770": {
      "name": "AIA_Extraction_DefaultAiReviwRole",
      "type": "Expression Rule",
      "sail_code": "=#\"urn:appian:translation-string:v1:ef6f89d7-ee52-4817-8a91-cb880fa01818\" & char(10) & char(10) & #\"urn:appian:translation-string:v1:65728831-0b11-4fa9-9454-3bb1c9d3e371\""
    },
    "_a-0000ec36-59aa-8000-9be0-011c48011c48_53600": {
      "name": "AIA_Test_GetLatestExtractionModelVersion",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!modelVersion: a!refreshVariable(\n    value: rule!AIA_Extraction_GetModelVersionById(\n      identifier: index(\n        #\"SYSTEM_SYSRULES_queryRecordType_v4\"(\n          recordType: recordType!AIA Extraction Model Version,\n          fields: {\n            recordType!AIA Extraction Model Version.modelVersionId\n          },\n          pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n            startIndex: 1,\n            batchSize: 1,\n            sort: {\n              #\"SYSTEM_SYSRULES_sortInfo\"(\n                field: recordType!AIA Extraction Model Version.modelVersionId\n              )\n            }\n          )\n        ).data[recordType!AIA Extraction Model Version.modelVersionId],\n        1,\n        null\n      )\n    ),\n    refreshAlways: true\n  ),\n  local!modelVersion\n)"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_159825": {
      "name": "AIA_DocIsPdf",
      "type": "Expression Rule",
      "sail_code": "rule!AIA_IsDocumentExtension(\n  document: ri!document,\n  extensions: {\"pdf\"}\n)"
    },
    "_a-0000ee35-0ca2-8000-9ba6-011c48011c48_13646": {
      "name": "AIA_LogMetric",
      "type": "Expression Rule",
      "sail_code": "a!match(\n  value: ri!name,\n  /* Classification Model Created */\n  equals: cons!AIA_MTR_CLASSIFICATION_MODEL_CREATED,\n  then: rule!AIA_MTR_ClassificationModelCreated(),\n  /* Classification Instance Created */\n  equals: cons!AIA_MTR_CLASSIFICATION_INSTANCE_CREATED,\n  then: rule!AIA_MTR_ClassificationInstanceCreated(),\n  /* Classification Instance Reconciled */\n  equals: cons!AIA_MTR_CLASSIFICATION_INSTANCE_RECONCILED,\n  then: rule!AIA_MTR_ClassificationInstanceReconciled(),\n  /* Classification Instance with Validation Errors */\n  equals: cons!AIA_MTR_INSTANCE_STATUS_CLASSIFIED_WITH_ERRORS,\n  then: rule!AIA_MTR_ClassificationInstanceClassifiedWithErrors(),\n  /* Classification Instance with Critical Error */\n  equals: cons!AIA_MTR_INSTANCE_STATUS_CLASSIFICATION_CRITICAL_ERROR,\n  then: rule!AIA_MTR_ClassificationInstanceError(),\n  \n  /* Extraction Model Created */\n  equals: cons!AIA_MTR_EXTRACTION_MODEL_CREATED,\n  then: rule!AIA_MTR_ExtractionModelCreated(),\n  /* Extraction Instance Created */\n  equals: cons!AIA_MTR_EXTRACTION_INSTANCE_CREATED,\n  then: rule!AIA_MTR_ExtractionInstanceCreated(),\n  /* Extraction Instance Reconciled */\n  equals: cons!AIA_MTR_EXTRACTION_INSTANCE_RECONCILED,\n  then: rule!AIA_MTR_ExtractionInstanceReconciled(),\n  /* Extraction Instance with Validation Errors */\n  equals: cons!AIA_MTR_INSTANCE_STATUS_EXTRACTED_WITH_ERRORS,\n  then: rule!AIA_MTR_ExtractionInstanceExtractedWithErrors(),\n  /* Extraction Instance with Critical Error */\n  equals: cons!AIA_MTR_INSTANCE_STATUS_EXTRACTION_CRITICAL_ERROR,\n  then: rule!AIA_MTR_ExtractionInstanceError(),\n  \n  /* Triggered when AI review raises an error (field level) */\n  equals: cons!AIA_MTR_AI_REVIEW_FIELD,\n  then: rule!AIA_MTR_ExtractionInstanceFieldAiReview(),\n  /* Triggered when AI review raises an error (instance level, this instance has 1 or more errors raised by AI review) */\n  equals: cons!AIA_MTR_AI_REVIEW_INSTANCE,\n  then: rule!AIA_MTR_ExtractionInstanceAiReview(),\n  /* Triggered when model is created with AI review turned on OR AI review is turned on for a model */\n  equals: cons!AIA_MTR_AI_REVIEW_MODEL_VERSION,\n  then: rule!AIA_MTR_ExtractionModelVersionAiReview(),\n  /* Triggered when user clicks accept */\n  equals: cons!AIA_MTR_AI_REVIEW_ACCEPT,\n  then: rule!AIA_MTR_ExtractionInstanceValidationAccept(),\n  /* Triggered when user clicks ignored */\n  equals: cons!AIA_MTR_AI_REVIEW_IGNORE,\n  then: rule!AIA_MTR_ExtractionInstanceValidationIgnore(),\n  /*triggered when spot check ocnfigured*/\n  equals: cons!AIA_MTR_SPOT_CHECK_MODEL_VERSION,\n  then: rule!AIA_MTR_ModelVersionConfigureSampling(),\n  /* Triggered when a model validation rule of type AI validation creates a validation instance */\n  equals: cons!AIA_MTR_AI_VALIDATION_RULE_OCCURANCE,\n  then: rule!AIA_MTR_InstanceValidationAiRuleOccurance(),\n  /*Confidence Threshold Enabled*/\n  equals: cons!AIA_MTR_CONFIDENCE_THRESHOLD_ENABLED,\n  then: rule!AIA_MTR_ConfidenceThresholdEnabled(),\n  /*Confidence Threshold Disabled*/\n  equals: cons!AIA_MTR_CONFIDENCE_THRESHOLD_DISABLED,\n  then: rule!AIA_MTR_ConfidenceThresholdDisabled(),\n  /*Extraction Model Version Restored*/\n  equals: cons!AIA_MTR_EXTRACTION_MODEL_VERSION_RESTORE,\n  then: rule!AIA_MTR_ExtractionModelVersionRestore(),\n  /*Classification Model Version Restored*/\n  equals: cons!AIA_MTR_CLASSIFICATION_MODEL_VERSION_RESTORE,\n  then: rule!AIA_MTR_ClassificationModelVersionRestore(),\n  /*Model Test Suite Created*/\n  equals: cons!AIA_MTR_MODEL_TEST_SUITE_CREATED,\n  then: rule!AIA_MTR_ModelTestSuiteCreated(),\n  /*Model Test Suite Updated*/\n  equals: cons!AIA_MTR_MODEL_TEST_SUITE_UPDATED,\n  then: rule!AIA_MTR_ModelTestSuiteUpdated(),\n  /*Model Test Run Initiated*/\n  equals: cons!AIA_MTR_MODEL_TEST_RUN_INITIATED,\n  then: rule!AIA_MTR_ModelTestRunInitiated(),\n  /*Classification Model Version Created with Multiple Outputs*/\n  equals: cons!AIA_MTR_MULTIPLE_OUTPUTS_CLASSIFICATION_MODEL_VERSION_CREATED,\n  then: rule!AIA_MTR_MultipleOutputsClassificationModelVersionCreated(),\n  /*Classification Instance Created for a Model Version that Allows Multiple Outputs*/\n  equals: cons!AIA_MTR_MULTIPLE_OUTPUTS_CLASSIFICATION_INSTANCE_CREATED,\n  then: rule!AIA_MTR_MultipleOutputsClassificationInstanceCreated(),\n  /*Classification Instance Reconciled for a Model Version that Allows Multiple Outputs*/\n  equals: cons!AIA_MTR_MULTIPLE_OUTPUTS_CLASSIFICATION_INSTANCE_RECONCILED,\n  then: rule!AIA_MTR_MultipleOutputsClassificationInstanceReconciled(),\n  default: null\n)"
    },
    "_a-0000eeb2-df20-8000-9bfe-011c48011c48_154565": {
      "name": "AIA_MTR_InstanceValidationAiRuleOccurance",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180846": {
      "name": "AIA_MTR_ClassificationModelCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180860": {
      "name": "AIA_MTR_ClassificationInstanceCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_85019": {
      "name": "AIA_IsExtractionInstance",
      "type": "Expression Rule",
      "sail_code": "runtimetypeof(\n  ri!Instance\n) = typeof(\n  recordType!AIA Extraction Instance()\n)"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180834": {
      "name": "AIA_MTR_ExtractionModelCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_36163": {
      "name": "SHRD_UTIL_QueryRecord",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!maxBatchSize: 5000,\n  /*Chosen return type*/\n  local!returnType: a!defaultValue(ri!returnType, \"OBJECT_ARRAY\"),\n  /*Determine the query parameters to use by the return type*/\n  local!queryParams: a!match(\n    value: local!returnType,\n    equals: \"OBJECT_ARRAY\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        #\"urn:appian:function:v1:a:listtype?okey=a!listType\"(ri!recordType),\n        'type!{http://www.appian.com/ae/types/2009}Map?list'\n      ),\n      fetchTotalCount: false,\n      isArray: true,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          local!maxBatchSize\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"SINGLE_OBJECT\",\n    then: a!map(\n      castToType: if(\n        a!isNullOrEmpty(ri!groupByFields),\n        ri!recordType,\n        'type!{http://www.appian.com/ae/types/2009}Map'\n      ),\n      fetchTotalCount: false,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"RECORD_BY_ID\",\n    then: a!map(\n      castToType: ri!recordType,\n      fetchTotalCount: false,\n      isArray: false,\n      queryRecordByIdentifier: true,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: 1,\n        batchSize: 1,\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"DATA_SUBSET\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}DataSubset',\n      fetchTotalCount: true,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n        startIndex: a!defaultValue(ri!pagingInfo.startIndex, 1),\n        batchSize: a!defaultValue(\n          ri!pagingInfo.batchSize,\n          local!maxBatchSize\n        ),\n        sort: { ri!pagingInfo.sort, ri!sort }\n      )\n    ),\n    equals: \"TOTAL_COUNT\",\n    then: a!map(\n      castToType: 'type!{http://www.appian.com/ae/types/2009}Integer',\n      fetchTotalCount: true,\n      isArray: false,\n      queryRecordByIdentifier: false,\n      pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(startIndex: 1, batchSize: 0)\n    ),\n    default: fn!error(\n      \"Invalid returnType, must be one of: OBJECT_ARRAY, SINGLE_OBJECT, RECORD_BY_ID, DATA_SUBSET, TOTAL_COUNT\"\n    )\n  ),\n  if(\n    /*Early exit for skip execution*/\n    ri!executeWhen = false,\n    cast(\n      local!queryParams.castToType,\n      if(local!queryParams.isArray, {}, null)\n    ),\n    a!localVariables(\n      /*Run the query*/\n      local!queryResult: a!refreshVariable(\n        value: if(\n          local!queryParams.queryRecordByIdentifier,\n          #\"SYSTEM_SYSRULES_queryRecordByIdentifier\"(\n            recordType: ri!recordType,\n            identifier: index({ri!identifier},1,null),\n            /*If fields is sent in using a!selectionFields(), then adding the fields contained in ri!relatedRecordData will break the query*/\n            fields: reject(\n              a!isNullOrEmpty,\n              a!flatten(\n                {\n                  ri!fields,\n                  if(\n                    or(\n                      typeof(ri!fields) = typeof(#\"SYSTEM_SYSRULES_selectionFields\"()),\n                      typeof(ri!fields) = typeof({#\"SYSTEM_SYSRULES_selectionFields\"()})\n                    ),\n                    {},\n                    index(ri!relatedRecordData, \"relationship\", {})\n                  )\n                }\n              )\n            ),\n            relatedRecordData: ri!relatedRecordData\n          ),\n          #\"SYSTEM_SYSRULES_queryRecordType_v1\"(\n            recordType: ri!recordType,\n            fields: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              reject(\n                a!isNullOrEmpty,\n                a!flatten(\n                  {\n                    ri!fields,\n                    index(ri!relatedRecordData, \"relationship\", {})\n                  }\n                )\n              ),\n              #\"SYSTEM_SYSRULES_aggregationFields\"(\n                groupings: #\"SYSTEM_SYSRULES_forEach\"(\n                  items: ri!groupByFields,\n                  expression: #\"SYSTEM_SYSRULES_grouping\"(field: fv!item, alias: tostring(fv!item))\n                ),\n                measures: #\"SYSTEM_SYSRULES_measure\"(\n                  field: ri!groupByFields[1],\n                  function: \"COUNT\",\n                  alias: \"count\"\n                )\n              )\n            ),\n            filters: #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n              operator: \"AND\",\n              ignoreFiltersWithEmptyValues: true,\n              logicalExpressions: {\n                ri!logicalExpressions,\n                if(\n                  and(\n                    a!isNotNullOrEmpty(ri!searchFields),\n                    a!isNotNullOrEmpty(ri!searchTerm)\n                  ),\n                  #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                    operator: \"AND\",\n                    logicalExpressions: #\"SYSTEM_SYSRULES_forEach\"(\n                      items: split(trim(ri!searchTerm), \" \"),\n                      expression: a!localVariables(\n                        local!splitSearchTerm: fv!item,\n                        /*   Initiate filter for each field by the value provided in searchTerm   */\n                        #\"SYSTEM_SYSRULES_queryLogicalExpression\"(\n                          operator: \"OR\",\n                          filters: #\"SYSTEM_SYSRULES_forEach\"(\n                            items: ri!searchFields,\n                            expression: #\"SYSTEM_SYSRULES_queryFilter\"(\n                              field: fv!item,\n                              operator: \"includes\",\n                              value: local!splitSearchTerm\n                            )\n                          )\n                        )\n                      )\n                    )\n                  ),\n                  {}\n                )\n              },\n              filters: ri!filters\n            ),\n            pagingInfo: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              local!queryParams.pagingInfo,\n              #\"urn:appian:function:v1:a:update\"(\n                local!queryParams.pagingInfo,\n                \"sort\",\n                null\n              )\n            ),\n            fetchTotalCount: local!queryParams.fetchTotalCount,\n            relatedRecordData: if(\n              a!isNullOrEmpty(ri!groupByFields),\n              ri!relatedRecordData,\n              {}\n            )\n          )\n        ),\n        refreshOnVarChange: ri!triggerRefresh,\n        refreshAfter: { \"RECORD_ACTION\" }\n      ),\n      /*Format the output*/\n      local!output: a!match(\n        value: local!returnType,\n        equals: \"OBJECT_ARRAY\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"data\",{})\n        ),\n        equals: \"SINGLE_OBJECT\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"data\",{})\n        ),\n        equals: \"RECORD_BY_ID\",\n        /*do not need to cast for queryRecordByIdentifier*/\n        then: local!queryResult,\n        equals: \"DATA_SUBSET\",\n        then: cast(\n          local!queryParams.castToType,\n          local!queryResult\n        ),\n        equals: \"TOTAL_COUNT\",\n        then: cast(\n          local!queryParams.castToType,\n          index(local!queryResult,\"totalCount\",{})\n        ),\n        default: null\n      ),\n      local!output\n    )\n  )\n)"
    },
    "_a-0000ef55-14e0-8000-a041-011c48011c48_505631": {
      "name": "AIA_MTR_MultipleOutputsClassificationInstanceCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee3e-060c-8000-9bb8-011c48011c48_204932": {
      "name": "AIA_Extraction_CreateJsonSchema",
      "type": "Expression Rule",
      "sail_code": "\na!localVariables(\n  local!modelFields: #\"SYSTEM_SYSRULES_fromJson_v1\"(#\"SYSTEM_SYSRULES_toJson_v1\"(\n    a!defaultValue(\n      ri!fields,\n      filter(\n        rule!AIA_Extraction_DisplayPromptField(\n          field: _,\n          mode: ri!mode,\n          operation: ri!operation\n        ),\n        ri!ExtractionModelVersion[recordType!AIA Extraction Model Version.fields]\n      )\n    )\n  )),\n  if(\n    a!isNotNullOrEmpty(local!modelFields),\n    a!localVariables(\n      local!fields: reduce(\n        #\"urn:appian:function:v1:a:update\",\n        a!map(),\n        merge(\n          local!modelFields.key,\n          #\"SYSTEM_SYSRULES_forEach\"(\n            local!modelFields,\n            rule!AIA_FieldJsonSchema(\n              item: fv!item,\n              mode: ri!mode,\n              operation: ri!operation,\n              includeArrays: a!defaultValue(ri!includeArrays, true)\n            )\n          )\n        )\n      ),\n      local!map: #\"SYSTEM_SYSRULES_fromJson_v1\"(\n        #\"SYSTEM_SYSRULES_toJson_v1\"(\n          value: a!map(\n            \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n            type: \"object\",\n            properties: local!fields,\n            required: reject(\n              fn!isnull,\n              index(\n                local!modelFields.key,\n                where(local!modelFields.required)\n              )\n            )\n          ),\n          removeNullOrEmptyFields: true\n        )\n      ),\n      if(\n        ri!returnJson,\n        prettyprintjson(#\"SYSTEM_SYSRULES_toJson_v1\"(local!map)),\n        local!map\n      )\n    ),\n    null\n  )\n)"
    },
    "_a-0000eec9-5676-8000-9c92-011c48011c48_179352": {
      "name": "AIA_MTR_ConfidenceThresholdEnabled",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000eea3-15ee-8000-9bd4-011c48011c48_137447": {
      "name": "AIA_MTR_ModelVersionConfigureSampling",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_31153": {
      "name": "AIA_AiReviewPrompt",
      "type": "Expression Rule",
      "sail_code": "=a!localVariables(\n  local!extractedData: ri!json, /* Should I remove the spans? */\na!defaultValue(\n  ri!ModelVersion[recordType!AIA Extraction Model Version.aiReviewRole],\n  rule!AIA_Extraction_DefaultAiReviwRole()\n) & \"\n\n------------\n\n\" & rule!AIA_AiReviewPromptFixed(\n  ModelVersion: ri!ModelVersion\n) & \na!defaultValue(\n  ri!ModelVersion[recordType!AIA Extraction Model Version.aiReviewInstructions],\n  \"\"\n) & \"\n\n[EXTRACTED DATA]\n\" & local!extractedData\n)"
    },
    "_a-0000ec5c-9eda-8000-9bec-011c48011c48_117023": {
      "name": "AIA_Extraction_GetModelVersionById",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_queryRecordByIdentifier\"(\n  recordType: recordType!AIA Extraction Model Version,\n  fields: {\n    rule!AIA_EXTRACTION_MODEL_VERSION_FIELDS()\n  },\n  relatedRecordData: {\n    #\"SYSTEM_SYSRULES_relatedRecordData\"(\n      relationship: recordType!AIA Extraction Model Version.fields,\n      sort: #\"SYSTEM_SYSRULES_sortInfo\"(\n        field: recordType!AIA Extraction Model Version Field.order,\n        ascending: true\n      )\n    ),\n    #\"SYSTEM_SYSRULES_relatedRecordData\"(\n      relationship: recordType!AIA Extraction Model Version.fields,\n      sort: #\"SYSTEM_SYSRULES_sortInfo\"(\n        field: recordType!AIA Extraction Model Version Field.order,\n        ascending: true\n      )\n    )\n  },\n  identifier: ri!identifier\n)"
    },
    "_a-0000eeca-c121-8000-9cab-011c48011c48_181995": {
      "name": "AIA_MTR_ExtractionModelVersionRestore",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ecf1-11b9-8000-9c4e-011c48011c48_203145": {
      "name": "AIA_EXTRACTION_MODEL_VERSION_FIELDS",
      "type": "Expression Rule",
      "sail_code": "{\n  /* Base */\n  recordType!AIA Extraction Model Version.status,\n  recordType!AIA Extraction Model Version.updates,\n  recordType!AIA Extraction Model Version.role,\n  recordType!AIA Extraction Model Version.instructions,\n  recordType!AIA Extraction Model Version.modelId,\n  recordType!AIA Extraction Model Version.versionId,\n  recordType!AIA Extraction Model Version.llm,\n  recordType!AIA Extraction Model Version.useAiReview,\n  recordType!AIA Extraction Model Version.aiReviewLlm,\n  recordType!AIA Extraction Model Version.aiReviewRole,\n  recordType!AIA Extraction Model Version.aiReviewInstructions,\n  recordType!AIA Extraction Model Version.useConfidence,\n  recordType!AIA Extraction Model Version.confidenceThreshold,\n  recordType!AIA Extraction Model Version.useSampling,\n  recordType!AIA Extraction Model Version.samplingRate,\n  recordType!AIA Extraction Model Version.instanceCount,\n  /* Fields */\n  recordType!AIA Extraction Model Version.fields.sectionId,\n  recordType!AIA Extraction Model Version.fields.section,\n  recordType!AIA Extraction Model Version.fields.order,\n  recordType!AIA Extraction Model Version.fields.key,\n  recordType!AIA Extraction Model Version.fields.label,\n  recordType!AIA Extraction Model Version.fields.type,\n  recordType!AIA Extraction Model Version.fields.isMultiple,\n  recordType!AIA Extraction Model Version.fields.description,\n  recordType!AIA Extraction Model Version.fields.instructions,\n  recordType!AIA Extraction Model Version.fields.extractionType,\n  recordType!AIA Extraction Model Version.fields.optionRule,\n  recordType!AIA Extraction Model Version.fields.validationRule,\n  recordType!AIA Extraction Model Version.fields.extractionRule,\n  recordType!AIA Extraction Model Version.fields.postProcessRule,\n  recordType!AIA Extraction Model Version.fields.required,\n  recordType!AIA Extraction Model Version.fields.useVision,\n  recordType!AIA Extraction Model Version.fields.isHidden,\n  recordType!AIA Extraction Model Version.fields.isNotTracked,\n  recordType!AIA Extraction Model Version.fields.useAiReview,\n  /* Columns */\n  recordType!AIA Extraction Model Version.fields.columns.order,\n  recordType!AIA Extraction Model Version.fields.columns.key,\n  recordType!AIA Extraction Model Version.fields.columns.label,\n  recordType!AIA Extraction Model Version.fields.columns.type,\n  recordType!AIA Extraction Model Version.fields.columns.isMultiple,\n  recordType!AIA Extraction Model Version.fields.columns.isHidden,\n  recordType!AIA Extraction Model Version.fields.columns.isNotTracked,\n  recordType!AIA Extraction Model Version.fields.columns.description,\n  recordType!AIA Extraction Model Version.fields.columns.instructions,\n  recordType!AIA Extraction Model Version.fields.columns.extractionType,\n  recordType!AIA Extraction Model Version.fields.columns.optionRule,\n  recordType!AIA Extraction Model Version.fields.columns.validationRule,\n  recordType!AIA Extraction Model Version.fields.columns.extractionRule,\n  recordType!AIA Extraction Model Version.fields.columns.postProcessRule,\n  recordType!AIA Extraction Model Version.fields.columns.required,\n  /* Examples */\n  recordType!AIA Extraction Model Version.examples,\n  /* Sections */\n  recordType!AIA Extraction Model Version.sections.name,\n  recordType!AIA Extraction Model Version.sections.description,\n  recordType!AIA Extraction Model Version.sections.rule,\n  /* Validation Rules */\n  recordType!AIA Extraction Model Version.validationRules.name,\n  recordType!AIA Extraction Model Version.validationRules.message,\n  recordType!AIA Extraction Model Version.validationRules.severity,\n  recordType!AIA Extraction Model Version.validationRules.validations,\n  /* Extraction Model */\n  recordType!AIA Extraction Model Version.extractionModel,\n}"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_184766": {
      "name": "AIA_PLG_WriteFile",
      "type": "Expression Rule",
      "sail_code": "with(\n  local!result: writefile(\n    ri!content,\n    ri!name,\n    ri!extension,\n    ri!folder,\n    ri!description\n  ),\n  if(\n    local!result.success,\n    local!result,\n    fn!error(local!result.error)\n  )\n)"
    },
    "0002ee63-0920-8000-fada-7f0000014e7a": {
      "name": "AIA Extraction Instance AI Review",
      "type": "Process Model",
      "sail_code": "// Output: ?\npv!ExtractionInstance[recordType!AIA Extraction Instance.documentId]\n\n// Output: ?\nrule!AIA_Extraction_AiReviewMaxPages(\n  ExtractionInstance: pv!ExtractionInstance\n)\n\n// Input: ?\n=pv!ExtractionInstance\n\n// Input: ?\nrule!AIA_CreateMaxPageValidation(\n  ExtractionInstance: pv!ExtractionInstance,\n  feature: cons!AIA_FEATURE_AI_REVIEW,\n  maxPages: pv!maxPages\n)\n\n// Input: ?\nrule!AIA_AiReviewLlmInput(\n  ExtractionInstance: pv!ExtractionInstance,\n  document: pv!document\n)\n\n// Input: ?\ncons!AIA_INPUT_TYPE_DOC\n\n// Input: ?\n=pv!ExtractionInstance[recordType!AIA Extraction Instance.id]\n\n// Input: ?\ncons!AIA_MODEL_TYPE_VALUES[1]\n\n// Input: ?\n=rule!AIA_AiReviewModel(\n  ExtractionInstance: pv!ExtractionInstance\n)\n\n// Input: ?\n=rule!AIA_AiReviewMode(\n  ExtractionInstance: pv!ExtractionInstance\n)\n\n// Input: ?\n#\"urn:appian:translation-string:v1:a67c9f85-f682-4191-bed6-c4912e7d88b4\"\n\n// Input: ?\n=rule!AIA_AiReviewPrompt(\n  ModelVersion: pv!ModelVersion,\n  json: readdocumentcontent(pv!ExtractionInstance[recordType!AIA Extraction Instance.responseDocumentId])\n)\n\n// Output: ?\nrule!AIA_CalculateReviewValidations(\n  json: ac!ProcessInfo.pv.responseJson,\n  ExtractionInstance: pv!ExtractionInstance,\n  ModelVersion: pv!ModelVersion\n)\n\n// Output: ?\nrule!AIA_Extraction_AddTokens(ExtractionInstance: pv!ExtractionInstance, inputTokens: ac!ProcessInfo.pv.inputTokens, outputTokens: ac!ProcessInfo.pv.outputTokens)\n\n// Input: ?\n={pv!validations}\n\n// Input: ?\n={recordType!AIA Instance Validation Error}\n\n// Input: ?\n=rule!AIA_LogMetric( name: cons!AIA_MTR_AI_REVIEW_INSTANCE)\n\n// Input: ?\n=#\"SYSTEM_SYSRULES_forEach\"( pv!validations, rule!AIA_LogMetric(name: cons!AIA_MTR_AI_REVIEW_FIELD))\n\n// Input: ?\n=document(pv!ExtractionInstance[recordType!AIA Extraction Instance.documentId], \"name\") & \"_1-20\"\n\n// Input: ?\n=pv!ExtractionInstance[recordType!AIA Extraction Instance.documentId]\n\n// Input: ?\n=pv!maxPages\n\n// Output: ?\nAC!NewDocumentCreated"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180874": {
      "name": "AIA_MTR_ClassificationInstanceReconciled",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ecf1-11b9-8000-9c4e-011c48011c48_199422": {
      "name": "AIA_Test_GetLatestExtractionInstanceWithFields",
      "type": "Expression Rule",
      "sail_code": "rule!AIA_Extraction_GetInstanceById(\n  identifier: #\"SYSTEM_SYSRULES_queryRecordType_v1\"(\n    recordType: recordType!AIA Extraction Instance,\n    pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n      startIndex: 1,\n      batchSize: 1,\n      sort: {\n        #\"SYSTEM_SYSRULES_sortInfo\"(\n          field: recordType!AIA Extraction Instance.id\n        )\n      }\n    )\n  ).data[recordType!AIA Extraction Instance.id],\n  additionalFields: {\n    recordType!AIA Extraction Instance.inputDocumentId,\n    recordType!AIA Extraction Instance.documentFolderId,\n    recordType!AIA Extraction Instance.modelVersion,\n    recordType!AIA Extraction Instance.modelVersion.confidenceThreshold,\n    recordType!AIA Extraction Instance.modelVersion,\n    recordType!AIA Extraction Instance.modelVersion,\n  }\n)"
    },
    "_a-0000ed74-17c4-8000-9c8d-011c48011c48_403026": {
      "name": "SHRD_CleanForFilename",
      "type": "Expression Rule",
      "sail_code": "stripwith(substitute(\n  substitute(\n    left(ri!input, 25),\n    char(10),\n    \" \"\n  ),\n  char(13),\n  \"\"\n), \"\\/;:\"\"|?'><*]\"),"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_180867": {
      "name": "AIA_MTR_ExtractionInstanceReconciled",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92474": {
      "name": "AIA_MTR_ClassificationInstanceError",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ec2d-5396-8000-9bdc-011c48011c48_40839": {
      "name": "AIA_Test_GetLatestExtractionInstance",
      "type": "Expression Rule",
      "sail_code": "rule!AIA_Extraction_GetInstanceById(\n  identifier: #\"SYSTEM_SYSRULES_queryRecordType_v3\"(\n    recordType: recordType!AIA Extraction Instance,\n    pagingInfo: #\"SYSTEM_SYSRULES_pagingInfo\"(\n      startIndex: 1,\n      batchSize: 1,\n      sort: {\n        #\"SYSTEM_SYSRULES_sortInfo\"(\n          field: recordType!AIA Extraction Instance.id\n        )\n      }\n    )\n  ).data[recordType!AIA Extraction Instance.id],\n  additionalFields: {\n    recordType!AIA Extraction Instance.instanceUuid,\n    recordType!AIA Extraction Instance.modelVersion.versionId,\n    recordType!AIA Extraction Instance.modelVersion.modelId,\n    recordType!AIA Extraction Instance.modelVersion.uuid,\n    recordType!AIA Extraction Instance.modelVersion.extractionModel.key,\n    recordType!AIA Extraction Instance.documentFolderId,\n    recordType!AIA Extraction Instance.fieldCount,\n    recordType!AIA Extraction Instance.sections,\n    recordType!AIA Extraction Instance.boundingBoxes,\n    recordType!AIA Extraction Instance.responseDocumentId,\n    recordType!AIA Extraction Instance.sourceDocumentId\n  }\n)"
    },
    "_a-0000ec44-cb49-8000-9be6-011c48011c48_79495": {
      "name": "AIA_Extraction_GetFieldOptions",
      "type": "Expression Rule",
      "sail_code": "if(\n  a!isNotNullOrEmpty(\n    ri!ModelVersionField[recordType!AIA Extraction Model Version Field.optionRule]\n  ),\n  a!localVariables(\n    local!optionsRule: a!refreshVariable(\n      refreshAlways: true,\n      value: getrulereferencebyname(\n        ri!ModelVersionField[recordType!AIA Extraction Model Version Field.optionRule]\n      )\n    ),\n    a!map(options: local!optionsRule())\n  ),\n  null\n)"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92481": {
      "name": "AIA_MTR_ExtractionInstanceExtractedWithErrors",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_34526": {
      "name": "AIA_CalculateReviewValidations",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!judgeFields: filter(\n    rule!AIA_Extraction_DisplayPromptField(field: _, mode: cons!AIA_SCHEMA_MODE_AI_REVIEW),\n    ri!ModelVersion[recordType!AIA Extraction Model Version.fields]\n  ),\n  local!judgeMap: rule!AIA_ExtractJson(\n    json: ri!json,\n    returnList: false\n  ),\n  if(\n    a!isNullOrEmpty(local!judgeMap),\n    null,\n    reject(\n      fn!isnull,\n      #\"SYSTEM_SYSRULES_forEach\"(\n        local!judgeFields,\n        a!localVariables(\n          local!judgedField: index(local!judgeMap, fv!item[recordType!AIA Extraction Model Version Field.key], false),\n          local!isCorrect: or(\n            index(local!judgedField, \"isCorrect\", false),\n            a!isNullOrEmpty(local!judgedField)\n          ),\n          if(\n            local!isCorrect,\n            null,\n            recordType!AIA Instance Validation Error(\n              recordType!AIA Instance Validation Error.instanceId: ri!ExtractionInstance[recordType!AIA Extraction Instance.id], \n              recordType!AIA Instance Validation Error.instanceType: cons!AIA_MODEL_TYPE_VALUES[1],\n              recordType!AIA Instance Validation Error.typeId: cons!AIA_VALIDATION_TYPE_ID_AI_REVIEW,\n              recordType!AIA Instance Validation Error.instanceFieldId: displayvalue(\n                fv!item[recordType!AIA Extraction Model Version Field.fieldId],\n                ri!ExtractionInstance[recordType!AIA Extraction Instance.fields.modelVersionFieldId],\n                ri!ExtractionInstance[recordType!AIA Extraction Instance.fields.id],\n                null\n              ),\n              recordType!AIA Instance Validation Error.message: rule!AIA_ToJson(\n                data: a!match(\n                  value: fv!item,\n                  /* Basic Field */\n                  whenTrue: and(\n                    not(a!defaultValue(fv!item[recordType!AIA Extraction Model Version Field.isMultiple], false)),\n                    fv!item[recordType!AIA Extraction Model Version Field.type] <> cons!AIA_EXTRACTION_FIELD_TYPE_TABLE\n                  ),\n                  /* List Field */\n                  whenTrue: and(\n                    a!defaultValue(fv!item[recordType!AIA Extraction Model Version Field.isMultiple], false),\n                    fv!item[recordType!AIA Extraction Model Version Field.type] <> cons!AIA_EXTRACTION_FIELD_TYPE_TABLE\n                  ),\n                  then: a!map(\n                    suggestedValue: index(local!judgedField, \"suggestedValue\", \"\"),\n                    reasoning: index(local!judgedField, \"reasoning\", #\"urn:appian:translation-string:v1:cb45d2b6-1821-451b-9ada-9973f38ee0d3\")\n                  ),\n                  /* Table Field */\n                  whenTrue: fv!item[recordType!AIA Extraction Model Version Field.type] = cons!AIA_EXTRACTION_FIELD_TYPE_TABLE,\n                  then: a!map(\n                    reasoning: index(local!judgedField, \"reasoning\", #\"urn:appian:translation-string:v1:cb45d2b6-1821-451b-9ada-9973f38ee0d3\")\n                  ),\n                  default: null\n                )\n              ),\n              recordType!AIA Instance Validation Error.messageDocId: if(\n                fv!item[recordType!AIA Extraction Model Version Field.type] = cons!AIA_EXTRACTION_FIELD_TYPE_TABLE,\n                rule!AIA_PLG_WriteFile(\n                  content: rule!AIA_ToJson(data: index(local!judgedField, \"suggestedValue\", \"null\")),\n                  name: rule!SHRD_CleanForFilename(\n                    input: ri!ExtractionInstance[recordType!AIA Extraction Instance.id] & \"_\" & fv!item[recordType!AIA Extraction Model Version Field.key] \n                  ),\n                  extension: \"json\",\n                  folder: cons!AIA_FOLDER_CLEANUP_DOCS,\n                  description: \"suggested table\"\n                ).document,\n                null\n              ),\n              recordType!AIA Instance Validation Error.severity: cons!AIA_AI_REVIEW_SEVERITY\n            )\n          )\n        )\n      )\n    )\n  )\n)"
    },
    "_a-0000ed16-a792-8000-9c64-011c48011c48_274759": {
      "name": "AIA_ToJson",
      "type": "Expression Rule",
      "sail_code": "if(\n  a!isNullOrEmpty(ri!data),\n  \"null\",\n  #\"SYSTEM_SYSRULES_toJson_v1\"(ri!data)\n)"
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_182518": {
      "name": "AIA_IsDocumentExtension",
      "type": "Expression Rule",
      "sail_code": "and(\n  a!isNotNullOrEmpty(ri!document),\n  contains(\n    lower(ri!extensions),\n    lower(document(\n      ri!document,\n      \"extension\"\n    ))\n  )\n)"
    },
    "_a-0000ef55-14e0-8000-a041-011c48011c48_505670": {
      "name": "AIA_MTR_MultipleOutputsClassificationInstanceReconciled",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ecea-6c5f-8000-9c4b-011c48011c48_190177": {
      "name": "AIA_Extraction_DisplayPromptField",
      "type": "Expression Rule",
      "sail_code": "a!match(\n  value: ri!mode,\n  whenTrue: a!isNullOrEmpty(ri!field[recordType!AIA Extraction Model Version Field.key]),\n  then: false,\n  equals: cons!AIA_SCHEMA_MODE_AI_REVIEW,\n  then: a!defaultValue(ri!field[recordType!AIA Extraction Model Version Field.useAiReview], false) = true,\n  equals: cons!AIA_PROMPT_MODE_CALCULATED,\n  then: or(\n    ri!field[recordType!AIA Extraction Model Version Field.extractionType] = cons!AIA_EXTRACTION_TYPES[4],\n    and(\n      ri!field[recordType!AIA Extraction Model Version Field.type] = cons!AIA_EXTRACTION_FIELD_TYPE_TABLE,\n      contains(\n        touniformstring(\n          ri!field[recordType!AIA Extraction Model Version Field.columns.extractionType]\n        ),\n        cons!AIA_EXTRACTION_TYPES[4]\n      )\n    )\n  ),\n  default: and(\n    /* Filter out field by section */\n    or(\n      and(\n        a!isNullOrEmpty(ri!sectionFilter),\n        a!isNullOrEmpty(ri!sectionId)\n      ),\n      and(\n        a!isNotNullOrEmpty(ri!sectionFilter),\n        a!isNotNullOrEmpty(\n          ri!field[recordType!AIA Extraction Model Version Field.section]\n        ),\n        ri!field[recordType!AIA Extraction Model Version Field.section] = ri!sectionFilter\n      ),\n      or(\n        and(\n          a!isNotNullOrEmpty(ri!sectionId),\n          a!isNotNullOrEmpty(\n            ri!field[recordType!AIA Extraction Model Version Field.sectionId]\n          ),\n          ri!field[recordType!AIA Extraction Model Version Field.sectionId] = ri!sectionId\n        ),\n        and(\n          a!isNotNullOrEmpty(ri!sectionId),\n          a!isNullOrEmpty(\n            ri!field[recordType!AIA Extraction Model Version Field.sectionId]\n          ),\n          ri!sectionId = - 1\n        )\n      )\n    ),\n    /* Filter out field by extraction type - Generative AI */\n    or(\n      ri!field[recordType!AIA Extraction Model Version Field.extractionType] = cons!AIA_EXTRACTION_TYPES[1],\n      a!isNullOrEmpty(\n        ri!field[recordType!AIA Extraction Model Version Field.extractionType]\n      )\n    ),\n    /* Filter out field by operation type */\n    or(\n      /* Filter out field by operation type - Generative AI - Text */\n      and(\n        or(\n          a!isNullOrEmpty(ri!operation),\n          ri!operation = cons!AIA_PROMPT_OPERATION_MODE_TEXT\n        ),\n        or(\n          a!isNullOrEmpty(ri!field[recordType!AIA Extraction Model Version Field.useVision]),\n          ri!field[recordType!AIA Extraction Model Version Field.useVision] = false,\n        )\n      ),\n      /* Filter out field by operation type - Generative AI - Vision */\n      and(\n        ri!operation = cons!AIA_PROMPT_OPERATION_MODE_MULTIMODAL,\n        or(\n          and(\n            a!isNotNullOrEmpty(ri!field[recordType!AIA Extraction Model Version Field.useVision]),\n            ri!field[recordType!AIA Extraction Model Version Field.useVision] = true\n          ),\n          and(\n            a!isNotNullOrEmpty(ri!parentField[recordType!AIA Extraction Model Version Field.useVision]),\n            ri!parentField[recordType!AIA Extraction Model Version Field.useVision] = true\n          )\n        )\n      )\n    )\n  )\n)"
    },
    "_a-0000ef55-14e0-8000-a041-011c48011c48_505575": {
      "name": "AIA_MTR_MultipleOutputsClassificationModelVersionCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ef46-744c-8000-9fed-011c48011c48_483943": {
      "name": "AIA_MTR_ModelTestSuiteCreated",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_90047": {
      "name": "AIA_CreateValidationErrorMessage",
      "type": "Expression Rule",
      "sail_code": "#\"SYSTEM_SYSRULES_toJson_v1\"(\n  a!map(\n    type: ri!type,\n    error: ri!error\n  )\n)"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_80937": {
      "name": "AIA_Extraction_AiReviewMaxPages",
      "type": "Expression Rule",
      "sail_code": "if(\n  rule!AIA_AiReviewMode(\n    ExtractionInstance: ri!ExtractionInstance\n  ) = cons!AIA_PROMPT_OPERATION_MODE_MULTIMODAL,\n  cons!AIA_VISION_PAGE_MAX,\n  cons!AIA_TEXT_PAGE_MAX\n)"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92571": {
      "name": "AIA_MTR_ExtractionInstanceAiReview",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000ee66-4fc0-8000-9baa-011c48011c48_43003": {
      "name": "AIA_ENUM_FieldSchemas",
      "type": "Expression Rule",
      "sail_code": "{\n  a!map(\n    name: cons!AIA_SCHEMA_MODE_PLAIN,\n    fields: {}\n  ),\n  a!map(\n    name: cons!AIA_SCHEMA_MODE_SPAN,\n    fields: {\n      a!map(\n        key: \"value\",\n        useFormat: true\n      ),\n      a!map(\n        key: \"spanId\",\n        required: false,\n        type: \"string\"\n      )\n    }\n  ),\n  a!map(\n    name: cons!AIA_PROMPT_MODE_CALCULATED,\n    fields: {\n      a!map(\n        key: \"value\",\n        useFormat: true\n      ),\n      a!map(\n        key: \"spanId\",\n        description: \"spanIds from all of the values that were used to derive the result. Return null if the values did not have spanId.\",\n        required: false,\n        type: \"string\"\n      ),\n      a!map(\n        key: \"reasoning\",\n        required: true,\n        type: \"string\"\n      )\n    }\n  ),\n  a!map(\n    name: cons!AIA_SCHEMA_MODE_AI_REVIEW,\n    fields: {\n      a!map(\n        key: \"extractedValue\",\n        required: false,\n        useFormat: true\n      ),\n      a!map(\n        key: \"suggestedValue\",\n        required: false,\n        useFormat: true\n      ),\n      a!map(\n        key: \"isCorrect\",\n        required: true,\n        type: \"boolean\"\n      ),\n      a!map(\n        key: \"reasoning\",\n        required: true,\n        type: \"string\"\n      )\n    }\n  )\n}"
    },
    "_a-0000ee6e-3b90-8000-9bac-011c48011c48_76653": {
      "name": "AIA_CreateValidation",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!isExtraction: rule!AIA_IsExtractionInstance(\n    instance: ri!Instance\n  ),\n  recordType!AIA Instance Validation Error(\n    recordType!AIA Instance Validation Error.instanceId: a!defaultValue(\n      ri!instanceId,\n      if(\n        local!isExtraction,\n        ri!Instance[recordType!AIA Extraction Instance.id],\n        ri!Instance[recordType!AIA Classification Instance.id]\n      )\n    ),\n    recordType!AIA Instance Validation Error.instanceType: a!defaultValue(\n      ri!instanceType,\n      if(\n        local!isExtraction,\n        cons!AIA_MODEL_TYPE_VALUES[1],\n        cons!AIA_MODEL_TYPE_VALUES[2]\n      )\n    ),\n    recordType!AIA Instance Validation Error.typeId: ri!typeId,\n    recordType!AIA Instance Validation Error.message: ri!message,\n    recordType!AIA Instance Validation Error.severity: ri!severity\n  )\n)"
    },
    "_a-0000ec2d-5396-8000-9bdc-011c48011c48_40909": {
      "name": "AIA_ExtractJson",
      "type": "Expression Rule",
      "sail_code": "a!localVariables(\n  local!firstTry: rule!AIA_ExtractJsonInner(\n    json: ri!json\n  ),\n  local!result: if(\n    a!isNotNullOrEmpty(local!firstTry),\n    local!firstTry,\n    a!localVariables(\n      local!secondTry: rule!AIA_ExtractJsonInner(\n        json: index(split(ri!json, \"Appian's private AI\"), 1, null),\n      ),\n      if(\n        a!isNotNullOrEmpty(local!secondTry),\n        local!secondTry,\n        a!localVariables(\n          local!thirdTry: rule!AIA_ExtractJsonInner(\n            json: index(split(ri!json, \"Appian's private AI\"), 2, null),\n          ),\n          if(\n            a!isNotNullOrEmpty(local!thirdTry),\n            local!thirdTry,\n            a!localVariables(\n              local!forthTry: rule!AIA_ExtractJsonInner(\n                json: index(split(ri!json, \"<output>\"), 1, null),\n              ),\n              if(\n                a!isNotNullOrEmpty(local!forthTry),\n                local!forthTry,\n                a!localVariables(\n                  local!fifthTry: rule!AIA_ExtractJsonInner(\n                    json: index(split(ri!json, \"</entities>\"), 1, null),\n                  ),\n                  local!fifthTry\n                )\n              )\n            )\n          )\n        )\n      )\n    )\n  ),\n  local!finalResult: if(\n    a!isNullOrEmpty(local!result),\n    null,\n    if(\n      a!defaultValue(ri!returnList, true),\n      local!result,\n      if(\n        rule!SHRD_IsList(local!result),\n        null,\n        local!result\n      )\n    )\n  ),\n  /* Handle scenario where the result comes back as properties of a $schema */\n  if(\n    or(\n      a!defaultValue(ri!returnList, true),\n      a!isNullOrEmpty(local!finalResult),\n      not(contains(\n        a!keys(local!finalResult),\n        \"$schema\"\n      ))\n    ),\n    local!finalResult,\n    local!finalResult.properties\n  )\n)"
    },
    "_a-0000ee78-c4db-8000-9bae-011c48011c48_92564": {
      "name": "AIA_MTR_ExtractionInstanceFieldAiReview",
      "type": "Expression Rule",
      "sail_code": "now()"
    },
    "_a-0000eed9-05f0-8000-9d10-011c48011c48_194771": {
      "name": "AIA_AiReviewDefaultModel",
      "type": "Expression Rule",
      "sail_code": "a!match(\n  value: rule!AIA_ENUM_LlmVersions(\n    includeVision: true,\n    returnOnlySupportedLlms: true\n  ),\n  default: rule!AIA_DefaultModel(),\n  whenTrue: contains(fv!value.value,cons!AIA_MODEL_SONNET_3_7_MULTIMODAL),\n  then: cons!AIA_MODEL_SONNET_3_7_MULTIMODAL,\n  whenTrue: contains(fv!value.value,cons!AIA_MODEL_SONNET_3_5_MULTIMODAL),\n  then: cons!AIA_MODEL_SONNET_3_5_MULTIMODAL\n)"
    },
    "_a-0000ee5d-151c-8000-9ba8-011c48011c48_38807": {
      "name": "AIA_AiReviewPromptFixed",
      "type": "Expression Rule",
      "sail_code": "\"## Task Overview\n1. Analyze the provided source document carefully\n2. Compare the extracted data (provided as JSON) against the source document field by field\n3. Determine if each extracted value is correct based on the source document\n4. Provide corrected values where necessary\n5. Output a structured JSON with verification results\n\n## Input\nA source document containing the original information\nJSON data previously extracted from the document\n\n## Output Format\n\nYour final output must be a single **JSON object** representing the original data, with each field enriched to include its location. The schema for an enriched field is as follows:\n\n```json\n\" & rule!AIA_Extraction_CreateJsonSchema(\n  ExtractionModelVersion: ri!ModelVersion,\n  mode: cons!AIA_SCHEMA_MODE_AI_REVIEW,\n  returnJson: true,\n  includeArrays: false\n) & \"\n```\n\n## Verification Guidelines\n* Be thorough and precise in your verification\n* Check exact values, not just approximate matches\n* For dates, verify the value against the ISO extracted date value.  **Do not return errors for dates not matching the correct format**\n* For monetary amounts, verify the exact number\n* For text fields, verify the exact spelling and formatting\n* For arrays, verify each item and its fields individually\n\n------------\n\n## Instructions\n\n1.  **Analyze the source document** provided.\n2.  **Review the extracted data** provided under `[EXTRACTED DATA]`.\n3.  **Only return fields referenced in the output format, make sure the output json matches the Output Format schema.\n4.  **For each field referenced in the output schema** (including nested fields within `arrays`), create an object containing three keys: `value`, `isCorrect`, and `reasoning`.\n    * `extractedValue`: This should be value original extracted from the document before the review.\n    * `suggestedValue`: This should be the **correct** value as found in the document. If the original extraction was wrong, you must provide the correct value here. If the **correct** value should be blank, return back \"\".\n    * `isCorrect`: A boolean (`true` or `false`). Set to `true` if the originally extracted data matches the document, and `false` otherwise.\n    * `reasoning`: A brief string explaining your decision. If correct, state where you found the information (e.g., \"\"The invoice number matches the value at the top right of the document.\"\"). If incorrect, explain the discrepancy (e.g., \"\"The extracted date was 2023-10-26, but the document clearly shows 2023-10-27.\"\").\n\""
    },
    "_a-0000ee21-294f-8000-9bb6-011c48011c48_176683": {
      "name": "AIA_Extraction_AddTokens",
      "type": "Expression Rule",
      "sail_code": "#\"urn:appian:function:v1:a:update\"(\n  data: ri!ExtractionInstance,\n  index: {\n    recordType!AIA Extraction Instance.inputTokens,\n    recordType!AIA Extraction Instance.outputTokens\n  },\n  value: {\n    a!defaultValue(\n      ri!ExtractionInstance[recordType!AIA Extraction Instance.inputTokens],\n      0\n    ) + a!defaultValue(ri!inputTokens, 0),\n    a!defaultValue(\n      ri!ExtractionInstance[recordType!AIA Extraction Instance.outputTokens],\n      0\n    ) + a!defaultValue(ri!outputTokens, 0)\n  }\n)"
    }
  }
}